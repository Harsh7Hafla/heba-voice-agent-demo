(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();function QT(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var cv={exports:{}},cl={},uv={exports:{}},Q={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ho=Symbol.for("react.element"),YT=Symbol.for("react.portal"),XT=Symbol.for("react.fragment"),ZT=Symbol.for("react.strict_mode"),eC=Symbol.for("react.profiler"),tC=Symbol.for("react.provider"),nC=Symbol.for("react.context"),iC=Symbol.for("react.forward_ref"),rC=Symbol.for("react.suspense"),sC=Symbol.for("react.memo"),oC=Symbol.for("react.lazy"),Rf=Symbol.iterator;function aC(t){return t===null||typeof t!="object"?null:(t=Rf&&t[Rf]||t["@@iterator"],typeof t=="function"?t:null)}var dv={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},hv=Object.assign,fv={};function Br(t,e,n){this.props=t,this.context=e,this.refs=fv,this.updater=n||dv}Br.prototype.isReactComponent={};Br.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Br.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function pv(){}pv.prototype=Br.prototype;function Rd(t,e,n){this.props=t,this.context=e,this.refs=fv,this.updater=n||dv}var xd=Rd.prototype=new pv;xd.constructor=Rd;hv(xd,Br.prototype);xd.isPureReactComponent=!0;var xf=Array.isArray,mv=Object.prototype.hasOwnProperty,Id={current:null},gv={key:!0,ref:!0,__self:!0,__source:!0};function vv(t,e,n){var i,r={},s=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)mv.call(e,i)&&!gv.hasOwnProperty(i)&&(r[i]=e[i]);var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];r.children=l}if(t&&t.defaultProps)for(i in a=t.defaultProps,a)r[i]===void 0&&(r[i]=a[i]);return{$$typeof:ho,type:t,key:s,ref:o,props:r,_owner:Id.current}}function lC(t,e){return{$$typeof:ho,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Dd(t){return typeof t=="object"&&t!==null&&t.$$typeof===ho}function cC(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var If=/\/+/g;function Vl(t,e){return typeof t=="object"&&t!==null&&t.key!=null?cC(""+t.key):e.toString(36)}function Ko(t,e,n,i,r){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case ho:case YT:o=!0}}if(o)return o=t,r=r(o),t=i===""?"."+Vl(o,0):i,xf(r)?(n="",t!=null&&(n=t.replace(If,"$&/")+"/"),Ko(r,e,n,"",function(c){return c})):r!=null&&(Dd(r)&&(r=lC(r,n+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(If,"$&/")+"/")+t)),e.push(r)),1;if(o=0,i=i===""?".":i+":",xf(t))for(var a=0;a<t.length;a++){s=t[a];var l=i+Vl(s,a);o+=Ko(s,e,n,l,r)}else if(l=aC(t),typeof l=="function")for(t=l.call(t),a=0;!(s=t.next()).done;)s=s.value,l=i+Vl(s,a++),o+=Ko(s,e,n,l,r);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Co(t,e,n){if(t==null)return t;var i=[],r=0;return Ko(t,i,"","",function(s){return e.call(n,s,r++)}),i}function uC(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var nt={current:null},Ho={transition:null},dC={ReactCurrentDispatcher:nt,ReactCurrentBatchConfig:Ho,ReactCurrentOwner:Id};function yv(){throw Error("act(...) is not supported in production builds of React.")}Q.Children={map:Co,forEach:function(t,e,n){Co(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Co(t,function(){e++}),e},toArray:function(t){return Co(t,function(e){return e})||[]},only:function(t){if(!Dd(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Q.Component=Br;Q.Fragment=XT;Q.Profiler=eC;Q.PureComponent=Rd;Q.StrictMode=ZT;Q.Suspense=rC;Q.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=dC;Q.act=yv;Q.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=hv({},t.props),r=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=Id.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)mv.call(e,l)&&!gv.hasOwnProperty(l)&&(i[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)i.children=n;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];i.children=a}return{$$typeof:ho,type:t.type,key:r,ref:s,props:i,_owner:o}};Q.createContext=function(t){return t={$$typeof:nC,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:tC,_context:t},t.Consumer=t};Q.createElement=vv;Q.createFactory=function(t){var e=vv.bind(null,t);return e.type=t,e};Q.createRef=function(){return{current:null}};Q.forwardRef=function(t){return{$$typeof:iC,render:t}};Q.isValidElement=Dd;Q.lazy=function(t){return{$$typeof:oC,_payload:{_status:-1,_result:t},_init:uC}};Q.memo=function(t,e){return{$$typeof:sC,type:t,compare:e===void 0?null:e}};Q.startTransition=function(t){var e=Ho.transition;Ho.transition={};try{t()}finally{Ho.transition=e}};Q.unstable_act=yv;Q.useCallback=function(t,e){return nt.current.useCallback(t,e)};Q.useContext=function(t){return nt.current.useContext(t)};Q.useDebugValue=function(){};Q.useDeferredValue=function(t){return nt.current.useDeferredValue(t)};Q.useEffect=function(t,e){return nt.current.useEffect(t,e)};Q.useId=function(){return nt.current.useId()};Q.useImperativeHandle=function(t,e,n){return nt.current.useImperativeHandle(t,e,n)};Q.useInsertionEffect=function(t,e){return nt.current.useInsertionEffect(t,e)};Q.useLayoutEffect=function(t,e){return nt.current.useLayoutEffect(t,e)};Q.useMemo=function(t,e){return nt.current.useMemo(t,e)};Q.useReducer=function(t,e,n){return nt.current.useReducer(t,e,n)};Q.useRef=function(t){return nt.current.useRef(t)};Q.useState=function(t){return nt.current.useState(t)};Q.useSyncExternalStore=function(t,e,n){return nt.current.useSyncExternalStore(t,e,n)};Q.useTransition=function(){return nt.current.useTransition()};Q.version="18.3.1";uv.exports=Q;var V=uv.exports;const zr=QT(V);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hC=V,fC=Symbol.for("react.element"),pC=Symbol.for("react.fragment"),mC=Object.prototype.hasOwnProperty,gC=hC.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,vC={key:!0,ref:!0,__self:!0,__source:!0};function kv(t,e,n){var i,r={},s=null,o=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)mC.call(e,i)&&!vC.hasOwnProperty(i)&&(r[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:fC,type:t,key:s,ref:o,props:r,_owner:gC.current}}cl.Fragment=pC;cl.jsx=kv;cl.jsxs=kv;cv.exports=cl;var M=cv.exports,qc={},Sv={exports:{}},Tt={},Tv={exports:{}},Cv={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(U,q){var K=U.length;U.push(q);e:for(;0<K;){var le=K-1>>>1,ye=U[le];if(0<r(ye,q))U[le]=q,U[K]=ye,K=le;else break e}}function n(U){return U.length===0?null:U[0]}function i(U){if(U.length===0)return null;var q=U[0],K=U.pop();if(K!==q){U[0]=K;e:for(var le=0,ye=U.length,On=ye>>>1;le<On;){var dn=2*(le+1)-1,Wi=U[dn],Ot=dn+1,To=U[Ot];if(0>r(Wi,K))Ot<ye&&0>r(To,Wi)?(U[le]=To,U[Ot]=K,le=Ot):(U[le]=Wi,U[dn]=K,le=dn);else if(Ot<ye&&0>r(To,K))U[le]=To,U[Ot]=K,le=Ot;else break e}}return q}function r(U,q){var K=U.sortIndex-q.sortIndex;return K!==0?K:U.id-q.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,d=null,h=3,f=!1,v=!1,g=!1,y=typeof setTimeout=="function"?setTimeout:null,p=typeof clearTimeout=="function"?clearTimeout:null,m=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function k(U){for(var q=n(c);q!==null;){if(q.callback===null)i(c);else if(q.startTime<=U)i(c),q.sortIndex=q.expirationTime,e(l,q);else break;q=n(c)}}function S(U){if(g=!1,k(U),!v)if(n(l)!==null)v=!0,te(T);else{var q=n(c);q!==null&&ie(S,q.startTime-U)}}function T(U,q){v=!1,g&&(g=!1,p(E),E=-1),f=!0;var K=h;try{for(k(q),d=n(l);d!==null&&(!(d.expirationTime>q)||U&&!L());){var le=d.callback;if(typeof le=="function"){d.callback=null,h=d.priorityLevel;var ye=le(d.expirationTime<=q);q=t.unstable_now(),typeof ye=="function"?d.callback=ye:d===n(l)&&i(l),k(q)}else i(l);d=n(l)}if(d!==null)var On=!0;else{var dn=n(c);dn!==null&&ie(S,dn.startTime-q),On=!1}return On}finally{d=null,h=K,f=!1}}var b=!1,P=null,E=-1,I=5,_=-1;function L(){return!(t.unstable_now()-_<I)}function z(){if(P!==null){var U=t.unstable_now();_=U;var q=!0;try{q=P(!0,U)}finally{q?Y():(b=!1,P=null)}}else b=!1}var Y;if(typeof m=="function")Y=function(){m(z)};else if(typeof MessageChannel<"u"){var we=new MessageChannel,De=we.port2;we.port1.onmessage=z,Y=function(){De.postMessage(null)}}else Y=function(){y(z,0)};function te(U){P=U,b||(b=!0,Y())}function ie(U,q){E=y(function(){U(t.unstable_now())},q)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(U){U.callback=null},t.unstable_continueExecution=function(){v||f||(v=!0,te(T))},t.unstable_forceFrameRate=function(U){0>U||125<U?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<U?Math.floor(1e3/U):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(U){switch(h){case 1:case 2:case 3:var q=3;break;default:q=h}var K=h;h=q;try{return U()}finally{h=K}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(U,q){switch(U){case 1:case 2:case 3:case 4:case 5:break;default:U=3}var K=h;h=U;try{return q()}finally{h=K}},t.unstable_scheduleCallback=function(U,q,K){var le=t.unstable_now();switch(typeof K=="object"&&K!==null?(K=K.delay,K=typeof K=="number"&&0<K?le+K:le):K=le,U){case 1:var ye=-1;break;case 2:ye=250;break;case 5:ye=1073741823;break;case 4:ye=1e4;break;default:ye=5e3}return ye=K+ye,U={id:u++,callback:q,priorityLevel:U,startTime:K,expirationTime:ye,sortIndex:-1},K>le?(U.sortIndex=K,e(c,U),n(l)===null&&U===n(c)&&(g?(p(E),E=-1):g=!0,ie(S,K-le))):(U.sortIndex=ye,e(l,U),v||f||(v=!0,te(T))),U},t.unstable_shouldYield=L,t.unstable_wrapCallback=function(U){var q=h;return function(){var K=h;h=q;try{return U.apply(this,arguments)}finally{h=K}}}})(Cv);Tv.exports=Cv;var yC=Tv.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kC=V,kt=yC;function A(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var bv=new Set,Ns={};function ji(t,e){Rr(t,e),Rr(t+"Capture",e)}function Rr(t,e){for(Ns[t]=e,t=0;t<e.length;t++)bv.add(e[t])}var _n=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Kc=Object.prototype.hasOwnProperty,SC=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Df={},Mf={};function TC(t){return Kc.call(Mf,t)?!0:Kc.call(Df,t)?!1:SC.test(t)?Mf[t]=!0:(Df[t]=!0,!1)}function CC(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function bC(t,e,n,i){if(e===null||typeof e>"u"||CC(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function it(t,e,n,i,r,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var qe={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){qe[t]=new it(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];qe[e]=new it(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){qe[t]=new it(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){qe[t]=new it(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){qe[t]=new it(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){qe[t]=new it(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){qe[t]=new it(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){qe[t]=new it(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){qe[t]=new it(t,5,!1,t.toLowerCase(),null,!1,!1)});var Md=/[\-:]([a-z])/g;function Ad(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Md,Ad);qe[e]=new it(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Md,Ad);qe[e]=new it(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Md,Ad);qe[e]=new it(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){qe[t]=new it(t,1,!1,t.toLowerCase(),null,!1,!1)});qe.xlinkHref=new it("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){qe[t]=new it(t,1,!1,t.toLowerCase(),null,!0,!0)});function Od(t,e,n,i){var r=qe.hasOwnProperty(e)?qe[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(bC(e,n,r,i)&&(n=null),i||r===null?TC(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,i=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var An=kC.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,bo=Symbol.for("react.element"),Gi=Symbol.for("react.portal"),$i=Symbol.for("react.fragment"),Ld=Symbol.for("react.strict_mode"),Hc=Symbol.for("react.profiler"),wv=Symbol.for("react.provider"),Ev=Symbol.for("react.context"),Nd=Symbol.for("react.forward_ref"),Gc=Symbol.for("react.suspense"),$c=Symbol.for("react.suspense_list"),Fd=Symbol.for("react.memo"),Vn=Symbol.for("react.lazy"),Pv=Symbol.for("react.offscreen"),Af=Symbol.iterator;function Gr(t){return t===null||typeof t!="object"?null:(t=Af&&t[Af]||t["@@iterator"],typeof t=="function"?t:null)}var ve=Object.assign,Bl;function ls(t){if(Bl===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Bl=e&&e[1]||""}return`
`+Bl+t}var zl=!1;function Wl(t,e){if(!t||zl)return"";zl=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var i=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){i=c}t.call(e.prototype)}else{try{throw Error()}catch(c){i=c}t()}}catch(c){if(c&&i&&typeof c.stack=="string"){for(var r=c.stack.split(`
`),s=i.stack.split(`
`),o=r.length-1,a=s.length-1;1<=o&&0<=a&&r[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==s[a]){var l=`
`+r[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{zl=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?ls(t):""}function wC(t){switch(t.tag){case 5:return ls(t.type);case 16:return ls("Lazy");case 13:return ls("Suspense");case 19:return ls("SuspenseList");case 0:case 2:case 15:return t=Wl(t.type,!1),t;case 11:return t=Wl(t.type.render,!1),t;case 1:return t=Wl(t.type,!0),t;default:return""}}function Jc(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case $i:return"Fragment";case Gi:return"Portal";case Hc:return"Profiler";case Ld:return"StrictMode";case Gc:return"Suspense";case $c:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Ev:return(t.displayName||"Context")+".Consumer";case wv:return(t._context.displayName||"Context")+".Provider";case Nd:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Fd:return e=t.displayName||null,e!==null?e:Jc(t.type)||"Memo";case Vn:e=t._payload,t=t._init;try{return Jc(t(e))}catch{}}return null}function EC(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Jc(e);case 8:return e===Ld?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function si(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function _v(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function PC(t){var e=_v(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){i=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function wo(t){t._valueTracker||(t._valueTracker=PC(t))}function Rv(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=_v(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function ka(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Qc(t,e){var n=e.checked;return ve({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Of(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=si(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function xv(t,e){e=e.checked,e!=null&&Od(t,"checked",e,!1)}function Yc(t,e){xv(t,e);var n=si(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Xc(t,e.type,n):e.hasOwnProperty("defaultValue")&&Xc(t,e.type,si(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Lf(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Xc(t,e,n){(e!=="number"||ka(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var cs=Array.isArray;function fr(t,e,n,i){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&i&&(t[n].defaultSelected=!0)}else{for(n=""+si(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,i&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function Zc(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(A(91));return ve({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Nf(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(A(92));if(cs(n)){if(1<n.length)throw Error(A(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:si(n)}}function Iv(t,e){var n=si(e.value),i=si(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function Ff(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function Dv(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function eu(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?Dv(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Eo,Mv=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,i,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Eo=Eo||document.createElement("div"),Eo.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Eo.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Fs(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var vs={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},_C=["Webkit","ms","Moz","O"];Object.keys(vs).forEach(function(t){_C.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),vs[e]=vs[t]})});function Av(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||vs.hasOwnProperty(t)&&vs[t]?(""+e).trim():e+"px"}function Ov(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,r=Av(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,r):t[n]=r}}var RC=ve({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function tu(t,e){if(e){if(RC[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(A(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(A(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(A(61))}if(e.style!=null&&typeof e.style!="object")throw Error(A(62))}}function nu(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var iu=null;function Ud(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var ru=null,pr=null,mr=null;function Uf(t){if(t=mo(t)){if(typeof ru!="function")throw Error(A(280));var e=t.stateNode;e&&(e=pl(e),ru(t.stateNode,t.type,e))}}function Lv(t){pr?mr?mr.push(t):mr=[t]:pr=t}function Nv(){if(pr){var t=pr,e=mr;if(mr=pr=null,Uf(t),e)for(t=0;t<e.length;t++)Uf(e[t])}}function Fv(t,e){return t(e)}function Uv(){}var ql=!1;function jv(t,e,n){if(ql)return t(e,n);ql=!0;try{return Fv(t,e,n)}finally{ql=!1,(pr!==null||mr!==null)&&(Uv(),Nv())}}function Us(t,e){var n=t.stateNode;if(n===null)return null;var i=pl(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(A(231,e,typeof n));return n}var su=!1;if(_n)try{var $r={};Object.defineProperty($r,"passive",{get:function(){su=!0}}),window.addEventListener("test",$r,$r),window.removeEventListener("test",$r,$r)}catch{su=!1}function xC(t,e,n,i,r,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(n,c)}catch(u){this.onError(u)}}var ys=!1,Sa=null,Ta=!1,ou=null,IC={onError:function(t){ys=!0,Sa=t}};function DC(t,e,n,i,r,s,o,a,l){ys=!1,Sa=null,xC.apply(IC,arguments)}function MC(t,e,n,i,r,s,o,a,l){if(DC.apply(this,arguments),ys){if(ys){var c=Sa;ys=!1,Sa=null}else throw Error(A(198));Ta||(Ta=!0,ou=c)}}function Vi(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function Vv(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function jf(t){if(Vi(t)!==t)throw Error(A(188))}function AC(t){var e=t.alternate;if(!e){if(e=Vi(t),e===null)throw Error(A(188));return e!==t?null:t}for(var n=t,i=e;;){var r=n.return;if(r===null)break;var s=r.alternate;if(s===null){if(i=r.return,i!==null){n=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===n)return jf(r),t;if(s===i)return jf(r),e;s=s.sibling}throw Error(A(188))}if(n.return!==i.return)n=r,i=s;else{for(var o=!1,a=r.child;a;){if(a===n){o=!0,n=r,i=s;break}if(a===i){o=!0,i=r,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,i=r;break}if(a===i){o=!0,i=s,n=r;break}a=a.sibling}if(!o)throw Error(A(189))}}if(n.alternate!==i)throw Error(A(190))}if(n.tag!==3)throw Error(A(188));return n.stateNode.current===n?t:e}function Bv(t){return t=AC(t),t!==null?zv(t):null}function zv(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=zv(t);if(e!==null)return e;t=t.sibling}return null}var Wv=kt.unstable_scheduleCallback,Vf=kt.unstable_cancelCallback,OC=kt.unstable_shouldYield,LC=kt.unstable_requestPaint,_e=kt.unstable_now,NC=kt.unstable_getCurrentPriorityLevel,jd=kt.unstable_ImmediatePriority,qv=kt.unstable_UserBlockingPriority,Ca=kt.unstable_NormalPriority,FC=kt.unstable_LowPriority,Kv=kt.unstable_IdlePriority,ul=null,tn=null;function UC(t){if(tn&&typeof tn.onCommitFiberRoot=="function")try{tn.onCommitFiberRoot(ul,t,void 0,(t.current.flags&128)===128)}catch{}}var Ht=Math.clz32?Math.clz32:BC,jC=Math.log,VC=Math.LN2;function BC(t){return t>>>=0,t===0?32:31-(jC(t)/VC|0)|0}var Po=64,_o=4194304;function us(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function ba(t,e){var n=t.pendingLanes;if(n===0)return 0;var i=0,r=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~r;a!==0?i=us(a):(s&=o,s!==0&&(i=us(s)))}else o=n&~r,o!==0?i=us(o):s!==0&&(i=us(s));if(i===0)return 0;if(e!==0&&e!==i&&!(e&r)&&(r=i&-i,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if(i&4&&(i|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-Ht(e),r=1<<n,i|=t[n],e&=~r;return i}function zC(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function WC(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,r=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-Ht(s),a=1<<o,l=r[o];l===-1?(!(a&n)||a&i)&&(r[o]=zC(a,e)):l<=e&&(t.expiredLanes|=a),s&=~a}}function au(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Hv(){var t=Po;return Po<<=1,!(Po&4194240)&&(Po=64),t}function Kl(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function fo(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Ht(e),t[e]=n}function qC(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-Ht(n),s=1<<r;e[r]=0,i[r]=-1,t[r]=-1,n&=~s}}function Vd(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-Ht(n),r=1<<i;r&e|t[i]&e&&(t[i]|=e),n&=~r}}var ne=0;function Gv(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var $v,Bd,Jv,Qv,Yv,lu=!1,Ro=[],$n=null,Jn=null,Qn=null,js=new Map,Vs=new Map,zn=[],KC="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Bf(t,e){switch(t){case"focusin":case"focusout":$n=null;break;case"dragenter":case"dragleave":Jn=null;break;case"mouseover":case"mouseout":Qn=null;break;case"pointerover":case"pointerout":js.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Vs.delete(e.pointerId)}}function Jr(t,e,n,i,r,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},e!==null&&(e=mo(e),e!==null&&Bd(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function HC(t,e,n,i,r){switch(e){case"focusin":return $n=Jr($n,t,e,n,i,r),!0;case"dragenter":return Jn=Jr(Jn,t,e,n,i,r),!0;case"mouseover":return Qn=Jr(Qn,t,e,n,i,r),!0;case"pointerover":var s=r.pointerId;return js.set(s,Jr(js.get(s)||null,t,e,n,i,r)),!0;case"gotpointercapture":return s=r.pointerId,Vs.set(s,Jr(Vs.get(s)||null,t,e,n,i,r)),!0}return!1}function Xv(t){var e=wi(t.target);if(e!==null){var n=Vi(e);if(n!==null){if(e=n.tag,e===13){if(e=Vv(n),e!==null){t.blockedOn=e,Yv(t.priority,function(){Jv(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Go(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=cu(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);iu=i,n.target.dispatchEvent(i),iu=null}else return e=mo(n),e!==null&&Bd(e),t.blockedOn=n,!1;e.shift()}return!0}function zf(t,e,n){Go(t)&&n.delete(e)}function GC(){lu=!1,$n!==null&&Go($n)&&($n=null),Jn!==null&&Go(Jn)&&(Jn=null),Qn!==null&&Go(Qn)&&(Qn=null),js.forEach(zf),Vs.forEach(zf)}function Qr(t,e){t.blockedOn===e&&(t.blockedOn=null,lu||(lu=!0,kt.unstable_scheduleCallback(kt.unstable_NormalPriority,GC)))}function Bs(t){function e(r){return Qr(r,t)}if(0<Ro.length){Qr(Ro[0],t);for(var n=1;n<Ro.length;n++){var i=Ro[n];i.blockedOn===t&&(i.blockedOn=null)}}for($n!==null&&Qr($n,t),Jn!==null&&Qr(Jn,t),Qn!==null&&Qr(Qn,t),js.forEach(e),Vs.forEach(e),n=0;n<zn.length;n++)i=zn[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<zn.length&&(n=zn[0],n.blockedOn===null);)Xv(n),n.blockedOn===null&&zn.shift()}var gr=An.ReactCurrentBatchConfig,wa=!0;function $C(t,e,n,i){var r=ne,s=gr.transition;gr.transition=null;try{ne=1,zd(t,e,n,i)}finally{ne=r,gr.transition=s}}function JC(t,e,n,i){var r=ne,s=gr.transition;gr.transition=null;try{ne=4,zd(t,e,n,i)}finally{ne=r,gr.transition=s}}function zd(t,e,n,i){if(wa){var r=cu(t,e,n,i);if(r===null)tc(t,e,i,Ea,n),Bf(t,i);else if(HC(r,t,e,n,i))i.stopPropagation();else if(Bf(t,i),e&4&&-1<KC.indexOf(t)){for(;r!==null;){var s=mo(r);if(s!==null&&$v(s),s=cu(t,e,n,i),s===null&&tc(t,e,i,Ea,n),s===r)break;r=s}r!==null&&i.stopPropagation()}else tc(t,e,i,null,n)}}var Ea=null;function cu(t,e,n,i){if(Ea=null,t=Ud(i),t=wi(t),t!==null)if(e=Vi(t),e===null)t=null;else if(n=e.tag,n===13){if(t=Vv(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Ea=t,null}function Zv(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(NC()){case jd:return 1;case qv:return 4;case Ca:case FC:return 16;case Kv:return 536870912;default:return 16}default:return 16}}var Kn=null,Wd=null,$o=null;function ey(){if($o)return $o;var t,e=Wd,n=e.length,i,r="value"in Kn?Kn.value:Kn.textContent,s=r.length;for(t=0;t<n&&e[t]===r[t];t++);var o=n-t;for(i=1;i<=o&&e[n-i]===r[s-i];i++);return $o=r.slice(t,1<i?1-i:void 0)}function Jo(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function xo(){return!0}function Wf(){return!1}function Ct(t){function e(n,i,r,s,o){this._reactName=n,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?xo:Wf,this.isPropagationStopped=Wf,this}return ve(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=xo)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=xo)},persist:function(){},isPersistent:xo}),e}var Wr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},qd=Ct(Wr),po=ve({},Wr,{view:0,detail:0}),QC=Ct(po),Hl,Gl,Yr,dl=ve({},po,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Kd,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Yr&&(Yr&&t.type==="mousemove"?(Hl=t.screenX-Yr.screenX,Gl=t.screenY-Yr.screenY):Gl=Hl=0,Yr=t),Hl)},movementY:function(t){return"movementY"in t?t.movementY:Gl}}),qf=Ct(dl),YC=ve({},dl,{dataTransfer:0}),XC=Ct(YC),ZC=ve({},po,{relatedTarget:0}),$l=Ct(ZC),eb=ve({},Wr,{animationName:0,elapsedTime:0,pseudoElement:0}),tb=Ct(eb),nb=ve({},Wr,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),ib=Ct(nb),rb=ve({},Wr,{data:0}),Kf=Ct(rb),sb={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ob={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ab={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function lb(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=ab[t])?!!e[t]:!1}function Kd(){return lb}var cb=ve({},po,{key:function(t){if(t.key){var e=sb[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Jo(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?ob[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Kd,charCode:function(t){return t.type==="keypress"?Jo(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Jo(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),ub=Ct(cb),db=ve({},dl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Hf=Ct(db),hb=ve({},po,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Kd}),fb=Ct(hb),pb=ve({},Wr,{propertyName:0,elapsedTime:0,pseudoElement:0}),mb=Ct(pb),gb=ve({},dl,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),vb=Ct(gb),yb=[9,13,27,32],Hd=_n&&"CompositionEvent"in window,ks=null;_n&&"documentMode"in document&&(ks=document.documentMode);var kb=_n&&"TextEvent"in window&&!ks,ty=_n&&(!Hd||ks&&8<ks&&11>=ks),Gf=" ",$f=!1;function ny(t,e){switch(t){case"keyup":return yb.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function iy(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Ji=!1;function Sb(t,e){switch(t){case"compositionend":return iy(e);case"keypress":return e.which!==32?null:($f=!0,Gf);case"textInput":return t=e.data,t===Gf&&$f?null:t;default:return null}}function Tb(t,e){if(Ji)return t==="compositionend"||!Hd&&ny(t,e)?(t=ey(),$o=Wd=Kn=null,Ji=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return ty&&e.locale!=="ko"?null:e.data;default:return null}}var Cb={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Jf(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!Cb[t.type]:e==="textarea"}function ry(t,e,n,i){Lv(i),e=Pa(e,"onChange"),0<e.length&&(n=new qd("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var Ss=null,zs=null;function bb(t){my(t,0)}function hl(t){var e=Xi(t);if(Rv(e))return t}function wb(t,e){if(t==="change")return e}var sy=!1;if(_n){var Jl;if(_n){var Ql="oninput"in document;if(!Ql){var Qf=document.createElement("div");Qf.setAttribute("oninput","return;"),Ql=typeof Qf.oninput=="function"}Jl=Ql}else Jl=!1;sy=Jl&&(!document.documentMode||9<document.documentMode)}function Yf(){Ss&&(Ss.detachEvent("onpropertychange",oy),zs=Ss=null)}function oy(t){if(t.propertyName==="value"&&hl(zs)){var e=[];ry(e,zs,t,Ud(t)),jv(bb,e)}}function Eb(t,e,n){t==="focusin"?(Yf(),Ss=e,zs=n,Ss.attachEvent("onpropertychange",oy)):t==="focusout"&&Yf()}function Pb(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return hl(zs)}function _b(t,e){if(t==="click")return hl(e)}function Rb(t,e){if(t==="input"||t==="change")return hl(e)}function xb(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var $t=typeof Object.is=="function"?Object.is:xb;function Ws(t,e){if($t(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!Kc.call(e,r)||!$t(t[r],e[r]))return!1}return!0}function Xf(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Zf(t,e){var n=Xf(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Xf(n)}}function ay(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?ay(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function ly(){for(var t=window,e=ka();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=ka(t.document)}return e}function Gd(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function Ib(t){var e=ly(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&ay(n.ownerDocument.documentElement,n)){if(i!==null&&Gd(n)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,s=Math.min(i.start,r);i=i.end===void 0?s:Math.min(i.end,r),!t.extend&&s>i&&(r=i,i=s,s=r),r=Zf(n,s);var o=Zf(n,i);r&&o&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),s>i?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var Db=_n&&"documentMode"in document&&11>=document.documentMode,Qi=null,uu=null,Ts=null,du=!1;function ep(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;du||Qi==null||Qi!==ka(i)||(i=Qi,"selectionStart"in i&&Gd(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Ts&&Ws(Ts,i)||(Ts=i,i=Pa(uu,"onSelect"),0<i.length&&(e=new qd("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=Qi)))}function Io(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Yi={animationend:Io("Animation","AnimationEnd"),animationiteration:Io("Animation","AnimationIteration"),animationstart:Io("Animation","AnimationStart"),transitionend:Io("Transition","TransitionEnd")},Yl={},cy={};_n&&(cy=document.createElement("div").style,"AnimationEvent"in window||(delete Yi.animationend.animation,delete Yi.animationiteration.animation,delete Yi.animationstart.animation),"TransitionEvent"in window||delete Yi.transitionend.transition);function fl(t){if(Yl[t])return Yl[t];if(!Yi[t])return t;var e=Yi[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in cy)return Yl[t]=e[n];return t}var uy=fl("animationend"),dy=fl("animationiteration"),hy=fl("animationstart"),fy=fl("transitionend"),py=new Map,tp="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function di(t,e){py.set(t,e),ji(e,[t])}for(var Xl=0;Xl<tp.length;Xl++){var Zl=tp[Xl],Mb=Zl.toLowerCase(),Ab=Zl[0].toUpperCase()+Zl.slice(1);di(Mb,"on"+Ab)}di(uy,"onAnimationEnd");di(dy,"onAnimationIteration");di(hy,"onAnimationStart");di("dblclick","onDoubleClick");di("focusin","onFocus");di("focusout","onBlur");di(fy,"onTransitionEnd");Rr("onMouseEnter",["mouseout","mouseover"]);Rr("onMouseLeave",["mouseout","mouseover"]);Rr("onPointerEnter",["pointerout","pointerover"]);Rr("onPointerLeave",["pointerout","pointerover"]);ji("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ji("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ji("onBeforeInput",["compositionend","keypress","textInput","paste"]);ji("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ji("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ji("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ds="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ob=new Set("cancel close invalid load scroll toggle".split(" ").concat(ds));function np(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,MC(i,e,void 0,t),t.currentTarget=null}function my(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],r=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&r.isPropagationStopped())break e;np(r,a,c),s=l}else for(o=0;o<i.length;o++){if(a=i[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&r.isPropagationStopped())break e;np(r,a,c),s=l}}}if(Ta)throw t=ou,Ta=!1,ou=null,t}function ce(t,e){var n=e[gu];n===void 0&&(n=e[gu]=new Set);var i=t+"__bubble";n.has(i)||(gy(e,t,2,!1),n.add(i))}function ec(t,e,n){var i=0;e&&(i|=4),gy(n,t,i,e)}var Do="_reactListening"+Math.random().toString(36).slice(2);function qs(t){if(!t[Do]){t[Do]=!0,bv.forEach(function(n){n!=="selectionchange"&&(Ob.has(n)||ec(n,!1,t),ec(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Do]||(e[Do]=!0,ec("selectionchange",!1,e))}}function gy(t,e,n,i){switch(Zv(e)){case 1:var r=$C;break;case 4:r=JC;break;default:r=zd}n=r.bind(null,e,n,t),r=void 0,!su||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function tc(t,e,n,i,r){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=i.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;o=o.return}for(;a!==null;){if(o=wi(a),o===null)return;if(l=o.tag,l===5||l===6){i=s=o;continue e}a=a.parentNode}}i=i.return}jv(function(){var c=s,u=Ud(n),d=[];e:{var h=py.get(t);if(h!==void 0){var f=qd,v=t;switch(t){case"keypress":if(Jo(n)===0)break e;case"keydown":case"keyup":f=ub;break;case"focusin":v="focus",f=$l;break;case"focusout":v="blur",f=$l;break;case"beforeblur":case"afterblur":f=$l;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=qf;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=XC;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=fb;break;case uy:case dy:case hy:f=tb;break;case fy:f=mb;break;case"scroll":f=QC;break;case"wheel":f=vb;break;case"copy":case"cut":case"paste":f=ib;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=Hf}var g=(e&4)!==0,y=!g&&t==="scroll",p=g?h!==null?h+"Capture":null:h;g=[];for(var m=c,k;m!==null;){k=m;var S=k.stateNode;if(k.tag===5&&S!==null&&(k=S,p!==null&&(S=Us(m,p),S!=null&&g.push(Ks(m,S,k)))),y)break;m=m.return}0<g.length&&(h=new f(h,v,null,n,u),d.push({event:h,listeners:g}))}}if(!(e&7)){e:{if(h=t==="mouseover"||t==="pointerover",f=t==="mouseout"||t==="pointerout",h&&n!==iu&&(v=n.relatedTarget||n.fromElement)&&(wi(v)||v[Rn]))break e;if((f||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,f?(v=n.relatedTarget||n.toElement,f=c,v=v?wi(v):null,v!==null&&(y=Vi(v),v!==y||v.tag!==5&&v.tag!==6)&&(v=null)):(f=null,v=c),f!==v)){if(g=qf,S="onMouseLeave",p="onMouseEnter",m="mouse",(t==="pointerout"||t==="pointerover")&&(g=Hf,S="onPointerLeave",p="onPointerEnter",m="pointer"),y=f==null?h:Xi(f),k=v==null?h:Xi(v),h=new g(S,m+"leave",f,n,u),h.target=y,h.relatedTarget=k,S=null,wi(u)===c&&(g=new g(p,m+"enter",v,n,u),g.target=k,g.relatedTarget=y,S=g),y=S,f&&v)t:{for(g=f,p=v,m=0,k=g;k;k=qi(k))m++;for(k=0,S=p;S;S=qi(S))k++;for(;0<m-k;)g=qi(g),m--;for(;0<k-m;)p=qi(p),k--;for(;m--;){if(g===p||p!==null&&g===p.alternate)break t;g=qi(g),p=qi(p)}g=null}else g=null;f!==null&&ip(d,h,f,g,!1),v!==null&&y!==null&&ip(d,y,v,g,!0)}}e:{if(h=c?Xi(c):window,f=h.nodeName&&h.nodeName.toLowerCase(),f==="select"||f==="input"&&h.type==="file")var T=wb;else if(Jf(h))if(sy)T=Rb;else{T=Pb;var b=Eb}else(f=h.nodeName)&&f.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(T=_b);if(T&&(T=T(t,c))){ry(d,T,n,u);break e}b&&b(t,h,c),t==="focusout"&&(b=h._wrapperState)&&b.controlled&&h.type==="number"&&Xc(h,"number",h.value)}switch(b=c?Xi(c):window,t){case"focusin":(Jf(b)||b.contentEditable==="true")&&(Qi=b,uu=c,Ts=null);break;case"focusout":Ts=uu=Qi=null;break;case"mousedown":du=!0;break;case"contextmenu":case"mouseup":case"dragend":du=!1,ep(d,n,u);break;case"selectionchange":if(Db)break;case"keydown":case"keyup":ep(d,n,u)}var P;if(Hd)e:{switch(t){case"compositionstart":var E="onCompositionStart";break e;case"compositionend":E="onCompositionEnd";break e;case"compositionupdate":E="onCompositionUpdate";break e}E=void 0}else Ji?ny(t,n)&&(E="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(E="onCompositionStart");E&&(ty&&n.locale!=="ko"&&(Ji||E!=="onCompositionStart"?E==="onCompositionEnd"&&Ji&&(P=ey()):(Kn=u,Wd="value"in Kn?Kn.value:Kn.textContent,Ji=!0)),b=Pa(c,E),0<b.length&&(E=new Kf(E,t,null,n,u),d.push({event:E,listeners:b}),P?E.data=P:(P=iy(n),P!==null&&(E.data=P)))),(P=kb?Sb(t,n):Tb(t,n))&&(c=Pa(c,"onBeforeInput"),0<c.length&&(u=new Kf("onBeforeInput","beforeinput",null,n,u),d.push({event:u,listeners:c}),u.data=P))}my(d,e)})}function Ks(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Pa(t,e){for(var n=e+"Capture",i=[];t!==null;){var r=t,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=Us(t,n),s!=null&&i.unshift(Ks(t,s,r)),s=Us(t,e),s!=null&&i.push(Ks(t,s,r))),t=t.return}return i}function qi(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function ip(t,e,n,i,r){for(var s=e._reactName,o=[];n!==null&&n!==i;){var a=n,l=a.alternate,c=a.stateNode;if(l!==null&&l===i)break;a.tag===5&&c!==null&&(a=c,r?(l=Us(n,s),l!=null&&o.unshift(Ks(n,l,a))):r||(l=Us(n,s),l!=null&&o.push(Ks(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var Lb=/\r\n?/g,Nb=/\u0000|\uFFFD/g;function rp(t){return(typeof t=="string"?t:""+t).replace(Lb,`
`).replace(Nb,"")}function Mo(t,e,n){if(e=rp(e),rp(t)!==e&&n)throw Error(A(425))}function _a(){}var hu=null,fu=null;function pu(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var mu=typeof setTimeout=="function"?setTimeout:void 0,Fb=typeof clearTimeout=="function"?clearTimeout:void 0,sp=typeof Promise=="function"?Promise:void 0,Ub=typeof queueMicrotask=="function"?queueMicrotask:typeof sp<"u"?function(t){return sp.resolve(null).then(t).catch(jb)}:mu;function jb(t){setTimeout(function(){throw t})}function nc(t,e){var n=e,i=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(i===0){t.removeChild(r),Bs(e);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=r}while(n);Bs(e)}function Yn(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function op(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var qr=Math.random().toString(36).slice(2),en="__reactFiber$"+qr,Hs="__reactProps$"+qr,Rn="__reactContainer$"+qr,gu="__reactEvents$"+qr,Vb="__reactListeners$"+qr,Bb="__reactHandles$"+qr;function wi(t){var e=t[en];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Rn]||n[en]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=op(t);t!==null;){if(n=t[en])return n;t=op(t)}return e}t=n,n=t.parentNode}return null}function mo(t){return t=t[en]||t[Rn],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Xi(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(A(33))}function pl(t){return t[Hs]||null}var vu=[],Zi=-1;function hi(t){return{current:t}}function ue(t){0>Zi||(t.current=vu[Zi],vu[Zi]=null,Zi--)}function ae(t,e){Zi++,vu[Zi]=t.current,t.current=e}var oi={},Qe=hi(oi),ut=hi(!1),Di=oi;function xr(t,e){var n=t.type.contextTypes;if(!n)return oi;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in n)r[s]=e[s];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function dt(t){return t=t.childContextTypes,t!=null}function Ra(){ue(ut),ue(Qe)}function ap(t,e,n){if(Qe.current!==oi)throw Error(A(168));ae(Qe,e),ae(ut,n)}function vy(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(A(108,EC(t)||"Unknown",r));return ve({},n,i)}function xa(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||oi,Di=Qe.current,ae(Qe,t),ae(ut,ut.current),!0}function lp(t,e,n){var i=t.stateNode;if(!i)throw Error(A(169));n?(t=vy(t,e,Di),i.__reactInternalMemoizedMergedChildContext=t,ue(ut),ue(Qe),ae(Qe,t)):ue(ut),ae(ut,n)}var pn=null,ml=!1,ic=!1;function yy(t){pn===null?pn=[t]:pn.push(t)}function zb(t){ml=!0,yy(t)}function fi(){if(!ic&&pn!==null){ic=!0;var t=0,e=ne;try{var n=pn;for(ne=1;t<n.length;t++){var i=n[t];do i=i(!0);while(i!==null)}pn=null,ml=!1}catch(r){throw pn!==null&&(pn=pn.slice(t+1)),Wv(jd,fi),r}finally{ne=e,ic=!1}}return null}var er=[],tr=0,Ia=null,Da=0,_t=[],Rt=0,Mi=null,Tn=1,Cn="";function yi(t,e){er[tr++]=Da,er[tr++]=Ia,Ia=t,Da=e}function ky(t,e,n){_t[Rt++]=Tn,_t[Rt++]=Cn,_t[Rt++]=Mi,Mi=t;var i=Tn;t=Cn;var r=32-Ht(i)-1;i&=~(1<<r),n+=1;var s=32-Ht(e)+r;if(30<s){var o=r-r%5;s=(i&(1<<o)-1).toString(32),i>>=o,r-=o,Tn=1<<32-Ht(e)+r|n<<r|i,Cn=s+t}else Tn=1<<s|n<<r|i,Cn=t}function $d(t){t.return!==null&&(yi(t,1),ky(t,1,0))}function Jd(t){for(;t===Ia;)Ia=er[--tr],er[tr]=null,Da=er[--tr],er[tr]=null;for(;t===Mi;)Mi=_t[--Rt],_t[Rt]=null,Cn=_t[--Rt],_t[Rt]=null,Tn=_t[--Rt],_t[Rt]=null}var vt=null,mt=null,he=!1,Bt=null;function Sy(t,e){var n=xt(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function cp(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,vt=t,mt=Yn(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,vt=t,mt=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Mi!==null?{id:Tn,overflow:Cn}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=xt(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,vt=t,mt=null,!0):!1;default:return!1}}function yu(t){return(t.mode&1)!==0&&(t.flags&128)===0}function ku(t){if(he){var e=mt;if(e){var n=e;if(!cp(t,e)){if(yu(t))throw Error(A(418));e=Yn(n.nextSibling);var i=vt;e&&cp(t,e)?Sy(i,n):(t.flags=t.flags&-4097|2,he=!1,vt=t)}}else{if(yu(t))throw Error(A(418));t.flags=t.flags&-4097|2,he=!1,vt=t}}}function up(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;vt=t}function Ao(t){if(t!==vt)return!1;if(!he)return up(t),he=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!pu(t.type,t.memoizedProps)),e&&(e=mt)){if(yu(t))throw Ty(),Error(A(418));for(;e;)Sy(t,e),e=Yn(e.nextSibling)}if(up(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(A(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){mt=Yn(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}mt=null}}else mt=vt?Yn(t.stateNode.nextSibling):null;return!0}function Ty(){for(var t=mt;t;)t=Yn(t.nextSibling)}function Ir(){mt=vt=null,he=!1}function Qd(t){Bt===null?Bt=[t]:Bt.push(t)}var Wb=An.ReactCurrentBatchConfig;function Xr(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(A(309));var i=n.stateNode}if(!i)throw Error(A(147,t));var r=i,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=r.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(A(284));if(!n._owner)throw Error(A(290,t))}return t}function Oo(t,e){throw t=Object.prototype.toString.call(e),Error(A(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function dp(t){var e=t._init;return e(t._payload)}function Cy(t){function e(p,m){if(t){var k=p.deletions;k===null?(p.deletions=[m],p.flags|=16):k.push(m)}}function n(p,m){if(!t)return null;for(;m!==null;)e(p,m),m=m.sibling;return null}function i(p,m){for(p=new Map;m!==null;)m.key!==null?p.set(m.key,m):p.set(m.index,m),m=m.sibling;return p}function r(p,m){return p=ti(p,m),p.index=0,p.sibling=null,p}function s(p,m,k){return p.index=k,t?(k=p.alternate,k!==null?(k=k.index,k<m?(p.flags|=2,m):k):(p.flags|=2,m)):(p.flags|=1048576,m)}function o(p){return t&&p.alternate===null&&(p.flags|=2),p}function a(p,m,k,S){return m===null||m.tag!==6?(m=uc(k,p.mode,S),m.return=p,m):(m=r(m,k),m.return=p,m)}function l(p,m,k,S){var T=k.type;return T===$i?u(p,m,k.props.children,S,k.key):m!==null&&(m.elementType===T||typeof T=="object"&&T!==null&&T.$$typeof===Vn&&dp(T)===m.type)?(S=r(m,k.props),S.ref=Xr(p,m,k),S.return=p,S):(S=na(k.type,k.key,k.props,null,p.mode,S),S.ref=Xr(p,m,k),S.return=p,S)}function c(p,m,k,S){return m===null||m.tag!==4||m.stateNode.containerInfo!==k.containerInfo||m.stateNode.implementation!==k.implementation?(m=dc(k,p.mode,S),m.return=p,m):(m=r(m,k.children||[]),m.return=p,m)}function u(p,m,k,S,T){return m===null||m.tag!==7?(m=xi(k,p.mode,S,T),m.return=p,m):(m=r(m,k),m.return=p,m)}function d(p,m,k){if(typeof m=="string"&&m!==""||typeof m=="number")return m=uc(""+m,p.mode,k),m.return=p,m;if(typeof m=="object"&&m!==null){switch(m.$$typeof){case bo:return k=na(m.type,m.key,m.props,null,p.mode,k),k.ref=Xr(p,null,m),k.return=p,k;case Gi:return m=dc(m,p.mode,k),m.return=p,m;case Vn:var S=m._init;return d(p,S(m._payload),k)}if(cs(m)||Gr(m))return m=xi(m,p.mode,k,null),m.return=p,m;Oo(p,m)}return null}function h(p,m,k,S){var T=m!==null?m.key:null;if(typeof k=="string"&&k!==""||typeof k=="number")return T!==null?null:a(p,m,""+k,S);if(typeof k=="object"&&k!==null){switch(k.$$typeof){case bo:return k.key===T?l(p,m,k,S):null;case Gi:return k.key===T?c(p,m,k,S):null;case Vn:return T=k._init,h(p,m,T(k._payload),S)}if(cs(k)||Gr(k))return T!==null?null:u(p,m,k,S,null);Oo(p,k)}return null}function f(p,m,k,S,T){if(typeof S=="string"&&S!==""||typeof S=="number")return p=p.get(k)||null,a(m,p,""+S,T);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case bo:return p=p.get(S.key===null?k:S.key)||null,l(m,p,S,T);case Gi:return p=p.get(S.key===null?k:S.key)||null,c(m,p,S,T);case Vn:var b=S._init;return f(p,m,k,b(S._payload),T)}if(cs(S)||Gr(S))return p=p.get(k)||null,u(m,p,S,T,null);Oo(m,S)}return null}function v(p,m,k,S){for(var T=null,b=null,P=m,E=m=0,I=null;P!==null&&E<k.length;E++){P.index>E?(I=P,P=null):I=P.sibling;var _=h(p,P,k[E],S);if(_===null){P===null&&(P=I);break}t&&P&&_.alternate===null&&e(p,P),m=s(_,m,E),b===null?T=_:b.sibling=_,b=_,P=I}if(E===k.length)return n(p,P),he&&yi(p,E),T;if(P===null){for(;E<k.length;E++)P=d(p,k[E],S),P!==null&&(m=s(P,m,E),b===null?T=P:b.sibling=P,b=P);return he&&yi(p,E),T}for(P=i(p,P);E<k.length;E++)I=f(P,p,E,k[E],S),I!==null&&(t&&I.alternate!==null&&P.delete(I.key===null?E:I.key),m=s(I,m,E),b===null?T=I:b.sibling=I,b=I);return t&&P.forEach(function(L){return e(p,L)}),he&&yi(p,E),T}function g(p,m,k,S){var T=Gr(k);if(typeof T!="function")throw Error(A(150));if(k=T.call(k),k==null)throw Error(A(151));for(var b=T=null,P=m,E=m=0,I=null,_=k.next();P!==null&&!_.done;E++,_=k.next()){P.index>E?(I=P,P=null):I=P.sibling;var L=h(p,P,_.value,S);if(L===null){P===null&&(P=I);break}t&&P&&L.alternate===null&&e(p,P),m=s(L,m,E),b===null?T=L:b.sibling=L,b=L,P=I}if(_.done)return n(p,P),he&&yi(p,E),T;if(P===null){for(;!_.done;E++,_=k.next())_=d(p,_.value,S),_!==null&&(m=s(_,m,E),b===null?T=_:b.sibling=_,b=_);return he&&yi(p,E),T}for(P=i(p,P);!_.done;E++,_=k.next())_=f(P,p,E,_.value,S),_!==null&&(t&&_.alternate!==null&&P.delete(_.key===null?E:_.key),m=s(_,m,E),b===null?T=_:b.sibling=_,b=_);return t&&P.forEach(function(z){return e(p,z)}),he&&yi(p,E),T}function y(p,m,k,S){if(typeof k=="object"&&k!==null&&k.type===$i&&k.key===null&&(k=k.props.children),typeof k=="object"&&k!==null){switch(k.$$typeof){case bo:e:{for(var T=k.key,b=m;b!==null;){if(b.key===T){if(T=k.type,T===$i){if(b.tag===7){n(p,b.sibling),m=r(b,k.props.children),m.return=p,p=m;break e}}else if(b.elementType===T||typeof T=="object"&&T!==null&&T.$$typeof===Vn&&dp(T)===b.type){n(p,b.sibling),m=r(b,k.props),m.ref=Xr(p,b,k),m.return=p,p=m;break e}n(p,b);break}else e(p,b);b=b.sibling}k.type===$i?(m=xi(k.props.children,p.mode,S,k.key),m.return=p,p=m):(S=na(k.type,k.key,k.props,null,p.mode,S),S.ref=Xr(p,m,k),S.return=p,p=S)}return o(p);case Gi:e:{for(b=k.key;m!==null;){if(m.key===b)if(m.tag===4&&m.stateNode.containerInfo===k.containerInfo&&m.stateNode.implementation===k.implementation){n(p,m.sibling),m=r(m,k.children||[]),m.return=p,p=m;break e}else{n(p,m);break}else e(p,m);m=m.sibling}m=dc(k,p.mode,S),m.return=p,p=m}return o(p);case Vn:return b=k._init,y(p,m,b(k._payload),S)}if(cs(k))return v(p,m,k,S);if(Gr(k))return g(p,m,k,S);Oo(p,k)}return typeof k=="string"&&k!==""||typeof k=="number"?(k=""+k,m!==null&&m.tag===6?(n(p,m.sibling),m=r(m,k),m.return=p,p=m):(n(p,m),m=uc(k,p.mode,S),m.return=p,p=m),o(p)):n(p,m)}return y}var Dr=Cy(!0),by=Cy(!1),Ma=hi(null),Aa=null,nr=null,Yd=null;function Xd(){Yd=nr=Aa=null}function Zd(t){var e=Ma.current;ue(Ma),t._currentValue=e}function Su(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function vr(t,e){Aa=t,Yd=nr=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(at=!0),t.firstContext=null)}function Mt(t){var e=t._currentValue;if(Yd!==t)if(t={context:t,memoizedValue:e,next:null},nr===null){if(Aa===null)throw Error(A(308));nr=t,Aa.dependencies={lanes:0,firstContext:t}}else nr=nr.next=t;return e}var Ei=null;function eh(t){Ei===null?Ei=[t]:Ei.push(t)}function wy(t,e,n,i){var r=e.interleaved;return r===null?(n.next=n,eh(e)):(n.next=r.next,r.next=n),e.interleaved=n,xn(t,i)}function xn(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Bn=!1;function th(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ey(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function wn(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Xn(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,Z&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,xn(t,n)}return r=i.interleaved,r===null?(e.next=e,eh(i)):(e.next=r.next,r.next=e),i.interleaved=e,xn(t,n)}function Qo(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,Vd(t,n)}}function hp(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var r=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?r=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?r=s=e:s=s.next=e}else r=s=e;n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Oa(t,e,n,i){var r=t.updateQueue;Bn=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(s!==null){var d=r.baseState;o=0,u=c=l=null,a=s;do{var h=a.lane,f=a.eventTime;if((i&h)===h){u!==null&&(u=u.next={eventTime:f,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var v=t,g=a;switch(h=e,f=n,g.tag){case 1:if(v=g.payload,typeof v=="function"){d=v.call(f,d,h);break e}d=v;break e;case 3:v.flags=v.flags&-65537|128;case 0:if(v=g.payload,h=typeof v=="function"?v.call(f,d,h):v,h==null)break e;d=ve({},d,h);break e;case 2:Bn=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,h=r.effects,h===null?r.effects=[a]:h.push(a))}else f={eventTime:f,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=f,l=d):u=u.next=f,o|=h;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;h=a,a=h.next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}}while(!0);if(u===null&&(l=d),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);Oi|=o,t.lanes=o,t.memoizedState=d}}function fp(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],r=i.callback;if(r!==null){if(i.callback=null,i=n,typeof r!="function")throw Error(A(191,r));r.call(i)}}}var go={},nn=hi(go),Gs=hi(go),$s=hi(go);function Pi(t){if(t===go)throw Error(A(174));return t}function nh(t,e){switch(ae($s,e),ae(Gs,t),ae(nn,go),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:eu(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=eu(e,t)}ue(nn),ae(nn,e)}function Mr(){ue(nn),ue(Gs),ue($s)}function Py(t){Pi($s.current);var e=Pi(nn.current),n=eu(e,t.type);e!==n&&(ae(Gs,t),ae(nn,n))}function ih(t){Gs.current===t&&(ue(nn),ue(Gs))}var pe=hi(0);function La(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var rc=[];function rh(){for(var t=0;t<rc.length;t++)rc[t]._workInProgressVersionPrimary=null;rc.length=0}var Yo=An.ReactCurrentDispatcher,sc=An.ReactCurrentBatchConfig,Ai=0,ge=null,Me=null,Le=null,Na=!1,Cs=!1,Js=0,qb=0;function Ke(){throw Error(A(321))}function sh(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!$t(t[n],e[n]))return!1;return!0}function oh(t,e,n,i,r,s){if(Ai=s,ge=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Yo.current=t===null||t.memoizedState===null?$b:Jb,t=n(i,r),Cs){s=0;do{if(Cs=!1,Js=0,25<=s)throw Error(A(301));s+=1,Le=Me=null,e.updateQueue=null,Yo.current=Qb,t=n(i,r)}while(Cs)}if(Yo.current=Fa,e=Me!==null&&Me.next!==null,Ai=0,Le=Me=ge=null,Na=!1,e)throw Error(A(300));return t}function ah(){var t=Js!==0;return Js=0,t}function Xt(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Le===null?ge.memoizedState=Le=t:Le=Le.next=t,Le}function At(){if(Me===null){var t=ge.alternate;t=t!==null?t.memoizedState:null}else t=Me.next;var e=Le===null?ge.memoizedState:Le.next;if(e!==null)Le=e,Me=t;else{if(t===null)throw Error(A(310));Me=t,t={memoizedState:Me.memoizedState,baseState:Me.baseState,baseQueue:Me.baseQueue,queue:Me.queue,next:null},Le===null?ge.memoizedState=Le=t:Le=Le.next=t}return Le}function Qs(t,e){return typeof e=="function"?e(t):e}function oc(t){var e=At(),n=e.queue;if(n===null)throw Error(A(311));n.lastRenderedReducer=t;var i=Me,r=i.baseQueue,s=n.pending;if(s!==null){if(r!==null){var o=r.next;r.next=s.next,s.next=o}i.baseQueue=r=s,n.pending=null}if(r!==null){s=r.next,i=i.baseState;var a=o=null,l=null,c=s;do{var u=c.lane;if((Ai&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),i=c.hasEagerState?c.eagerState:t(i,c.action);else{var d={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=d,o=i):l=l.next=d,ge.lanes|=u,Oi|=u}c=c.next}while(c!==null&&c!==s);l===null?o=i:l.next=a,$t(i,e.memoizedState)||(at=!0),e.memoizedState=i,e.baseState=o,e.baseQueue=l,n.lastRenderedState=i}if(t=n.interleaved,t!==null){r=t;do s=r.lane,ge.lanes|=s,Oi|=s,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function ac(t){var e=At(),n=e.queue;if(n===null)throw Error(A(311));n.lastRenderedReducer=t;var i=n.dispatch,r=n.pending,s=e.memoizedState;if(r!==null){n.pending=null;var o=r=r.next;do s=t(s,o.action),o=o.next;while(o!==r);$t(s,e.memoizedState)||(at=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,i]}function _y(){}function Ry(t,e){var n=ge,i=At(),r=e(),s=!$t(i.memoizedState,r);if(s&&(i.memoizedState=r,at=!0),i=i.queue,lh(Dy.bind(null,n,i,t),[t]),i.getSnapshot!==e||s||Le!==null&&Le.memoizedState.tag&1){if(n.flags|=2048,Ys(9,Iy.bind(null,n,i,r,e),void 0,null),Ue===null)throw Error(A(349));Ai&30||xy(n,e,r)}return r}function xy(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=ge.updateQueue,e===null?(e={lastEffect:null,stores:null},ge.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function Iy(t,e,n,i){e.value=n,e.getSnapshot=i,My(e)&&Ay(t)}function Dy(t,e,n){return n(function(){My(e)&&Ay(t)})}function My(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!$t(t,n)}catch{return!0}}function Ay(t){var e=xn(t,1);e!==null&&Gt(e,t,1,-1)}function pp(t){var e=Xt();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Qs,lastRenderedState:t},e.queue=t,t=t.dispatch=Gb.bind(null,ge,t),[e.memoizedState,t]}function Ys(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=ge.updateQueue,e===null?(e={lastEffect:null,stores:null},ge.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function Oy(){return At().memoizedState}function Xo(t,e,n,i){var r=Xt();ge.flags|=t,r.memoizedState=Ys(1|e,n,void 0,i===void 0?null:i)}function gl(t,e,n,i){var r=At();i=i===void 0?null:i;var s=void 0;if(Me!==null){var o=Me.memoizedState;if(s=o.destroy,i!==null&&sh(i,o.deps)){r.memoizedState=Ys(e,n,s,i);return}}ge.flags|=t,r.memoizedState=Ys(1|e,n,s,i)}function mp(t,e){return Xo(8390656,8,t,e)}function lh(t,e){return gl(2048,8,t,e)}function Ly(t,e){return gl(4,2,t,e)}function Ny(t,e){return gl(4,4,t,e)}function Fy(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Uy(t,e,n){return n=n!=null?n.concat([t]):null,gl(4,4,Fy.bind(null,e,t),n)}function ch(){}function jy(t,e){var n=At();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&sh(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function Vy(t,e){var n=At();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&sh(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function By(t,e,n){return Ai&21?($t(n,e)||(n=Hv(),ge.lanes|=n,Oi|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,at=!0),t.memoizedState=n)}function Kb(t,e){var n=ne;ne=n!==0&&4>n?n:4,t(!0);var i=sc.transition;sc.transition={};try{t(!1),e()}finally{ne=n,sc.transition=i}}function zy(){return At().memoizedState}function Hb(t,e,n){var i=ei(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},Wy(t))qy(e,n);else if(n=wy(t,e,n,i),n!==null){var r=et();Gt(n,t,i,r),Ky(n,e,i)}}function Gb(t,e,n){var i=ei(t),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(Wy(t))qy(e,r);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(r.hasEagerState=!0,r.eagerState=a,$t(a,o)){var l=e.interleaved;l===null?(r.next=r,eh(e)):(r.next=l.next,l.next=r),e.interleaved=r;return}}catch{}finally{}n=wy(t,e,r,i),n!==null&&(r=et(),Gt(n,t,i,r),Ky(n,e,i))}}function Wy(t){var e=t.alternate;return t===ge||e!==null&&e===ge}function qy(t,e){Cs=Na=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function Ky(t,e,n){if(n&4194240){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,Vd(t,n)}}var Fa={readContext:Mt,useCallback:Ke,useContext:Ke,useEffect:Ke,useImperativeHandle:Ke,useInsertionEffect:Ke,useLayoutEffect:Ke,useMemo:Ke,useReducer:Ke,useRef:Ke,useState:Ke,useDebugValue:Ke,useDeferredValue:Ke,useTransition:Ke,useMutableSource:Ke,useSyncExternalStore:Ke,useId:Ke,unstable_isNewReconciler:!1},$b={readContext:Mt,useCallback:function(t,e){return Xt().memoizedState=[t,e===void 0?null:e],t},useContext:Mt,useEffect:mp,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Xo(4194308,4,Fy.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Xo(4194308,4,t,e)},useInsertionEffect:function(t,e){return Xo(4,2,t,e)},useMemo:function(t,e){var n=Xt();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=Xt();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=Hb.bind(null,ge,t),[i.memoizedState,t]},useRef:function(t){var e=Xt();return t={current:t},e.memoizedState=t},useState:pp,useDebugValue:ch,useDeferredValue:function(t){return Xt().memoizedState=t},useTransition:function(){var t=pp(!1),e=t[0];return t=Kb.bind(null,t[1]),Xt().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=ge,r=Xt();if(he){if(n===void 0)throw Error(A(407));n=n()}else{if(n=e(),Ue===null)throw Error(A(349));Ai&30||xy(i,e,n)}r.memoizedState=n;var s={value:n,getSnapshot:e};return r.queue=s,mp(Dy.bind(null,i,s,t),[t]),i.flags|=2048,Ys(9,Iy.bind(null,i,s,n,e),void 0,null),n},useId:function(){var t=Xt(),e=Ue.identifierPrefix;if(he){var n=Cn,i=Tn;n=(i&~(1<<32-Ht(i)-1)).toString(32)+n,e=":"+e+"R"+n,n=Js++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=qb++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},Jb={readContext:Mt,useCallback:jy,useContext:Mt,useEffect:lh,useImperativeHandle:Uy,useInsertionEffect:Ly,useLayoutEffect:Ny,useMemo:Vy,useReducer:oc,useRef:Oy,useState:function(){return oc(Qs)},useDebugValue:ch,useDeferredValue:function(t){var e=At();return By(e,Me.memoizedState,t)},useTransition:function(){var t=oc(Qs)[0],e=At().memoizedState;return[t,e]},useMutableSource:_y,useSyncExternalStore:Ry,useId:zy,unstable_isNewReconciler:!1},Qb={readContext:Mt,useCallback:jy,useContext:Mt,useEffect:lh,useImperativeHandle:Uy,useInsertionEffect:Ly,useLayoutEffect:Ny,useMemo:Vy,useReducer:ac,useRef:Oy,useState:function(){return ac(Qs)},useDebugValue:ch,useDeferredValue:function(t){var e=At();return Me===null?e.memoizedState=t:By(e,Me.memoizedState,t)},useTransition:function(){var t=ac(Qs)[0],e=At().memoizedState;return[t,e]},useMutableSource:_y,useSyncExternalStore:Ry,useId:zy,unstable_isNewReconciler:!1};function Ut(t,e){if(t&&t.defaultProps){e=ve({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Tu(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:ve({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var vl={isMounted:function(t){return(t=t._reactInternals)?Vi(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=et(),r=ei(t),s=wn(i,r);s.payload=e,n!=null&&(s.callback=n),e=Xn(t,s,r),e!==null&&(Gt(e,t,r,i),Qo(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=et(),r=ei(t),s=wn(i,r);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=Xn(t,s,r),e!==null&&(Gt(e,t,r,i),Qo(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=et(),i=ei(t),r=wn(n,i);r.tag=2,e!=null&&(r.callback=e),e=Xn(t,r,i),e!==null&&(Gt(e,t,i,n),Qo(e,t,i))}};function gp(t,e,n,i,r,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,s,o):e.prototype&&e.prototype.isPureReactComponent?!Ws(n,i)||!Ws(r,s):!0}function Hy(t,e,n){var i=!1,r=oi,s=e.contextType;return typeof s=="object"&&s!==null?s=Mt(s):(r=dt(e)?Di:Qe.current,i=e.contextTypes,s=(i=i!=null)?xr(t,r):oi),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=vl,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=s),e}function vp(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&vl.enqueueReplaceState(e,e.state,null)}function Cu(t,e,n,i){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs={},th(t);var s=e.contextType;typeof s=="object"&&s!==null?r.context=Mt(s):(s=dt(e)?Di:Qe.current,r.context=xr(t,s)),r.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(Tu(t,e,s,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&vl.enqueueReplaceState(r,r.state,null),Oa(t,n,r,i),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function Ar(t,e){try{var n="",i=e;do n+=wC(i),i=i.return;while(i);var r=n}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:r,digest:null}}function lc(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function bu(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var Yb=typeof WeakMap=="function"?WeakMap:Map;function Gy(t,e,n){n=wn(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){ja||(ja=!0,Au=i),bu(t,e)},n}function $y(t,e,n){n=wn(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;n.payload=function(){return i(r)},n.callback=function(){bu(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){bu(t,e),typeof i!="function"&&(Zn===null?Zn=new Set([this]):Zn.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function yp(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new Yb;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(n)||(r.add(n),t=dw.bind(null,t,e,n),e.then(t,t))}function kp(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Sp(t,e,n,i,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=wn(-1,1),e.tag=2,Xn(n,e,1))),n.lanes|=1),t)}var Xb=An.ReactCurrentOwner,at=!1;function Ye(t,e,n,i){e.child=t===null?by(e,null,n,i):Dr(e,t.child,n,i)}function Tp(t,e,n,i,r){n=n.render;var s=e.ref;return vr(e,r),i=oh(t,e,n,i,s,r),n=ah(),t!==null&&!at?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,In(t,e,r)):(he&&n&&$d(e),e.flags|=1,Ye(t,e,i,r),e.child)}function Cp(t,e,n,i,r){if(t===null){var s=n.type;return typeof s=="function"&&!vh(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,Jy(t,e,s,i,r)):(t=na(n.type,null,i,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&r)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:Ws,n(o,i)&&t.ref===e.ref)return In(t,e,r)}return e.flags|=1,t=ti(s,i),t.ref=e.ref,t.return=e,e.child=t}function Jy(t,e,n,i,r){if(t!==null){var s=t.memoizedProps;if(Ws(s,i)&&t.ref===e.ref)if(at=!1,e.pendingProps=i=s,(t.lanes&r)!==0)t.flags&131072&&(at=!0);else return e.lanes=t.lanes,In(t,e,r)}return wu(t,e,n,i,r)}function Qy(t,e,n){var i=e.pendingProps,r=i.children,s=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ae(rr,pt),pt|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,ae(rr,pt),pt|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:n,ae(rr,pt),pt|=i}else s!==null?(i=s.baseLanes|n,e.memoizedState=null):i=n,ae(rr,pt),pt|=i;return Ye(t,e,r,n),e.child}function Yy(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function wu(t,e,n,i,r){var s=dt(n)?Di:Qe.current;return s=xr(e,s),vr(e,r),n=oh(t,e,n,i,s,r),i=ah(),t!==null&&!at?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,In(t,e,r)):(he&&i&&$d(e),e.flags|=1,Ye(t,e,n,r),e.child)}function bp(t,e,n,i,r){if(dt(n)){var s=!0;xa(e)}else s=!1;if(vr(e,r),e.stateNode===null)Zo(t,e),Hy(e,n,i),Cu(e,n,i,r),i=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=n.contextType;typeof c=="object"&&c!==null?c=Mt(c):(c=dt(n)?Di:Qe.current,c=xr(e,c));var u=n.getDerivedStateFromProps,d=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==i||l!==c)&&vp(e,o,i,c),Bn=!1;var h=e.memoizedState;o.state=h,Oa(e,i,o,r),l=e.memoizedState,a!==i||h!==l||ut.current||Bn?(typeof u=="function"&&(Tu(e,n,u,i),l=e.memoizedState),(a=Bn||gp(e,n,a,i,h,l,c))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),o.props=i,o.state=l,o.context=c,i=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,Ey(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:Ut(e.type,a),o.props=c,d=e.pendingProps,h=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=Mt(l):(l=dt(n)?Di:Qe.current,l=xr(e,l));var f=n.getDerivedStateFromProps;(u=typeof f=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==d||h!==l)&&vp(e,o,i,l),Bn=!1,h=e.memoizedState,o.state=h,Oa(e,i,o,r);var v=e.memoizedState;a!==d||h!==v||ut.current||Bn?(typeof f=="function"&&(Tu(e,n,f,i),v=e.memoizedState),(c=Bn||gp(e,n,c,i,h,v,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,v,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,v,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=v),o.props=i,o.state=v,o.context=l,i=c):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),i=!1)}return Eu(t,e,n,i,s,r)}function Eu(t,e,n,i,r,s){Yy(t,e);var o=(e.flags&128)!==0;if(!i&&!o)return r&&lp(e,n,!1),In(t,e,s);i=e.stateNode,Xb.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&o?(e.child=Dr(e,t.child,null,s),e.child=Dr(e,null,a,s)):Ye(t,e,a,s),e.memoizedState=i.state,r&&lp(e,n,!0),e.child}function Xy(t){var e=t.stateNode;e.pendingContext?ap(t,e.pendingContext,e.pendingContext!==e.context):e.context&&ap(t,e.context,!1),nh(t,e.containerInfo)}function wp(t,e,n,i,r){return Ir(),Qd(r),e.flags|=256,Ye(t,e,n,i),e.child}var Pu={dehydrated:null,treeContext:null,retryLane:0};function _u(t){return{baseLanes:t,cachePool:null,transitions:null}}function Zy(t,e,n){var i=e.pendingProps,r=pe.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(r&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),ae(pe,r&1),t===null)return ku(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=i.children,t=i.fallback,s?(i=e.mode,s=e.child,o={mode:"hidden",children:o},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=Sl(o,i,0,null),t=xi(t,i,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=_u(n),e.memoizedState=Pu,t):uh(e,o));if(r=t.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return Zb(t,e,o,i,a,r,n);if(s){s=i.fallback,o=e.mode,r=t.child,a=r.sibling;var l={mode:"hidden",children:i.children};return!(o&1)&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=l,e.deletions=null):(i=ti(r,l),i.subtreeFlags=r.subtreeFlags&14680064),a!==null?s=ti(a,s):(s=xi(s,o,n,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,o=t.child.memoizedState,o=o===null?_u(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=Pu,i}return s=t.child,t=s.sibling,i=ti(s,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=n),i.return=e,i.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function uh(t,e){return e=Sl({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Lo(t,e,n,i){return i!==null&&Qd(i),Dr(e,t.child,null,n),t=uh(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function Zb(t,e,n,i,r,s,o){if(n)return e.flags&256?(e.flags&=-257,i=lc(Error(A(422))),Lo(t,e,o,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=i.fallback,r=e.mode,i=Sl({mode:"visible",children:i.children},r,0,null),s=xi(s,r,o,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,e.mode&1&&Dr(e,t.child,null,o),e.child.memoizedState=_u(o),e.memoizedState=Pu,s);if(!(e.mode&1))return Lo(t,e,o,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var a=i.dgst;return i=a,s=Error(A(419)),i=lc(s,i,void 0),Lo(t,e,o,i)}if(a=(o&t.childLanes)!==0,at||a){if(i=Ue,i!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|o)?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,xn(t,r),Gt(i,t,r,-1))}return gh(),i=lc(Error(A(421))),Lo(t,e,o,i)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=hw.bind(null,t),r._reactRetry=e,null):(t=s.treeContext,mt=Yn(r.nextSibling),vt=e,he=!0,Bt=null,t!==null&&(_t[Rt++]=Tn,_t[Rt++]=Cn,_t[Rt++]=Mi,Tn=t.id,Cn=t.overflow,Mi=e),e=uh(e,i.children),e.flags|=4096,e)}function Ep(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),Su(t.return,e,n)}function cc(t,e,n,i,r){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r)}function e0(t,e,n){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(Ye(t,e,i.children,n),i=pe.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Ep(t,n,e);else if(t.tag===19)Ep(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(ae(pe,i),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&La(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),cc(e,!1,r,n,s);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&La(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}cc(e,!0,n,null,s);break;case"together":cc(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Zo(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function In(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Oi|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(A(153));if(e.child!==null){for(t=e.child,n=ti(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=ti(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function ew(t,e,n){switch(e.tag){case 3:Xy(e),Ir();break;case 5:Py(e);break;case 1:dt(e.type)&&xa(e);break;case 4:nh(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;ae(Ma,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(ae(pe,pe.current&1),e.flags|=128,null):n&e.child.childLanes?Zy(t,e,n):(ae(pe,pe.current&1),t=In(t,e,n),t!==null?t.sibling:null);ae(pe,pe.current&1);break;case 19:if(i=(n&e.childLanes)!==0,t.flags&128){if(i)return e0(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),ae(pe,pe.current),i)break;return null;case 22:case 23:return e.lanes=0,Qy(t,e,n)}return In(t,e,n)}var t0,Ru,n0,i0;t0=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Ru=function(){};n0=function(t,e,n,i){var r=t.memoizedProps;if(r!==i){t=e.stateNode,Pi(nn.current);var s=null;switch(n){case"input":r=Qc(t,r),i=Qc(t,i),s=[];break;case"select":r=ve({},r,{value:void 0}),i=ve({},i,{value:void 0}),s=[];break;case"textarea":r=Zc(t,r),i=Zc(t,i),s=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=_a)}tu(n,i);var o;n=null;for(c in r)if(!i.hasOwnProperty(c)&&r.hasOwnProperty(c)&&r[c]!=null)if(c==="style"){var a=r[c];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(Ns.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in i){var l=i[c];if(a=r!=null?r[c]:void 0,i.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(s||(s=[]),s.push(c,n)),n=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(Ns.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&ce("scroll",t),s||a===l||(s=[])):(s=s||[]).push(c,l))}n&&(s=s||[]).push("style",n);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};i0=function(t,e,n,i){n!==i&&(e.flags|=4)};function Zr(t,e){if(!he)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function He(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function tw(t,e,n){var i=e.pendingProps;switch(Jd(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return He(e),null;case 1:return dt(e.type)&&Ra(),He(e),null;case 3:return i=e.stateNode,Mr(),ue(ut),ue(Qe),rh(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(Ao(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Bt!==null&&(Nu(Bt),Bt=null))),Ru(t,e),He(e),null;case 5:ih(e);var r=Pi($s.current);if(n=e.type,t!==null&&e.stateNode!=null)n0(t,e,n,i,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(A(166));return He(e),null}if(t=Pi(nn.current),Ao(e)){i=e.stateNode,n=e.type;var s=e.memoizedProps;switch(i[en]=e,i[Hs]=s,t=(e.mode&1)!==0,n){case"dialog":ce("cancel",i),ce("close",i);break;case"iframe":case"object":case"embed":ce("load",i);break;case"video":case"audio":for(r=0;r<ds.length;r++)ce(ds[r],i);break;case"source":ce("error",i);break;case"img":case"image":case"link":ce("error",i),ce("load",i);break;case"details":ce("toggle",i);break;case"input":Of(i,s),ce("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},ce("invalid",i);break;case"textarea":Nf(i,s),ce("invalid",i)}tu(n,s),r=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?i.textContent!==a&&(s.suppressHydrationWarning!==!0&&Mo(i.textContent,a,t),r=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&Mo(i.textContent,a,t),r=["children",""+a]):Ns.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&ce("scroll",i)}switch(n){case"input":wo(i),Lf(i,s,!0);break;case"textarea":wo(i),Ff(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=_a)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Dv(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=o.createElement(n,{is:i.is}):(t=o.createElement(n),n==="select"&&(o=t,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):t=o.createElementNS(t,n),t[en]=e,t[Hs]=i,t0(t,e,!1,!1),e.stateNode=t;e:{switch(o=nu(n,i),n){case"dialog":ce("cancel",t),ce("close",t),r=i;break;case"iframe":case"object":case"embed":ce("load",t),r=i;break;case"video":case"audio":for(r=0;r<ds.length;r++)ce(ds[r],t);r=i;break;case"source":ce("error",t),r=i;break;case"img":case"image":case"link":ce("error",t),ce("load",t),r=i;break;case"details":ce("toggle",t),r=i;break;case"input":Of(t,i),r=Qc(t,i),ce("invalid",t);break;case"option":r=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},r=ve({},i,{value:void 0}),ce("invalid",t);break;case"textarea":Nf(t,i),r=Zc(t,i),ce("invalid",t);break;default:r=i}tu(n,r),a=r;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?Ov(t,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&Mv(t,l)):s==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&Fs(t,l):typeof l=="number"&&Fs(t,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Ns.hasOwnProperty(s)?l!=null&&s==="onScroll"&&ce("scroll",t):l!=null&&Od(t,s,l,o))}switch(n){case"input":wo(t),Lf(t,i,!1);break;case"textarea":wo(t),Ff(t);break;case"option":i.value!=null&&t.setAttribute("value",""+si(i.value));break;case"select":t.multiple=!!i.multiple,s=i.value,s!=null?fr(t,!!i.multiple,s,!1):i.defaultValue!=null&&fr(t,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=_a)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return He(e),null;case 6:if(t&&e.stateNode!=null)i0(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(A(166));if(n=Pi($s.current),Pi(nn.current),Ao(e)){if(i=e.stateNode,n=e.memoizedProps,i[en]=e,(s=i.nodeValue!==n)&&(t=vt,t!==null))switch(t.tag){case 3:Mo(i.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Mo(i.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[en]=e,e.stateNode=i}return He(e),null;case 13:if(ue(pe),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(he&&mt!==null&&e.mode&1&&!(e.flags&128))Ty(),Ir(),e.flags|=98560,s=!1;else if(s=Ao(e),i!==null&&i.dehydrated!==null){if(t===null){if(!s)throw Error(A(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(A(317));s[en]=e}else Ir(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;He(e),s=!1}else Bt!==null&&(Nu(Bt),Bt=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||pe.current&1?Oe===0&&(Oe=3):gh())),e.updateQueue!==null&&(e.flags|=4),He(e),null);case 4:return Mr(),Ru(t,e),t===null&&qs(e.stateNode.containerInfo),He(e),null;case 10:return Zd(e.type._context),He(e),null;case 17:return dt(e.type)&&Ra(),He(e),null;case 19:if(ue(pe),s=e.memoizedState,s===null)return He(e),null;if(i=(e.flags&128)!==0,o=s.rendering,o===null)if(i)Zr(s,!1);else{if(Oe!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=La(t),o!==null){for(e.flags|=128,Zr(s,!1),i=o.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;n!==null;)s=n,t=i,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return ae(pe,pe.current&1|2),e.child}t=t.sibling}s.tail!==null&&_e()>Or&&(e.flags|=128,i=!0,Zr(s,!1),e.lanes=4194304)}else{if(!i)if(t=La(o),t!==null){if(e.flags|=128,i=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Zr(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!he)return He(e),null}else 2*_e()-s.renderingStartTime>Or&&n!==1073741824&&(e.flags|=128,i=!0,Zr(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=_e(),e.sibling=null,n=pe.current,ae(pe,i?n&1|2:n&1),e):(He(e),null);case 22:case 23:return mh(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?pt&1073741824&&(He(e),e.subtreeFlags&6&&(e.flags|=8192)):He(e),null;case 24:return null;case 25:return null}throw Error(A(156,e.tag))}function nw(t,e){switch(Jd(e),e.tag){case 1:return dt(e.type)&&Ra(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Mr(),ue(ut),ue(Qe),rh(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return ih(e),null;case 13:if(ue(pe),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(A(340));Ir()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return ue(pe),null;case 4:return Mr(),null;case 10:return Zd(e.type._context),null;case 22:case 23:return mh(),null;case 24:return null;default:return null}}var No=!1,$e=!1,iw=typeof WeakSet=="function"?WeakSet:Set,j=null;function ir(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){Te(t,e,i)}else n.current=null}function xu(t,e,n){try{n()}catch(i){Te(t,e,i)}}var Pp=!1;function rw(t,e){if(hu=wa,t=ly(),Gd(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,c=0,u=0,d=t,h=null;t:for(;;){for(var f;d!==n||r!==0&&d.nodeType!==3||(a=o+r),d!==s||i!==0&&d.nodeType!==3||(l=o+i),d.nodeType===3&&(o+=d.nodeValue.length),(f=d.firstChild)!==null;)h=d,d=f;for(;;){if(d===t)break t;if(h===n&&++c===r&&(a=o),h===s&&++u===i&&(l=o),(f=d.nextSibling)!==null)break;d=h,h=d.parentNode}d=f}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(fu={focusedElem:t,selectionRange:n},wa=!1,j=e;j!==null;)if(e=j,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,j=t;else for(;j!==null;){e=j;try{var v=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(v!==null){var g=v.memoizedProps,y=v.memoizedState,p=e.stateNode,m=p.getSnapshotBeforeUpdate(e.elementType===e.type?g:Ut(e.type,g),y);p.__reactInternalSnapshotBeforeUpdate=m}break;case 3:var k=e.stateNode.containerInfo;k.nodeType===1?k.textContent="":k.nodeType===9&&k.documentElement&&k.removeChild(k.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(A(163))}}catch(S){Te(e,e.return,S)}if(t=e.sibling,t!==null){t.return=e.return,j=t;break}j=e.return}return v=Pp,Pp=!1,v}function bs(t,e,n){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&t)===t){var s=r.destroy;r.destroy=void 0,s!==void 0&&xu(e,n,s)}r=r.next}while(r!==i)}}function yl(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function Iu(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function r0(t){var e=t.alternate;e!==null&&(t.alternate=null,r0(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[en],delete e[Hs],delete e[gu],delete e[Vb],delete e[Bb])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function s0(t){return t.tag===5||t.tag===3||t.tag===4}function _p(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||s0(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Du(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=_a));else if(i!==4&&(t=t.child,t!==null))for(Du(t,e,n),t=t.sibling;t!==null;)Du(t,e,n),t=t.sibling}function Mu(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(Mu(t,e,n),t=t.sibling;t!==null;)Mu(t,e,n),t=t.sibling}var je=null,jt=!1;function Ln(t,e,n){for(n=n.child;n!==null;)o0(t,e,n),n=n.sibling}function o0(t,e,n){if(tn&&typeof tn.onCommitFiberUnmount=="function")try{tn.onCommitFiberUnmount(ul,n)}catch{}switch(n.tag){case 5:$e||ir(n,e);case 6:var i=je,r=jt;je=null,Ln(t,e,n),je=i,jt=r,je!==null&&(jt?(t=je,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):je.removeChild(n.stateNode));break;case 18:je!==null&&(jt?(t=je,n=n.stateNode,t.nodeType===8?nc(t.parentNode,n):t.nodeType===1&&nc(t,n),Bs(t)):nc(je,n.stateNode));break;case 4:i=je,r=jt,je=n.stateNode.containerInfo,jt=!0,Ln(t,e,n),je=i,jt=r;break;case 0:case 11:case 14:case 15:if(!$e&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var s=r,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&xu(n,e,o),r=r.next}while(r!==i)}Ln(t,e,n);break;case 1:if(!$e&&(ir(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(a){Te(n,e,a)}Ln(t,e,n);break;case 21:Ln(t,e,n);break;case 22:n.mode&1?($e=(i=$e)||n.memoizedState!==null,Ln(t,e,n),$e=i):Ln(t,e,n);break;default:Ln(t,e,n)}}function Rp(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new iw),e.forEach(function(i){var r=fw.bind(null,t,i);n.has(i)||(n.add(i),i.then(r,r))})}}function Lt(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var r=n[i];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:je=a.stateNode,jt=!1;break e;case 3:je=a.stateNode.containerInfo,jt=!0;break e;case 4:je=a.stateNode.containerInfo,jt=!0;break e}a=a.return}if(je===null)throw Error(A(160));o0(s,o,r),je=null,jt=!1;var l=r.alternate;l!==null&&(l.return=null),r.return=null}catch(c){Te(r,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)a0(e,t),e=e.sibling}function a0(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Lt(e,t),Qt(t),i&4){try{bs(3,t,t.return),yl(3,t)}catch(g){Te(t,t.return,g)}try{bs(5,t,t.return)}catch(g){Te(t,t.return,g)}}break;case 1:Lt(e,t),Qt(t),i&512&&n!==null&&ir(n,n.return);break;case 5:if(Lt(e,t),Qt(t),i&512&&n!==null&&ir(n,n.return),t.flags&32){var r=t.stateNode;try{Fs(r,"")}catch(g){Te(t,t.return,g)}}if(i&4&&(r=t.stateNode,r!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&xv(r,s),nu(a,o);var c=nu(a,s);for(o=0;o<l.length;o+=2){var u=l[o],d=l[o+1];u==="style"?Ov(r,d):u==="dangerouslySetInnerHTML"?Mv(r,d):u==="children"?Fs(r,d):Od(r,u,d,c)}switch(a){case"input":Yc(r,s);break;case"textarea":Iv(r,s);break;case"select":var h=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var f=s.value;f!=null?fr(r,!!s.multiple,f,!1):h!==!!s.multiple&&(s.defaultValue!=null?fr(r,!!s.multiple,s.defaultValue,!0):fr(r,!!s.multiple,s.multiple?[]:"",!1))}r[Hs]=s}catch(g){Te(t,t.return,g)}}break;case 6:if(Lt(e,t),Qt(t),i&4){if(t.stateNode===null)throw Error(A(162));r=t.stateNode,s=t.memoizedProps;try{r.nodeValue=s}catch(g){Te(t,t.return,g)}}break;case 3:if(Lt(e,t),Qt(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{Bs(e.containerInfo)}catch(g){Te(t,t.return,g)}break;case 4:Lt(e,t),Qt(t);break;case 13:Lt(e,t),Qt(t),r=t.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(fh=_e())),i&4&&Rp(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?($e=(c=$e)||u,Lt(e,t),$e=c):Lt(e,t),Qt(t),i&8192){if(c=t.memoizedState!==null,(t.stateNode.isHidden=c)&&!u&&t.mode&1)for(j=t,u=t.child;u!==null;){for(d=j=u;j!==null;){switch(h=j,f=h.child,h.tag){case 0:case 11:case 14:case 15:bs(4,h,h.return);break;case 1:ir(h,h.return);var v=h.stateNode;if(typeof v.componentWillUnmount=="function"){i=h,n=h.return;try{e=i,v.props=e.memoizedProps,v.state=e.memoizedState,v.componentWillUnmount()}catch(g){Te(i,n,g)}}break;case 5:ir(h,h.return);break;case 22:if(h.memoizedState!==null){Ip(d);continue}}f!==null?(f.return=h,j=f):Ip(d)}u=u.sibling}e:for(u=null,d=t;;){if(d.tag===5){if(u===null){u=d;try{r=d.stateNode,c?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=d.stateNode,l=d.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=Av("display",o))}catch(g){Te(t,t.return,g)}}}else if(d.tag===6){if(u===null)try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(g){Te(t,t.return,g)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===t)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===t)break e;for(;d.sibling===null;){if(d.return===null||d.return===t)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Lt(e,t),Qt(t),i&4&&Rp(t);break;case 21:break;default:Lt(e,t),Qt(t)}}function Qt(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(s0(n)){var i=n;break e}n=n.return}throw Error(A(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(Fs(r,""),i.flags&=-33);var s=_p(t);Mu(t,s,r);break;case 3:case 4:var o=i.stateNode.containerInfo,a=_p(t);Du(t,a,o);break;default:throw Error(A(161))}}catch(l){Te(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function sw(t,e,n){j=t,l0(t)}function l0(t,e,n){for(var i=(t.mode&1)!==0;j!==null;){var r=j,s=r.child;if(r.tag===22&&i){var o=r.memoizedState!==null||No;if(!o){var a=r.alternate,l=a!==null&&a.memoizedState!==null||$e;a=No;var c=$e;if(No=o,($e=l)&&!c)for(j=r;j!==null;)o=j,l=o.child,o.tag===22&&o.memoizedState!==null?Dp(r):l!==null?(l.return=o,j=l):Dp(r);for(;s!==null;)j=s,l0(s),s=s.sibling;j=r,No=a,$e=c}xp(t)}else r.subtreeFlags&8772&&s!==null?(s.return=r,j=s):xp(t)}}function xp(t){for(;j!==null;){var e=j;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:$e||yl(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!$e)if(n===null)i.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:Ut(e.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&fp(e,s,i);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}fp(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var d=u.dehydrated;d!==null&&Bs(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(A(163))}$e||e.flags&512&&Iu(e)}catch(h){Te(e,e.return,h)}}if(e===t){j=null;break}if(n=e.sibling,n!==null){n.return=e.return,j=n;break}j=e.return}}function Ip(t){for(;j!==null;){var e=j;if(e===t){j=null;break}var n=e.sibling;if(n!==null){n.return=e.return,j=n;break}j=e.return}}function Dp(t){for(;j!==null;){var e=j;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{yl(4,e)}catch(l){Te(e,n,l)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(l){Te(e,r,l)}}var s=e.return;try{Iu(e)}catch(l){Te(e,s,l)}break;case 5:var o=e.return;try{Iu(e)}catch(l){Te(e,o,l)}}}catch(l){Te(e,e.return,l)}if(e===t){j=null;break}var a=e.sibling;if(a!==null){a.return=e.return,j=a;break}j=e.return}}var ow=Math.ceil,Ua=An.ReactCurrentDispatcher,dh=An.ReactCurrentOwner,Dt=An.ReactCurrentBatchConfig,Z=0,Ue=null,Ie=null,We=0,pt=0,rr=hi(0),Oe=0,Xs=null,Oi=0,kl=0,hh=0,ws=null,st=null,fh=0,Or=1/0,fn=null,ja=!1,Au=null,Zn=null,Fo=!1,Hn=null,Va=0,Es=0,Ou=null,ea=-1,ta=0;function et(){return Z&6?_e():ea!==-1?ea:ea=_e()}function ei(t){return t.mode&1?Z&2&&We!==0?We&-We:Wb.transition!==null?(ta===0&&(ta=Hv()),ta):(t=ne,t!==0||(t=window.event,t=t===void 0?16:Zv(t.type)),t):1}function Gt(t,e,n,i){if(50<Es)throw Es=0,Ou=null,Error(A(185));fo(t,n,i),(!(Z&2)||t!==Ue)&&(t===Ue&&(!(Z&2)&&(kl|=n),Oe===4&&Wn(t,We)),ht(t,i),n===1&&Z===0&&!(e.mode&1)&&(Or=_e()+500,ml&&fi()))}function ht(t,e){var n=t.callbackNode;WC(t,e);var i=ba(t,t===Ue?We:0);if(i===0)n!==null&&Vf(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(n!=null&&Vf(n),e===1)t.tag===0?zb(Mp.bind(null,t)):yy(Mp.bind(null,t)),Ub(function(){!(Z&6)&&fi()}),n=null;else{switch(Gv(i)){case 1:n=jd;break;case 4:n=qv;break;case 16:n=Ca;break;case 536870912:n=Kv;break;default:n=Ca}n=g0(n,c0.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function c0(t,e){if(ea=-1,ta=0,Z&6)throw Error(A(327));var n=t.callbackNode;if(yr()&&t.callbackNode!==n)return null;var i=ba(t,t===Ue?We:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=Ba(t,i);else{e=i;var r=Z;Z|=2;var s=d0();(Ue!==t||We!==e)&&(fn=null,Or=_e()+500,Ri(t,e));do try{cw();break}catch(a){u0(t,a)}while(!0);Xd(),Ua.current=s,Z=r,Ie!==null?e=0:(Ue=null,We=0,e=Oe)}if(e!==0){if(e===2&&(r=au(t),r!==0&&(i=r,e=Lu(t,r))),e===1)throw n=Xs,Ri(t,0),Wn(t,i),ht(t,_e()),n;if(e===6)Wn(t,i);else{if(r=t.current.alternate,!(i&30)&&!aw(r)&&(e=Ba(t,i),e===2&&(s=au(t),s!==0&&(i=s,e=Lu(t,s))),e===1))throw n=Xs,Ri(t,0),Wn(t,i),ht(t,_e()),n;switch(t.finishedWork=r,t.finishedLanes=i,e){case 0:case 1:throw Error(A(345));case 2:ki(t,st,fn);break;case 3:if(Wn(t,i),(i&130023424)===i&&(e=fh+500-_e(),10<e)){if(ba(t,0)!==0)break;if(r=t.suspendedLanes,(r&i)!==i){et(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=mu(ki.bind(null,t,st,fn),e);break}ki(t,st,fn);break;case 4:if(Wn(t,i),(i&4194240)===i)break;for(e=t.eventTimes,r=-1;0<i;){var o=31-Ht(i);s=1<<o,o=e[o],o>r&&(r=o),i&=~s}if(i=r,i=_e()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*ow(i/1960))-i,10<i){t.timeoutHandle=mu(ki.bind(null,t,st,fn),i);break}ki(t,st,fn);break;case 5:ki(t,st,fn);break;default:throw Error(A(329))}}}return ht(t,_e()),t.callbackNode===n?c0.bind(null,t):null}function Lu(t,e){var n=ws;return t.current.memoizedState.isDehydrated&&(Ri(t,e).flags|=256),t=Ba(t,e),t!==2&&(e=st,st=n,e!==null&&Nu(e)),t}function Nu(t){st===null?st=t:st.push.apply(st,t)}function aw(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var r=n[i],s=r.getSnapshot;r=r.value;try{if(!$t(s(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Wn(t,e){for(e&=~hh,e&=~kl,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Ht(e),i=1<<n;t[n]=-1,e&=~i}}function Mp(t){if(Z&6)throw Error(A(327));yr();var e=ba(t,0);if(!(e&1))return ht(t,_e()),null;var n=Ba(t,e);if(t.tag!==0&&n===2){var i=au(t);i!==0&&(e=i,n=Lu(t,i))}if(n===1)throw n=Xs,Ri(t,0),Wn(t,e),ht(t,_e()),n;if(n===6)throw Error(A(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,ki(t,st,fn),ht(t,_e()),null}function ph(t,e){var n=Z;Z|=1;try{return t(e)}finally{Z=n,Z===0&&(Or=_e()+500,ml&&fi())}}function Li(t){Hn!==null&&Hn.tag===0&&!(Z&6)&&yr();var e=Z;Z|=1;var n=Dt.transition,i=ne;try{if(Dt.transition=null,ne=1,t)return t()}finally{ne=i,Dt.transition=n,Z=e,!(Z&6)&&fi()}}function mh(){pt=rr.current,ue(rr)}function Ri(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,Fb(n)),Ie!==null)for(n=Ie.return;n!==null;){var i=n;switch(Jd(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&Ra();break;case 3:Mr(),ue(ut),ue(Qe),rh();break;case 5:ih(i);break;case 4:Mr();break;case 13:ue(pe);break;case 19:ue(pe);break;case 10:Zd(i.type._context);break;case 22:case 23:mh()}n=n.return}if(Ue=t,Ie=t=ti(t.current,null),We=pt=e,Oe=0,Xs=null,hh=kl=Oi=0,st=ws=null,Ei!==null){for(e=0;e<Ei.length;e++)if(n=Ei[e],i=n.interleaved,i!==null){n.interleaved=null;var r=i.next,s=n.pending;if(s!==null){var o=s.next;s.next=r,i.next=o}n.pending=i}Ei=null}return t}function u0(t,e){do{var n=Ie;try{if(Xd(),Yo.current=Fa,Na){for(var i=ge.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}Na=!1}if(Ai=0,Le=Me=ge=null,Cs=!1,Js=0,dh.current=null,n===null||n.return===null){Oe=1,Xs=e,Ie=null;break}e:{var s=t,o=n.return,a=n,l=e;if(e=We,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,d=u.tag;if(!(u.mode&1)&&(d===0||d===11||d===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var f=kp(o);if(f!==null){f.flags&=-257,Sp(f,o,a,s,e),f.mode&1&&yp(s,c,e),e=f,l=c;var v=e.updateQueue;if(v===null){var g=new Set;g.add(l),e.updateQueue=g}else v.add(l);break e}else{if(!(e&1)){yp(s,c,e),gh();break e}l=Error(A(426))}}else if(he&&a.mode&1){var y=kp(o);if(y!==null){!(y.flags&65536)&&(y.flags|=256),Sp(y,o,a,s,e),Qd(Ar(l,a));break e}}s=l=Ar(l,a),Oe!==4&&(Oe=2),ws===null?ws=[s]:ws.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var p=Gy(s,l,e);hp(s,p);break e;case 1:a=l;var m=s.type,k=s.stateNode;if(!(s.flags&128)&&(typeof m.getDerivedStateFromError=="function"||k!==null&&typeof k.componentDidCatch=="function"&&(Zn===null||!Zn.has(k)))){s.flags|=65536,e&=-e,s.lanes|=e;var S=$y(s,a,e);hp(s,S);break e}}s=s.return}while(s!==null)}f0(n)}catch(T){e=T,Ie===n&&n!==null&&(Ie=n=n.return);continue}break}while(!0)}function d0(){var t=Ua.current;return Ua.current=Fa,t===null?Fa:t}function gh(){(Oe===0||Oe===3||Oe===2)&&(Oe=4),Ue===null||!(Oi&268435455)&&!(kl&268435455)||Wn(Ue,We)}function Ba(t,e){var n=Z;Z|=2;var i=d0();(Ue!==t||We!==e)&&(fn=null,Ri(t,e));do try{lw();break}catch(r){u0(t,r)}while(!0);if(Xd(),Z=n,Ua.current=i,Ie!==null)throw Error(A(261));return Ue=null,We=0,Oe}function lw(){for(;Ie!==null;)h0(Ie)}function cw(){for(;Ie!==null&&!OC();)h0(Ie)}function h0(t){var e=m0(t.alternate,t,pt);t.memoizedProps=t.pendingProps,e===null?f0(t):Ie=e,dh.current=null}function f0(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=nw(n,e),n!==null){n.flags&=32767,Ie=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Oe=6,Ie=null;return}}else if(n=tw(n,e,pt),n!==null){Ie=n;return}if(e=e.sibling,e!==null){Ie=e;return}Ie=e=t}while(e!==null);Oe===0&&(Oe=5)}function ki(t,e,n){var i=ne,r=Dt.transition;try{Dt.transition=null,ne=1,uw(t,e,n,i)}finally{Dt.transition=r,ne=i}return null}function uw(t,e,n,i){do yr();while(Hn!==null);if(Z&6)throw Error(A(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(A(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(qC(t,s),t===Ue&&(Ie=Ue=null,We=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Fo||(Fo=!0,g0(Ca,function(){return yr(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=Dt.transition,Dt.transition=null;var o=ne;ne=1;var a=Z;Z|=4,dh.current=null,rw(t,n),a0(n,t),Ib(fu),wa=!!hu,fu=hu=null,t.current=n,sw(n),LC(),Z=a,ne=o,Dt.transition=s}else t.current=n;if(Fo&&(Fo=!1,Hn=t,Va=r),s=t.pendingLanes,s===0&&(Zn=null),UC(n.stateNode),ht(t,_e()),e!==null)for(i=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(ja)throw ja=!1,t=Au,Au=null,t;return Va&1&&t.tag!==0&&yr(),s=t.pendingLanes,s&1?t===Ou?Es++:(Es=0,Ou=t):Es=0,fi(),null}function yr(){if(Hn!==null){var t=Gv(Va),e=Dt.transition,n=ne;try{if(Dt.transition=null,ne=16>t?16:t,Hn===null)var i=!1;else{if(t=Hn,Hn=null,Va=0,Z&6)throw Error(A(331));var r=Z;for(Z|=4,j=t.current;j!==null;){var s=j,o=s.child;if(j.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(j=c;j!==null;){var u=j;switch(u.tag){case 0:case 11:case 15:bs(8,u,s)}var d=u.child;if(d!==null)d.return=u,j=d;else for(;j!==null;){u=j;var h=u.sibling,f=u.return;if(r0(u),u===c){j=null;break}if(h!==null){h.return=f,j=h;break}j=f}}}var v=s.alternate;if(v!==null){var g=v.child;if(g!==null){v.child=null;do{var y=g.sibling;g.sibling=null,g=y}while(g!==null)}}j=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,j=o;else e:for(;j!==null;){if(s=j,s.flags&2048)switch(s.tag){case 0:case 11:case 15:bs(9,s,s.return)}var p=s.sibling;if(p!==null){p.return=s.return,j=p;break e}j=s.return}}var m=t.current;for(j=m;j!==null;){o=j;var k=o.child;if(o.subtreeFlags&2064&&k!==null)k.return=o,j=k;else e:for(o=m;j!==null;){if(a=j,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:yl(9,a)}}catch(T){Te(a,a.return,T)}if(a===o){j=null;break e}var S=a.sibling;if(S!==null){S.return=a.return,j=S;break e}j=a.return}}if(Z=r,fi(),tn&&typeof tn.onPostCommitFiberRoot=="function")try{tn.onPostCommitFiberRoot(ul,t)}catch{}i=!0}return i}finally{ne=n,Dt.transition=e}}return!1}function Ap(t,e,n){e=Ar(n,e),e=Gy(t,e,1),t=Xn(t,e,1),e=et(),t!==null&&(fo(t,1,e),ht(t,e))}function Te(t,e,n){if(t.tag===3)Ap(t,t,n);else for(;e!==null;){if(e.tag===3){Ap(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(Zn===null||!Zn.has(i))){t=Ar(n,t),t=$y(e,t,1),e=Xn(e,t,1),t=et(),e!==null&&(fo(e,1,t),ht(e,t));break}}e=e.return}}function dw(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=et(),t.pingedLanes|=t.suspendedLanes&n,Ue===t&&(We&n)===n&&(Oe===4||Oe===3&&(We&130023424)===We&&500>_e()-fh?Ri(t,0):hh|=n),ht(t,e)}function p0(t,e){e===0&&(t.mode&1?(e=_o,_o<<=1,!(_o&130023424)&&(_o=4194304)):e=1);var n=et();t=xn(t,e),t!==null&&(fo(t,e,n),ht(t,n))}function hw(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),p0(t,n)}function fw(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(A(314))}i!==null&&i.delete(e),p0(t,n)}var m0;m0=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||ut.current)at=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return at=!1,ew(t,e,n);at=!!(t.flags&131072)}else at=!1,he&&e.flags&1048576&&ky(e,Da,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;Zo(t,e),t=e.pendingProps;var r=xr(e,Qe.current);vr(e,n),r=oh(null,e,i,t,r,n);var s=ah();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,dt(i)?(s=!0,xa(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,th(e),r.updater=vl,e.stateNode=r,r._reactInternals=e,Cu(e,i,t,n),e=Eu(null,e,i,!0,s,n)):(e.tag=0,he&&s&&$d(e),Ye(null,e,r,n),e=e.child),e;case 16:i=e.elementType;e:{switch(Zo(t,e),t=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=mw(i),t=Ut(i,t),r){case 0:e=wu(null,e,i,t,n);break e;case 1:e=bp(null,e,i,t,n);break e;case 11:e=Tp(null,e,i,t,n);break e;case 14:e=Cp(null,e,i,Ut(i.type,t),n);break e}throw Error(A(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Ut(i,r),wu(t,e,i,r,n);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Ut(i,r),bp(t,e,i,r,n);case 3:e:{if(Xy(e),t===null)throw Error(A(387));i=e.pendingProps,s=e.memoizedState,r=s.element,Ey(t,e),Oa(e,i,null,n);var o=e.memoizedState;if(i=o.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=Ar(Error(A(423)),e),e=wp(t,e,i,n,r);break e}else if(i!==r){r=Ar(Error(A(424)),e),e=wp(t,e,i,n,r);break e}else for(mt=Yn(e.stateNode.containerInfo.firstChild),vt=e,he=!0,Bt=null,n=by(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Ir(),i===r){e=In(t,e,n);break e}Ye(t,e,i,n)}e=e.child}return e;case 5:return Py(e),t===null&&ku(e),i=e.type,r=e.pendingProps,s=t!==null?t.memoizedProps:null,o=r.children,pu(i,r)?o=null:s!==null&&pu(i,s)&&(e.flags|=32),Yy(t,e),Ye(t,e,o,n),e.child;case 6:return t===null&&ku(e),null;case 13:return Zy(t,e,n);case 4:return nh(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=Dr(e,null,i,n):Ye(t,e,i,n),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Ut(i,r),Tp(t,e,i,r,n);case 7:return Ye(t,e,e.pendingProps,n),e.child;case 8:return Ye(t,e,e.pendingProps.children,n),e.child;case 12:return Ye(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,s=e.memoizedProps,o=r.value,ae(Ma,i._currentValue),i._currentValue=o,s!==null)if($t(s.value,o)){if(s.children===r.children&&!ut.current){e=In(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===i){if(s.tag===1){l=wn(-1,n&-n),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=n,l=s.alternate,l!==null&&(l.lanes|=n),Su(s.return,n,e),a.lanes|=n;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(A(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),Su(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Ye(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,vr(e,n),r=Mt(r),i=i(r),e.flags|=1,Ye(t,e,i,n),e.child;case 14:return i=e.type,r=Ut(i,e.pendingProps),r=Ut(i.type,r),Cp(t,e,i,r,n);case 15:return Jy(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Ut(i,r),Zo(t,e),e.tag=1,dt(i)?(t=!0,xa(e)):t=!1,vr(e,n),Hy(e,i,r),Cu(e,i,r,n),Eu(null,e,i,!0,t,n);case 19:return e0(t,e,n);case 22:return Qy(t,e,n)}throw Error(A(156,e.tag))};function g0(t,e){return Wv(t,e)}function pw(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function xt(t,e,n,i){return new pw(t,e,n,i)}function vh(t){return t=t.prototype,!(!t||!t.isReactComponent)}function mw(t){if(typeof t=="function")return vh(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Nd)return 11;if(t===Fd)return 14}return 2}function ti(t,e){var n=t.alternate;return n===null?(n=xt(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function na(t,e,n,i,r,s){var o=2;if(i=t,typeof t=="function")vh(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case $i:return xi(n.children,r,s,e);case Ld:o=8,r|=8;break;case Hc:return t=xt(12,n,e,r|2),t.elementType=Hc,t.lanes=s,t;case Gc:return t=xt(13,n,e,r),t.elementType=Gc,t.lanes=s,t;case $c:return t=xt(19,n,e,r),t.elementType=$c,t.lanes=s,t;case Pv:return Sl(n,r,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case wv:o=10;break e;case Ev:o=9;break e;case Nd:o=11;break e;case Fd:o=14;break e;case Vn:o=16,i=null;break e}throw Error(A(130,t==null?t:typeof t,""))}return e=xt(o,n,e,r),e.elementType=t,e.type=i,e.lanes=s,e}function xi(t,e,n,i){return t=xt(7,t,i,e),t.lanes=n,t}function Sl(t,e,n,i){return t=xt(22,t,i,e),t.elementType=Pv,t.lanes=n,t.stateNode={isHidden:!1},t}function uc(t,e,n){return t=xt(6,t,null,e),t.lanes=n,t}function dc(t,e,n){return e=xt(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function gw(t,e,n,i,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Kl(0),this.expirationTimes=Kl(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Kl(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function yh(t,e,n,i,r,s,o,a,l){return t=new gw(t,e,n,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=xt(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},th(s),t}function vw(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Gi,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function v0(t){if(!t)return oi;t=t._reactInternals;e:{if(Vi(t)!==t||t.tag!==1)throw Error(A(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(dt(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(A(171))}if(t.tag===1){var n=t.type;if(dt(n))return vy(t,n,e)}return e}function y0(t,e,n,i,r,s,o,a,l){return t=yh(n,i,!0,t,r,s,o,a,l),t.context=v0(null),n=t.current,i=et(),r=ei(n),s=wn(i,r),s.callback=e??null,Xn(n,s,r),t.current.lanes=r,fo(t,r,i),ht(t,i),t}function Tl(t,e,n,i){var r=e.current,s=et(),o=ei(r);return n=v0(n),e.context===null?e.context=n:e.pendingContext=n,e=wn(s,o),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=Xn(r,e,o),t!==null&&(Gt(t,r,o,s),Qo(t,r,o)),o}function za(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Op(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function kh(t,e){Op(t,e),(t=t.alternate)&&Op(t,e)}function yw(){return null}var k0=typeof reportError=="function"?reportError:function(t){console.error(t)};function Sh(t){this._internalRoot=t}Cl.prototype.render=Sh.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(A(409));Tl(t,e,null,null)};Cl.prototype.unmount=Sh.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Li(function(){Tl(null,t,null,null)}),e[Rn]=null}};function Cl(t){this._internalRoot=t}Cl.prototype.unstable_scheduleHydration=function(t){if(t){var e=Qv();t={blockedOn:null,target:t,priority:e};for(var n=0;n<zn.length&&e!==0&&e<zn[n].priority;n++);zn.splice(n,0,t),n===0&&Xv(t)}};function Th(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function bl(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Lp(){}function kw(t,e,n,i,r){if(r){if(typeof i=="function"){var s=i;i=function(){var c=za(o);s.call(c)}}var o=y0(e,i,t,0,null,!1,!1,"",Lp);return t._reactRootContainer=o,t[Rn]=o.current,qs(t.nodeType===8?t.parentNode:t),Li(),o}for(;r=t.lastChild;)t.removeChild(r);if(typeof i=="function"){var a=i;i=function(){var c=za(l);a.call(c)}}var l=yh(t,0,!1,null,null,!1,!1,"",Lp);return t._reactRootContainer=l,t[Rn]=l.current,qs(t.nodeType===8?t.parentNode:t),Li(function(){Tl(e,l,n,i)}),l}function wl(t,e,n,i,r){var s=n._reactRootContainer;if(s){var o=s;if(typeof r=="function"){var a=r;r=function(){var l=za(o);a.call(l)}}Tl(e,o,t,r)}else o=kw(n,e,t,r,i);return za(o)}$v=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=us(e.pendingLanes);n!==0&&(Vd(e,n|1),ht(e,_e()),!(Z&6)&&(Or=_e()+500,fi()))}break;case 13:Li(function(){var i=xn(t,1);if(i!==null){var r=et();Gt(i,t,1,r)}}),kh(t,1)}};Bd=function(t){if(t.tag===13){var e=xn(t,134217728);if(e!==null){var n=et();Gt(e,t,134217728,n)}kh(t,134217728)}};Jv=function(t){if(t.tag===13){var e=ei(t),n=xn(t,e);if(n!==null){var i=et();Gt(n,t,e,i)}kh(t,e)}};Qv=function(){return ne};Yv=function(t,e){var n=ne;try{return ne=t,e()}finally{ne=n}};ru=function(t,e,n){switch(e){case"input":if(Yc(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var r=pl(i);if(!r)throw Error(A(90));Rv(i),Yc(i,r)}}}break;case"textarea":Iv(t,n);break;case"select":e=n.value,e!=null&&fr(t,!!n.multiple,e,!1)}};Fv=ph;Uv=Li;var Sw={usingClientEntryPoint:!1,Events:[mo,Xi,pl,Lv,Nv,ph]},es={findFiberByHostInstance:wi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Tw={bundleType:es.bundleType,version:es.version,rendererPackageName:es.rendererPackageName,rendererConfig:es.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:An.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Bv(t),t===null?null:t.stateNode},findFiberByHostInstance:es.findFiberByHostInstance||yw,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Uo=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Uo.isDisabled&&Uo.supportsFiber)try{ul=Uo.inject(Tw),tn=Uo}catch{}}Tt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Sw;Tt.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Th(e))throw Error(A(200));return vw(t,e,null,n)};Tt.createRoot=function(t,e){if(!Th(t))throw Error(A(299));var n=!1,i="",r=k0;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=yh(t,1,!1,null,null,n,!1,i,r),t[Rn]=e.current,qs(t.nodeType===8?t.parentNode:t),new Sh(e)};Tt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(A(188)):(t=Object.keys(t).join(","),Error(A(268,t)));return t=Bv(e),t=t===null?null:t.stateNode,t};Tt.flushSync=function(t){return Li(t)};Tt.hydrate=function(t,e,n){if(!bl(e))throw Error(A(200));return wl(null,t,e,!0,n)};Tt.hydrateRoot=function(t,e,n){if(!Th(t))throw Error(A(405));var i=n!=null&&n.hydratedSources||null,r=!1,s="",o=k0;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=y0(e,null,t,1,n??null,r,!1,s,o),t[Rn]=e.current,qs(t),i)for(t=0;t<i.length;t++)n=i[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new Cl(e)};Tt.render=function(t,e,n){if(!bl(e))throw Error(A(200));return wl(null,t,e,!1,n)};Tt.unmountComponentAtNode=function(t){if(!bl(t))throw Error(A(40));return t._reactRootContainer?(Li(function(){wl(null,null,t,!1,function(){t._reactRootContainer=null,t[Rn]=null})}),!0):!1};Tt.unstable_batchedUpdates=ph;Tt.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!bl(n))throw Error(A(200));if(t==null||t._reactInternals===void 0)throw Error(A(38));return wl(t,e,n,!1,i)};Tt.version="18.3.1-next-f1338f8080-20240426";function S0(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(S0)}catch(t){console.error(t)}}S0(),Sv.exports=Tt;var Cw=Sv.exports,Np=Cw;qc.createRoot=Np.createRoot,qc.hydrateRoot=Np.hydrateRoot;var Fp={};function bw(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in t)){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(t)}var ww=Object.defineProperty,Ew=(t,e,n)=>e in t?ww(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Up=(t,e,n)=>Ew(t,typeof e!="symbol"?e+"":e,n);let tt=class{constructor(){Up(this,"_locking"),Up(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const n=new Promise(r=>e=()=>{this._locks-=1,r()}),i=this._locking.then(()=>e);return this._locking=this._locking.then(()=>n),i}};function Ce(t,e){if(!t)throw new Error(e)}const Pw=34028234663852886e22,_w=-34028234663852886e22,Rw=4294967295,xw=2147483647,Iw=-2147483648;function ia(t){if(typeof t!="number")throw new Error("invalid int 32: "+typeof t);if(!Number.isInteger(t)||t>xw||t<Iw)throw new Error("invalid int 32: "+t)}function Fu(t){if(typeof t!="number")throw new Error("invalid uint 32: "+typeof t);if(!Number.isInteger(t)||t>Rw||t<0)throw new Error("invalid uint 32: "+t)}function T0(t){if(typeof t!="number")throw new Error("invalid float 32: "+typeof t);if(Number.isFinite(t)&&(t>Pw||t<_w))throw new Error("invalid float 32: "+t)}const C0=Symbol("@bufbuild/protobuf/enum-type");function Dw(t){const e=t[C0];return Ce(e,"missing enum type on enum object"),e}function b0(t,e,n,i){t[C0]=w0(e,n.map(r=>({no:r.no,name:r.name,localName:t[r.no]})))}function w0(t,e,n){const i=Object.create(null),r=Object.create(null),s=[];for(const o of e){const a=E0(o);s.push(a),i[o.name]=a,r[o.no]=a}return{typeName:t,values:s,findName(o){return i[o]},findNumber(o){return r[o]}}}function Mw(t,e,n){const i={};for(const r of e){const s=E0(r);i[s.localName]=s.no,i[s.no]=s.localName}return b0(i,t,e),i}function E0(t){return"localName"in t?t:Object.assign(Object.assign({},t),{localName:t.name})}class Ch{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,n){const i=this.getType(),r=i.runtime.bin,s=r.makeReadOptions(n);return r.readMessage(this,s.readerFactory(e),e.byteLength,s),this}fromJson(e,n){const i=this.getType(),r=i.runtime.json,s=r.makeReadOptions(n);return r.readMessage(i,e,s,this),this}fromJsonString(e,n){let i;try{i=JSON.parse(e)}catch(r){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(r instanceof Error?r.message:String(r)))}return this.fromJson(i,n)}toBinary(e){const n=this.getType(),i=n.runtime.bin,r=i.makeWriteOptions(e),s=r.writerFactory();return i.writeMessage(this,s,r),s.finish()}toJson(e){const n=this.getType(),i=n.runtime.json,r=i.makeWriteOptions(e);return i.writeMessage(this,r)}toJsonString(e){var n;const i=this.toJson(e);return JSON.stringify(i,null,(n=e==null?void 0:e.prettySpaces)!==null&&n!==void 0?n:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function Aw(t,e,n,i){var r;const s=(r=i==null?void 0:i.localName)!==null&&r!==void 0?r:e.substring(e.lastIndexOf(".")+1),o={[s]:function(a){t.util.initFields(this),t.util.initPartial(a,this)}}[s];return Object.setPrototypeOf(o.prototype,new Ch),Object.assign(o,{runtime:t,typeName:e,fields:t.util.newFieldList(n),fromBinary(a,l){return new o().fromBinary(a,l)},fromJson(a,l){return new o().fromJson(a,l)},fromJsonString(a,l){return new o().fromJsonString(a,l)},equals(a,l){return t.util.equals(o,a,l)}}),o}function Ow(){let t=0,e=0;for(let i=0;i<28;i+=7){let r=this.buf[this.pos++];if(t|=(r&127)<<i,!(r&128))return this.assertBounds(),[t,e]}let n=this.buf[this.pos++];if(t|=(n&15)<<28,e=(n&112)>>4,!(n&128))return this.assertBounds(),[t,e];for(let i=3;i<=31;i+=7){let r=this.buf[this.pos++];if(e|=(r&127)<<i,!(r&128))return this.assertBounds(),[t,e]}throw new Error("invalid varint")}function hc(t,e,n){for(let s=0;s<28;s=s+7){const o=t>>>s,a=!(!(o>>>7)&&e==0),l=(a?o|128:o)&255;if(n.push(l),!a)return}const i=t>>>28&15|(e&7)<<4,r=!!(e>>3);if(n.push((r?i|128:i)&255),!!r){for(let s=3;s<31;s=s+7){const o=e>>>s,a=!!(o>>>7),l=(a?o|128:o)&255;if(n.push(l),!a)return}n.push(e>>>31&1)}}const ra=4294967296;function jp(t){const e=t[0]==="-";e&&(t=t.slice(1));const n=1e6;let i=0,r=0;function s(o,a){const l=Number(t.slice(o,a));r*=n,i=i*n+l,i>=ra&&(r=r+(i/ra|0),i=i%ra)}return s(-24,-18),s(-18,-12),s(-12,-6),s(-6),e?_0(i,r):bh(i,r)}function Lw(t,e){let n=bh(t,e);const i=n.hi&2147483648;i&&(n=_0(n.lo,n.hi));const r=P0(n.lo,n.hi);return i?"-"+r:r}function P0(t,e){if({lo:t,hi:e}=Nw(t,e),e<=2097151)return String(ra*e+t);const n=t&16777215,i=(t>>>24|e<<8)&16777215,r=e>>16&65535;let s=n+i*6777216+r*6710656,o=i+r*8147497,a=r*2;const l=1e7;return s>=l&&(o+=Math.floor(s/l),s%=l),o>=l&&(a+=Math.floor(o/l),o%=l),a.toString()+Vp(o)+Vp(s)}function Nw(t,e){return{lo:t>>>0,hi:e>>>0}}function bh(t,e){return{lo:t|0,hi:e|0}}function _0(t,e){return e=~e,t?t=~t+1:e+=1,bh(t,e)}const Vp=t=>{const e=String(t);return"0000000".slice(e.length)+e};function Bp(t,e){if(t>=0){for(;t>127;)e.push(t&127|128),t=t>>>7;e.push(t)}else{for(let n=0;n<9;n++)e.push(t&127|128),t=t>>7;e.push(1)}}function Fw(){let t=this.buf[this.pos++],e=t&127;if(!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<7,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<14,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<21,!(t&128))return this.assertBounds(),e;t=this.buf[this.pos++],e|=(t&15)<<28;for(let n=5;t&128&&n<10;n++)t=this.buf[this.pos++];if(t&128)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function Uw(){const t=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof t.getBigInt64=="function"&&typeof t.getBigUint64=="function"&&typeof t.setBigInt64=="function"&&typeof t.setBigUint64=="function"&&(typeof process!="object"||typeof Fp!="object"||Fp.BUF_BIGINT_DISABLE!=="1")){const r=BigInt("-9223372036854775808"),s=BigInt("9223372036854775807"),o=BigInt("0"),a=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(l){const c=typeof l=="bigint"?l:BigInt(l);if(c>s||c<r)throw new Error("int64 invalid: ".concat(l));return c},uParse(l){const c=typeof l=="bigint"?l:BigInt(l);if(c>a||c<o)throw new Error("uint64 invalid: ".concat(l));return c},enc(l){return t.setBigInt64(0,this.parse(l),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},uEnc(l){return t.setBigInt64(0,this.uParse(l),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},dec(l,c){return t.setInt32(0,l,!0),t.setInt32(4,c,!0),t.getBigInt64(0,!0)},uDec(l,c){return t.setInt32(0,l,!0),t.setInt32(4,c,!0),t.getBigUint64(0,!0)}}}const n=r=>Ce(/^-?[0-9]+$/.test(r),"int64 invalid: ".concat(r)),i=r=>Ce(/^[0-9]+$/.test(r),"uint64 invalid: ".concat(r));return{zero:"0",supported:!1,parse(r){return typeof r!="string"&&(r=r.toString()),n(r),r},uParse(r){return typeof r!="string"&&(r=r.toString()),i(r),r},enc(r){return typeof r!="string"&&(r=r.toString()),n(r),jp(r)},uEnc(r){return typeof r!="string"&&(r=r.toString()),i(r),jp(r)},dec(r,s){return Lw(r,s)},uDec(r,s){return P0(r,s)}}}const fe=Uw();var x;(function(t){t[t.DOUBLE=1]="DOUBLE",t[t.FLOAT=2]="FLOAT",t[t.INT64=3]="INT64",t[t.UINT64=4]="UINT64",t[t.INT32=5]="INT32",t[t.FIXED64=6]="FIXED64",t[t.FIXED32=7]="FIXED32",t[t.BOOL=8]="BOOL",t[t.STRING=9]="STRING",t[t.BYTES=12]="BYTES",t[t.UINT32=13]="UINT32",t[t.SFIXED32=15]="SFIXED32",t[t.SFIXED64=16]="SFIXED64",t[t.SINT32=17]="SINT32",t[t.SINT64=18]="SINT64"})(x||(x={}));var ai;(function(t){t[t.BIGINT=0]="BIGINT",t[t.STRING=1]="STRING"})(ai||(ai={}));function Nn(t,e,n){if(e===n)return!0;if(t==x.BYTES){if(!(e instanceof Uint8Array)||!(n instanceof Uint8Array)||e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}switch(t){case x.UINT64:case x.FIXED64:case x.INT64:case x.SFIXED64:case x.SINT64:return e==n}return!1}function Lr(t,e){switch(t){case x.BOOL:return!1;case x.UINT64:case x.FIXED64:case x.INT64:case x.SFIXED64:case x.SINT64:return e==0?fe.zero:"0";case x.DOUBLE:case x.FLOAT:return 0;case x.BYTES:return new Uint8Array(0);case x.STRING:return"";default:return 0}}function R0(t,e){switch(t){case x.BOOL:return e===!1;case x.STRING:return e==="";case x.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var Re;(function(t){t[t.Varint=0]="Varint",t[t.Bit64=1]="Bit64",t[t.LengthDelimited=2]="LengthDelimited",t[t.StartGroup=3]="StartGroup",t[t.EndGroup=4]="EndGroup",t[t.Bit32=5]="Bit32"})(Re||(Re={}));class jw{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let r=0;r<this.chunks.length;r++)e+=this.chunks[r].length;let n=new Uint8Array(e),i=0;for(let r=0;r<this.chunks.length;r++)n.set(this.chunks[r],i),i+=this.chunks[r].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,n){return this.uint32((e<<3|n)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(Fu(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return ia(e),Bp(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let n=this.textEncoder.encode(e);return this.uint32(n.byteLength),this.raw(n)}float(e){T0(e);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,e,!0),this.raw(n)}double(e){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,e,!0),this.raw(n)}fixed32(e){Fu(e);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,e,!0),this.raw(n)}sfixed32(e){ia(e);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,e,!0),this.raw(n)}sint32(e){return ia(e),e=(e<<1^e>>31)>>>0,Bp(e,this.buf),this}sfixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=fe.enc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}fixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=fe.uEnc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}int64(e){let n=fe.enc(e);return hc(n.lo,n.hi,this.buf),this}sint64(e){let n=fe.enc(e),i=n.hi>>31,r=n.lo<<1^i,s=(n.hi<<1|n.lo>>>31)^i;return hc(r,s,this.buf),this}uint64(e){let n=fe.uEnc(e);return hc(n.lo,n.hi,this.buf),this}}class Vw{constructor(e,n){this.varint64=Ow,this.uint32=Fw,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=n??new TextDecoder}tag(){let e=this.uint32(),n=e>>>3,i=e&7;if(n<=0||i<0||i>5)throw new Error("illegal tag: field no "+n+" wire type "+i);return[n,i]}skip(e,n){let i=this.pos;switch(e){case Re.Varint:for(;this.buf[this.pos++]&128;);break;case Re.Bit64:this.pos+=4;case Re.Bit32:this.pos+=4;break;case Re.LengthDelimited:let r=this.uint32();this.pos+=r;break;case Re.StartGroup:for(;;){const[s,o]=this.tag();if(o===Re.EndGroup){if(n!==void 0&&s!==n)throw new Error("invalid end group tag");break}this.skip(o,s)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(i,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return fe.dec(...this.varint64())}uint64(){return fe.uDec(...this.varint64())}sint64(){let[e,n]=this.varint64(),i=-(e&1);return e=(e>>>1|(n&1)<<31)^i,n=n>>>1^i,fe.dec(e,n)}bool(){let[e,n]=this.varint64();return e!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return fe.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return fe.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),n=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(n,n+e)}string(){return this.textDecoder.decode(this.bytes())}}function Bw(t,e,n,i){let r;return{typeName:e,extendee:n,get field(){if(!r){const s=typeof i=="function"?i():i;s.name=e.split(".").pop(),s.jsonName="[".concat(e,"]"),r=t.util.newFieldList([s]).list()[0]}return r},runtime:t}}function x0(t){const e=t.field.localName,n=Object.create(null);return n[e]=zw(t),[n,()=>n[e]]}function zw(t){const e=t.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return Lr(e.T,e.L);case"message":const n=e.T,i=new n;return n.fieldWrapper?n.fieldWrapper.unwrapField(i):i;case"map":throw"map fields are not allowed to be extensions"}}function Ww(t,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let n=t.length-1;n>=0;--n)if(t[n].no==e.no)return[t[n]];return[]}return t.filter(n=>n.no===e.no)}let vn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),El=[];for(let t=0;t<vn.length;t++)El[vn[t].charCodeAt(0)]=t;El[45]=vn.indexOf("+");El[95]=vn.indexOf("/");const I0={dec(t){let e=t.length*3/4;t[t.length-2]=="="?e-=2:t[t.length-1]=="="&&(e-=1);let n=new Uint8Array(e),i=0,r=0,s,o=0;for(let a=0;a<t.length;a++){if(s=El[t.charCodeAt(a)],s===void 0)switch(t[a]){case"=":r=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(r){case 0:o=s,r=1;break;case 1:n[i++]=o<<2|(s&48)>>4,o=s,r=2;break;case 2:n[i++]=(o&15)<<4|(s&60)>>2,o=s,r=3;break;case 3:n[i++]=(o&3)<<6|s,r=0;break}}if(r==1)throw Error("invalid base64 string.");return n.subarray(0,i)},enc(t){let e="",n=0,i,r=0;for(let s=0;s<t.length;s++)switch(i=t[s],n){case 0:e+=vn[i>>2],r=(i&3)<<4,n=1;break;case 1:e+=vn[r|i>>4],r=(i&15)<<2,n=2;break;case 2:e+=vn[r|i>>6],e+=vn[i&63],n=0;break}return n&&(e+=vn[r],e+="=",n==1&&(e+="=")),e}};function qw(t,e,n){M0(e,t);const i=e.runtime.bin.makeReadOptions(n),r=Ww(t.getType().runtime.bin.listUnknownFields(t),e.field),[s,o]=x0(e);for(const a of r)e.runtime.bin.readField(s,i.readerFactory(a.data),e.field,a.wireType,i);return o()}function Kw(t,e,n,i){M0(e,t);const r=e.runtime.bin.makeReadOptions(i),s=e.runtime.bin.makeWriteOptions(i);if(D0(t,e)){const c=t.getType().runtime.bin.listUnknownFields(t).filter(u=>u.no!=e.field.no);t.getType().runtime.bin.discardUnknownFields(t);for(const u of c)t.getType().runtime.bin.onUnknownField(t,u.no,u.wireType,u.data)}const o=s.writerFactory();let a=e.field;!a.opt&&!a.repeated&&(a.kind=="enum"||a.kind=="scalar")&&(a=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(a,n,o,s);const l=r.readerFactory(o.finish());for(;l.pos<l.len;){const[c,u]=l.tag(),d=l.skip(u,c);t.getType().runtime.bin.onUnknownField(t,c,u,d)}}function D0(t,e){const n=t.getType();return e.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(t).find(i=>i.no==e.field.no)}function M0(t,e){Ce(t.extendee.typeName==e.getType().typeName,"extension ".concat(t.typeName," can only be applied to message ").concat(t.extendee.typeName))}function A0(t,e){const n=t.localName;if(t.repeated)return e[n].length>0;if(t.oneof)return e[t.oneof.localName].case===n;switch(t.kind){case"enum":case"scalar":return t.opt||t.req?e[n]!==void 0:t.kind=="enum"?e[n]!==t.T.values[0].no:!R0(t.T,e[n]);case"message":return e[n]!==void 0;case"map":return Object.keys(e[n]).length>0}}function zp(t,e){const n=t.localName,i=!t.opt&&!t.req;if(t.repeated)e[n]=[];else if(t.oneof)e[t.oneof.localName]={case:void 0};else switch(t.kind){case"map":e[n]={};break;case"enum":e[n]=i?t.T.values[0].no:void 0;break;case"scalar":e[n]=i?Lr(t.T,t.L):void 0;break;case"message":e[n]=void 0;break}}function yn(t,e){if(t===null||typeof t!="object"||!Object.getOwnPropertyNames(Ch.prototype).every(i=>i in t&&typeof t[i]=="function"))return!1;const n=t.getType();return n===null||typeof n!="function"||!("typeName"in n)||typeof n.typeName!="string"?!1:e===void 0?!0:n.typeName==e.typeName}function O0(t,e){return yn(e)||!t.fieldWrapper?e:t.fieldWrapper.wrapField(e)}x.DOUBLE,x.FLOAT,x.INT64,x.UINT64,x.INT32,x.UINT32,x.BOOL,x.STRING,x.BYTES;const Wp={ignoreUnknownFields:!1},qp={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function Hw(t){return t?Object.assign(Object.assign({},Wp),t):Wp}function Gw(t){return t?Object.assign(Object.assign({},qp),t):qp}const Wa=Symbol(),sa=Symbol();function $w(){return{makeReadOptions:Hw,makeWriteOptions:Gw,readMessage(t,e,n,i){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error("cannot decode message ".concat(t.typeName," from JSON: ").concat(Zt(e)));i=i??new t;const r=new Map,s=n.typeRegistry;for(const[o,a]of Object.entries(e)){const l=t.fields.findJsonName(o);if(l){if(l.oneof){if(a===null&&l.kind=="scalar")continue;const c=r.get(l.oneof);if(c!==void 0)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: multiple keys for oneof "').concat(l.oneof.name,'" present: "').concat(c,'", "').concat(o,'"'));r.set(l.oneof,o)}Kp(i,a,l,n,t)}else{let c=!1;if(s!=null&&s.findExtension&&o.startsWith("[")&&o.endsWith("]")){const u=s.findExtension(o.substring(1,o.length-1));if(u&&u.extendee.typeName==t.typeName){c=!0;const[d,h]=x0(u);Kp(d,a,u.field,n,u),Kw(i,u,h(),n)}}if(!c&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: key "').concat(o,'" is unknown'))}}return i},writeMessage(t,e){const n=t.getType(),i={};let r;try{for(r of n.fields.byNumber()){if(!A0(r,t)){if(r.req)throw"required field not set";if(!e.emitDefaultValues||!Qw(r))continue}const o=r.oneof?t[r.oneof.localName].value:t[r.localName],a=Hp(r,o,e);a!==void 0&&(i[e.useProtoFieldName?r.name:r.jsonName]=a)}const s=e.typeRegistry;if(s!=null&&s.findExtensionFor)for(const o of n.runtime.bin.listUnknownFields(t)){const a=s.findExtensionFor(n.typeName,o.no);if(a&&D0(t,a)){const l=qw(t,a,e),c=Hp(a.field,l,e);c!==void 0&&(i[a.field.jsonName]=c)}}}catch(s){const o=r?"cannot encode field ".concat(n.typeName,".").concat(r.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),a=s instanceof Error?s.message:String(s);throw new Error(o+(a.length>0?": ".concat(a):""))}return i},readScalar(t,e,n){return Ps(t,e,n??ai.BIGINT,!0)},writeScalar(t,e,n){if(e!==void 0&&(n||R0(t,e)))return oa(t,e)},debug:Zt}}function Zt(t){if(t===null)return"null";switch(typeof t){case"object":return Array.isArray(t)?"array":"object";case"string":return t.length>100?"string":'"'.concat(t.split('"').join('\\"'),'"');default:return String(t)}}function Kp(t,e,n,i,r){let s=n.localName;if(n.repeated){if(Ce(n.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Zt(e)));const o=t[s];for(const a of e){if(a===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Zt(a)));switch(n.kind){case"message":o.push(n.T.fromJson(a,i));break;case"enum":const l=fc(n.T,a,i.ignoreUnknownFields,!0);l!==sa&&o.push(l);break;case"scalar":try{o.push(Ps(n.T,a,n.L,!0))}catch(c){let u="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Zt(a));throw c instanceof Error&&c.message.length>0&&(u+=": ".concat(c.message)),new Error(u)}break}}}else if(n.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Zt(e)));const o=t[s];for(const[a,l]of Object.entries(e)){if(l===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: map value null"));let c;try{c=Jw(n.K,a)}catch(u){let d="cannot decode map key for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Zt(e));throw u instanceof Error&&u.message.length>0&&(d+=": ".concat(u.message)),new Error(d)}switch(n.V.kind){case"message":o[c]=n.V.T.fromJson(l,i);break;case"enum":const u=fc(n.V.T,l,i.ignoreUnknownFields,!0);u!==sa&&(o[c]=u);break;case"scalar":try{o[c]=Ps(n.V.T,l,ai.BIGINT,!0)}catch(d){let h="cannot decode map value for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Zt(e));throw d instanceof Error&&d.message.length>0&&(h+=": ".concat(d.message)),new Error(h)}break}}}else switch(n.oneof&&(t=t[n.oneof.localName]={case:s},s="value"),n.kind){case"message":const o=n.T;if(e===null&&o.typeName!="google.protobuf.Value")return;let a=t[s];yn(a)?a.fromJson(e,i):(t[s]=a=o.fromJson(e,i),o.fieldWrapper&&!n.oneof&&(t[s]=o.fieldWrapper.unwrapField(a)));break;case"enum":const l=fc(n.T,e,i.ignoreUnknownFields,!1);switch(l){case Wa:zp(n,t);break;case sa:break;default:t[s]=l;break}break;case"scalar":try{const c=Ps(n.T,e,n.L,!1);switch(c){case Wa:zp(n,t);break;default:t[s]=c;break}}catch(c){let u="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(Zt(e));throw c instanceof Error&&c.message.length>0&&(u+=": ".concat(c.message)),new Error(u)}break}}function Jw(t,e){if(t===x.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return Ps(t,e,ai.BIGINT,!0).toString()}function Ps(t,e,n,i){if(e===null)return i?Lr(t,n):Wa;switch(t){case x.DOUBLE:case x.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const r=Number(e);if(Number.isNaN(r)||!Number.isFinite(r))break;return t==x.FLOAT&&T0(r),r;case x.INT32:case x.FIXED32:case x.SFIXED32:case x.SINT32:case x.UINT32:let s;if(typeof e=="number"?s=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(s=Number(e)),s===void 0)break;return t==x.UINT32||t==x.FIXED32?Fu(s):ia(s),s;case x.INT64:case x.SFIXED64:case x.SINT64:if(typeof e!="number"&&typeof e!="string")break;const o=fe.parse(e);return n?o.toString():o;case x.FIXED64:case x.UINT64:if(typeof e!="number"&&typeof e!="string")break;const a=fe.uParse(e);return n?a.toString():a;case x.BOOL:if(typeof e!="boolean")break;return e;case x.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case x.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return I0.dec(e)}throw new Error}function fc(t,e,n,i){if(e===null)return t.typeName=="google.protobuf.NullValue"?0:i?t.values[0].no:Wa;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const r=t.findName(e);if(r!==void 0)return r.no;if(n)return sa;break}throw new Error("cannot decode enum ".concat(t.typeName," from JSON: ").concat(Zt(e)))}function Qw(t){return t.repeated||t.kind=="map"?!0:!(t.oneof||t.kind=="message"||t.opt||t.req)}function Hp(t,e,n){if(t.kind=="map"){Ce(typeof e=="object"&&e!=null);const i={},r=Object.entries(e);switch(t.V.kind){case"scalar":for(const[o,a]of r)i[o.toString()]=oa(t.V.T,a);break;case"message":for(const[o,a]of r)i[o.toString()]=a.toJson(n);break;case"enum":const s=t.V.T;for(const[o,a]of r)i[o.toString()]=pc(s,a,n.enumAsInteger);break}return n.emitDefaultValues||r.length>0?i:void 0}if(t.repeated){Ce(Array.isArray(e));const i=[];switch(t.kind){case"scalar":for(let r=0;r<e.length;r++)i.push(oa(t.T,e[r]));break;case"enum":for(let r=0;r<e.length;r++)i.push(pc(t.T,e[r],n.enumAsInteger));break;case"message":for(let r=0;r<e.length;r++)i.push(e[r].toJson(n));break}return n.emitDefaultValues||i.length>0?i:void 0}switch(t.kind){case"scalar":return oa(t.T,e);case"enum":return pc(t.T,e,n.enumAsInteger);case"message":return O0(t.T,e).toJson(n)}}function pc(t,e,n){var i;if(Ce(typeof e=="number"),t.typeName=="google.protobuf.NullValue")return null;if(n)return e;const r=t.findNumber(e);return(i=r==null?void 0:r.name)!==null&&i!==void 0?i:e}function oa(t,e){switch(t){case x.INT32:case x.SFIXED32:case x.SINT32:case x.FIXED32:case x.UINT32:return Ce(typeof e=="number"),e;case x.FLOAT:case x.DOUBLE:return Ce(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case x.STRING:return Ce(typeof e=="string"),e;case x.BOOL:return Ce(typeof e=="boolean"),e;case x.UINT64:case x.FIXED64:case x.INT64:case x.SFIXED64:case x.SINT64:return Ce(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case x.BYTES:return Ce(e instanceof Uint8Array),I0.enc(e)}}const Ki=Symbol("@bufbuild/protobuf/unknown-fields"),Gp={readUnknownFields:!0,readerFactory:t=>new Vw(t)},$p={writeUnknownFields:!0,writerFactory:()=>new jw};function Yw(t){return t?Object.assign(Object.assign({},Gp),t):Gp}function Xw(t){return t?Object.assign(Object.assign({},$p),t):$p}function Zw(){return{makeReadOptions:Yw,makeWriteOptions:Xw,listUnknownFields(t){var e;return(e=t[Ki])!==null&&e!==void 0?e:[]},discardUnknownFields(t){delete t[Ki]},writeUnknownFields(t,e){const i=t[Ki];if(i)for(const r of i)e.tag(r.no,r.wireType).raw(r.data)},onUnknownField(t,e,n,i){const r=t;Array.isArray(r[Ki])||(r[Ki]=[]),r[Ki].push({no:e,wireType:n,data:i})},readMessage(t,e,n,i,r){const s=t.getType(),o=r?e.len:e.pos+n;let a,l;for(;e.pos<o&&([a,l]=e.tag(),!(r===!0&&l==Re.EndGroup));){const c=s.fields.find(a);if(!c){const u=e.skip(l,a);i.readUnknownFields&&this.onUnknownField(t,a,l,u);continue}Jp(t,e,c,l,i)}if(r&&(l!=Re.EndGroup||a!==n))throw new Error("invalid end group tag")},readField:Jp,writeMessage(t,e,n){const i=t.getType();for(const r of i.fields.byNumber()){if(!A0(r,t)){if(r.req)throw new Error("cannot encode field ".concat(i.typeName,".").concat(r.name," to binary: required field not set"));continue}const s=r.oneof?t[r.oneof.localName].value:t[r.localName];Qp(r,s,e,n)}return n.writeUnknownFields&&this.writeUnknownFields(t,e),e},writeField(t,e,n,i){e!==void 0&&Qp(t,e,n,i)}}}function Jp(t,e,n,i,r){let{repeated:s,localName:o}=n;switch(n.oneof&&(t=t[n.oneof.localName],t.case!=o&&delete t.value,t.case=o,o="value"),n.kind){case"scalar":case"enum":const a=n.kind=="enum"?x.INT32:n.T;let l=qa;if(n.kind=="scalar"&&n.L>0&&(l=tE),s){let h=t[o];if(i==Re.LengthDelimited&&a!=x.STRING&&a!=x.BYTES){let v=e.uint32()+e.pos;for(;e.pos<v;)h.push(l(e,a))}else h.push(l(e,a))}else t[o]=l(e,a);break;case"message":const c=n.T;s?t[o].push(aa(e,new c,r,n)):yn(t[o])?aa(e,t[o],r,n):(t[o]=aa(e,new c,r,n),c.fieldWrapper&&!n.oneof&&!n.repeated&&(t[o]=c.fieldWrapper.unwrapField(t[o])));break;case"map":let[u,d]=eE(n,e,r);t[o][u]=d;break}}function aa(t,e,n,i){const r=e.getType().runtime.bin,s=i==null?void 0:i.delimited;return r.readMessage(e,t,s?i.no:t.uint32(),n,s),e}function eE(t,e,n){const i=e.uint32(),r=e.pos+i;let s,o;for(;e.pos<r;){const[a]=e.tag();switch(a){case 1:s=qa(e,t.K);break;case 2:switch(t.V.kind){case"scalar":o=qa(e,t.V.T);break;case"enum":o=e.int32();break;case"message":o=aa(e,new t.V.T,n,void 0);break}break}}if(s===void 0&&(s=Lr(t.K,ai.BIGINT)),typeof s!="string"&&typeof s!="number"&&(s=s.toString()),o===void 0)switch(t.V.kind){case"scalar":o=Lr(t.V.T,ai.BIGINT);break;case"enum":o=t.V.T.values[0].no;break;case"message":o=new t.V.T;break}return[s,o]}function tE(t,e){const n=qa(t,e);return typeof n=="bigint"?n.toString():n}function qa(t,e){switch(e){case x.STRING:return t.string();case x.BOOL:return t.bool();case x.DOUBLE:return t.double();case x.FLOAT:return t.float();case x.INT32:return t.int32();case x.INT64:return t.int64();case x.UINT64:return t.uint64();case x.FIXED64:return t.fixed64();case x.BYTES:return t.bytes();case x.FIXED32:return t.fixed32();case x.SFIXED32:return t.sfixed32();case x.SFIXED64:return t.sfixed64();case x.SINT64:return t.sint64();case x.UINT32:return t.uint32();case x.SINT32:return t.sint32()}}function Qp(t,e,n,i){Ce(e!==void 0);const r=t.repeated;switch(t.kind){case"scalar":case"enum":let s=t.kind=="enum"?x.INT32:t.T;if(r)if(Ce(Array.isArray(e)),t.packed)iE(n,s,t.no,e);else for(const o of e)_s(n,s,t.no,o);else _s(n,s,t.no,e);break;case"message":if(r){Ce(Array.isArray(e));for(const o of e)Yp(n,i,t,o)}else Yp(n,i,t,e);break;case"map":Ce(typeof e=="object"&&e!=null);for(const[o,a]of Object.entries(e))nE(n,i,t,o,a);break}}function nE(t,e,n,i,r){t.tag(n.no,Re.LengthDelimited),t.fork();let s=i;switch(n.K){case x.INT32:case x.FIXED32:case x.UINT32:case x.SFIXED32:case x.SINT32:s=Number.parseInt(i);break;case x.BOOL:Ce(i=="true"||i=="false"),s=i=="true";break}switch(_s(t,n.K,1,s),n.V.kind){case"scalar":_s(t,n.V.T,2,r);break;case"enum":_s(t,x.INT32,2,r);break;case"message":Ce(r!==void 0),t.tag(2,Re.LengthDelimited).bytes(r.toBinary(e));break}t.join()}function Yp(t,e,n,i){const r=O0(n.T,i);n.delimited?t.tag(n.no,Re.StartGroup).raw(r.toBinary(e)).tag(n.no,Re.EndGroup):t.tag(n.no,Re.LengthDelimited).bytes(r.toBinary(e))}function _s(t,e,n,i){Ce(i!==void 0);let[r,s]=L0(e);t.tag(n,r)[s](i)}function iE(t,e,n,i){if(!i.length)return;t.tag(n,Re.LengthDelimited).fork();let[,r]=L0(e);for(let s=0;s<i.length;s++)t[r](i[s]);t.join()}function L0(t){let e=Re.Varint;switch(t){case x.BYTES:case x.STRING:e=Re.LengthDelimited;break;case x.DOUBLE:case x.FIXED64:case x.SFIXED64:e=Re.Bit64;break;case x.FIXED32:case x.SFIXED32:case x.FLOAT:e=Re.Bit32;break}const n=x[t].toLowerCase();return[e,n]}function rE(){return{setEnumType:b0,initPartial(t,e){if(t===void 0)return;const n=e.getType();for(const i of n.fields.byMember()){const r=i.localName,s=e,o=t;if(o[r]!=null)switch(i.kind){case"oneof":const a=o[r].case;if(a===void 0)continue;const l=i.findField(a);let c=o[r].value;l&&l.kind=="message"&&!yn(c,l.T)?c=new l.T(c):l&&l.kind==="scalar"&&l.T===x.BYTES&&(c=ts(c)),s[r]={case:a,value:c};break;case"scalar":case"enum":let u=o[r];i.T===x.BYTES&&(u=i.repeated?u.map(ts):ts(u)),s[r]=u;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===x.BYTES)for(const[f,v]of Object.entries(o[r]))s[r][f]=ts(v);else Object.assign(s[r],o[r]);break;case"message":const h=i.V.T;for(const f of Object.keys(o[r])){let v=o[r][f];h.fieldWrapper||(v=new h(v)),s[r][f]=v}break}break;case"message":const d=i.T;if(i.repeated)s[r]=o[r].map(h=>yn(h,d)?h:new d(h));else{const h=o[r];d.fieldWrapper?d.typeName==="google.protobuf.BytesValue"?s[r]=ts(h):s[r]=h:s[r]=yn(h,d)?h:new d(h)}break}}},equals(t,e,n){return e===n?!0:!e||!n?!1:t.fields.byMember().every(i=>{const r=e[i.localName],s=n[i.localName];if(i.repeated){if(r.length!==s.length)return!1;switch(i.kind){case"message":return r.every((o,a)=>i.T.equals(o,s[a]));case"scalar":return r.every((o,a)=>Nn(i.T,o,s[a]));case"enum":return r.every((o,a)=>Nn(x.INT32,o,s[a]))}throw new Error("repeated cannot contain ".concat(i.kind))}switch(i.kind){case"message":let o=r,a=s;return i.T.fieldWrapper&&(o!==void 0&&!yn(o)&&(o=i.T.fieldWrapper.wrapField(o)),a!==void 0&&!yn(a)&&(a=i.T.fieldWrapper.wrapField(a))),i.T.equals(o,a);case"enum":return Nn(x.INT32,r,s);case"scalar":return Nn(i.T,r,s);case"oneof":if(r.case!==s.case)return!1;const l=i.findField(r.case);if(l===void 0)return!0;switch(l.kind){case"message":return l.T.equals(r.value,s.value);case"enum":return Nn(x.INT32,r.value,s.value);case"scalar":return Nn(l.T,r.value,s.value)}throw new Error("oneof cannot contain ".concat(l.kind));case"map":const c=Object.keys(r).concat(Object.keys(s));switch(i.V.kind){case"message":const u=i.V.T;return c.every(h=>u.equals(r[h],s[h]));case"enum":return c.every(h=>Nn(x.INT32,r[h],s[h]));case"scalar":const d=i.V.T;return c.every(h=>Nn(d,r[h],s[h]))}break}})},clone(t){const e=t.getType(),n=new e,i=n;for(const r of e.fields.byMember()){const s=t[r.localName];let o;if(r.repeated)o=s.map(jo);else if(r.kind=="map"){o=i[r.localName];for(const[a,l]of Object.entries(s))o[a]=jo(l)}else r.kind=="oneof"?o=r.findField(s.case)?{case:s.case,value:jo(s.value)}:{case:void 0}:o=jo(s);i[r.localName]=o}for(const r of e.runtime.bin.listUnknownFields(t))e.runtime.bin.onUnknownField(i,r.no,r.wireType,r.data);return n}}}function jo(t){if(t===void 0)return t;if(yn(t))return t.clone();if(t instanceof Uint8Array){const e=new Uint8Array(t.byteLength);return e.set(t),e}return t}function ts(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function sE(t,e,n){return{syntax:t,json:$w(),bin:Zw(),util:Object.assign(Object.assign({},rE()),{newFieldList:e,initFields:n}),makeMessageType(i,r,s){return Aw(this,i,r,s)},makeEnum:Mw,makeEnumType:w0,getEnumType:Dw,makeExtension(i,r,s){return Bw(this,i,r,s)}}}class oE{constructor(e,n){this._fields=e,this._normalizer=n}findJsonName(e){if(!this.jsonNames){const n={};for(const i of this.list())n[i.jsonName]=n[i.name]=i;this.jsonNames=n}return this.jsonNames[e]}find(e){if(!this.numbers){const n={};for(const i of this.list())n[i.no]=i;this.numbers=n}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,n)=>e.no-n.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let n;for(const i of this.list())i.oneof?i.oneof!==n&&(n=i.oneof,e.push(n)):e.push(i)}return this.members}}function N0(t,e){const n=F0(t);return e?n:hE(dE(n))}function aE(t){return N0(t,!1)}const lE=F0;function F0(t){let e=!1;const n=[];for(let i=0;i<t.length;i++){let r=t.charAt(i);switch(r){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(r),e=!1;break;default:e&&(e=!1,r=r.toUpperCase()),n.push(r);break}}return n.join("")}const cE=new Set(["constructor","toString","toJSON","valueOf"]),uE=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),U0=t=>"".concat(t,"$"),dE=t=>uE.has(t)?U0(t):t,hE=t=>cE.has(t)?U0(t):t;class fE{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=aE(e)}addField(e){Ce(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let n=0;n<this.fields.length;n++)this._lookup[this.fields[n].localName]=this.fields[n]}return this._lookup[e]}}function pE(t,e){var n,i,r,s,o,a;const l=[];let c;for(const u of typeof t=="function"?t():t){const d=u;if(d.localName=N0(u.name,u.oneof!==void 0),d.jsonName=(n=u.jsonName)!==null&&n!==void 0?n:lE(u.name),d.repeated=(i=u.repeated)!==null&&i!==void 0?i:!1,u.kind=="scalar"&&(d.L=(r=u.L)!==null&&r!==void 0?r:ai.BIGINT),d.delimited=(s=u.delimited)!==null&&s!==void 0?s:!1,d.req=(o=u.req)!==null&&o!==void 0?o:!1,d.opt=(a=u.opt)!==null&&a!==void 0?a:!1,u.packed===void 0&&(d.packed=u.kind=="enum"||u.kind=="scalar"&&u.T!=x.BYTES&&u.T!=x.STRING),u.oneof!==void 0){const h=typeof u.oneof=="string"?u.oneof:u.oneof.name;(!c||c.name!=h)&&(c=new fE(h)),d.oneof=c,c.addField(d)}l.push(d)}return l}const w=sE("proto3",t=>new oE(t,e=>pE(e)),t=>{for(const e of t.getType().fields.byMember()){if(e.opt)continue;const n=e.localName,i=t;if(e.repeated){i[n]=[];continue}switch(e.kind){case"oneof":i[n]={case:void 0};break;case"enum":i[n]=0;break;case"map":i[n]={};break;case"scalar":i[n]=Lr(e.T,e.L);break}}});class ot extends Ch{constructor(e){super(),this.seconds=fe.zero,this.nanos=0,w.util.initPartial(e,this)}fromJson(e,n){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(w.json.debug(e)));const i=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!i)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const r=Date.parse(i[1]+"-"+i[2]+"-"+i[3]+"T"+i[4]+":"+i[5]+":"+i[6]+(i[8]?i[8]:"Z"));if(Number.isNaN(r))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=fe.parse(r/1e3),this.nanos=0,i[7]&&(this.nanos=parseInt("1"+i[7]+"0".repeat(9-i[7].length))-1e9),this}toJson(e){const n=Number(this.seconds)*1e3;if(n<Date.parse("0001-01-01T00:00:00Z")||n>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let i="Z";if(this.nanos>0){const r=(this.nanos+1e9).toString().substring(1);r.substring(3)==="000000"?i="."+r.substring(0,3)+"Z":r.substring(6)==="000"?i="."+r.substring(0,6)+"Z":i="."+r+"Z"}return new Date(n).toISOString().replace(".000Z",i)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return ot.fromDate(new Date)}static fromDate(e){const n=e.getTime();return new ot({seconds:fe.parse(Math.floor(n/1e3)),nanos:n%1e3*1e6})}static fromBinary(e,n){return new ot().fromBinary(e,n)}static fromJson(e,n){return new ot().fromJson(e,n)}static fromJsonString(e,n){return new ot().fromJsonString(e,n)}static equals(e,n){return w.util.equals(ot,e,n)}}ot.runtime=w;ot.typeName="google.protobuf.Timestamp";ot.fields=w.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const mE=w.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:ot},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:gE,repeated:!0},{no:5,name:"events",kind:"message",T:yE,repeated:!0}]),gE=w.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:vE,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),vE=w.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:ot},{no:3,name:"value",kind:"scalar",T:2}]),yE=w.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:ot},{no:7,name:"normalized_end_timestamp",kind:"message",T:ot,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),j0=w.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),zt=w.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),xe=w.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),wh=w.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),hs=w.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),Zs=w.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),Kt=w.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),Si=w.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),kE=w.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),Ne=w.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),Pl=w.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:Ka,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:X0}]),Ka=w.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),SE=w.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:w.getEnumType(xe),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),Ni=w.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:w.getEnumType(kr)},{no:4,name:"tracks",kind:"message",T:sr,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:SE},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:w.getEnumType(eo)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:w.getEnumType(Kt)},{no:18,name:"kind_details",kind:"enum",T:w.getEnumType(TE),repeated:!0}]),kr=w.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),eo=w.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"},{no:7,name:"CONNECTOR"}]),TE=w.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),Ae=w.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),CE=w.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:ni,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:w.getEnumType(V0)},{no:6,name:"sdp_cid",kind:"scalar",T:9}]),sr=w.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:w.getEnumType(zt)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:w.getEnumType(xe)},{no:10,name:"layers",kind:"message",T:ni,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:CE,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:w.getEnumType(Ae)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:X0},{no:19,name:"audio_features",kind:"enum",T:w.getEnumType(Ne),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:w.getEnumType(j0)}]),ni=w.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:w.getEnumType(wh)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9}]),V0=w.makeEnum("livekit.VideoLayer.Mode",[{no:0,name:"MODE_UNUSED"},{no:1,name:"ONE_SPATIAL_LAYER_PER_STREAM"},{no:2,name:"MULTIPLE_SPATIAL_LAYERS_PER_STREAM"},{no:3,name:"ONE_SPATIAL_LAYER_PER_STREAM_INCOMPLETE_RTCP_SR"}]),Ze=w.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:w.getEnumType(G)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:Eh,oneof:"value"},{no:3,name:"speaker",kind:"message",T:bE,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:q0,oneof:"value"},{no:7,name:"transcription",kind:"message",T:wE,oneof:"value"},{no:8,name:"metrics",kind:"message",T:mE,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:Ha,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:Ph,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:_h,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:Rh,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:Ga,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:$a,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:Ja,oneof:"value"},{no:18,name:"encrypted_packet",kind:"message",T:B0,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),G=w.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),B0=w.makeMessageType("livekit.EncryptedPacket",()=>[{no:1,name:"encryption_type",kind:"enum",T:w.getEnumType(Ae)},{no:2,name:"iv",kind:"scalar",T:12},{no:3,name:"key_index",kind:"scalar",T:13},{no:4,name:"encrypted_value",kind:"scalar",T:12}]),z0=w.makeMessageType("livekit.EncryptedPacketPayload",()=>[{no:1,name:"user",kind:"message",T:Eh,oneof:"value"},{no:3,name:"chat_message",kind:"message",T:Ha,oneof:"value"},{no:4,name:"rpc_request",kind:"message",T:Ph,oneof:"value"},{no:5,name:"rpc_ack",kind:"message",T:_h,oneof:"value"},{no:6,name:"rpc_response",kind:"message",T:Rh,oneof:"value"},{no:7,name:"stream_header",kind:"message",T:Ga,oneof:"value"},{no:8,name:"stream_chunk",kind:"message",T:$a,oneof:"value"},{no:9,name:"stream_trailer",kind:"message",T:Ja,oneof:"value"}]),bE=w.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:W0,repeated:!0}]),W0=w.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),Eh=w.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),q0=w.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),wE=w.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:EE,repeated:!0}]),EE=w.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),Ha=w.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),Ph=w.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),_h=w.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),Rh=w.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:K0,oneof:"value"}]),K0=w.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),H0=w.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),G0=w.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:w.getEnumType($0)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),$0=w.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),J0=w.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:w.getEnumType(Q0)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),Q0=w.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),Y0=w.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:Xp},{no:2,name:"screen",kind:"message",T:Xp},{no:3,name:"resume_connection",kind:"enum",T:w.getEnumType(Zs)},{no:4,name:"disabled_codecs",kind:"message",T:PE},{no:5,name:"force_relay",kind:"enum",T:w.getEnumType(Zs)}]),Xp=w.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:w.getEnumType(Zs)}]),PE=w.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:Ka,repeated:!0},{no:2,name:"publish",kind:"message",T:Ka,repeated:!0}]),X0=w.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),Uu=w.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),Z0=w.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:w.getEnumType(Uu)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),ek=w.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),Ga=w.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:w.getEnumType(Ae)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:Z0,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:ek,oneof:"content_header"}],{localName:"DataStream_Header"}),$a=w.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),Ja=w.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),_E=w.makeMessageType("livekit.SubscribedAudioCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"enabled",kind:"scalar",T:8}]),Wt=w.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),ju=w.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),RE=w.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),xE=w.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:li,oneof:"message"},{no:2,name:"answer",kind:"message",T:li,oneof:"message"},{no:3,name:"trickle",kind:"message",T:_l,oneof:"message"},{no:4,name:"add_track",kind:"message",T:to,oneof:"message"},{no:5,name:"mute",kind:"message",T:Rl,oneof:"message"},{no:6,name:"subscription",kind:"message",T:xl,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:tk,oneof:"message"},{no:8,name:"leave",kind:"message",T:Il,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:ik,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:ok,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:Ah,oneof:"message"},{no:13,name:"simulate",kind:"message",T:Yt,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:Dh,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:ck,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:Ih,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:nk,oneof:"message"}]),Zp=w.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:IE,oneof:"message"},{no:2,name:"answer",kind:"message",T:li,oneof:"message"},{no:3,name:"offer",kind:"message",T:li,oneof:"message"},{no:4,name:"trickle",kind:"message",T:_l,oneof:"message"},{no:5,name:"update",kind:"message",T:AE,oneof:"message"},{no:6,name:"track_published",kind:"message",T:xh,oneof:"message"},{no:8,name:"leave",kind:"message",T:Il,oneof:"message"},{no:9,name:"mute",kind:"message",T:Rl,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:OE,oneof:"message"},{no:11,name:"room_update",kind:"message",T:LE,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:FE,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:jE,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:BE,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:WE,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:ME,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:DE,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:KE,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:$E,oneof:"message"},{no:22,name:"request_response",kind:"message",T:JE,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:QE,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:qE,oneof:"message"},{no:25,name:"media_sections_requirement",kind:"message",T:eP,oneof:"message"},{no:26,name:"subscribed_audio_codec_update",kind:"message",T:zE,oneof:"message"}]),Vu=w.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:ni,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:w.getEnumType(V0)}]),to=w.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:w.getEnumType(zt)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:w.getEnumType(xe)},{no:9,name:"layers",kind:"message",T:ni,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:Vu,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:w.getEnumType(Ae)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:w.getEnumType(j0)},{no:17,name:"audio_features",kind:"enum",T:w.getEnumType(Ne),repeated:!0}]),_l=w.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:w.getEnumType(Wt)},{no:3,name:"final",kind:"scalar",T:8}]),Rl=w.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),IE=w.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:Pl},{no:2,name:"participant",kind:"message",T:Ni},{no:3,name:"other_participants",kind:"message",T:Ni,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:rk,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:Y0},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:G0},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:Ka,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),DE=w.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:rk,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:Y0},{no:3,name:"server_info",kind:"message",T:G0},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),xh=w.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:sr}]),ME=w.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),li=w.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13},{no:4,name:"mid_to_track_id",kind:"map",K:9,V:{kind:"scalar",T:9}}]),AE=w.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:Ni,repeated:!0}]),xl=w.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:H0,repeated:!0}]),tk=w.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:w.getEnumType(wh)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),Ih=w.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:w.getEnumType(Ne),repeated:!0}]),nk=w.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),Il=w.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:w.getEnumType(Kt)},{no:3,name:"action",kind:"enum",T:w.getEnumType(Sr)},{no:4,name:"regions",kind:"message",T:HE}]),Sr=w.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),ik=w.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:ni,repeated:!0}]),Dh=w.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),rk=w.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),OE=w.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:W0,repeated:!0}]),LE=w.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:Pl}]),NE=w.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:w.getEnumType(hs)},{no:3,name:"score",kind:"scalar",T:2}]),FE=w.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:NE,repeated:!0}]),UE=w.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:w.getEnumType(ju)}]),jE=w.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:UE,repeated:!0}]),Mh=w.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:w.getEnumType(wh)},{no:2,name:"enabled",kind:"scalar",T:8}]),VE=w.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:Mh,repeated:!0}]),BE=w.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:Mh,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:VE,repeated:!0}]),zE=w.makeMessageType("livekit.SubscribedAudioCodecUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_audio_codecs",kind:"message",T:_E,repeated:!0}]),sk=w.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),ok=w.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:sk,repeated:!0}]),WE=w.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),qE=w.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:Pl},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:Ni},{no:4,name:"other_participants",kind:"message",T:Ni,repeated:!0}]),Ah=w.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:li},{no:2,name:"subscription",kind:"message",T:xl},{no:3,name:"publish_tracks",kind:"message",T:xh,repeated:!0},{no:4,name:"data_channels",kind:"message",T:lk,repeated:!0},{no:5,name:"offer",kind:"message",T:li},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:ak,repeated:!0}]),ak=w.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),lk=w.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:w.getEnumType(Wt)}]),Yt=w.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:w.getEnumType(RE),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),ck=w.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),KE=w.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),HE=w.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:GE,repeated:!0}]),GE=w.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),$E=w.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:w.getEnumType(kE)}]),JE=w.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:w.getEnumType(Oh)},{no:3,name:"message",kind:"scalar",T:9},{no:4,name:"trickle",kind:"message",T:_l,oneof:"request"},{no:5,name:"add_track",kind:"message",T:to,oneof:"request"},{no:6,name:"mute",kind:"message",T:Rl,oneof:"request"},{no:7,name:"update_metadata",kind:"message",T:Dh,oneof:"request"},{no:8,name:"update_audio_track",kind:"message",T:Ih,oneof:"request"},{no:9,name:"update_video_track",kind:"message",T:nk,oneof:"request"}]),Oh=w.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"},{no:4,name:"QUEUED"},{no:5,name:"UNSUPPORTED_TYPE"},{no:6,name:"UNCLASSIFIED_ERROR"}]),QE=w.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),uk=w.makeMessageType("livekit.ConnectionSettings",()=>[{no:1,name:"auto_subscribe",kind:"scalar",T:8},{no:2,name:"adaptive_stream",kind:"scalar",T:8},{no:3,name:"subscriber_allow_pause",kind:"scalar",T:8,opt:!0},{no:4,name:"disable_ice_lite",kind:"scalar",T:8}]),YE=w.makeMessageType("livekit.JoinRequest",()=>[{no:1,name:"client_info",kind:"message",T:J0},{no:2,name:"connection_settings",kind:"message",T:uk},{no:3,name:"metadata",kind:"scalar",T:9},{no:4,name:"participant_attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"add_track_requests",kind:"message",T:to,repeated:!0},{no:6,name:"publisher_offer",kind:"message",T:li},{no:7,name:"reconnect",kind:"scalar",T:8},{no:8,name:"reconnect_reason",kind:"enum",T:w.getEnumType(Si)},{no:9,name:"participant_sid",kind:"scalar",T:9},{no:10,name:"sync_state",kind:"message",T:Ah}]),XE=w.makeMessageType("livekit.WrappedJoinRequest",()=>[{no:1,name:"compression",kind:"enum",T:w.getEnumType(ZE)},{no:2,name:"join_request",kind:"scalar",T:12}]),ZE=w.makeEnum("livekit.WrappedJoinRequest.Compression",[{no:0,name:"NONE"},{no:1,name:"GZIP"}]),eP=w.makeMessageType("livekit.MediaSectionsRequirement",()=>[{no:1,name:"num_audios",kind:"scalar",T:13},{no:2,name:"num_videos",kind:"scalar",T:13}]);function tP(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var la={exports:{}},nP=la.exports,em;function iP(){return em||(em=1,function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(nP,function(){var e=function(){},n="undefined",i=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],s={},o=null;function a(g,y){var p=g[y];if(typeof p.bind=="function")return p.bind(g);try{return Function.prototype.bind.call(p,g)}catch{return function(){return Function.prototype.apply.apply(p,[g,arguments])}}}function l(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function c(g){return g==="debug"&&(g="log"),typeof console===n?!1:g==="trace"&&i?l:console[g]!==void 0?a(console,g):console.log!==void 0?a(console,"log"):e}function u(){for(var g=this.getLevel(),y=0;y<r.length;y++){var p=r[y];this[p]=y<g?e:this.methodFactory(p,g,this.name)}if(this.log=this.debug,typeof console===n&&g<this.levels.SILENT)return"No console available for logging"}function d(g){return function(){typeof console!==n&&(u.call(this),this[g].apply(this,arguments))}}function h(g,y,p){return c(g)||d.apply(this,arguments)}function f(g,y){var p=this,m,k,S,T="loglevel";typeof g=="string"?T+=":"+g:typeof g=="symbol"&&(T=void 0);function b(L){var z=(r[L]||"silent").toUpperCase();if(!(typeof window===n||!T)){try{window.localStorage[T]=z;return}catch{}try{window.document.cookie=encodeURIComponent(T)+"="+z+";"}catch{}}}function P(){var L;if(!(typeof window===n||!T)){try{L=window.localStorage[T]}catch{}if(typeof L===n)try{var z=window.document.cookie,Y=encodeURIComponent(T),we=z.indexOf(Y+"=");we!==-1&&(L=/^([^;]+)/.exec(z.slice(we+Y.length+1))[1])}catch{}return p.levels[L]===void 0&&(L=void 0),L}}function E(){if(!(typeof window===n||!T)){try{window.localStorage.removeItem(T)}catch{}try{window.document.cookie=encodeURIComponent(T)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function I(L){var z=L;if(typeof z=="string"&&p.levels[z.toUpperCase()]!==void 0&&(z=p.levels[z.toUpperCase()]),typeof z=="number"&&z>=0&&z<=p.levels.SILENT)return z;throw new TypeError("log.setLevel() called with invalid level: "+L)}p.name=g,p.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},p.methodFactory=y||h,p.getLevel=function(){return S??k??m},p.setLevel=function(L,z){return S=I(L),z!==!1&&b(S),u.call(p)},p.setDefaultLevel=function(L){k=I(L),P()||p.setLevel(L,!1)},p.resetLevel=function(){S=null,E(),u.call(p)},p.enableAll=function(L){p.setLevel(p.levels.TRACE,L)},p.disableAll=function(L){p.setLevel(p.levels.SILENT,L)},p.rebuild=function(){if(o!==p&&(m=I(o.getLevel())),u.call(p),o===p)for(var L in s)s[L].rebuild()},m=I(o?o.getLevel():"WARN");var _=P();_!=null&&(S=I(_)),u.call(p)}o=new f,o.getLogger=function(y){if(typeof y!="symbol"&&typeof y!="string"||y==="")throw new TypeError("You must supply a name when creating a logger.");var p=s[y];return p||(p=s[y]=new f(y,o.methodFactory)),p};var v=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=v),o},o.getLoggers=function(){return s},o.default=o,o})}(la)),la.exports}var Dl=iP(),Bu;(function(t){t[t.trace=0]="trace",t[t.debug=1]="debug",t[t.info=2]="info",t[t.warn=3]="warn",t[t.error=4]="error",t[t.silent=5]="silent"})(Bu||(Bu={}));var Jt;(function(t){t.Default="livekit",t.Room="livekit-room",t.TokenSource="livekit-token-source",t.Participant="livekit-participant",t.Track="livekit-track",t.Publication="livekit-track-publication",t.Engine="livekit-engine",t.Signal="livekit-signal",t.PCManager="livekit-pc-manager",t.PCTransport="livekit-pc-transport",t.E2EE="lk-e2ee"})(Jt||(Jt={}));let H=Dl.getLogger("livekit");Object.values(Jt).map(t=>Dl.getLogger(t));H.setDefaultLevel(Bu.info);function Dn(t){const e=Dl.getLogger(t);return e.setDefaultLevel(H.getLevel()),e}const rP=Dl.getLogger("lk-e2ee"),ns=7e3,sP=[0,300,2*2*300,3*3*300,4*4*300,ns,ns,ns,ns,ns];class oP{constructor(e){this._retryDelays=e!==void 0?[...e]:sP}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const n=this._retryDelays[e.retryCount];return e.retryCount<=1?n:n+Math.random()*1e3}}function aP(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n}function C(t,e,n,i){function r(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{c(i.next(u))}catch(d){o(d)}}function l(u){try{c(i.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):r(u.value).then(a,l)}c((i=i.apply(t,e||[])).next())})}function tm(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function kn(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof tm=="function"?tm(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(s){n[s]=t[s]&&function(o){return new Promise(function(a,l){o=t[s](o),r(a,l,o.done,o.value)})}}function r(s,o,a,l){Promise.resolve(l).then(function(c){s({value:c,done:a})},o)}}var Vo={exports:{}},nm;function lP(){if(nm)return Vo.exports;nm=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(T,b,P){return Function.prototype.apply.call(T,b,P)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(T){return Object.getOwnPropertyNames(T).concat(Object.getOwnPropertySymbols(T))}:n=function(T){return Object.getOwnPropertyNames(T)};function i(S){console&&console.warn&&console.warn(S)}var r=Number.isNaN||function(T){return T!==T};function s(){s.init.call(this)}Vo.exports=s,Vo.exports.once=p,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(S){if(typeof S!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof S)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(S){if(typeof S!="number"||S<0||r(S))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+S+".");o=S}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(T){if(typeof T!="number"||T<0||r(T))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+T+".");return this._maxListeners=T,this};function l(S){return S._maxListeners===void 0?s.defaultMaxListeners:S._maxListeners}s.prototype.getMaxListeners=function(){return l(this)},s.prototype.emit=function(T){for(var b=[],P=1;P<arguments.length;P++)b.push(arguments[P]);var E=T==="error",I=this._events;if(I!==void 0)E=E&&I.error===void 0;else if(!E)return!1;if(E){var _;if(b.length>0&&(_=b[0]),_ instanceof Error)throw _;var L=new Error("Unhandled error."+(_?" ("+_.message+")":""));throw L.context=_,L}var z=I[T];if(z===void 0)return!1;if(typeof z=="function")e(z,this,b);else for(var Y=z.length,we=v(z,Y),P=0;P<Y;++P)e(we[P],this,b);return!0};function c(S,T,b,P){var E,I,_;if(a(b),I=S._events,I===void 0?(I=S._events=Object.create(null),S._eventsCount=0):(I.newListener!==void 0&&(S.emit("newListener",T,b.listener?b.listener:b),I=S._events),_=I[T]),_===void 0)_=I[T]=b,++S._eventsCount;else if(typeof _=="function"?_=I[T]=P?[b,_]:[_,b]:P?_.unshift(b):_.push(b),E=l(S),E>0&&_.length>E&&!_.warned){_.warned=!0;var L=new Error("Possible EventEmitter memory leak detected. "+_.length+" "+String(T)+" listeners added. Use emitter.setMaxListeners() to increase limit");L.name="MaxListenersExceededWarning",L.emitter=S,L.type=T,L.count=_.length,i(L)}return S}s.prototype.addListener=function(T,b){return c(this,T,b,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(T,b){return c(this,T,b,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(S,T,b){var P={fired:!1,wrapFn:void 0,target:S,type:T,listener:b},E=u.bind(P);return E.listener=b,P.wrapFn=E,E}s.prototype.once=function(T,b){return a(b),this.on(T,d(this,T,b)),this},s.prototype.prependOnceListener=function(T,b){return a(b),this.prependListener(T,d(this,T,b)),this},s.prototype.removeListener=function(T,b){var P,E,I,_,L;if(a(b),E=this._events,E===void 0)return this;if(P=E[T],P===void 0)return this;if(P===b||P.listener===b)--this._eventsCount===0?this._events=Object.create(null):(delete E[T],E.removeListener&&this.emit("removeListener",T,P.listener||b));else if(typeof P!="function"){for(I=-1,_=P.length-1;_>=0;_--)if(P[_]===b||P[_].listener===b){L=P[_].listener,I=_;break}if(I<0)return this;I===0?P.shift():g(P,I),P.length===1&&(E[T]=P[0]),E.removeListener!==void 0&&this.emit("removeListener",T,L||b)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(T){var b,P,E;if(P=this._events,P===void 0)return this;if(P.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):P[T]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete P[T]),this;if(arguments.length===0){var I=Object.keys(P),_;for(E=0;E<I.length;++E)_=I[E],_!=="removeListener"&&this.removeAllListeners(_);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(b=P[T],typeof b=="function")this.removeListener(T,b);else if(b!==void 0)for(E=b.length-1;E>=0;E--)this.removeListener(T,b[E]);return this};function h(S,T,b){var P=S._events;if(P===void 0)return[];var E=P[T];return E===void 0?[]:typeof E=="function"?b?[E.listener||E]:[E]:b?y(E):v(E,E.length)}s.prototype.listeners=function(T){return h(this,T,!0)},s.prototype.rawListeners=function(T){return h(this,T,!1)},s.listenerCount=function(S,T){return typeof S.listenerCount=="function"?S.listenerCount(T):f.call(S,T)},s.prototype.listenerCount=f;function f(S){var T=this._events;if(T!==void 0){var b=T[S];if(typeof b=="function")return 1;if(b!==void 0)return b.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function v(S,T){for(var b=new Array(T),P=0;P<T;++P)b[P]=S[P];return b}function g(S,T){for(;T+1<S.length;T++)S[T]=S[T+1];S.pop()}function y(S){for(var T=new Array(S.length),b=0;b<T.length;++b)T[b]=S[b].listener||S[b];return T}function p(S,T){return new Promise(function(b,P){function E(_){S.removeListener(T,I),P(_)}function I(){typeof S.removeListener=="function"&&S.removeListener("error",E),b([].slice.call(arguments))}k(S,T,I,{once:!0}),T!=="error"&&m(S,E,{once:!0})})}function m(S,T,b){typeof S.on=="function"&&k(S,"error",T,b)}function k(S,T,b,P){if(typeof S.on=="function")P.once?S.once(T,b):S.on(T,b);else if(typeof S.addEventListener=="function")S.addEventListener(T,function E(I){P.once&&S.removeEventListener(T,E),b(I)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof S)}return Vo.exports}var cn=lP();let dk=!0,hk=!0;function fs(t,e,n){const i=t.match(e);return i&&i.length>=n&&parseFloat(i[n],10)}function Bi(t,e,n){if(!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(o,a){if(o!==e)return r.apply(this,arguments);const l=c=>{const u=n(c);u&&(a.handleEvent?a.handleEvent(u):a(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,l),r.apply(this,[o,l])};const s=i.removeEventListener;i.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(a))return s.apply(this,arguments);const l=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,l])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function cP(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(dk=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function uP(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(hk=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function fk(){if(typeof window=="object"){if(dk)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Lh(t,e){hk&&console.warn(t+" is deprecated, please use "+e+" instead.")}function dP(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const i=n.userAgentData.brands.find(r=>r.brand==="Chromium");if(i)return{browser:"chrome",version:parseInt(i.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(fs(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(fs(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(fs(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=fs(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function im(t){return Object.prototype.toString.call(t)==="[object Object]"}function pk(t){return im(t)?Object.keys(t).reduce(function(e,n){const i=im(t[n]),r=i?pk(t[n]):t[n],s=i&&!Object.keys(r).length;return r===void 0||s?e:Object.assign(e,{[n]:r})},{}):t}function zu(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?zu(t,t.get(e[i]),n):i.endsWith("Ids")&&e[i].forEach(r=>{zu(t,t.get(r),n)})}))}function rm(t,e,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const s=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&s.push(o)}),s.forEach(o=>{t.forEach(a=>{a.type===i&&a.trackId===o.id&&zu(t,a,r)})}),r}const sm=fk;function mk(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const i=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const l={};return Object.keys(a).forEach(c=>{if(c==="require"||c==="advanced"||c==="mediaSource")return;const u=typeof a[c]=="object"?a[c]:{ideal:a[c]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const d=function(h,f){return h?h+f.charAt(0).toUpperCase()+f.slice(1):f==="deviceId"?"sourceId":f};if(u.ideal!==void 0){l.optional=l.optional||[];let h={};typeof u.ideal=="number"?(h[d("min",c)]=u.ideal,l.optional.push(h),h={},h[d("max",c)]=u.ideal,l.optional.push(h)):(h[d("",c)]=u.ideal,l.optional.push(h))}u.exact!==void 0&&typeof u.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[d("",c)]=u.exact):["min","max"].forEach(h=>{u[h]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[d(h,c)]=u[h])})}),a.advanced&&(l.optional=(l.optional||[]).concat(a.advanced)),l},r=function(a,l){if(e.version>=61)return l(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const c=function(u,d,h){d in u&&!(h in u)&&(u[h]=u[d],delete u[d])};a=JSON.parse(JSON.stringify(a)),c(a.audio,"autoGainControl","googAutoGainControl"),c(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=i(a.audio)}if(a&&typeof a.video=="object"){let c=a.video.facingMode;c=c&&(typeof c=="object"?c:{ideal:c});const u=e.version<66;if(c&&(c.exact==="user"||c.exact==="environment"||c.ideal==="user"||c.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete a.video.facingMode;let d;if(c.exact==="environment"||c.ideal==="environment"?d=["back","rear"]:(c.exact==="user"||c.ideal==="user")&&(d=["front"]),d)return n.mediaDevices.enumerateDevices().then(h=>{h=h.filter(v=>v.kind==="videoinput");let f=h.find(v=>d.some(g=>v.label.toLowerCase().includes(g)));return!f&&h.length&&d.includes("back")&&(f=h[h.length-1]),f&&(a.video.deviceId=c.exact?{exact:f.deviceId}:{ideal:f.deviceId}),a.video=i(a.video),sm("chrome: "+JSON.stringify(a)),l(a)})}a.video=i(a.video)}return sm("chrome: "+JSON.stringify(a)),l(a)},s=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,l,c){r(a,u=>{n.webkitGetUserMedia(u,l,d=>{c&&c(s(d))})})};if(n.getUserMedia=o.bind(n),n.mediaDevices.getUserMedia){const a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(l){return r(l,c=>a(c).then(u=>{if(c.audio&&!u.getAudioTracks().length||c.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(d=>{d.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(s(u))))}}}function gk(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function vk(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",r=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===r.track.id):s={track:r.track};const o=new Event("track");o.track=r.track,o.receiver=s,o.transceiver={receiver:s},o.streams=[i.stream],this.dispatchEvent(o)}),i.stream.getTracks().forEach(r=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===r.id):s={track:r};const o=new Event("track");o.track=r,o.receiver=s,o.transceiver={receiver:s},o.streams=[i.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Bi(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function yk(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(r,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=r.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:r}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,l){let c=r.apply(this,arguments);return c||(c=e(this,a),this._senders.push(c)),c};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){s.apply(this,arguments);const l=this._senders.indexOf(a);l!==-1&&this._senders.splice(l,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],n.apply(this,[s]),s.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],i.apply(this,[s]),s.getTracks().forEach(o=>{const a=this._senders.find(l=>l.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function kk(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=n.apply(this,[]);return s.forEach(o=>o._pc=this),s});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=i.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(o=>rm(o,s.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach(s=>s._pc=this),r}),Bi(t,"track",i=>(i.receiver._pc=i.srcElement,i)),t.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(s=>rm(s,r.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const i=arguments[0];let r,s,o;return this.getSenders().forEach(a=>{a.track===i&&(r?o=!0:r=a)}),this.getReceivers().forEach(a=>(a.track===i&&(s?o=!0:s=a),a.track===i)),o||r&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function Sk(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(l)===-1&&this._shimmedLocalStreams[a.id].push(l):this._shimmedLocalStreams[a.id]=[a,l],l};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(c=>{if(this.getSenders().find(d=>d.track===c))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();n.apply(this,arguments);const l=this.getSenders().filter(c=>a.indexOf(c)===-1);this._shimmedLocalStreams[o.id]=[o].concat(l)};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],i.apply(this,arguments)};const r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const l=this._shimmedLocalStreams[a].indexOf(o);l!==-1&&this._shimmedLocalStreams[a].splice(l,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),r.apply(this,arguments)}}function Tk(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return Sk(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const u=n.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(d=>this._reverseStreams[d.id])};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(d=>{if(this.getSenders().find(f=>f.track===d))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const d=new t.MediaStream(u.getTracks());this._streams[u.id]=d,this._reverseStreams[d.id]=u,u=d}i.apply(this,[u])};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},t.RTCPeerConnection.prototype.addTrack=function(u,d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const h=[].slice.call(arguments,1);if(h.length!==1||!h[0].getTracks().find(g=>g===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(g=>g.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const v=this._streams[d.id];if(v)v.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const g=new t.MediaStream([u]);this._streams[d.id]=g,this._reverseStreams[g.id]=d,this.addStream(g)}return this.getSenders().find(g=>g.track===u)};function s(c,u){let d=u.sdp;return Object.keys(c._reverseStreams||[]).forEach(h=>{const f=c._reverseStreams[h],v=c._streams[f.id];d=d.replace(new RegExp(v.id,"g"),f.id)}),new RTCSessionDescription({type:u.type,sdp:d})}function o(c,u){let d=u.sdp;return Object.keys(c._reverseStreams||[]).forEach(h=>{const f=c._reverseStreams[h],v=c._streams[f.id];d=d.replace(new RegExp(f.id,"g"),v.id)}),new RTCSessionDescription({type:u.type,sdp:d})}["createOffer","createAnswer"].forEach(function(c){const u=t.RTCPeerConnection.prototype[c],d={[c](){const h=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[v=>{const g=s(this,v);h[0].apply(null,[g])},v=>{h[1]&&h[1].apply(null,v)},arguments[2]]):u.apply(this,arguments).then(v=>s(this,v))}};t.RTCPeerConnection.prototype[c]=d[c]});const a=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const l=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const c=l.get.apply(this);return c.type===""?c:s(this,c)}}),t.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let h;Object.keys(this._streams).forEach(f=>{this._streams[f].getTracks().find(g=>u.track===g)&&(h=this._streams[f])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Wu(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=t.RTCPeerConnection.prototype[n],r={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=r[n]})}function Ck(t,e){Bi(t,"negotiationneeded",n=>{const i=n.target;if(!((e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return n})}var om=Object.freeze({__proto__:null,fixNegotiationNeeded:Ck,shimAddTrackRemoveTrack:Tk,shimAddTrackRemoveTrackWithNative:Sk,shimGetSendersWithDtmf:yk,shimGetUserMedia:mk,shimMediaStream:gk,shimOnTrack:vk,shimPeerConnection:Wu,shimSenderReceiverGetStats:kk});function bk(t,e){const n=t&&t.navigator,i=t&&t.MediaStreamTrack;if(n.getUserMedia=function(r,s,o){Lh("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(r).then(s,o)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const r=function(o,a,l){a in o&&!(l in o)&&(o[l]=o[a],delete o[a])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),r(o.audio,"autoGainControl","mozAutoGainControl"),r(o.audio,"noiseSuppression","mozNoiseSuppression")),s(o)},i&&i.prototype.getSettings){const o=i.prototype.getSettings;i.prototype.getSettings=function(){const a=o.apply(this,arguments);return r(a,"mozAutoGainControl","autoGainControl"),r(a,"mozNoiseSuppression","noiseSuppression"),a}}if(i&&i.prototype.applyConstraints){const o=i.prototype.applyConstraints;i.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),r(a,"autoGainControl","mozAutoGainControl"),r(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function hP(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return i.video===!0?i.video={mediaSource:e}:i.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(i)})}function wk(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function qu(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const s=t.RTCPeerConnection.prototype[r],o={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=o[r]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,o,a]=arguments;return i.apply(this,[s||null]).then(l=>{if(e.version<53&&!o)try{l.forEach(c=>{c.type=n[c.type]||c.type})}catch(c){if(c.name!=="TypeError")throw c;l.forEach((u,d)=>{l.set(d,Object.assign({},u,{type:n[u.type]||u.type}))})}return l}).then(o,a)}}function Ek(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const r=n.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Pk(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i}),Bi(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function _k(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){Lh("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&n.getTracks().includes(i.track)&&this.removeTrack(i)})})}function Rk(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function xk(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const r=i.length>0;r&&i.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=e.apply(this,arguments);if(r){const{sender:o}=s,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=i,o.sendEncodings=i,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return s})}function Ik(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const i=e.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function Dk(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function Mk(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var am=Object.freeze({__proto__:null,shimAddTransceiver:xk,shimCreateAnswer:Mk,shimCreateOffer:Dk,shimGetDisplayMedia:hP,shimGetParameters:Ik,shimGetUserMedia:bk,shimOnTrack:wk,shimPeerConnection:qu,shimRTCDataChannel:Rk,shimReceiverGetStats:Pk,shimRemoveStream:_k,shimSenderGetStats:Ek});function Ak(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(r=>e.call(this,r,i)),i.getVideoTracks().forEach(r=>e.call(this,r,i))},t.RTCPeerConnection.prototype.addTrack=function(i){for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];return s&&s.forEach(a=>{this._localStreams?this._localStreams.includes(a)||this._localStreams.push(a):this._localStreams=[a]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(n);if(i===-1)return;this._localStreams.splice(i,1);const r=n.getTracks();this.getSenders().forEach(s=>{r.includes(s.track)&&this.removeTrack(s)})})}}function Ok(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(r=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(r))return;this._remoteStreams.push(r);const s=new Event("addstream");s.stream=r,this.dispatchEvent(s)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(s=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(s)>=0)return;i._remoteStreams.push(s);const o=new Event("addstream");o.stream=s,i.dispatchEvent(o)})}),e.apply(i,arguments)}}}function Lk(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,i=e.createAnswer,r=e.setLocalDescription,s=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(c,u){const d=arguments.length>=2?arguments[2]:arguments[0],h=n.apply(this,[d]);return u?(h.then(c,u),Promise.resolve()):h},e.createAnswer=function(c,u){const d=arguments.length>=2?arguments[2]:arguments[0],h=i.apply(this,[d]);return u?(h.then(c,u),Promise.resolve()):h};let a=function(l,c,u){const d=r.apply(this,[l]);return u?(d.then(c,u),Promise.resolve()):d};e.setLocalDescription=a,a=function(l,c,u){const d=s.apply(this,[l]);return u?(d.then(c,u),Promise.resolve()):d},e.setRemoteDescription=a,a=function(l,c,u){const d=o.apply(this,[l]);return u?(d.then(c,u),Promise.resolve()):d},e.addIceCandidate=a}function Nk(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,i=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=r=>i(Fk(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(i,r,s){e.mediaDevices.getUserMedia(i).then(r,s)}).bind(e))}function Fk(t){return t&&t.video!==void 0?Object.assign({},t,{video:pk(t.video)}):t}function Uk(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(i,r){if(i&&i.iceServers){const s=[];for(let o=0;o<i.iceServers.length;o++){let a=i.iceServers[o];a.urls===void 0&&a.url?(Lh("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,s.push(a)):s.push(i.iceServers[o])}i.iceServers=s}return new e(i,r)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function jk(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Vk(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const r=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveAudio===!0&&!r&&this.addTransceiver("audio",{direction:"recvonly"}),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):i.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function Bk(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var lm=Object.freeze({__proto__:null,shimAudioContext:Bk,shimCallbacksAPI:Lk,shimConstraints:Fk,shimCreateOfferLegacy:Vk,shimGetUserMedia:Nk,shimLocalStreamsAPI:Ak,shimRTCIceServerUrls:Uk,shimRemoteStreamsAPI:Ok,shimTrackEventTransceiver:jk}),mc={exports:{}},cm;function fP(){return cm||(cm=1,function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(n){return n.split(`
m=`).map((r,s)=>(s>0?"m="+r:r).trim()+`\r
`)},e.getDescription=function(n){const i=e.splitSections(n);return i&&i[0]},e.getMediaSections=function(n){const i=e.splitSections(n);return i.shift(),i},e.matchPrefix=function(n,i){return e.splitLines(n).filter(r=>r.indexOf(i)===0)},e.parseCandidate=function(n){let i;n.indexOf("a=candidate:")===0?i=n.substring(12).split(" "):i=n.substring(10).split(" ");const r={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let s=8;s<i.length;s+=2)switch(i[s]){case"raddr":r.relatedAddress=i[s+1];break;case"rport":r.relatedPort=parseInt(i[s+1],10);break;case"tcptype":r.tcpType=i[s+1];break;case"ufrag":r.ufrag=i[s+1],r.usernameFragment=i[s+1];break;default:r[i[s]]===void 0&&(r[i[s]]=i[s+1]);break}return r},e.writeCandidate=function(n){const i=[];i.push(n.foundation);const r=n.component;r==="rtp"?i.push(1):r==="rtcp"?i.push(2):i.push(r),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const s=n.type;return i.push("typ"),i.push(s),s!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let i=n.substring(9).split(" ");const r={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),r.name=i[0],r.clockRate=parseInt(i[1],10),r.channels=i.length===3?parseInt(i[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const r=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const i={};let r;const s=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<s.length;o++)r=s[o].trim().split("="),i[r[0].trim()]=r[1];return i},e.writeFmtp=function(n){let i="",r=n.payloadType;if(n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const s=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?s.push(o+"="+n.parameters[o]):s.push(o)}),i+="a=fmtp:"+r+" "+s.join(";")+`\r
`}return i},e.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(n){let i="",r=n.payloadType;return n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(s=>{i+="a=rtcp-fb:"+r+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(n){const i=n.indexOf(" "),r={ssrc:parseInt(n.substring(7,i),10)},s=n.indexOf(":",i);return s>-1?(r.attribute=n.substring(i+1,s),r.value=n.substring(s+1)):r.attribute=n.substring(i+1),r},e.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(r=>parseInt(r,10))}},e.getMid=function(n){const i=e.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:e.matchPrefix(n+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,i){let r="a=setup:"+i+`\r
`;return n.fingerprints.forEach(s=>{r+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),r},e.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,i){return e.matchPrefix(n+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,i){const r=e.matchPrefix(n+i,"a=ice-ufrag:")[0],s=e.matchPrefix(n+i,"a=ice-pwd:")[0];return r&&s?{usernameFragment:r.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=e.splitLines(n)[0].split(" ");i.profile=s[2];for(let a=3;a<s.length;a++){const l=s[a],c=e.matchPrefix(n,"a=rtpmap:"+l+" ")[0];if(c){const u=e.parseRtpMap(c),d=e.matchPrefix(n,"a=fmtp:"+l+" ");switch(u.parameters=d.length?e.parseFmtp(d[0]):{},u.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+l+" ").map(e.parseRtcpFb),i.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(a=>{i.headerExtensions.push(e.parseExtmap(a))});const o=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(a=>{o.forEach(l=>{a.rtcpFeedback.find(u=>u.type===l.type&&u.parameter===l.parameter)||a.rtcpFeedback.push(l)})}),i},e.writeRtpDescription=function(n,i){let r="";r+="m="+n+" ",r+=i.codecs.length>0?"9":"0",r+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=i.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(o=>{r+=e.writeRtpMap(o),r+=e.writeFmtp(o),r+=e.writeRtcpFb(o)});let s=0;return i.codecs.forEach(o=>{o.maxptime>s&&(s=o.maxptime)}),s>0&&(r+="a=maxptime:"+s+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(o=>{r+=e.writeExtmap(o)}),r},e.parseRtpEncodingParameters=function(n){const i=[],r=e.parseRtpParameters(n),s=r.fecMechanisms.indexOf("RED")!==-1,o=r.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(n,"a=ssrc:").map(h=>e.parseSsrcMedia(h)).filter(h=>h.attribute==="cname"),l=a.length>0&&a[0].ssrc;let c;const u=e.matchPrefix(n,"a=ssrc-group:FID").map(h=>h.substring(17).split(" ").map(v=>parseInt(v,10)));u.length>0&&u[0].length>1&&u[0][0]===l&&(c=u[0][1]),r.codecs.forEach(h=>{if(h.name.toUpperCase()==="RTX"&&h.parameters.apt){let f={ssrc:l,codecPayloadType:parseInt(h.parameters.apt,10)};l&&c&&(f.rtx={ssrc:c}),i.push(f),s&&(f=JSON.parse(JSON.stringify(f)),f.fec={ssrc:l,mechanism:o?"red+ulpfec":"red"},i.push(f))}}),i.length===0&&l&&i.push({ssrc:l});let d=e.matchPrefix(n,"b=");return d.length&&(d[0].indexOf("b=TIAS:")===0?d=parseInt(d[0].substring(7),10):d[0].indexOf("b=AS:")===0?d=parseInt(d[0].substring(5),10)*1e3*.95-50*40*8:d=void 0,i.forEach(h=>{h.maxBitrate=d})),i},e.parseRtcpParameters=function(n){const i={},r=e.matchPrefix(n,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];r&&(i.cname=r.value,i.ssrc=r.ssrc);const s=e.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=s.length>0,i.compound=s.length===0;const o=e.matchPrefix(n,"a=rtcp-mux");return i.mux=o.length>0,i},e.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},e.parseMsid=function(n){let i;const r=e.matchPrefix(n,"a=msid:");if(r.length===1)return i=r[0].substring(7).split(" "),{stream:i[0],track:i[1]};const s=e.matchPrefix(n,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(s.length>0)return i=s[0].value.split(" "),{stream:i[0],track:i[1]}},e.parseSctpDescription=function(n){const i=e.parseMLine(n),r=e.matchPrefix(n,"a=max-message-size:");let s;r.length>0&&(s=parseInt(r[0].substring(19),10)),isNaN(s)&&(s=65536);const o=e.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:i.fmt,maxMessageSize:s};const a=e.matchPrefix(n,"a=sctpmap:");if(a.length>0){const l=a[0].substring(10).split(" ");return{port:parseInt(l[0],10),protocol:l[1],maxMessageSize:s}}},e.writeSctpDescription=function(n,i){let r=[];return n.protocol!=="DTLS/SCTP"?r=["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:r=["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&r.push("a=max-message-size:"+i.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,i,r){let s;const o=i!==void 0?i:2;return n?s=n:s=e.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,i){const r=e.splitLines(n);for(let s=0;s<r.length;s++)switch(r[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[s].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const r=e.splitLines(n)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},e.parseOLine=function(n){const r=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=e.splitLines(n);for(let r=0;r<i.length;r++)if(i[r].length<2||i[r].charAt(1)!=="=")return!1;return!0},t.exports=e}(mc)),mc.exports}var zk=fP(),Tr=tP(zk),pP=bw({__proto__:null,default:Tr},[zk]);function ca(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substring(2)),i.candidate&&i.candidate.length){const r=new e(i),s=Tr.parseCandidate(i.candidate);for(const o in s)o in r||Object.defineProperty(r,o,{value:s[o]});return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new e(i)},t.RTCIceCandidate.prototype=e.prototype,Bi(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function Ku(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Bi(t,"icecandidate",e=>{if(e.candidate){const n=Tr.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function ua(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(a){if(!a||!a.sdp)return!1;const l=Tr.splitSections(a.sdp);return l.shift(),l.some(c=>{const u=Tr.parseMLine(c);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},i=function(a){const l=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(l===null||l.length<2)return-1;const c=parseInt(l[1],10);return c!==c?-1:c},r=function(a){let l=65536;return e.browser==="firefox"&&(e.version<57?a===-1?l=16384:l=2147483637:e.version<60?l=e.version===57?65535:65536:l=2147483637),l},s=function(a,l){let c=65536;e.browser==="firefox"&&e.version===57&&(c=65535);const u=Tr.matchPrefix(a.sdp,"a=max-message-size:");return u.length>0?c=parseInt(u[0].substring(19),10):e.browser==="firefox"&&l!==-1&&(c=2147483637),c},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const l=i(arguments[0]),c=r(l),u=s(arguments[0],l);let d;c===0&&u===0?d=Number.POSITIVE_INFINITY:c===0||u===0?d=Math.max(c,u):d=Math.min(c,u);const h={};Object.defineProperty(h,"maxMessageSize",{get(){return d}}),this._sctp=h}return o.apply(this,arguments)}}function da(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(i,r){const s=i.send;i.send=function(){const a=arguments[0],l=a.length||a.size||a.byteLength;if(i.readyState==="open"&&r.sctp&&l>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return s.apply(i,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const r=n.apply(this,arguments);return e(r,this),r},Bi(t,"datachannel",i=>(e(i.channel,i.target),i))}function Hu(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const s=r.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const o=new Event("connectionstatechange",r);s.dispatchEvent(o)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function Gu(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=r.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&r instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:r.type,sdp:s}):r.sdp=s}return n.apply(this,arguments)}}function ha(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function fa(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer";break}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}var mP=Object.freeze({__proto__:null,removeExtmapAllowMixed:Gu,shimAddIceCandidateNullOrEmpty:ha,shimConnectionState:Hu,shimMaxMessageSize:ua,shimParameterlessSetLocalDescription:fa,shimRTCIceCandidate:ca,shimRTCIceCandidateRelayProtocol:Ku,shimSendThrowTypeError:da});function gP(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=fk,i=dP(t),r={browserDetails:i,commonShim:mP,extractVersion:fs,disableLog:cP,disableWarnings:uP,sdp:pP};switch(i.browser){case"chrome":if(!om||!Wu||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=om,ha(t,i),fa(t),mk(t,i),gk(t),Wu(t,i),vk(t),Tk(t,i),yk(t),kk(t),Ck(t,i),ca(t),Ku(t),Hu(t),ua(t,i),da(t),Gu(t,i);break;case"firefox":if(!am||!qu||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=am,ha(t,i),fa(t),bk(t,i),qu(t,i),wk(t),_k(t),Ek(t),Pk(t),Rk(t),xk(t),Ik(t),Dk(t),Mk(t),ca(t),Hu(t),ua(t,i),da(t);break;case"safari":if(!lm||!e.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=lm,ha(t,i),fa(t),Uk(t),Vk(t),Lk(t),Ak(t),Ok(t),jk(t),Nk(t),Bk(t),ca(t),Ku(t),ua(t,i),da(t),Gu(t,i);break;default:n("Unsupported browser!");break}return r}gP({window:typeof window>"u"?void 0:window});class lt extends Promise{constructor(e){super(e)}catch(e){return super.catch(e)}static reject(e){return super.reject(e)}static all(e){return super.all(e)}static race(e){return super.race(e)}}const vP=/version\/(\d+(\.?_?\d+)+)/i;let gc;function ft(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const n=navigator.userAgent.toLowerCase();if(gc===void 0||e){const i=yP.find(r=>{let{test:s}=r;return s.test(n)});gc=i==null?void 0:i.describe(n)}return gc}const yP=[{test:/firefox|iceweasel|fxios/i,describe(t){return{name:"Firefox",version:pa(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:vc(t)}}},{test:/chrom|crios|crmo/i,describe(t){return{name:"Chrome",version:pa(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("crios")?"iOS":void 0,osVersion:vc(t)}}},{test:/safari|applewebkit/i,describe(t){return{name:"Safari",version:pa(vP,t),os:t.includes("mobile/")?"iOS":"macOS",osVersion:vc(t)}}}];function pa(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=e.match(t);return i&&i.length>=n&&i[n]||""}function vc(t){return t.includes("mac os")?pa(/\(.+?(\d+_\d+(:?_\d+)?)/,t,1).replace(/_/g,"."):void 0}var kP="2.17.0";const SP=kP,TP=16;class un extends Error{constructor(e,n){super(n||"an error has occured"),this.name="LiveKitError",this.code=e}}var oe;(function(t){t[t.NotAllowed=0]="NotAllowed",t[t.ServerUnreachable=1]="ServerUnreachable",t[t.InternalError=2]="InternalError",t[t.Cancelled=3]="Cancelled",t[t.LeaveRequest=4]="LeaveRequest",t[t.Timeout=5]="Timeout",t[t.WebSocket=6]="WebSocket",t[t.ServiceNotFound=7]="ServiceNotFound"})(oe||(oe={}));class B extends un{constructor(e,n,i,r){super(1,e),this.name="ConnectionError",this.status=i,this.reason=n,this.context=r,this.reasonName=oe[n]}static notAllowed(e,n,i){return new B(e,oe.NotAllowed,n,i)}static timeout(e){return new B(e,oe.Timeout)}static leaveRequest(e,n){return new B(e,oe.LeaveRequest,void 0,n)}static internal(e,n){return new B(e,oe.InternalError,void 0,n)}static cancelled(e){return new B(e,oe.Cancelled)}static serverUnreachable(e,n){return new B(e,oe.ServerUnreachable,n)}static websocket(e,n,i){return new B(e,oe.WebSocket,n,i)}static serviceNotFound(e,n){return new B(e,oe.ServiceNotFound,void 0,n)}}class Nh extends un{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class Sn extends un{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class CP extends un{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class Pe extends un{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class Cr extends un{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class um extends un{constructor(e,n){super(15,e),this.name="PublishTrackError",this.status=n}}class dm extends un{constructor(e,n){super(15,e),this.name="SignalRequestError",this.reason=n,this.reasonName=typeof n=="string"?n:Oh[n]}}var Xe;(function(t){t[t.AlreadyOpened=0]="AlreadyOpened",t[t.AbnormalEnd=1]="AbnormalEnd",t[t.DecodeFailed=2]="DecodeFailed",t[t.LengthExceeded=3]="LengthExceeded",t[t.Incomplete=4]="Incomplete",t[t.HandlerAlreadyRegistered=7]="HandlerAlreadyRegistered",t[t.EncryptionTypeMismatch=8]="EncryptionTypeMismatch"})(Xe||(Xe={}));class Pt extends un{constructor(e,n){super(16,e),this.name="DataStreamError",this.reason=n,this.reasonName=Xe[n]}}class Hi extends un{constructor(e){super(18,e),this.name="SignalReconnectError"}}var Qa;(function(t){t.PermissionDenied="PermissionDenied",t.NotFound="NotFound",t.DeviceInUse="DeviceInUse",t.Other="Other"})(Qa||(Qa={}));(function(t){function e(n){if(n&&"name"in n)return n.name==="NotFoundError"||n.name==="DevicesNotFoundError"?t.NotFound:n.name==="NotAllowedError"||n.name==="PermissionDeniedError"?t.PermissionDenied:n.name==="NotReadableError"||n.name==="TrackStartError"?t.DeviceInUse:t.Other}t.getFailure=e})(Qa||(Qa={}));class Be{}Be.setTimeout=function(){return setTimeout(...arguments)};Be.setInterval=function(){return setInterval(...arguments)};Be.clearTimeout=function(){return clearTimeout(...arguments)};Be.clearInterval=function(){return clearInterval(...arguments)};var D;(function(t){t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting",t.Reconnected="reconnected",t.Disconnected="disconnected",t.ConnectionStateChanged="connectionStateChanged",t.Moved="moved",t.MediaDevicesChanged="mediaDevicesChanged",t.ParticipantConnected="participantConnected",t.ParticipantDisconnected="participantDisconnected",t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalAudioSilenceDetected="localAudioSilenceDetected",t.ActiveSpeakersChanged="activeSpeakersChanged",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.ParticipantAttributesChanged="participantAttributesChanged",t.ParticipantActive="participantActive",t.RoomMetadataChanged="roomMetadataChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.AudioPlaybackStatusChanged="audioPlaybackChanged",t.VideoPlaybackStatusChanged="videoPlaybackChanged",t.MediaDevicesError="mediaDevicesError",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.SignalConnected="signalConnected",t.RecordingStatusChanged="recordingStatusChanged",t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ActiveDeviceChanged="activeDeviceChanged",t.ChatMessage="chatMessage",t.LocalTrackSubscribed="localTrackSubscribed",t.MetricsReceived="metricsReceived"})(D||(D={}));var F;(function(t){t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackCpuConstrained="localTrackCpuConstrained",t.LocalSenderCreated="localSenderCreated",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.IsSpeakingChanged="isSpeakingChanged",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.TrackCpuConstrained="trackCpuConstrained",t.MediaDevicesError="mediaDevicesError",t.AudioStreamAcquired="audioStreamAcquired",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.PCTrackAdded="pcTrackAdded",t.AttributesChanged="attributesChanged",t.LocalTrackSubscribed="localTrackSubscribed",t.ChatMessage="chatMessage",t.Active="active"})(F||(F={}));var N;(function(t){t.TransportsCreated="transportsCreated",t.Connected="connected",t.Disconnected="disconnected",t.Resuming="resuming",t.Resumed="resumed",t.Restarting="restarting",t.Restarted="restarted",t.SignalResumed="signalResumed",t.SignalRestarted="signalRestarted",t.Closing="closing",t.MediaTrackAdded="mediaTrackAdded",t.ActiveSpeakersUpdate="activeSpeakersUpdate",t.DataPacketReceived="dataPacketReceived",t.RTPVideoMapUpdate="rtpVideoMapUpdate",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ParticipantUpdate="participantUpdate",t.RoomUpdate="roomUpdate",t.SpeakersChanged="speakersChanged",t.StreamStateChanged="streamStateChanged",t.ConnectionQualityUpdate="connectionQualityUpdate",t.SubscriptionError="subscriptionError",t.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",t.RemoteMute="remoteMute",t.SubscribedQualityUpdate="subscribedQualityUpdate",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackSubscribed="localTrackSubscribed",t.Offline="offline",t.SignalRequestResponse="signalRequestResponse",t.SignalConnected="signalConnected",t.RoomMoved="roomMoved"})(N||(N={}));var O;(function(t){t.Message="message",t.Muted="muted",t.Unmuted="unmuted",t.Restarted="restarted",t.Ended="ended",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",t.CpuConstrained="cpuConstrained",t.UpdateSettings="updateSettings",t.UpdateSubscription="updateSubscription",t.AudioPlaybackStarted="audioPlaybackStarted",t.AudioPlaybackFailed="audioPlaybackFailed",t.AudioSilenceDetected="audioSilenceDetected",t.VisibilityChanged="visibilityChanged",t.VideoDimensionsChanged="videoDimensionsChanged",t.VideoPlaybackStarted="videoPlaybackStarted",t.VideoPlaybackFailed="videoPlaybackFailed",t.ElementAttached="elementAttached",t.ElementDetached="elementDetached",t.UpstreamPaused="upstreamPaused",t.UpstreamResumed="upstreamResumed",t.SubscriptionPermissionChanged="subscriptionPermissionChanged",t.SubscriptionStatusChanged="subscriptionStatusChanged",t.SubscriptionFailed="subscriptionFailed",t.TrackProcessorUpdate="trackProcessorUpdate",t.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",t.TranscriptionReceived="transcriptionReceived",t.TimeSyncUpdate="timeSyncUpdate",t.PreConnectBufferFlushed="preConnectBufferFlushed"})(O||(O={}));function bP(t){return typeof t>"u"?t:typeof structuredClone=="function"?typeof t=="object"&&t!==null?structuredClone(Object.assign({},t)):structuredClone(t):JSON.parse(JSON.stringify(t))}class re{constructor(e,n,i,r,s){if(typeof e=="object")this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else if(n!==void 0&&i!==void 0)this.width=e,this.height=n,this.aspectRatio=e/n,this.encoding={maxBitrate:i,maxFramerate:r,priority:s};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const wP=["vp8","h264"],EP=["vp8","h264","vp9","av1","h265"];function PP(t){return!!wP.find(e=>e===t)}const _P=PP;var hm;(function(t){t[t.PREFER_REGRESSION=0]="PREFER_REGRESSION",t[t.SIMULCAST=1]="SIMULCAST",t[t.REGRESSION=2]="REGRESSION"})(hm||(hm={}));var $u;(function(t){t.telephone={maxBitrate:12e3},t.speech={maxBitrate:24e3},t.music={maxBitrate:48e3},t.musicStereo={maxBitrate:64e3},t.musicHighQuality={maxBitrate:96e3},t.musicHighQualityStereo={maxBitrate:128e3}})($u||($u={}));const no={h90:new re(160,90,9e4,20),h180:new re(320,180,16e4,20),h216:new re(384,216,18e4,20),h360:new re(640,360,45e4,20),h540:new re(960,540,8e5,25),h720:new re(1280,720,17e5,30),h1080:new re(1920,1080,3e6,30),h1440:new re(2560,1440,5e6,30),h2160:new re(3840,2160,8e6,30)},Ju={h120:new re(160,120,7e4,20),h180:new re(240,180,125e3,20),h240:new re(320,240,14e4,20),h360:new re(480,360,33e4,20),h480:new re(640,480,5e5,20),h540:new re(720,540,6e5,25),h720:new re(960,720,13e5,30),h1080:new re(1440,1080,23e5,30),h1440:new re(1920,1440,38e5,30)},Fh={h360fps3:new re(640,360,2e5,3,"medium"),h360fps15:new re(640,360,4e5,15,"medium"),h720fps5:new re(1280,720,8e5,5,"medium"),h720fps15:new re(1280,720,15e5,15,"medium"),h720fps30:new re(1280,720,2e6,30,"medium"),h1080fps15:new re(1920,1080,25e5,15,"medium"),h1080fps30:new re(1920,1080,5e6,30,"medium"),original:new re(0,0,7e6,30,"medium")};function Wk(t,e,n){var i,r,s,o;const{optionsWithoutProcessor:a,audioProcessor:l,videoProcessor:c}=Hk(t??{}),u=e==null?void 0:e.processor,d=n==null?void 0:n.processor,h=a??{};return h.audio===!0&&(h.audio={}),h.video===!0&&(h.video={}),h.audio&&(Qu(h.audio,e),(i=(s=h.audio).deviceId)!==null&&i!==void 0||(s.deviceId={ideal:"default"}),(l||u)&&(h.audio.processor=l??u)),h.video&&(Qu(h.video,n),(r=(o=h.video).deviceId)!==null&&r!==void 0||(o.deviceId={ideal:"default"}),(c||d)&&(h.video.processor=c??d)),h}function Qu(t,e){return Object.keys(e).forEach(n=>{t[n]===void 0&&(t[n]=e[n])}),t}function Uh(t){var e,n,i,r;const s={};if(t.video)if(typeof t.video=="object"){const o={},a=o,l=t.video;Object.keys(l).forEach(c=>{switch(c){case"resolution":Qu(a,l.resolution);break;default:a[c]=l[c]}}),s.video=o,(e=(i=s.video).deviceId)!==null&&e!==void 0||(i.deviceId={ideal:"default"})}else s.video=t.video?{deviceId:{ideal:"default"}}:!1;else s.video=!1;return t.audio?typeof t.audio=="object"?(s.audio=t.audio,(n=(r=s.audio).deviceId)!==null&&n!==void 0||(r.deviceId={ideal:"default"})):s.audio={deviceId:{ideal:"default"}}:s.audio=!1,s}function qk(t){return C(this,arguments,void 0,function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return function*(){const i=Kk();if(i){const r=i.createAnalyser();r.fftSize=2048;const s=r.frequencyBinCount,o=new Uint8Array(s);i.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(r),yield ze(n),r.getByteTimeDomainData(o);const l=o.some(c=>c!==128&&c!==0);return i.close(),!l}return!1}()})}function Kk(){var t;const e=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(e){const n=new e({latencyHint:"interactive"});if(n.state==="suspended"&&typeof window<"u"&&(!((t=window.document)===null||t===void 0)&&t.body)){const i=()=>C(this,void 0,void 0,function*(){var r;try{n.state==="suspended"&&(yield n.resume())}catch(s){console.warn("Error trying to auto-resume audio context",s)}finally{(r=window.document.body)===null||r===void 0||r.removeEventListener("click",i)}});n.addEventListener("statechange",()=>{var r;n.state==="closed"&&((r=window.document.body)===null||r===void 0||r.removeEventListener("click",i))}),window.document.body.addEventListener("click",i)}return n}}function RP(t){return t==="audioinput"?R.Source.Microphone:t==="videoinput"?R.Source.Camera:R.Source.Unknown}function Yu(t){return t===R.Source.Microphone?"audioinput":t===R.Source.Camera?"videoinput":void 0}function xP(t){var e,n;let i=(e=t.video)!==null&&e!==void 0?e:!0;return t.resolution&&t.resolution.width>0&&t.resolution.height>0&&(i=typeof i=="boolean"?{}:i,Ui()?i=Object.assign(Object.assign({},i),{width:{max:t.resolution.width},height:{max:t.resolution.height},frameRate:t.resolution.frameRate}):i=Object.assign(Object.assign({},i),{width:{ideal:t.resolution.width},height:{ideal:t.resolution.height},frameRate:t.resolution.frameRate})),{audio:(n=t.audio)!==null&&n!==void 0?n:!1,video:i,controller:t.controller,selfBrowserSurface:t.selfBrowserSurface,surfaceSwitching:t.surfaceSwitching,systemAudio:t.systemAudio,preferCurrentTab:t.preferCurrentTab}}function Rs(t){return t.split("/")[1].toLowerCase()}function IP(t){const e=[];return t.forEach(n=>{n.track!==void 0&&e.push(new xh({cid:n.track.mediaStreamID,track:n.trackInfo}))}),e}function $(t){return"mediaStreamTrack"in t?{trackID:t.sid,source:t.source,muted:t.isMuted,enabled:t.mediaStreamTrack.enabled,kind:t.kind,streamID:t.mediaStreamID,streamTrackID:t.mediaStreamTrack.id}:{trackID:t.trackSid,enabled:t.isEnabled,muted:t.isMuted,trackInfo:Object.assign({mimeType:t.mimeType,name:t.trackName,encrypted:t.isEncrypted,kind:t.kind,source:t.source},t.track?$(t.track):{})}}function DP(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function MP(t,e){var n;t===void 0&&(t={}),e===void 0&&(e={});const i=[...Object.keys(e),...Object.keys(t)],r={};for(const s of i)t[s]!==e[s]&&(r[s]=(n=e[s])!==null&&n!==void 0?n:"");return r}function Hk(t){const e=Object.assign({},t);let n,i;return typeof e.audio=="object"&&e.audio.processor&&(n=e.audio.processor,e.audio=Object.assign(Object.assign({},e.audio),{processor:void 0})),typeof e.video=="object"&&e.video.processor&&(i=e.video.processor,e.video=Object.assign(Object.assign({},e.video),{processor:void 0})),{audioProcessor:n,videoProcessor:i,optionsWithoutProcessor:bP(e)}}function AP(t){switch(t){case xe.CAMERA:return R.Source.Camera;case xe.MICROPHONE:return R.Source.Microphone;case xe.SCREEN_SHARE:return R.Source.ScreenShare;case xe.SCREEN_SHARE_AUDIO:return R.Source.ScreenShareAudio;default:return R.Source.Unknown}}function fm(t,e){return t.width*t.height<e.width*e.height}function OP(t,e){var n;return(n=t.layers)===null||n===void 0?void 0:n.find(i=>i.quality===e)}const LP=5e3,is=[];var gt;(function(t){t[t.LOW=0]="LOW",t[t.MEDIUM=1]="MEDIUM",t[t.HIGH=2]="HIGH"})(gt||(gt={}));class R extends cn.EventEmitter{get streamState(){return this._streamState}setStreamState(e){this._streamState=e}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var r;super(),this.attachedElements=[],this.isMuted=!1,this._streamState=R.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=H,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),LP):this.handleAppVisibilityChanged()},this.log=Dn((r=i.loggerName)!==null&&r!==void 0?r:Jt.Track),this.loggerContextCb=i.loggerContextCb,this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=R.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),$(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let n="audio";this.kind===R.Kind.Video&&(n="video"),this.attachedElements.length===0&&this.kind===R.Kind.Video&&this.addAppVisibilityListener(),e||(n==="audio"&&(is.forEach(s=>{s.parentElement===null&&!e&&(e=s)}),e&&is.splice(is.indexOf(e),1)),e||(e=document.createElement(n))),this.attachedElements.includes(e)||this.attachedElements.push(e),or(this.mediaStreamTrack,e);const i=e.srcObject.getTracks(),r=i.some(s=>s.kind==="audio");return e.play().then(()=>{this.emit(r?O.AudioPlaybackStarted:O.VideoPlaybackStarted)}).catch(s=>{s.name==="NotAllowedError"?this.emit(r?O.AudioPlaybackFailed:O.VideoPlaybackFailed,s):s.name==="AbortError"?H.debug("".concat(r?"audio":"video"," playback aborted, likely due to new play request")):H.warn("could not playback ".concat(r?"audio":"video"),s),r&&e&&i.some(o=>o.kind==="video")&&s.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(O.ElementAttached,e),e}detach(e){try{if(e){br(this.mediaStreamTrack,e);const i=this.attachedElements.indexOf(e);return i>=0&&(this.attachedElements.splice(i,1),this.recycleElement(e),this.emit(O.ElementDetached,e)),e}const n=[];return this.attachedElements.forEach(i=>{br(this.mediaStreamTrack,i),n.push(i),this.recycleElement(i),this.emit(O.ElementDetached,i)}),this.attachedElements=[],n}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=Dn(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let n=!0;e.pause(),is.forEach(i=>{i.parentElement||(n=!1)}),n&&is.push(e)}}handleAppVisibilityChanged(){return C(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===R.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){ct()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){ct()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function or(t,e){let n;e.srcObject instanceof MediaStream?n=e.srcObject:n=new MediaStream;let i;t.kind==="audio"?i=n.getAudioTracks():i=n.getVideoTracks(),i.includes(t)||(i.forEach(r=>{n.removeTrack(r)}),n.addTrack(t)),(!Ui()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=n.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==n&&(e.srcObject=n,(Ui()||Fi())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=n,e.play().catch(()=>{})},0))}function br(t,e){if(e.srcObject instanceof MediaStream){const n=e.srcObject;n.removeTrack(t),n.getTracks().length>0?e.srcObject=n:e.srcObject=null}}(function(t){let e;(function(c){c.Audio="audio",c.Video="video",c.Unknown="unknown"})(e=t.Kind||(t.Kind={}));let n;(function(c){c.Camera="camera",c.Microphone="microphone",c.ScreenShare="screen_share",c.ScreenShareAudio="screen_share_audio",c.Unknown="unknown"})(n=t.Source||(t.Source={}));let i;(function(c){c.Active="active",c.Paused="paused",c.Unknown="unknown"})(i=t.StreamState||(t.StreamState={}));function r(c){switch(c){case e.Audio:return zt.AUDIO;case e.Video:return zt.VIDEO;default:return zt.DATA}}t.kindToProto=r;function s(c){switch(c){case zt.AUDIO:return e.Audio;case zt.VIDEO:return e.Video;default:return e.Unknown}}t.kindFromProto=s;function o(c){switch(c){case n.Camera:return xe.CAMERA;case n.Microphone:return xe.MICROPHONE;case n.ScreenShare:return xe.SCREEN_SHARE;case n.ScreenShareAudio:return xe.SCREEN_SHARE_AUDIO;default:return xe.UNKNOWN}}t.sourceToProto=o;function a(c){switch(c){case xe.CAMERA:return n.Camera;case xe.MICROPHONE:return n.Microphone;case xe.SCREEN_SHARE:return n.ScreenShare;case xe.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}}t.sourceFromProto=a;function l(c){switch(c){case ju.ACTIVE:return i.Active;case ju.PAUSED:return i.Paused;default:return i.Unknown}}t.streamStateFromProto=l})(R||(R={}));const NP="|",pm="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function FP(t){const e=t.split(NP);return e.length>1?[e[0],t.substr(e[0].length+1)]:[t,""]}function ze(t){return new lt(e=>Be.setTimeout(e,t))}function Xu(){return"addTransceiver"in RTCPeerConnection.prototype}function Zu(){return"addTrack"in RTCPeerConnection.prototype}function UP(){if(!("getCapabilities"in RTCRtpSender)||Ui()||Fi())return!1;const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType.toLowerCase()==="video/av1"){e=!0;break}}return e}function jP(){if(!("getCapabilities"in RTCRtpSender)||Fi())return!1;if(Ui()){const n=ft();if(n!=null&&n.version&&ln(n.version,"16")<0||(n==null?void 0:n.os)==="iOS"&&(n!=null&&n.osVersion)&&ln(n.osVersion,"16")<0)return!1}const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType.toLowerCase()==="video/vp9"){e=!0;break}}return e}function qt(t){return t==="av1"||t==="vp9"}function ed(t){return!document||io()?!1:(t||(t=document.createElement("audio")),"setSinkId"in t)}function VP(){return typeof RTCPeerConnection>"u"?!1:Xu()||Zu()}function Fi(){var t;return((t=ft())===null||t===void 0?void 0:t.name)==="Firefox"}function mm(){const t=ft();return!!t&&t.name==="Chrome"&&t.os!=="iOS"}function Ui(){var t;return((t=ft())===null||t===void 0?void 0:t.name)==="Safari"}function io(){const t=ft();return(t==null?void 0:t.name)==="Safari"||(t==null?void 0:t.os)==="iOS"}function BP(){const t=ft();return(t==null?void 0:t.name)==="Safari"&&t.version.startsWith("17.")||(t==null?void 0:t.os)==="iOS"&&!!(t!=null&&t.osVersion)&&ln(t.osVersion,"17")>=0}function zP(t){return t||(t=ft()),(t==null?void 0:t.name)==="Safari"&&ln(t.version,"18.3")>0||(t==null?void 0:t.os)==="iOS"&&!!(t!=null&&t.osVersion)&&ln(t.osVersion,"18.3")>0}function Gk(){var t,e;return ct()?(e=(t=navigator.userAgentData)===null||t===void 0?void 0:t.mobile)!==null&&e!==void 0?e:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function WP(){const t=ft(),e="17.2";if(t)return t.name!=="Safari"&&t.os!=="iOS"||t.os==="iOS"&&t.osVersion&&ln(t.osVersion,e)>=0?!0:t.name==="Safari"&&ln(t.version,e)>=0}function ct(){return typeof document<"u"}function an(){return navigator.product=="ReactNative"}function Nr(t){return t.hostname.endsWith(".livekit.cloud")||t.hostname.endsWith(".livekit.run")}function yc(t){return Nr(t)?t.hostname.split(".")[0]:null}function $k(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function Jk(){if(!an())return;let t=$k();if(t)return t.platform}function gm(){if(ct())return window.devicePixelRatio;if(an()){let t=$k();if(t)return t.devicePixelRatio}return 1}function ln(t,e){const n=t.split("."),i=e.split("."),r=Math.min(n.length,i.length);for(let s=0;s<r;++s){const o=parseInt(n[s],10),a=parseInt(i[s],10);if(o>a)return 1;if(o<a)return-1;if(s===r-1&&o===a)return 0}return t===""&&e!==""?-1:e===""?1:n.length==i.length?0:n.length<i.length?-1:1}function qP(t){for(const e of t)e.target.handleResize(e)}function KP(t){for(const e of t)e.target.handleVisibilityChanged(e)}let kc=null;const vm=()=>(kc||(kc=new ResizeObserver(qP)),kc);let Sc=null;const ym=()=>(Sc||(Sc=new IntersectionObserver(KP,{root:null,rootMargin:"0px"})),Sc);function HP(){var t;const e=new J0({sdk:Q0.JS,protocol:TP,version:SP});return an()&&(e.os=(t=Jk())!==null&&t!==void 0?t:""),e}function km(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const r=document.createElement("canvas");r.width=t,r.height=e;const s=r.getContext("2d");s==null||s.fillRect(0,0,r.width,r.height),i&&s&&(s.beginPath(),s.arc(t/2,e/2,50,0,Math.PI*2,!0),s.closePath(),s.fillStyle="grey",s.fill());const o=r.captureStream(),[a]=o.getTracks();if(!a)throw Error("Could not get empty media stream video track");return a.enabled=n,a}let rs;function Tc(){if(!rs){const t=new AudioContext,e=t.createOscillator(),n=t.createGain();n.gain.setValueAtTime(0,0);const i=t.createMediaStreamDestination();if(e.connect(n),n.connect(i),e.start(),[rs]=i.stream.getAudioTracks(),!rs)throw Error("Could not get empty media stream audio track");rs.enabled=!1}return rs.clone()}class It{get isResolved(){return this._isResolved}constructor(e,n){this._isResolved=!1,this.onFinally=n,this.promise=new Promise((i,r)=>C(this,void 0,void 0,function*(){this.resolve=i,this.reject=r,e&&(yield e(i,r))})).finally(()=>{var i;this._isResolved=!0,(i=this.onFinally)===null||i===void 0||i.call(this)})}}function GP(t){return EP.includes(t)}function ii(t){if(typeof t=="string"||typeof t=="number")return t;if(Array.isArray(t))return t[0];if(t.exact!==void 0)return Array.isArray(t.exact)?t.exact[0]:t.exact;if(t.ideal!==void 0)return Array.isArray(t.ideal)?t.ideal[0]:t.ideal;throw Error("could not unwrap constraint")}function $P(t){return t.startsWith("http")?t.replace(/^(http)/,"ws"):t}function ro(t){return t.startsWith("ws")?t.replace(/^(ws)/,"http"):t}function JP(t,e){return t.segments.map(n=>{let{id:i,text:r,language:s,startTime:o,endTime:a,final:l}=n;var c;const u=(c=e.get(i))!==null&&c!==void 0?c:Date.now(),d=Date.now();return l?e.delete(i):e.set(i,u),{id:i,text:r,startTime:Number.parseInt(o.toString()),endTime:Number.parseInt(a.toString()),final:l,language:s,firstReceivedTime:u,lastReceivedTime:d}})}function QP(t){const{id:e,timestamp:n,message:i,editTimestamp:r}=t;return{id:e,timestamp:Number.parseInt(n.toString()),editTimestamp:r?Number.parseInt(r.toString()):void 0,message:i}}function Sm(t){switch(t.reason){case oe.LeaveRequest:return t.context;case oe.Cancelled:return Kt.CLIENT_INITIATED;case oe.NotAllowed:return Kt.USER_REJECTED;case oe.ServerUnreachable:return Kt.JOIN_FAILURE;default:return Kt.UNKNOWN_REASON}}function ma(t){return t!==void 0?Number(t):void 0}function Ti(t){return t!==void 0?BigInt(t):void 0}function wr(t){return!!t&&!(t instanceof MediaStreamTrack)&&t.isLocal}function rn(t){return!!t&&t.kind==R.Kind.Audio}function pi(t){return!!t&&t.kind==R.Kind.Video}function Fn(t){return wr(t)&&pi(t)}function hn(t){return wr(t)&&rn(t)}function td(t){return!!t&&!t.isLocal}function YP(t){return!!t&&!t.isLocal}function Cc(t){return td(t)&&pi(t)}function XP(t){return t.isLocal}function ZP(t,e){const n=[];let i=new TextEncoder().encode(t);for(;i.length>e;){let r=e;for(;r>0;){const s=i[r];if(s!==void 0&&(s&192)!==128)break;r--}n.push(i.slice(0,r)),i=i.slice(r)}return i.length>0&&n.push(i),n}function e_(t){var e;const n=t.get("Cache-Control");if(n){const i=(e=n.match(/(?:^|[,\s])max-age=(\d+)/))===null||e===void 0?void 0:e[1];if(i)return parseInt(i,10)}}function t_(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const i=n_(t,e);return n?i:jh(i,"v1")}function n_(t,e){const n=new URL($P(t));return e.forEach((i,r)=>{n.searchParams.set(r,i)}),jh(n,"rtc")}function i_(t){const e=new URL(ro(t));return jh(e,"validate")}function Qk(t){return t.endsWith("/")?t:"".concat(t,"/")}function jh(t,e){return t.pathname="".concat(Qk(t.pathname)).concat(e),t}function Tm(t){if(typeof t=="string")return Zp.fromJson(JSON.parse(t),{ignoreUnknownFields:!0});if(t instanceof ArrayBuffer)return Zp.fromBinary(new Uint8Array(t));throw new Error("could not decode websocket message: ".concat(typeof t))}function r_(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Unknown reason";if(!(t instanceof AbortSignal))return e;const n=t.reason;switch(typeof n){case"string":return n;case"object":return n instanceof Error?n.message:e;default:return"toString"in n?n.toString():e}}const s_=10,ss="lk_e2ee",o_="LKFrameEncryptionKey",a_={sharedKey:!1,ratchetSalt:o_,ratchetWindowSize:8,failureTolerance:s_,keyringSize:16};var ri;(function(t){t.SetKey="setKey",t.RatchetRequest="ratchetRequest",t.KeyRatcheted="keyRatcheted"})(ri||(ri={}));var Cm;(function(t){t.KeyRatcheted="keyRatcheted"})(Cm||(Cm={}));var Gn;(function(t){t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError"})(Gn||(Gn={}));var bm;(function(t){t.Error="cryptorError"})(bm||(bm={}));function l_(){return c_()||nd()}function nd(){return typeof window.RTCRtpScriptTransform<"u"}function c_(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}function u_(t){var e,n,i,r,s;if(((e=t.value)===null||e===void 0?void 0:e.case)!=="sipDtmf"&&((n=t.value)===null||n===void 0?void 0:n.case)!=="metrics"&&((i=t.value)===null||i===void 0?void 0:i.case)!=="speaker"&&((r=t.value)===null||r===void 0?void 0:r.case)!=="transcription"&&((s=t.value)===null||s===void 0?void 0:s.case)!=="encryptedPacket")return new z0({value:t.value})}class NM extends cn.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(n,i,r)=>{H.debug("key ratcheted event received",{ratchetResult:n,participantId:i,keyIndex:r})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},a_),e),this.on(ri.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,n,i){const r={key:e,participantIdentity:n,keyIndex:i};if(!this.options.sharedKey&&!n)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(n??"shared","-").concat(i??0),r),this.emit(ri.SetKey,r)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,n){this.emit(ri.RatchetRequest,e,n)}}var wm;(function(t){t[t.InvalidKey=0]="InvalidKey",t[t.MissingKey=1]="MissingKey",t[t.InternalError=2]="InternalError"})(wm||(wm={}));class d_ extends cn.EventEmitter{constructor(e,n){super(),this.decryptDataRequests=new Map,this.encryptDataRequests=new Map,this.onWorkerMessage=i=>{var r,s;const{kind:o,data:a}=i.data;switch(o){case"error":if(H.error(a.error.message),a.uuid){const u=this.decryptDataRequests.get(a.uuid);if(u!=null&&u.reject){u.reject(a.error);break}const d=this.encryptDataRequests.get(a.uuid);if(d!=null&&d.reject){d.reject(a.error);break}}this.emit(Gn.EncryptionError,a.error,a.participantIdentity);break;case"initAck":a.enabled&&this.keyProvider.getKeys().forEach(u=>{this.postKey(u)});break;case"enable":if(a.enabled&&this.keyProvider.getKeys().forEach(u=>{this.postKey(u)}),this.encryptionEnabled!==a.enabled&&a.participantIdentity===((r=this.room)===null||r===void 0?void 0:r.localParticipant.identity))this.emit(Gn.ParticipantEncryptionStatusChanged,a.enabled,this.room.localParticipant),this.encryptionEnabled=a.enabled;else if(a.participantIdentity){const u=(s=this.room)===null||s===void 0?void 0:s.getParticipantByIdentity(a.participantIdentity);if(!u)throw TypeError("couldn't set encryption status, participant not found".concat(a.participantIdentity));this.emit(Gn.ParticipantEncryptionStatusChanged,a.enabled,u)}break;case"ratchetKey":this.keyProvider.emit(ri.KeyRatcheted,a.ratchetResult,a.participantIdentity,a.keyIndex);break;case"decryptDataResponse":const l=this.decryptDataRequests.get(a.uuid);l!=null&&l.resolve&&l.resolve(a);break;case"encryptDataResponse":const c=this.encryptDataRequests.get(a.uuid);c!=null&&c.resolve&&c.resolve(a);break}},this.onWorkerError=i=>{H.error("e2ee worker encountered an error:",{error:i.error}),this.emit(Gn.EncryptionError,i.error,void 0)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1,this.dataChannelEncryptionEnabled=n}get isEnabled(){return this.encryptionEnabled}get isDataChannelEncryptionEnabled(){return this.isEnabled&&this.dataChannelEncryptionEnabled}setup(e){if(!l_())throw new Nh("tried to setup end-to-end encryption on an unsupported browser");if(H.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const n={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:rP.getLevel()}};this.worker&&(H.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(n))}}setParticipantCryptorEnabled(e,n){H.debug("set e2ee to ".concat(e," for participant ").concat(n)),this.postEnable(e,n)}setSifTrailer(e){!e||e.length===0?H.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(N.RTPVideoMapUpdate,n=>{this.postRTPMap(n)})}setupEventListeners(e,n){e.on(D.TrackPublished,(i,r)=>this.setParticipantCryptorEnabled(i.trackInfo.encryption!==Ae.NONE,r.identity)),e.on(D.ConnectionStateChanged,i=>{i===ee.Connected&&e.remoteParticipants.forEach(r=>{r.trackPublications.forEach(s=>{this.setParticipantCryptorEnabled(s.trackInfo.encryption!==Ae.NONE,r.identity)})})}).on(D.TrackUnsubscribed,(i,r,s)=>{var o;const a={kind:"removeTransform",data:{participantIdentity:s.identity,trackId:i.mediaStreamID}};(o=this.worker)===null||o===void 0||o.postMessage(a)}).on(D.TrackSubscribed,(i,r,s)=>{this.setupE2EEReceiver(i,s.identity,r.trackInfo)}).on(D.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");n.getKeys().forEach(i=>{this.postKey(i)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(F.LocalSenderCreated,(i,r)=>C(this,void 0,void 0,function*(){this.setupE2EESender(r,i)})),e.localParticipant.on(F.LocalTrackPublished,i=>{if(!pi(i.track)||!io())return;const r={kind:"updateCodec",data:{trackId:i.track.mediaStreamID,codec:Rs(i.trackInfo.codecs[0].mimeType),participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(r)}),n.on(ri.SetKey,i=>this.postKey(i)).on(ri.RatchetRequest,(i,r)=>this.postRatchetRequest(i,r))}encryptData(e){return C(this,void 0,void 0,function*(){if(!this.worker)throw Error("could not encrypt data, worker is missing");const n=crypto.randomUUID(),i={kind:"encryptDataRequest",data:{uuid:n,payload:e,participantIdentity:this.room.localParticipant.identity}},r=new It;return r.onFinally=()=>{this.encryptDataRequests.delete(n)},this.encryptDataRequests.set(n,r),this.worker.postMessage(i),r.promise})}handleEncryptedData(e,n,i,r){if(!this.worker)throw Error("could not handle encrypted data, worker is missing");const s=crypto.randomUUID(),o={kind:"decryptDataRequest",data:{uuid:s,payload:e,iv:n,participantIdentity:i,keyIndex:r}},a=new It;return a.onFinally=()=>{this.decryptDataRequests.delete(s)},this.decryptDataRequests.set(s,a),this.worker.postMessage(o),a.promise}postRatchetRequest(e,n){if(!this.worker)throw Error("could not ratchet key, worker is missing");const i={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:n}};this.worker.postMessage(i)}postKey(e){let{key:n,participantIdentity:i,keyIndex:r}=e;var s;if(!this.worker)throw Error("could not set key, worker is missing");const o={kind:"setKey",data:{participantIdentity:i,isPublisher:i===((s=this.room)===null||s===void 0?void 0:s.localParticipant.identity),key:n,keyIndex:r}};this.worker.postMessage(o)}postEnable(e,n){if(this.worker){const i={kind:"enable",data:{enabled:e,participantIdentity:n}};this.worker.postMessage(i)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var n;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const i={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(i)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const n={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(n)}setupE2EEReceiver(e,n,i){if(e.receiver){if(!(i!=null&&i.mimeType)||i.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,n,e.kind==="video"?Rs(i.mimeType):void 0)}}setupE2EESender(e,n){if(!wr(e)||!n){n||H.warn("early return because sender is not ready");return}this.handleSender(n,e.mediaStreamID,void 0)}handleReceiver(e,n,i,r){return C(this,void 0,void 0,function*(){if(this.worker){if(nd()&&!mm()){const s={kind:"decode",participantIdentity:i,trackId:n,codec:r};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{if(ss in e&&r){const l={kind:"updateCodec",data:{trackId:n,codec:r,participantIdentity:i}};this.worker.postMessage(l);return}let s=e.writableStream,o=e.readableStream;if(!s||!o){const l=e.createEncodedStreams();e.writableStream=l.writable,s=l.writable,e.readableStream=l.readable,o=l.readable}const a={kind:"decode",data:{readableStream:o,writableStream:s,trackId:n,codec:r,participantIdentity:i,isReuse:ss in e}};this.worker.postMessage(a,[o,s])}e[ss]=!0}})}handleSender(e,n,i){var r;if(!(ss in e||!this.worker)){if(!(!((r=this.room)===null||r===void 0)&&r.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(nd()&&!mm()){H.info("initialize script transform");const s={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:n,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{H.info("initialize encoded streams");const s=e.createEncodedStreams(),o={kind:"encode",data:{readableStream:s.readable,writableStream:s.writable,codec:i,trackId:n,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(o,[s.readable,s.writable])}e[ss]=!0}}}const h_=500,f_=15e3;class Er{constructor(){this.failedConnectionAttempts=new Map,this.backOffPromises=new Map}static getInstance(){return this._instance||(this._instance=new Er),this._instance}addFailedConnectionAttempt(e){var n;const i=new URL(e),r=yc(i);if(!r)return;let s=(n=this.failedConnectionAttempts.get(r))!==null&&n!==void 0?n:0;this.failedConnectionAttempts.set(r,s+1),this.backOffPromises.set(r,ze(Math.min(h_*Math.pow(2,s),f_)))}getBackOffPromise(e){const n=new URL(e),i=n&&yc(n);return i&&this.backOffPromises.get(i)||Promise.resolve()}resetFailedConnectionAttempts(e){const n=new URL(e),i=n&&yc(n);i&&(this.failedConnectionAttempts.set(i,0),this.backOffPromises.set(i,Promise.resolve()))}resetAll(){this.backOffPromises.clear(),this.failedConnectionAttempts.clear()}}Er._instance=null;const bc="default";class Fe{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new Fe),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return C(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;if(((s=Fe.userMediaPromiseMap)===null||s===void 0?void 0:s.size)>0){H.debug("awaiting getUserMedia promise");try{n?yield Fe.userMediaPromiseMap.get(n):yield Promise.all(Fe.userMediaPromiseMap.values())}catch{H.warn("error waiting for media permissons")}}let o=yield navigator.mediaDevices.enumerateDevices();if(r&&!(Ui()&&i.hasDeviceInUse(n))&&(o.filter(l=>l.kind===n).length===0||o.some(l=>{const c=l.label==="",u=n?l.kind===n:!0;return c&&u}))){const l={video:n!=="audioinput"&&n!=="audiooutput",audio:n!=="videoinput"&&{deviceId:{ideal:"default"}}},c=yield navigator.mediaDevices.getUserMedia(l);o=yield navigator.mediaDevices.enumerateDevices(),c.getTracks().forEach(u=>{u.stop()})}return i._previousDevices=o,n&&(o=o.filter(a=>a.kind===n)),o}()})}normalizeDeviceId(e,n,i){return C(this,void 0,void 0,function*(){if(n!==bc)return n;const r=yield this.getDevices(e),s=r.find(a=>a.deviceId===bc);if(!s){H.warn("could not reliably determine default device");return}const o=r.find(a=>a.deviceId!==bc&&a.groupId===(i??s.groupId));if(!o){H.warn("could not reliably determine default device");return}return o==null?void 0:o.deviceId})}hasDeviceInUse(e){return e?Fe.userMediaPromiseMap.has(e):Fe.userMediaPromiseMap.size>0}}Fe.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];Fe.userMediaPromiseMap=new Map;var xs;(function(t){t[t.WAITING=0]="WAITING",t[t.RUNNING=1]="RUNNING",t[t.COMPLETED=2]="COMPLETED"})(xs||(xs={}));class p_{constructor(){this.pendingTasks=new Map,this.taskMutex=new tt,this.nextTaskIndex=0}run(e){return C(this,void 0,void 0,function*(){const n={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:xs.WAITING};this.pendingTasks.set(n.id,n);const i=yield this.taskMutex.lock();try{return n.executedAt=Date.now(),n.status=xs.RUNNING,yield e()}finally{n.status=xs.COMPLETED,this.pendingTasks.delete(n.id),i()}})}flush(){return C(this,void 0,void 0,function*(){return this.run(()=>C(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}class m_{get readyState(){return this.ws.readyState}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i,r;if(!((i=n.signal)===null||i===void 0)&&i.aborted)throw new DOMException("This operation was aborted","AbortError");this.url=e;const s=new WebSocket(e,(r=n.protocols)!==null&&r!==void 0?r:[]);s.binaryType="arraybuffer",this.ws=s;const o=function(){let{closeCode:a,reason:l}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return s.close(a,l)};this.opened=new lt((a,l)=>{const c=()=>{l(B.websocket("Encountered websocket error during connection establishment"))};s.onopen=()=>{a({readable:new ReadableStream({start(u){s.onmessage=d=>{let{data:h}=d;return u.enqueue(h)},s.onerror=d=>u.error(d)},cancel:o}),writable:new WritableStream({write(u){s.send(u)},abort(){s.close()},close:o}),protocol:s.protocol,extensions:s.extensions}),s.removeEventListener("error",c)},s.addEventListener("error",c)}),this.closed=new lt((a,l)=>{const c=()=>C(this,void 0,void 0,function*(){const u=new lt(h=>{s.readyState!==WebSocket.CLOSED&&s.addEventListener("close",f=>{h(f)},{once:!0})}),d=yield lt.race([ze(250),u]);d?a(d):l(B.websocket("Encountered unspecified websocket error without a timely close event"))});s.onclose=u=>{let{code:d,reason:h}=u;a({closeCode:d,reason:h}),s.removeEventListener("error",c)},s.addEventListener("error",c)}),n.signal&&(n.signal.onabort=()=>s.close()),this.close=o}}const g_=["syncState","trickle","offer","answer","simulate","leave"];function v_(t){const e=g_.indexOf(t.case)>=0;return H.trace("request allowed to bypass queue:",{canPass:e,req:t}),e}var se;(function(t){t[t.CONNECTING=0]="CONNECTING",t[t.CONNECTED=1]="CONNECTED",t[t.RECONNECTING=2]="RECONNECTING",t[t.DISCONNECTING=3]="DISCONNECTING",t[t.DISCONNECTED=4]="DISCONNECTED"})(se||(se={}));const y_=250;class Vh{get currentState(){return this.state}get isDisconnected(){return this.state===se.DISCONNECTING||this.state===se.DISCONNECTED}get isEstablishingConnection(){return this.state===se.CONNECTING||this.state===se.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;this.rtt=0,this.state=se.DISCONNECTED,this.log=H,this._requestId=0,this.useV0SignalPath=!1,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0,this.onMediaSectionsRequirement=void 0},this.log=Dn((i=n.loggerName)!==null&&i!==void 0?i:Jt.Signal),this.loggerContextCb=n.loggerContextCb,this.useJSON=e,this.requestQueue=new p_,this.queuedRequests=[],this.closingLock=new tt,this.connectionLock=new tt,this.state=se.DISCONNECTED}get logContext(){var e,n;return(n=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&n!==void 0?n:{}}join(e,n,i,r){return C(this,arguments,void 0,function(s,o,a,l){var c=this;let u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return function*(){return c.state=se.CONNECTING,c.options=a,yield c.connect(s,o,a,l,u)}()})}reconnect(e,n,i,r){return C(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=se.RECONNECTING,this.clearPingInterval(),yield this.connect(e,n,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:i,reconnectReason:r}),void 0,this.useV0SignalPath)})}connect(e,n,i,r){return C(this,arguments,void 0,function(s,o,a,l){var c=this;let u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return function*(){const d=yield c.connectionLock.lock();c.connectOptions=a,c.useV0SignalPath=u;const h=HP(),f=u?k_(o,h,a):S_(o,h,a),v=t_(s,f,u).toString(),g=i_(v).toString();return new Promise((y,p)=>C(c,void 0,void 0,function*(){var m,k;try{let S=!1;const T=_=>C(this,void 0,void 0,function*(){if(S)return;S=!0;const L=_ instanceof Event?_.currentTarget:_,z=r_(L,"Abort handler called");this.streamWriter&&!this.isDisconnected?this.sendLeave().then(()=>this.close(z)).catch(Y=>{this.log.error(Y),this.close()}):this.close(),b(),p(B.cancelled(z))});l==null||l.addEventListener("abort",T);const b=()=>{clearTimeout(P),l==null||l.removeEventListener("abort",T)},P=setTimeout(()=>{T(B.timeout("room connection has timed out (signal)"))},a.websocketTimeout),E=(_,L)=>{this.handleSignalConnected(_,P,L)},I=new URL(v);I.searchParams.has("access_token")&&I.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(I),Object.assign({reconnect:a.reconnect,reconnectReason:a.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new m_(v);try{this.ws.closed.then(te=>{var ie;this.isEstablishingConnection&&p(B.internal("Websocket got closed during a (re)connection attempt: ".concat(te.reason))),te.closeCode!==1e3&&(this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:te.reason,code:te.closeCode,wasClean:te.closeCode===1e3,state:this.state})),this.state===se.CONNECTED&&this.handleOnClose((ie=te.reason)!==null&&ie!==void 0?ie:"Unexpected WS error"))}).catch(te=>{this.isEstablishingConnection&&p(B.internal("Websocket error during a (re)connection attempt: ".concat(te)))});const _=yield this.ws.opened.catch(te=>C(this,void 0,void 0,function*(){if(this.state!==se.CONNECTED){this.state=se.DISCONNECTED,clearTimeout(P);const ie=yield this.handleConnectionError(te,g);p(ie);return}this.handleWSError(te),p(te)}));if(clearTimeout(P),!_)return;const L=_.readable.getReader();this.streamWriter=_.writable.getWriter();const z=yield L.read();if(L.releaseLock(),!z.value)throw B.internal("no message received as first message");const Y=Tm(z.value),we=this.validateFirstMessage(Y,(m=a.reconnect)!==null&&m!==void 0?m:!1);if(!we.isValid){p(we.error);return}((k=Y.message)===null||k===void 0?void 0:k.case)==="join"&&(this.pingTimeoutDuration=Y.message.value.pingTimeout,this.pingIntervalDuration=Y.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})));const De=we.shouldProcessFirstMessage?Y:void 0;E(_,De),y(we.response)}catch(_){p(_)}finally{b()}}finally{d()}}))}()})}startReadingLoop(e,n){return C(this,void 0,void 0,function*(){for(n&&this.handleSignalResponse(n);;){this.signalLatency&&(yield ze(this.signalLatency));const{done:i,value:r}=yield e.read();if(i)break;const s=Tm(r);this.handleSignalResponse(s)}})}close(){return C(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Close method called on signal client";return function*(){if([se.DISCONNECTING||se.DISCONNECTED].includes(e.state)){e.log.debug("ignoring signal close as it's already in disconnecting state");return}const r=yield e.closingLock.lock();try{if(e.clearPingInterval(),n&&(e.state=se.DISCONNECTING),e.ws){e.ws.close({closeCode:1e3,reason:i});const s=e.ws.closed;e.ws=void 0,e.streamWriter=void 0,yield Promise.race([s,ze(y_)])}}catch(s){e.log.debug("websocket error while closing",Object.assign(Object.assign({},e.logContext),{error:s}))}finally{n&&(e.state=se.DISCONNECTED),r()}}()})}sendOffer(e,n){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:ar(e,n)})}sendAnswer(e,n){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:ar(e,n)})}sendIceCandidate(e,n){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new _l({candidateInit:JSON.stringify(e),target:n})})}sendMuteTrack(e,n){return this.sendRequest({case:"mute",value:new Rl({sid:e,muted:n})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,n){return C(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return function*(){const a=s.getNextRequestId();return yield s.sendRequest({case:"updateMetadata",value:new Dh({requestId:a,metadata:i,name:r,attributes:o})}),a}()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,n){return this.sendRequest({case:"updateLayers",value:new ik({trackSid:e,layers:n})})}sendUpdateSubscriptionPermissions(e,n){return this.sendRequest({case:"subscriptionPermission",value:new ok({allParticipants:e,trackPermissions:n})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:fe.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new ck({timestamp:fe.parse(Date.now()),rtt:fe.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,n){return this.sendRequest({case:"updateAudioTrack",value:new Ih({trackSid:e,features:n})})}sendLeave(){return this.sendRequest({case:"leave",value:new Il({reason:Kt.CLIENT_INITIATED,action:Sr.DISCONNECT})})}sendRequest(e){return C(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(!r&&!v_(n)&&i.state===se.RECONNECTING){i.queuedRequests.push(()=>C(i,void 0,void 0,function*(){yield this.sendRequest(n,!0)}));return}if(r||(yield i.requestQueue.flush()),i.signalLatency&&(yield ze(i.signalLatency)),i.isDisconnected){i.log.debug("skipping signal request (type: ".concat(n.case,") - SignalClient disconnected"));return}if(!i.streamWriter){i.log.error("cannot send signal request before connected, type: ".concat(n==null?void 0:n.case),i.logContext);return}const o=new xE({message:n});try{i.useJSON?yield i.streamWriter.write(o.toJsonString()):yield i.streamWriter.write(o.toBinary())}catch(a){i.log.error("error sending signal message",Object.assign(Object.assign({},i.logContext),{error:a}))}}()})}handleSignalResponse(e){var n,i;const r=e.message;if(r==null){this.log.debug("received unsupported message",this.logContext);return}let s=!1;if(r.case==="answer"){const o=Em(r.value);this.onAnswer&&this.onAnswer(o,r.value.id,r.value.midToTrackId)}else if(r.case==="offer"){const o=Em(r.value);this.onOffer&&this.onOffer(o,r.value.id,r.value.midToTrackId)}else if(r.case==="trickle"){const o=JSON.parse(r.value.candidateInit);this.onTrickle&&this.onTrickle(o,r.value.target)}else r.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((n=r.value.participants)!==null&&n!==void 0?n:[]):r.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(r.value):r.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((i=r.value.speakers)!==null&&i!==void 0?i:[]):r.case==="leave"?this.onLeave&&this.onLeave(r.value):r.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(r.value.sid,r.value.muted):r.case==="roomUpdate"?this.onRoomUpdate&&r.value.room&&this.onRoomUpdate(r.value.room):r.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(r.value):r.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(r.value):r.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(r.value):r.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(r.value):r.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(r.value):r.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(r.value):r.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(r.value):r.case==="pong"||(r.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(r.value.lastPingTimestamp.toString()),this.resetPingTimeout(),s=!0):r.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(r.value):r.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(r.value.trackSid):r.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(r.value.token),this.onRoomMoved&&this.onRoomMoved(r.value)):r.case==="mediaSectionsRequirement"?this.onMediaSectionsRequirement&&this.onMediaSectionsRequirement(r.value):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:r.case})));s||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return C(this,void 0,void 0,function*(){if(this.state===se.DISCONNECTED)return;const n=this.onClose;yield this.close(void 0,e),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),n&&n(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=Be.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&Be.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=Be.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&Be.clearInterval(this.pingInterval)}handleSignalConnected(e,n,i){this.state=se.CONNECTED,clearTimeout(n),this.startPingInterval(),this.startReadingLoop(e.readable.getReader(),i)}validateFirstMessage(e,n){var i,r,s,o,a;return((i=e.message)===null||i===void 0?void 0:i.case)==="join"?{isValid:!0,response:e.message.value}:this.state===se.RECONNECTING&&((r=e.message)===null||r===void 0?void 0:r.case)!=="leave"?((s=e.message)===null||s===void 0?void 0:s.case)==="reconnect"?{isValid:!0,response:e.message.value}:(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),{isValid:!0,response:void 0,shouldProcessFirstMessage:!0}):this.isEstablishingConnection&&((o=e.message)===null||o===void 0?void 0:o.case)==="leave"?{isValid:!1,error:B.leaveRequest("Received leave request while trying to (re)connect",e.message.value.reason)}:n?{isValid:!1,error:B.internal("Unexpected first message")}:{isValid:!1,error:B.internal("did not receive join response, got ".concat((a=e.message)===null||a===void 0?void 0:a.case," instead"))}}handleConnectionError(e,n){return C(this,void 0,void 0,function*(){try{const i=yield fetch(n);switch(i.status){case 404:return B.serviceNotFound("v1 RTC path not found. Consider upgrading your LiveKit server version","v0-rtc");case 401:case 403:const r=yield i.text();return B.notAllowed(r,i.status);default:break}return e instanceof B?e:B.internal("Encountered unknown websocket error during connection: ".concat(e),{status:i.status,statusText:i.statusText})}catch(i){return i instanceof B?i:B.serverUnreachable(i instanceof Error?i.message:"server was not reachable")}})}}function Em(t){const e={type:"offer",sdp:t.sdp};switch(t.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=t.type;break}return e}function ar(t,e){return new li({sdp:t.sdp,type:t.type,id:e})}function k_(t,e,n){var i;const r=new URLSearchParams;return r.set("access_token",t),n.reconnect&&(r.set("reconnect","1"),n.sid&&r.set("sid",n.sid)),r.set("auto_subscribe",n.autoSubscribe?"1":"0"),r.set("sdk",an()?"reactnative":"js"),r.set("version",e.version),r.set("protocol",e.protocol.toString()),e.deviceModel&&r.set("device_model",e.deviceModel),e.os&&r.set("os",e.os),e.osVersion&&r.set("os_version",e.osVersion),e.browser&&r.set("browser",e.browser),e.browserVersion&&r.set("browser_version",e.browserVersion),n.adaptiveStream&&r.set("adaptive_stream","1"),n.reconnectReason&&r.set("reconnect_reason",n.reconnectReason.toString()),!((i=navigator.connection)===null||i===void 0)&&i.type&&r.set("network",navigator.connection.type),r}function S_(t,e,n){const i=new URLSearchParams;i.set("access_token",t);const r=new YE({clientInfo:e,connectionSettings:new uk({autoSubscribe:!!n.autoSubscribe,adaptiveStream:!!n.adaptiveStream}),reconnect:!!n.reconnect,participantSid:n.sid?n.sid:void 0});n.reconnectReason&&(r.reconnectReason=n.reconnectReason);const s=new XE({joinRequest:r.toBinary()});return i.set("join_request",btoa(new TextDecoder("utf-8").decode(s.toBinary()))),i}class Pm{constructor(){this.buffer=[],this._totalSize=0}push(e){this.buffer.push(e),this._totalSize+=e.data.byteLength}pop(){const e=this.buffer.shift();return e&&(this._totalSize-=e.data.byteLength),e}getAll(){return this.buffer.slice()}popToSequence(e){for(;this.buffer.length>0&&this.buffer[0].sequence<=e;)this.pop()}alignBufferedAmount(e){for(;this.buffer.length>0;){const n=this.buffer[0];if(this._totalSize-n.data.byteLength<=e)break;this.pop()}}get length(){return this.buffer.length}}class T_{constructor(e){this._map=new Map,this._lastCleanup=0,this.ttl=e}set(e,n){const i=Date.now();i-this._lastCleanup>this.ttl/2&&this.cleanup();const r=i+this.ttl;return this._map.set(e,{value:n,expiresAt:r}),this}get(e){const n=this._map.get(e);if(n){if(n.expiresAt<Date.now()){this._map.delete(e);return}return n.value}}has(e){const n=this._map.get(e);return n?n.expiresAt<Date.now()?(this._map.delete(e),!1):!0:!1}delete(e){return this._map.delete(e)}clear(){this._map.clear()}cleanup(){const e=Date.now();for(const[n,i]of this._map.entries())i.expiresAt<e&&this._map.delete(n);this._lastCleanup=e}get size(){return this.cleanup(),this._map.size}forEach(e){this.cleanup();for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e(i.value,n,this.asValueMap())}map(e){this.cleanup();const n=[],i=this.asValueMap();for(const[r,s]of i.entries())n.push(e(s,r,i));return n}asValueMap(){const e=new Map;for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e.set(n,i.value);return e}}var Nt={},wc={},Ec={exports:{}},_m;function Bh(){if(_m)return Ec.exports;_m=1;var t=Ec.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var n="candidate:%s %d %s %d %s %d typ %s";return n+=e.raddr!=null?" raddr %s rport %d":"%v%v",n+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(n+=" generation %d"),n+=e["network-id"]!=null?" network-id %d":"%v",n+=e["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var n="ssrc:%d";return e.attribute!=null&&(n+=" %s",e.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var n="mediaclk:";return n+=e.id!=null?"id=%s %s":"%v%s",n+=e.mediaClockValue!=null?"=%s":"",n+=e.rateNumerator!=null?" rate=%s":"",n+=e.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(t).forEach(function(e){var n=t[e];n.forEach(function(i){i.reg||(i.reg=/(.*)/),i.format||(i.format="%s")})}),Ec.exports}var Rm;function C_(){return Rm||(Rm=1,function(t){var e=function(a){return String(Number(a))===a?Number(a):a},n=function(a,l,c,u){if(u&&!c)l[u]=e(a[1]);else for(var d=0;d<c.length;d+=1)a[d+1]!=null&&(l[c[d]]=e(a[d+1]))},i=function(a,l,c){var u=a.name&&a.names;a.push&&!l[a.push]?l[a.push]=[]:u&&!l[a.name]&&(l[a.name]={});var d=a.push?{}:u?l[a.name]:l;n(c.match(a.reg),d,a.names,a.name),a.push&&l[a.push].push(d)},r=Bh(),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(a){var l={},c=[],u=l;return a.split(/(\r\n|\r|\n)/).filter(s).forEach(function(d){var h=d[0],f=d.slice(2);h==="m"&&(c.push({rtp:[],fmtp:[]}),u=c[c.length-1]);for(var v=0;v<(r[h]||[]).length;v+=1){var g=r[h][v];if(g.reg.test(f))return i(g,u,f)}}),l.media=c,l};var o=function(a,l){var c=l.split(/=(.+)/,2);return c.length===2?a[c[0]]=e(c[1]):c.length===1&&l.length>1&&(a[c[0]]=void 0),a};t.parseParams=function(a){return a.split(/;\s?/).reduce(o,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(a){return a.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(a){for(var l=[],c=a.split(" ").map(e),u=0;u<c.length;u+=3)l.push({component:c[u],ip:c[u+1],port:c[u+2]});return l},t.parseImageAttributes=function(a){return a.split(" ").map(function(l){return l.substring(1,l.length-1).split(",").reduce(o,{})})},t.parseSimulcastStreamList=function(a){return a.split(";").map(function(l){return l.split(",").map(function(c){var u,d=!1;return c[0]!=="~"?u=e(c):(u=e(c.substring(1,c.length)),d=!0),{scid:u,paused:d}})})}}(wc)),wc}var Pc,xm;function b_(){if(xm)return Pc;xm=1;var t=Bh(),e=/%[sdv%]/g,n=function(o){var a=1,l=arguments,c=l.length;return o.replace(e,function(u){if(a>=c)return u;var d=l[a];switch(a+=1,u){case"%%":return"%";case"%s":return String(d);case"%d":return Number(d);case"%v":return""}})},i=function(o,a,l){var c=a.format instanceof Function?a.format(a.push?l:l[a.name]):a.format,u=[o+"="+c];if(a.names)for(var d=0;d<a.names.length;d+=1){var h=a.names[d];a.name?u.push(l[a.name][h]):u.push(l[a.names[d]])}else u.push(l[a.name]);return n.apply(null,u)},r=["v","o","s","i","u","e","p","c","b","t","r","z","a"],s=["i","c","b","a"];return Pc=function(o,a){a=a||{},o.version==null&&(o.version=0),o.name==null&&(o.name=" "),o.media.forEach(function(d){d.payloads==null&&(d.payloads="")});var l=a.outerOrder||r,c=a.innerOrder||s,u=[];return l.forEach(function(d){t[d].forEach(function(h){h.name in o&&o[h.name]!=null?u.push(i(d,h,o)):h.push in o&&o[h.push]!=null&&o[h.push].forEach(function(f){u.push(i(d,h,f))})})}),o.media.forEach(function(d){u.push(i("m",t.m[0],d)),c.forEach(function(h){t[h].forEach(function(f){f.name in d&&d[f.name]!=null?u.push(i(h,f,d)):f.push in d&&d[f.push]!=null&&d[f.push].forEach(function(v){u.push(i(h,f,v))})})})}),u.join(`\r
`)+`\r
`},Pc}var Im;function w_(){if(Im)return Nt;Im=1;var t=C_(),e=b_(),n=Bh();return Nt.grammar=n,Nt.write=e,Nt.parse=t.parse,Nt.parseParams=t.parseParams,Nt.parseFmtpConfig=t.parseFmtpConfig,Nt.parsePayloads=t.parsePayloads,Nt.parseRemoteCandidates=t.parseRemoteCandidates,Nt.parseImageAttributes=t.parseImageAttributes,Nt.parseSimulcastStreamList=t.parseSimulcastStreamList,Nt}var Un=w_();function zh(t,e,n){var i,r,s;e===void 0&&(e=50),n===void 0&&(n={});var o=(i=n.isImmediate)!=null&&i,a=(r=n.callback)!=null&&r,l=n.maxWait,c=Date.now(),u=[];function d(){if(l!==void 0){var f=Date.now()-c;if(f+e>=l)return l-f}return e}var h=function(){var f=[].slice.call(arguments),v=this;return new Promise(function(g,y){var p=o&&s===void 0;if(s!==void 0&&clearTimeout(s),s=setTimeout(function(){if(s=void 0,c=Date.now(),!o){var k=t.apply(v,f);a&&a(k),u.forEach(function(S){return(0,S.resolve)(k)}),u=[]}},d()),p){var m=t.apply(v,f);return a&&a(m),g(m)}u.push({resolve:g,reject:y})})};return h.cancel=function(f){s!==void 0&&clearTimeout(s),u.forEach(function(v){return(0,v.reject)(f)}),u=[]},h}const E_=.7,P_=20,Pr={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class Dm extends cn.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;super(),this.log=H,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=zh(r=>C(this,void 0,void 0,function*(){this.emit(Pr.NegotiationStarted);try{yield this.createAndSendOffer()}catch(s){if(r)r(s);else throw s}}),P_),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=Dn((i=n.loggerName)!==null&&i!==void 0?i:Jt.PCTransport),this.loggerOptions=n,this.config=e,this._pc=this.createPC(),this.offerLock=new tt}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=n=>{var i;n.candidate&&((i=this.onIceCandidate)===null||i===void 0||i.call(this,n.candidate))},e.onicecandidateerror=n=>{var i;(i=this.onIceCandidateError)===null||i===void 0||i.call(this,n)},e.oniceconnectionstatechange=()=>{var n;(n=this.onIceConnectionStateChange)===null||n===void 0||n.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var n;(n=this.onSignalingStatechange)===null||n===void 0||n.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var n;(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,e.connectionState)},e.ondatachannel=n=>{var i;(i=this.onDataChannel)===null||i===void 0||i.call(this,n)},e.ontrack=n=>{var i;(i=this.onTrack)===null||i===void 0||i.call(this,n)},e}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return C(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e,n){return C(this,void 0,void 0,function*(){var i;if(e.type==="answer"&&this.latestOfferId>0&&n>0&&n!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:n,latestOfferId:this.latestOfferId})),!1;let r;if(e.type==="offer"){let{stereoMids:s,nackMids:o}=__(e);this.remoteStereoMids=s,this.remoteNackMids=o}else if(e.type==="answer"){const s=Un.parse((i=e.sdp)!==null&&i!==void 0?i:"");s.media.forEach(o=>{const a=Wh(o.mid);o.type==="audio"&&this.trackBitrates.some(l=>{if(!l.transceiver||a!=l.transceiver.mid)return!1;let c=0;if(o.rtp.some(d=>d.codec.toUpperCase()===l.codec.toUpperCase()?(c=d.payload,!0):!1),c===0)return!0;let u=!1;for(const d of o.fmtp)if(d.payload===c){d.config=d.config.split(";").filter(h=>!h.includes("maxaveragebitrate")).join(";"),l.maxbr>0&&(d.config+=";maxaveragebitrate=".concat(l.maxbr*1e3)),u=!0;break}return u||l.maxbr>0&&o.fmtp.push({payload:c,config:"maxaveragebitrate=".concat(l.maxbr*1e3)}),!0})}),r=Un.write(s)}return yield this.setMungedSDP(e,r,!0),this.pendingCandidates.forEach(s=>{this.pc.addIceCandidate(s)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(Pr.NegotiationComplete),e.sdp&&Un.parse(e.sdp).media.forEach(o=>{o.type==="video"&&this.emit(Pr.RTPVideoPayloadTypes,o.rtp)})),!0})}createAndSendOffer(e){return C(this,void 0,void 0,function*(){var n;const i=yield this.offerLock.lock();try{if(this.onOffer===void 0)return;if(e!=null&&e.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const a=this._pc.remoteDescription;if(e!=null&&e.iceRestart&&a)yield this._pc.setRemoteDescription(a);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const r=this.latestOfferId+1;this.latestOfferId=r;const s=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:s.sdp},this.logContext));const o=Un.parse((n=s.sdp)!==null&&n!==void 0?n:"");if(o.media.forEach(a=>{Am(a),a.type==="audio"?Mm(a,["all"],[]):a.type==="video"&&this.trackBitrates.some(l=>{if(!a.msid||!l.cid||!a.msid.includes(l.cid))return!1;let c=0;if(a.rtp.some(d=>d.codec.toUpperCase()===l.codec.toUpperCase()?(c=d.payload,!0):!1),c===0||(qt(l.codec)&&!Ui()&&this.ensureVideoDDExtensionForSVC(a,o),!qt(l.codec)))return!0;const u=Math.round(l.maxbr*E_);for(const d of a.fmtp)if(d.payload===c){d.config.includes("x-google-start-bitrate")||(d.config+=";x-google-start-bitrate=".concat(u));break}return!0})}),this.latestOfferId>r){this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:r}));return}yield this.setMungedSDP(s,Un.write(o)),this.onOffer(s,this.latestOfferId)}finally{i()}})}createAndSetAnswer(){return C(this,void 0,void 0,function*(){var e;const n=yield this.pc.createAnswer(),i=Un.parse((e=n.sdp)!==null&&e!==void 0?e:"");return i.media.forEach(r=>{Am(r),r.type==="audio"&&Mm(r,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(n,Un.write(i)),n})}createDataChannel(e,n){return this.pc.createDataChannel(e,n)}addTransceiver(e,n){return this.pc.addTransceiver(e,n)}addTransceiverOfKind(e,n){return this.pc.addTransceiver(e,n)}addTrack(e){if(!this._pc)throw new Pe("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var n;if(!this._pc)throw new Pe("PC closed, cannot configure");return(n=this._pc)===null||n===void 0?void 0:n.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var n;return(n=this._pc)===null||n===void 0?void 0:n.removeTrack(e)}getConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&n!==void 0?n:"closed"}getICEConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&n!==void 0?n:"closed"}getSignallingState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&n!==void 0?n:"closed"}getTransceivers(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&n!==void 0?n:[]}getSenders(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&n!==void 0?n:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return C(this,void 0,void 0,function*(){var e;if(!this._pc)return;let n="";const i=new Map,r=new Map;if((yield this._pc.getStats()).forEach(a=>{switch(a.type){case"transport":n=a.selectedCandidatePairId;break;case"candidate-pair":n===""&&a.selected&&(n=a.id),i.set(a.id,a);break;case"remote-candidate":r.set(a.id,"".concat(a.address,":").concat(a.port));break}}),n==="")return;const o=(e=i.get(n))===null||e===void 0?void 0:e.remoteCandidateId;if(o!==void 0)return r.get(o)})}setMungedSDP(e,n,i){return C(this,void 0,void 0,function*(){if(n){const r=e.sdp;e.sdp=n;try{this.log.debug("setting munged ".concat(i?"remote":"local"," description"),this.logContext),i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(s){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:s,sdp:n})),e.sdp=r}}try{i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(r){let s="unknown error";r instanceof Error?s=r.message:typeof r=="string"&&(s=r);const o={error:s,sdp:e.sdp};throw!i&&this.pc.remoteDescription&&(o.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:o})),new Cr(s)}})}ensureVideoDDExtensionForSVC(e,n){var i,r;if(!((i=e.ext)===null||i===void 0?void 0:i.some(o=>o.uri===pm))){if(this.ddExtID===0){let o=0;n.media.forEach(a=>{var l;a.type==="video"&&((l=a.ext)===null||l===void 0||l.forEach(c=>{c.value>o&&(o=c.value)}))}),this.ddExtID=o+1}(r=e.ext)===null||r===void 0||r.push({value:this.ddExtID,uri:pm})}}}function Mm(t,e,n){const i=Wh(t.mid);let r=0;t.rtp.some(s=>s.codec==="opus"?(r=s.payload,!0):!1),r>0&&(t.rtcpFb||(t.rtcpFb=[]),n.includes(i)&&!t.rtcpFb.some(s=>s.payload===r&&s.type==="nack")&&t.rtcpFb.push({payload:r,type:"nack"}),(e.includes(i)||e.length===1&&e[0]==="all")&&t.fmtp.some(s=>s.payload===r?(s.config.includes("stereo=1")||(s.config+=";stereo=1"),!0):!1))}function __(t){var e;const n=[],i=[],r=Un.parse((e=t.sdp)!==null&&e!==void 0?e:"");let s=0;return r.media.forEach(o=>{var a;const l=Wh(o.mid);o.type==="audio"&&(o.rtp.some(c=>c.codec==="opus"?(s=c.payload,!0):!1),!((a=o.rtcpFb)===null||a===void 0)&&a.some(c=>c.payload===s&&c.type==="nack")&&i.push(l),o.fmtp.some(c=>c.payload===s?(c.config.includes("sprop-stereo=1")&&n.push(l),!0):!1))}),{stereoMids:n,nackMids:i}}function Am(t){if(t.connection){const e=t.connection.ip.indexOf(":")>=0;(t.connection.version===4&&e||t.connection.version===6&&!e)&&(t.connection.ip="0.0.0.0",t.connection.version=4)}}function Wh(t){return typeof t=="number"?t.toFixed(0):t}const id="vp8",R_={audioPreset:$u.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:Fh.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:id,backupCodec:!0,preConnectBuffer:!1},Yk={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},Xk={deviceId:{ideal:"default"},resolution:no.h720.resolution},x_={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new oP,disconnectOnPageLeave:!0,webAudioMix:!1,singlePeerConnection:!0},qh={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var ke;(function(t){t[t.NEW=0]="NEW",t[t.CONNECTING=1]="CONNECTING",t[t.CONNECTED=2]="CONNECTED",t[t.FAILED=3]="FAILED",t[t.CLOSING=4]="CLOSING",t[t.CLOSED=5]="CLOSED"})(ke||(ke={}));class I_{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}get mode(){return this._mode}constructor(e,n,i){var r;this.peerConnectionTimeout=qh.peerConnectionTimeout,this.log=H,this.updateState=()=>{var s,o;const a=this.state,l=this.requiredTransports.map(c=>c.getConnectionState());l.every(c=>c==="connected")?this.state=ke.CONNECTED:l.some(c=>c==="failed")?this.state=ke.FAILED:l.some(c=>c==="connecting")?this.state=ke.CONNECTING:l.every(c=>c==="closed")?this.state=ke.CLOSED:l.some(c=>c==="closed")?this.state=ke.CLOSING:l.every(c=>c==="new")&&(this.state=ke.NEW),a!==this.state&&(this.log.debug("pc state change: from ".concat(ke[a]," to ").concat(ke[this.state]),this.logContext),(s=this.onStateChange)===null||s===void 0||s.call(this,this.state,this.publisher.getConnectionState(),(o=this.subscriber)===null||o===void 0?void 0:o.getConnectionState()))},this.log=Dn((r=i.loggerName)!==null&&r!==void 0?r:Jt.PCManager),this.loggerOptions=i,this.isPublisherConnectionRequired=n!=="subscriber-primary",this.isSubscriberConnectionRequired=n==="subscriber-primary",this.publisher=new Dm(e,i),this._mode=n,n!=="publisher-only"&&(this.subscriber=new Dm(e,i),this.subscriber.onConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.subscriber.onIceCandidate=s=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,s,Wt.SUBSCRIBER)},this.subscriber.onDataChannel=s=>{var o;(o=this.onDataChannel)===null||o===void 0||o.call(this,s)},this.subscriber.onTrack=s=>{var o;(o=this.onTrack)===null||o===void 0||o.call(this,s)}),this.publisher.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=s=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,s,Wt.PUBLISHER)},this.publisher.onTrack=s=>{var o;(o=this.onTrack)===null||o===void 0||o.call(this,s)},this.publisher.onOffer=(s,o)=>{var a;(a=this.onPublisherOffer)===null||a===void 0||a.call(this,s,o)},this.state=ke.NEW,this.connectionLock=new tt,this.remoteOfferLock=new tt}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e,n){return this.publisher.setRemoteDescription(e,n)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return C(this,void 0,void 0,function*(){var e;if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const n=this.publisher;for(const i of n.getSenders())try{n.canRemoveTrack()&&n.removeTrack(i)}catch(r){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:r}))}}yield Promise.all([this.publisher.close(),(e=this.subscriber)===null||e===void 0?void 0:e.close()]),this.updateState()})}triggerIceRestart(){return C(this,void 0,void 0,function*(){this.subscriber&&(this.subscriber.restartingIce=!0),this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,n){return C(this,void 0,void 0,function*(){var i;n===Wt.PUBLISHER?yield this.publisher.addIceCandidate(e):yield(i=this.subscriber)===null||i===void 0?void 0:i.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e,n){return C(this,void 0,void 0,function*(){var i,r,s;this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:(i=this.subscriber)===null||i===void 0?void 0:i.getSignallingState().toString()}));const o=yield this.remoteOfferLock.lock();try{return(yield(r=this.subscriber)===null||r===void 0?void 0:r.setRemoteDescription(e,n))?yield(s=this.subscriber)===null||s===void 0?void 0:s.createAndSetAnswer():void 0}finally{o()}})}updateConfiguration(e,n){var i;this.publisher.setConfiguration(e),(i=this.subscriber)===null||i===void 0||i.setConfiguration(e),n&&this.triggerIceRestart()}ensurePCTransportConnection(e,n){return C(this,void 0,void 0,function*(){var i;const r=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((i=this.requiredTransports)===null||i===void 0?void 0:i.map(s=>this.ensureTransportConnected(s,e,n)))}finally{r()}})}negotiate(e){return C(this,void 0,void 0,function*(){return new lt((n,i)=>C(this,void 0,void 0,function*(){const r=setTimeout(()=>{i(new Cr("negotiation timed out"))},this.peerConnectionTimeout),s=()=>{clearTimeout(r),i(new Cr("negotiation aborted"))};e.signal.addEventListener("abort",s),this.publisher.once(Pr.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(Pr.NegotiationComplete,()=>{clearTimeout(r),n()})}),yield this.publisher.negotiate(o=>{clearTimeout(r),o instanceof Error?i(o):i(new Error(String(o)))})}))})}addPublisherTransceiver(e,n){return this.publisher.addTransceiver(e,n)}addPublisherTransceiverOfKind(e,n){return this.publisher.addTransceiverOfKind(e,n)}getMidForReceiver(e){const i=(this.subscriber?this.subscriber.getTransceivers():this.publisher.getTransceivers()).find(r=>r.receiver===e);return i==null?void 0:i.mid}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,n){return this.publisher.createDataChannel(e,n)}getConnectedAddress(e){return e===Wt.PUBLISHER?this.publisher.getConnectedAddress():e===Wt.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&this.subscriber&&e.push(this.subscriber),e}ensureTransportConnected(e,n){return C(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return function*(){if(i.getConnectionState()!=="connected")return new Promise((l,c)=>C(s,void 0,void 0,function*(){const u=()=>{this.log.warn("abort transport connection",this.logContext),Be.clearTimeout(d),c(B.cancelled("room connection has been cancelled"))};r!=null&&r.signal.aborted&&u(),r==null||r.signal.addEventListener("abort",u);const d=Be.setTimeout(()=>{r==null||r.signal.removeEventListener("abort",u),c(B.internal("could not establish pc connection"))},o);for(;this.state!==ke.CONNECTED;)if(yield ze(50),r!=null&&r.signal.aborted){c(B.cancelled("room connection has been cancelled"));return}Be.clearTimeout(d),r==null||r.signal.removeEventListener("abort",u),l()}))}()})}}const Zk=5e3,D_=3e4;class X{static fetchRegionSettings(e,n,i){return C(this,void 0,void 0,function*(){const r=yield X.fetchLock.lock();try{const s=yield fetch("".concat(M_(e),"/regions"),{headers:{authorization:"Bearer ".concat(n)},signal:i});if(s.ok){const o=e_(s.headers),a=o?o*1e3:Zk;return{regionSettings:yield s.json(),updatedAtInMs:Date.now(),maxAgeInMs:a}}else throw s.status===401?B.notAllowed("Could not fetch region settings: ".concat(s.statusText),s.status):B.internal("Could not fetch region settings: ".concat(s.statusText))}catch(s){throw s instanceof B?s:i!=null&&i.aborted?B.cancelled("Region fetching was aborted"):B.serverUnreachable("Could not fetch region settings, ".concat(s instanceof Error?"".concat(s.name,": ").concat(s.message):s))}finally{r()}})}static scheduleRefetch(e,n,i){return C(this,void 0,void 0,function*(){const r=X.settingsTimeouts.get(e.hostname);clearTimeout(r),X.settingsTimeouts.set(e.hostname,setTimeout(()=>C(this,void 0,void 0,function*(){try{const s=yield X.fetchRegionSettings(e,n);X.updateCachedRegionSettings(e,n,s)}catch(s){if(s instanceof B&&s.reason===oe.NotAllowed){H.debug("token is not valid, cancelling auto region refresh");return}H.debug("auto refetching of region settings failed",{error:s}),X.scheduleRefetch(e,n,i)}}),i))})}static updateCachedRegionSettings(e,n,i){X.cache.set(e.hostname,i),X.scheduleRefetch(e,n,i.maxAgeInMs)}static stopRefetch(e){const n=X.settingsTimeouts.get(e);n&&(clearTimeout(n),X.settingsTimeouts.delete(e))}static scheduleCleanup(e){let n=X.connectionTrackers.get(e);n&&(n.cleanupTimeout&&clearTimeout(n.cleanupTimeout),n.cleanupTimeout=setTimeout(()=>{const i=X.connectionTrackers.get(e);i&&i.connectionCount===0&&(H.debug("stopping region refetch after disconnect delay",{hostname:e}),X.stopRefetch(e)),i&&(i.cleanupTimeout=void 0)},D_))}static cancelCleanup(e){const n=X.connectionTrackers.get(e);n!=null&&n.cleanupTimeout&&(clearTimeout(n.cleanupTimeout),n.cleanupTimeout=void 0)}notifyConnected(){const e=this.serverUrl.hostname;let n=X.connectionTrackers.get(e);n||(n={connectionCount:0},X.connectionTrackers.set(e,n)),n.connectionCount++,X.cancelCleanup(e)}notifyDisconnected(){const e=this.serverUrl.hostname,n=X.connectionTrackers.get(e);n&&(n.connectionCount=Math.max(0,n.connectionCount-1),n.connectionCount===0&&X.scheduleCleanup(e))}constructor(e,n){this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=n}updateToken(e){this.token=e}isCloud(){return Nr(this.serverUrl)}getServerUrl(){return this.serverUrl}fetchRegionSettings(e){return C(this,void 0,void 0,function*(){return X.fetchRegionSettings(this.serverUrl,this.token,e)})}getNextBestRegionUrl(e){return C(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");let n=X.cache.get(this.serverUrl.hostname);(!n||Date.now()-n.updatedAtInMs>n.maxAgeInMs)&&(n=yield this.fetchRegionSettings(e),X.updateCachedRegionSettings(this.serverUrl,this.token,n));const i=n.regionSettings.regions.filter(r=>!this.attemptedRegions.find(s=>s.url===r.url));if(i.length>0){const r=i[0];return this.attemptedRegions.push(r),H.debug("next region: ".concat(r.region)),r.url}else return null})}resetAttempts(){this.attemptedRegions=[]}setServerReportedRegions(e){X.updateCachedRegionSettings(this.serverUrl,this.token,e)}}X.cache=new Map;X.settingsTimeouts=new Map;X.connectionTrackers=new Map;X.fetchLock=new tt;function M_(t){return"".concat(t.protocol.replace("ws","http"),"//").concat(t.host,"/settings")}class be extends Error{constructor(e,n,i){super(n),this.code=e,this.message=Om(n,be.MAX_MESSAGE_BYTES),this.data=i?Om(i,be.MAX_DATA_BYTES):void 0}static fromProto(e){return new be(e.code,e.message,e.data)}toProto(){return new K0({code:this.code,message:this.message,data:this.data})}static builtIn(e,n){return new be(be.ErrorCode[e],be.ErrorMessage[e],n)}}be.MAX_MESSAGE_BYTES=256;be.MAX_DATA_BYTES=15360;be.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};be.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const eS=15360;function Kh(t){return new TextEncoder().encode(t).length}function Om(t,e){if(Kh(t)<=e)return t;let n=0,i=t.length;const r=new TextEncoder;for(;n<i;){const s=Math.floor((n+i+1)/2);r.encode(t.slice(0,s)).length<=e?n=s:i=s-1}return t.slice(0,n)}const Hh=2e3;function Ml(t,e){if(!e)return 0;let n,i;return"bytesReceived"in t?(n=t.bytesReceived,i=e.bytesReceived):"bytesSent"in t&&(n=t.bytesSent,i=e.bytesSent),n===void 0||i===void 0||t.timestamp===void 0||e.timestamp===void 0?0:(n-i)*8*1e3/(t.timestamp-e.timestamp)}const Gh=typeof MediaRecorder<"u";class A_{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const O_=Gh?MediaRecorder:A_;class L_ extends O_{constructor(e,n){if(!Gh)throw new Error("MediaRecorder is not available in this environment");super(new MediaStream([e.mediaStreamTrack]),n);let i,r;const s=()=>r===void 0,o=()=>{this.removeEventListener("dataavailable",i),this.removeEventListener("stop",o),this.removeEventListener("error",a),r==null||r.close(),r=void 0},a=l=>{r==null||r.error(l),this.removeEventListener("dataavailable",i),this.removeEventListener("stop",o),this.removeEventListener("error",a),r=void 0};this.byteStream=new ReadableStream({start:l=>{r=l,i=c=>C(this,void 0,void 0,function*(){let u;if(c.data.arrayBuffer){const d=yield c.data.arrayBuffer();u=new Uint8Array(d)}else if(c.data.byteArray)u=c.data.byteArray;else throw new Error("no data available!");s()||l.enqueue(u)}),this.addEventListener("dataavailable",i)},cancel:()=>{o()}}),this.addEventListener("stop",o),this.addEventListener("error",a)}}function N_(){return Gh}const F_=1e3,U_=1e4;class tS extends R{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(e,n,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=arguments.length>4?arguments[4]:void 0;super(e,n,s),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=zh(()=>C(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>C(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(O.Ended,this)},this.reacquireTrack=!1,this.providedByUser=r,this.muteLock=new tt,this.pauseUpstreamLock=new tt,this.trackChangeLock=new tt,this.trackChangeLock.lock().then(o=>C(this,void 0,void 0,function*(){try{yield this.setMediaStreamTrack(e,!0)}finally{o()}})),this._constraints=e.getConstraints(),i&&(this._constraints=i)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==R.Kind.Video)return;const{width:e,height:n}=this._mediaStreamTrack.getSettings();if(e&&n)return{width:e,height:n}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,n;return(n=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&n!==void 0?n:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,n){return C(this,void 0,void 0,function*(){var i;if(e===this._mediaStreamTrack&&!n)return;this._mediaStreamTrack&&(this.attachedElements.forEach(s=>{br(this._mediaStreamTrack,s)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let r;if(this.processor&&e){if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(or(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),r=this.processor.processedTrack}this.sender&&((i=this.sender.transport)===null||i===void 0?void 0:i.state)!=="closed"&&(yield this.sender.replaceTrack(r??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(s=>{or(r??e,s)}))})}waitForDimensions(){return C(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:F_;return function*(){var i;if(e.kind===R.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((i=ft())===null||i===void 0?void 0:i.os)==="iOS"&&(yield ze(10));const r=Date.now();for(;Date.now()-r<n;){const s=e.dimensions;if(s)return s;yield ze(50)}throw new Sn("unable to get track dimensions after timeout")}()})}setDeviceId(e){return C(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===ii(e)||(this._constraints.deviceId=e,this.isMuted)?!0:(yield this.restartTrack(),ii(e)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return C(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){if(e.source===R.Source.ScreenShare)return;const{deviceId:i,groupId:r}=e._mediaStreamTrack.getSettings(),s=e.kind===R.Kind.Audio?"audioinput":"videoinput";return n?Fe.getInstance().normalizeDeviceId(s,i,r):i}()})}mute(){return C(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return C(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,n){return C(this,void 0,void 0,function*(){const i=yield this.trackChangeLock.lock();try{if(!this.sender)throw new Sn("unable to replace an unpublished track");let r,s;return typeof n=="boolean"?r=n:n!==void 0&&(r=n.userProvidedTrack,s=n.stopProcessor),this.providedByUser=r??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),s&&this.processor&&(yield this.internalStopProcessor()),this}finally{i()}})}restart(e){return C(this,void 0,void 0,function*(){this.manuallyStopped=!1;const n=yield this.trackChangeLock.lock();try{e||(e=this._constraints);const{deviceId:i,facingMode:r}=e,s=aP(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const o={audio:!1,video:!1};this.kind===R.Kind.Video?o.video=i||r?{deviceId:i,facingMode:r}:!0:o.audio=i?Object.assign({deviceId:i},s):!0,this.attachedElements.forEach(c=>{br(this.mediaStreamTrack,c)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const l=(yield navigator.mediaDevices.getUserMedia(o)).getTracks()[0];return this.kind===R.Kind.Video&&(yield l.applyConstraints(s)),l.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(l),this._constraints=e,this.emit(O.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{n()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?O.Muted:O.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return C(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),Gk()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return C(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(O.UpstreamPaused,this);const i=ft();if((i==null?void 0:i.name)==="Safari"&&ln(i.version,"12.0")<0)throw new Nh("pauseUpstream is not supported on Safari < 12.");((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{n()}})}resumeUpstream(){return C(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(O.UpstreamResumed,this),((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{n()}})}getRTCStatsReport(){return C(this,void 0,void 0,function*(){var e;return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return C(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;const o=yield i.trackChangeLock.lock();try{i.log.debug("setting up processor",i.logContext);const a=document.createElement(i.kind),l={kind:i.kind,track:i._mediaStreamTrack,element:a,audioContext:i.audioContext};if(yield n.init(l),i.log.debug("processor initialized",i.logContext),i.processor&&(yield i.internalStopProcessor()),i.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(or(i._mediaStreamTrack,a),a.muted=!0,a.play().catch(c=>{c instanceof DOMException&&c.name==="AbortError"?(i.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},i.logContext),{error:c})),setTimeout(()=>{a.play().catch(u=>{i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{err:u}))})},100)):i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{error:c}))}),i.processor=n,i.processorElement=a,i.processor.processedTrack){for(const c of i.attachedElements)c!==i.processorElement&&r&&(br(i._mediaStreamTrack,c),or(i.processor.processedTrack,c));yield(s=i.sender)===null||s===void 0?void 0:s.replaceTrack(i.processor.processedTrack)}i.emit(O.TrackProcessorUpdate,i.processor)}finally{o()}}()})}getProcessor(){return this.processor}stopProcessor(){return C(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){const i=yield e.trackChangeLock.lock();try{yield e.internalStopProcessor(n)}finally{i()}}()})}internalStopProcessor(){return C(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var i,r;e.processor&&(e.log.debug("stopping processor",e.logContext),(i=e.processor.processedTrack)===null||i===void 0||i.stop(),yield e.processor.destroy(),e.processor=void 0,n||((r=e.processorElement)===null||r===void 0||r.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(O.TrackProcessorUpdate))}()})}startPreConnectBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!N_()){this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext);return}if(this.localTrackRecorder){this.log.warn("preconnect buffer already started");return}else{let n="audio/webm;codecs=opus";MediaRecorder.isTypeSupported(n)||(n="video/mp4"),this.localTrackRecorder=new L_(this,{mimeType:n})}this.localTrackRecorder.start(e),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},U_)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.byteStream}getPreConnectBufferMimeType(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.mimeType}}class Ya extends tS{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;super(e,R.Kind.Audio,n,i,s),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>C(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let o;try{o=yield this.getSenderStats()}catch(a){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:a}));return}o&&this.prevStats&&(this._currentBitrate=Ml(o,this.prevStats)),this.prevStats=o}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(O.AudioTrackFeatureUpdate,this,Ne.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(O.AudioTrackFeatureUpdate,this,Ne.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=r,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return C(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===R.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return C(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const i=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==ii(this._constraints.deviceId);return this.source===R.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||i)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{n()}})}restartTrack(e){return C(this,void 0,void 0,function*(){let n;if(e){const i=Uh({audio:e});typeof i.audio!="boolean"&&(n=i.audio)}yield this.restart(n)})}restart(e){const n=Object.create(null,{restart:{get:()=>super.restart}});return C(this,void 0,void 0,function*(){const i=yield n.restart.call(this,e);return this.checkForSilence(),i})}startMonitor(){ct()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},Hh)))}setProcessor(e){return C(this,void 0,void 0,function*(){var n;const i=yield this.trackChangeLock.lock();try{if(!an()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.internalStopProcessor());const r={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(r),this.processor=e,this.processor.processedTrack&&(yield(n=this.sender)===null||n===void 0?void 0:n.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(O.TrackProcessorUpdate,this.processor)}finally{i()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return C(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const n=yield this.sender.getStats();let i;return n.forEach(r=>{r.type==="outbound-rtp"&&(i={type:"audio",streamId:r.id,packetsSent:r.packetsSent,packetsLost:r.packetsLost,bytesSent:r.bytesSent,timestamp:r.timestamp,roundTripTime:r.roundTripTime,jitter:r.jitter})}),i})}checkForSilence(){return C(this,void 0,void 0,function*(){const e=yield qk(this);return e&&(this.isMuted||this.log.debug("silence detected on local audio track",this.logContext),this.emit(O.AudioSilenceDetected)),e})}}function j_(t,e,n){switch(t.kind){case"audio":return new Ya(t,e,!1,void 0,n);case"video":return new Xa(t,e,!1,n);default:throw new Sn("unsupported track type: ".concat(t.kind))}}const V_=Object.values(no),B_=Object.values(Ju),z_=Object.values(Fh),W_=[no.h180,no.h360],q_=[Ju.h180,Ju.h360],K_=t=>[{scaleResolutionDownBy:2,fps:t.encoding.maxFramerate}].map(n=>{var i,r;return new re(Math.floor(t.width/n.scaleResolutionDownBy),Math.floor(t.height/n.scaleResolutionDownBy),Math.max(15e4,Math.floor(t.encoding.maxBitrate/(Math.pow(n.scaleResolutionDownBy,2)*(((i=t.encoding.maxFramerate)!==null&&i!==void 0?i:30)/((r=n.fps)!==null&&r!==void 0?r:30))))),n.fps,t.encoding.priority)}),rd=["q","h","f"];function sd(t,e,n,i){var r,s;let o=i==null?void 0:i.videoEncoding;t&&(o=i==null?void 0:i.screenShareEncoding);const a=i==null?void 0:i.simulcast,l=i==null?void 0:i.scalabilityMode,c=i==null?void 0:i.videoCodec;if(!o&&!a&&!l||!e||!n)return[{}];o||(o=G_(t,e,n,c),H.debug("using video encoding",o));const u=o.maxFramerate,d=new re(e,n,o.maxBitrate,o.maxFramerate,o.priority);if(l&&qt(c)){const v=new nS(l),g=[];if(v.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(l));const y=ft();if(io()||an()||(y==null?void 0:y.name)==="Chrome"&&ln(y==null?void 0:y.version,"113")<0){const p=v.suffix=="h"?2:3,m=zP(y);for(let k=0;k<v.spatial;k+=1)g.push({rid:rd[2-k],maxBitrate:o.maxBitrate/Math.pow(p,k),maxFramerate:d.encoding.maxFramerate,scaleResolutionDownBy:m?Math.pow(2,k):void 0});g[0].scalabilityMode=l}else g.push({maxBitrate:o.maxBitrate,maxFramerate:d.encoding.maxFramerate,scalabilityMode:l});return d.encoding.priority&&(g[0].priority=d.encoding.priority,g[0].networkPriority=d.encoding.priority),H.debug("using svc encoding",{encodings:g}),g}if(!a)return[o];let h=[];t?h=(r=Nm(i==null?void 0:i.screenShareSimulcastLayers))!==null&&r!==void 0?r:Lm(t,d):h=(s=Nm(i==null?void 0:i.videoSimulcastLayers))!==null&&s!==void 0?s:Lm(t,d);let f;if(h.length>0){const v=h[0];h.length>1&&([,f]=h);const g=Math.max(e,n);if(g>=960&&f)return _c(e,n,[v,f,d],u);if(g>=480)return _c(e,n,[v,d],u)}return _c(e,n,[d])}function H_(t,e,n){var i,r,s,o;if(!n.backupCodec||n.backupCodec===!0||n.backupCodec.codec===n.videoCodec)return;e!==n.backupCodec.codec&&H.warn("requested a different codec than specified as backup",{serverRequested:e,backup:n.backupCodec.codec}),n.videoCodec=e,n.videoEncoding=n.backupCodec.encoding;const a=t.mediaStreamTrack.getSettings(),l=(i=a.width)!==null&&i!==void 0?i:(r=t.dimensions)===null||r===void 0?void 0:r.width,c=(s=a.height)!==null&&s!==void 0?s:(o=t.dimensions)===null||o===void 0?void 0:o.height;return t.source===R.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),sd(t.source===R.Source.ScreenShare,l,c,n)}function G_(t,e,n,i){const r=$_(t,e,n);let{encoding:s}=r[0];const o=Math.max(e,n);for(let a=0;a<r.length;a+=1){const l=r[a];if(s=l.encoding,l.width>=o)break}if(i)switch(i){case"av1":case"h265":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.7;break;case"vp9":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.85;break}return s}function $_(t,e,n){if(t)return z_;const i=e>n?e/n:n/e;return Math.abs(i-16/9)<Math.abs(i-4/3)?V_:B_}function Lm(t,e){if(t)return K_(e);const{width:n,height:i}=e,r=n>i?n/i:i/n;return Math.abs(r-16/9)<Math.abs(r-4/3)?W_:q_}function _c(t,e,n,i){const r=[];if(n.forEach((s,o)=>{if(o>=rd.length)return;const a=Math.min(t,e),c={rid:rd[o],scaleResolutionDownBy:Math.max(1,a/Math.min(s.width,s.height)),maxBitrate:s.encoding.maxBitrate},u=i&&s.encoding.maxFramerate?Math.min(i,s.encoding.maxFramerate):s.encoding.maxFramerate;u&&(c.maxFramerate=u);const d=Fi()||o===0;s.encoding.priority&&d&&(c.priority=s.encoding.priority,c.networkPriority=s.encoding.priority),r.push(c)}),an()&&Jk()==="ios"){let s;r.forEach(a=>{s?a.maxFramerate&&a.maxFramerate>s&&(s=a.maxFramerate):s=a.maxFramerate});let o=!0;r.forEach(a=>{var l;a.maxFramerate!=s&&(o&&(o=!1,H.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),H.info('Setting framerate of encoding "'.concat((l=a.rid)!==null&&l!==void 0?l:"",'" to ').concat(s)),a.maxFramerate=s)})}return r}function Nm(t){if(t)return t.sort((e,n)=>{const{encoding:i}=e,{encoding:r}=n;return i.maxBitrate>r.maxBitrate?1:i.maxBitrate<r.maxBitrate?-1:i.maxBitrate===r.maxBitrate&&i.maxFramerate&&r.maxFramerate?i.maxFramerate>r.maxFramerate?1:-1:0})}class nS{constructor(e){const n=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!n)throw new Error("invalid scalability mode");if(this.spatial=parseInt(n[1]),this.temporal=parseInt(n[2]),n.length>3)switch(n[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=n[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}function J_(t){return t.source===R.Source.ScreenShare||t.constraints.height&&ii(t.constraints.height)>=1080?"maintain-resolution":"balanced"}const Q_=5e3;class Xa extends tS{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0;super(e,R.Kind.Video,n,i,r),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>C(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let s;try{s=yield this.getSenderStats()}catch(l){this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:l}));return}const o=new Map(s.map(l=>[l.rid,l])),a=s.some(l=>l.qualityLimitationReason==="cpu");if(a!==this.isCpuConstrained&&(this.isCpuConstrained=a,this.isCpuConstrained&&this.emit(O.CpuConstrained)),this.prevStats){let l=0;o.forEach((c,u)=>{var d;const h=(d=this.prevStats)===null||d===void 0?void 0:d.get(u);l+=Ml(c,h)}),this._currentBitrate=l}this.prevStats=o}),this.senderLock=new tt}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var n;if(this.signalClient=e,!ct())return;const i=(n=this.sender)===null||n===void 0?void 0:n.getParameters();i&&(this.encodings=i.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},Hh))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return C(this,void 0,void 0,function*(){var n,i,r,s,o;yield e.pauseUpstream.call(this);try{for(var a=!0,l=kn(this.simulcastCodecs.values()),c;c=yield l.next(),n=c.done,!n;a=!0)s=c.value,a=!1,yield(o=s.sender)===null||o===void 0?void 0:o.replaceTrack(null)}catch(u){i={error:u}}finally{try{!a&&!n&&(r=l.return)&&(yield r.call(l))}finally{if(i)throw i.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return C(this,void 0,void 0,function*(){var n,i,r,s,o;yield e.resumeUpstream.call(this);try{for(var a=!0,l=kn(this.simulcastCodecs.values()),c;c=yield l.next(),n=c.done,!n;a=!0){s=c.value,a=!1;const u=s;yield(o=u.sender)===null||o===void 0?void 0:o.replaceTrack(u.mediaStreamTrack)}}catch(u){i={error:u}}finally{try{!a&&!n&&(r=l.return)&&(yield r.call(l))}finally{if(i)throw i.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return C(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===R.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return C(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.source===R.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{n()}})}setTrackMuted(e){super.setTrackMuted(e);for(const n of this.simulcastCodecs.values())n.mediaStreamTrack.enabled=!e}getSenderStats(){return C(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const n=[],i=yield this.sender.getStats();return i.forEach(r=>{var s;if(r.type==="outbound-rtp"){const o={type:"video",streamId:r.id,frameHeight:r.frameHeight,frameWidth:r.frameWidth,framesPerSecond:r.framesPerSecond,framesSent:r.framesSent,firCount:r.firCount,pliCount:r.pliCount,nackCount:r.nackCount,packetsSent:r.packetsSent,bytesSent:r.bytesSent,qualityLimitationReason:r.qualityLimitationReason,qualityLimitationDurations:r.qualityLimitationDurations,qualityLimitationResolutionChanges:r.qualityLimitationResolutionChanges,rid:(s=r.rid)!==null&&s!==void 0?s:r.id,retransmittedPacketsSent:r.retransmittedPacketsSent,targetBitrate:r.targetBitrate,timestamp:r.timestamp},a=i.get(r.remoteId);a&&(o.jitter=a.jitter,o.packetsLost=a.packetsLost,o.roundTripTime=a.roundTripTime),n.push(o)}}),n.sort((r,s)=>{var o,a;return((o=s.frameWidth)!==null&&o!==void 0?o:0)-((a=r.frameWidth)!==null&&a!==void 0?a:0)}),n})}setPublishingQuality(e){const n=[];for(let i=gt.LOW;i<=gt.HIGH;i+=1)n.push(new Mh({quality:i,enabled:i<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(qt(this.codec),n)}restartTrack(e){return C(this,void 0,void 0,function*(){var n,i,r,s,o;let a;if(e){const d=Uh({video:e});typeof d.video!="boolean"&&(a=d.video)}yield this.restart(a),this.isCpuConstrained=!1;try{for(var l=!0,c=kn(this.simulcastCodecs.values()),u;u=yield c.next(),n=u.done,!n;l=!0){s=u.value,l=!1;const d=s;d.sender&&((o=d.sender.transport)===null||o===void 0?void 0:o.state)!=="closed"&&(d.mediaStreamTrack=this.mediaStreamTrack.clone(),yield d.sender.replaceTrack(d.mediaStreamTrack))}}catch(d){i={error:d}}finally{try{!l&&!n&&(r=c.return)&&(yield r.call(c))}finally{if(i)throw i.error}}})}setProcessor(e){const n=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return C(this,arguments,void 0,function(i){var r=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var o,a,l,c,u,d;if(yield n.setProcessor.call(r,i,s),!((u=r.processor)===null||u===void 0)&&u.processedTrack)try{for(var h=!0,f=kn(r.simulcastCodecs.values()),v;v=yield f.next(),o=v.done,!o;h=!0)c=v.value,h=!1,yield(d=c.sender)===null||d===void 0?void 0:d.replaceTrack(r.processor.processedTrack)}catch(g){a={error:g}}finally{try{!h&&!o&&(l=f.return)&&(yield l.call(f))}finally{if(a)throw a.error}}}()})}setDegradationPreference(e){return C(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const n=this.sender.getParameters();n.degradationPreference=e,this.sender.setParameters(n)}catch(n){this.log.warn("failed to set degradationPreference",Object.assign({error:n},this.logContext))}})}addSimulcastTrack(e,n){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}const i={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:n};return this.simulcastCodecs.set(e,i),i}setSimulcastTrackSender(e,n){const i=this.simulcastCodecs.get(e);i&&(i.sender=n,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},Q_))}setPublishingCodecs(e){return C(this,void 0,void 0,function*(){var n,i,r,s,o,a,l;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(qt(e[0].codec),e[0].qualities),[];this.subscribedCodecs=e;const c=[];try{for(n=!0,i=kn(e);r=yield i.next(),s=r.done,!s;n=!0){l=r.value,n=!1;const u=l;if(!this.codec||this.codec===u.codec)yield this.setPublishingLayers(qt(u.codec),u.qualities);else{const d=this.simulcastCodecs.get(u.codec);if(this.log.debug("try setPublishingCodec for ".concat(u.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:d})),!d||!d.sender){for(const h of u.qualities)if(h.enabled){c.push(u.codec);break}}else d.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(u.codec),this.logContext),yield Fm(d.sender,d.encodings,u.qualities,this.senderLock,qt(u.codec),this.log,this.logContext))}}}catch(u){o={error:u}}finally{try{!n&&!s&&(a=i.return)&&(yield a.call(i))}finally{if(o)throw o.error}}return c})}setPublishingLayers(e,n){return C(this,void 0,void 0,function*(){if(this.optimizeForPerformance){this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:n}));return}this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:n})),!(!this.sender||!this.encodings)&&(yield Fm(this.sender,this.encodings,n,this.senderLock,e,this.log,this.logContext))})}prioritizePerformance(){return C(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const e=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const n=this.sender.getParameters();n.encodings=n.encodings.map((i,r)=>{var s;return Object.assign(Object.assign({},i),{active:r===0,scaleResolutionDownBy:Math.max(1,Math.ceil(((s=this.mediaStreamTrack.getSettings().height)!==null&&s!==void 0?s:360)/360)),scalabilityMode:r===0&&qt(this.codec)?"L1T3":void 0,maxFramerate:r===0?15:0,maxBitrate:r===0?i.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:n.encodings})),this.encodings=n.encodings,yield this.sender.setParameters(n)}catch(n){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:n})),this.optimizeForPerformance=!1}finally{e()}})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return C(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),Gk()&&this.isInBackground&&this.source===R.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function Fm(t,e,n,i,r,s,o){return C(this,void 0,void 0,function*(){const a=yield i.lock();s.debug("setPublishingLayersForSender",Object.assign(Object.assign({},o),{sender:t,qualities:n,senderEncodings:e}));try{const l=t.getParameters(),{encodings:c}=l;if(!c)return;if(c.length!==e.length){s.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},o),{encodings:c,senderEncodings:e}));return}let u=!1;!1&&c[0].scalabilityMode||(r&&n.some(f=>f.enabled)&&n.forEach(f=>f.enabled=!0),c.forEach((h,f)=>{var v;let g=(v=h.rid)!==null&&v!==void 0?v:"";g===""&&(g="q");const y=iS(g),p=n.find(m=>m.quality===y);p&&h.active!==p.enabled&&(u=!0,h.active=p.enabled,s.debug("setting layer ".concat(p.quality," to ").concat(h.active?"enabled":"disabled"),o),Fi()&&(p.enabled?(h.scaleResolutionDownBy=e[f].scaleResolutionDownBy,h.maxBitrate=e[f].maxBitrate,h.maxFrameRate=e[f].maxFrameRate):(h.scaleResolutionDownBy=4,h.maxBitrate=10,h.maxFrameRate=2)))})),u&&(l.encodings=c,s.debug("setting encodings",Object.assign(Object.assign({},o),{encodings:l.encodings})),yield t.setParameters(l))}finally{a()}})}function iS(t){switch(t){case"f":return gt.HIGH;case"h":return gt.MEDIUM;case"q":return gt.LOW;default:return gt.HIGH}}function Um(t,e,n,i){if(!n)return[new ni({quality:gt.HIGH,width:t,height:e,bitrate:0,ssrc:0})];if(i){const r=n[0].scalabilityMode,s=new nS(r),o=[],a=s.suffix=="h"?1.5:2,l=s.suffix=="h"?2:3;for(let c=0;c<s.spatial;c+=1)o.push(new ni({quality:Math.min(gt.HIGH,s.spatial-1)-c,width:Math.ceil(t/Math.pow(a,c)),height:Math.ceil(e/Math.pow(a,c)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(l,c)):0,ssrc:0}));return o}return n.map(r=>{var s,o,a;const l=(s=r.scaleResolutionDownBy)!==null&&s!==void 0?s:1;let c=iS((o=r.rid)!==null&&o!==void 0?o:"");return new ni({quality:c,width:Math.ceil(t/l),height:Math.ceil(e/l),bitrate:(a=r.maxBitrate)!==null&&a!==void 0?a:0,ssrc:0})})}const jm="_lossy",Vm="_reliable",Y_=2*1e3,Rc="leave-reconnect",X_=3e4,Z_=8*1024,e1=256*1024;var wt;(function(t){t[t.New=0]="New",t[t.Connected=1]="Connected",t[t.Disconnected=2]="Disconnected",t[t.Reconnecting=3]="Reconnecting",t[t.Closed=4]="Closed"})(wt||(wt={}));class t1 extends cn.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var n;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=qh.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=wt.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=H,this.reliableDataSequence=1,this.reliableMessageBuffer=new Pm,this.reliableReceivedState=new T_(X_),this.lossyDataStatCurrentBytes=0,this.lossyDataStatByterate=0,this.lossyDataDropCount=0,this.midToTrackId={},this.isWaitingForNetworkReconnect=!1,this.handleDataChannel=i=>C(this,[i],void 0,function(r){var s=this;let{channel:o}=r;return function*(){if(o){if(o.label===Vm)s.reliableDCSub=o;else if(o.label===jm)s.lossyDCSub=o;else return;s.log.debug("on data channel ".concat(o.id,", ").concat(o.label),s.logContext),o.onmessage=s.handleDataMessage}}()}),this.handleDataMessage=i=>C(this,void 0,void 0,function*(){var r,s,o,a,l;const c=yield this.dataProcessLock.lock();try{let u;if(i.data instanceof ArrayBuffer)u=i.data;else if(i.data instanceof Blob)u=yield i.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:i.data}));return}const d=Ze.fromBinary(new Uint8Array(u));if(d.sequence>0&&d.participantSid!==""){const h=this.reliableReceivedState.get(d.participantSid);if(h&&d.sequence<=h)return;this.reliableReceivedState.set(d.participantSid,d.sequence)}if(((r=d.value)===null||r===void 0?void 0:r.case)==="speaker")this.emit(N.ActiveSpeakersUpdate,d.value.value.speakers);else if(((s=d.value)===null||s===void 0?void 0:s.case)==="encryptedPacket"){if(!this.e2eeManager){this.log.error("Received encrypted packet but E2EE not set up",this.logContext);return}const h=yield(o=this.e2eeManager)===null||o===void 0?void 0:o.handleEncryptedData(d.value.value.encryptedValue,d.value.value.iv,d.participantIdentity,d.value.value.keyIndex),f=z0.fromBinary(h.payload),v=new Ze({value:f.value,participantIdentity:d.participantIdentity,participantSid:d.participantSid});((a=v.value)===null||a===void 0?void 0:a.case)==="user"&&Bm(v,v.value.value),this.emit(N.DataPacketReceived,v,d.value.value.encryptionType)}else((l=d.value)===null||l===void 0?void 0:l.case)==="user"&&Bm(d,d.value.value),this.emit(N.DataPacketReceived,d,Ae.NONE)}finally{c()}}),this.handleDataError=i=>{const s=i.currentTarget.maxRetransmits===0?"lossy":"reliable";if(i instanceof ErrorEvent&&i.error){const{error:o}=i.error;this.log.error("DataChannel error on ".concat(s,": ").concat(i.message),Object.assign(Object.assign({},this.logContext),{error:o}))}else this.log.error("Unknown DataChannel error on ".concat(s),Object.assign(Object.assign({},this.logContext),{event:i}))},this.handleBufferedAmountLow=i=>{const s=i.currentTarget.maxRetransmits===0?G.LOSSY:G.RELIABLE;this.updateAndEmitDCBufferStatus(s)},this.handleDisconnect=(i,r)=>{if(this._isClosed)return;this.log.warn("".concat(i," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const s=l=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(l,"ms. giving up"),this.logContext),this.emit(N.Disconnected),this.close()},o=Date.now()-this.reconnectStart;let a=this.getNextRetryDelay({elapsedMs:o,retryCount:this.reconnectAttempts});if(a===null){s(o);return}i===Rc&&(a=0),this.log.debug("reconnecting in ".concat(a,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=Be.setTimeout(()=>this.attemptReconnect(r).finally(()=>this.reconnectTimeout=void 0),a)},this.waitForRestarted=()=>new Promise((i,r)=>{this.pcState===wt.Connected&&i();const s=()=>{this.off(N.Disconnected,o),i()},o=()=>{this.off(N.Restarted,s),r()};this.once(N.Restarted,s),this.once(N.Disconnected,o)}),this.updateAndEmitDCBufferStatus=i=>{if(i===G.RELIABLE){const s=this.dataChannelForKind(i);s&&this.reliableMessageBuffer.alignBufferedAmount(s.bufferedAmount)}const r=this.isBufferStatusLow(i);typeof r<"u"&&r!==this.dcBufferStatus.get(i)&&(this.dcBufferStatus.set(i,r),this.emit(N.DCBufferStatusChanged,r,i))},this.isBufferStatusLow=i=>{const r=this.dataChannelForKind(i);if(r)return r.bufferedAmount<=r.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>C(this,void 0,void 0,function*(){!this.url||!(yield fetch(ro(this.url),{method:"HEAD"}).then(r=>r.ok).catch(()=>!1))||(this.log.info("detected network reconnected"),(this.client.currentState===se.RECONNECTING||this.isWaitingForNetworkReconnect&&this.client.currentState===se.CONNECTED)&&(this.clearReconnectTimeout(),this.attemptReconnect(Si.RR_SIGNAL_DISCONNECTED),this.isWaitingForNetworkReconnect=!1))}),this.handleBrowserOffline=()=>C(this,void 0,void 0,function*(){if(this.url)try{yield Promise.race([fetch(ro(this.url),{method:"HEAD"}),ze(4e3).then(()=>Promise.reject())])}catch{window.navigator.onLine===!1&&(this.log.info("detected network interruption"),this.isWaitingForNetworkReconnect=!0)}}),this.log=Dn((n=e.loggerName)!==null&&n!==void 0?n:Jt.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new Vh(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.closingLock=new tt,this.dataProcessLock=new tt,this.dcBufferStatus=new Map([[G.LOSSY,!0],[G.RELIABLE,!0]]),this.client.onParticipantUpdate=i=>this.emit(N.ParticipantUpdate,i),this.client.onConnectionQuality=i=>this.emit(N.ConnectionQualityUpdate,i),this.client.onRoomUpdate=i=>this.emit(N.RoomUpdate,i),this.client.onSubscriptionError=i=>this.emit(N.SubscriptionError,i),this.client.onSubscriptionPermissionUpdate=i=>this.emit(N.SubscriptionPermissionUpdate,i),this.client.onSpeakersChanged=i=>this.emit(N.SpeakersChanged,i),this.client.onStreamStateUpdate=i=>this.emit(N.StreamStateChanged,i),this.client.onRequestResponse=i=>this.emit(N.SignalRequestResponse,i)}get logContext(){var e,n,i,r,s,o;return{room:(n=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||n===void 0?void 0:n.name,roomID:(r=(i=this.latestJoinResponse)===null||i===void 0?void 0:i.room)===null||r===void 0?void 0:r.sid,participant:(o=(s=this.latestJoinResponse)===null||s===void 0?void 0:s.participant)===null||o===void 0?void 0:o.identity,pID:this.participantSid}}join(e,n,i,r){return C(this,arguments,void 0,function(s,o,a,l){var c=this;let u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return function*(){c.url=s,c.token=o,c.signalOpts=a,c.maxJoinAttempts=a.maxRetries;try{c.joinAttempts+=1,c.setupSignalClientCallbacks();const d=yield c.client.join(s,o,a,l,u);return c._isClosed=!1,c.latestJoinResponse=d,c.subscriberPrimary=d.subscriberPrimary,c.pcManager||(yield c.configure(d,!u)),(!c.subscriberPrimary||d.fastPublish)&&c.negotiate().catch(h=>{H.error(h,c.logContext)}),c.registerOnLineListener(),c.clientConfiguration=d.clientConfiguration,c.emit(N.SignalConnected,d),d}catch(d){if(d instanceof B){if(d.reason===oe.ServerUnreachable){if(c.log.warn("Couldn't connect to server, attempt ".concat(c.joinAttempts," of ").concat(c.maxJoinAttempts),c.logContext),c.joinAttempts<c.maxJoinAttempts)return c.join(s,o,a,l,u)}else if(d.reason===oe.ServiceNotFound)return c.log.warn("Initial connection failed: ".concat(d.message,"  Retrying")),c.join(s,o,a,l,!0)}throw d}}()})}close(){return C(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(N.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),this.cleanupLossyDataStats(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return C(this,void 0,void 0,function*(){var e;yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const n=i=>{i&&(i.close(),i.onbufferedamountlow=null,i.onclose=null,i.onclosing=null,i.onerror=null,i.onmessage=null,i.onopen=null)};n(this.lossyDC),n(this.lossyDCSub),n(this.reliableDC),n(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new Pm,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupLossyDataStats(){this.lossyDataStatByterate=0,this.lossyDataStatCurrentBytes=0,this.lossyDataStatInterval&&(clearInterval(this.lossyDataStatInterval),this.lossyDataStatInterval=void 0),this.lossyDataDropCount=0}cleanupClient(){return C(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new Sn("a track with the same ID has already been published");return new Promise((n,i)=>{const r=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],i(B.timeout("publication of local track timed out, no response from server"))},1e4);this.pendingTrackResolvers[e.cid]={resolve:s=>{clearTimeout(r),n(s)},reject:()=>{clearTimeout(r),i(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:n}=this.pendingTrackResolvers[e.track.id];n&&n(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(n){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:n}))}return!1}updateMuteStatus(e,n){this.client.sendMuteTrack(e,n)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return C(this,void 0,void 0,function*(){var e;return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e,n){return C(this,void 0,void 0,function*(){var i,r;if(this.pcManager&&this.pcManager.currentState!==ke.NEW)return;this.participantSid=(i=e.participant)===null||i===void 0?void 0:i.sid;const s=this.makeRTCConfiguration(e);this.pcManager=new I_(s,n?"publisher-only":e.subscriberPrimary?"subscriber-primary":"publisher-primary",this.loggerOptions),this.emit(N.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(o,a)=>{this.client.sendIceCandidate(o,a)},this.pcManager.onPublisherOffer=(o,a)=>{this.client.sendOffer(o,a)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(o,a,l)=>C(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(o),this.logContext),["closed","disconnected","failed"].includes(a)&&(this.publisherConnectionPromise=void 0),o===ke.CONNECTED){const d=this.pcState===wt.New;this.pcState=wt.Connected,d&&this.emit(N.Connected,e)}else o===ke.FAILED&&(this.pcState===wt.Connected||this.pcState===wt.Reconnecting)&&(this.pcState=wt.Disconnected,this.handleDisconnect("peerconnection failed",l==="failed"?Si.RR_SUBSCRIBER_FAILED:Si.RR_PUBLISHER_FAILED));const c=this.client.isDisconnected||this.client.currentState===se.RECONNECTING,u=[ke.FAILED,ke.CLOSING,ke.CLOSED].includes(o);c&&u&&!this._isClosed&&this.emit(N.Offline)}),this.pcManager.onTrack=o=>{o.streams.length!==0&&this.emit(N.MediaTrackAdded,o.track,o.streams[0],o.receiver)},n1((r=e.serverInfo)===null||r===void 0?void 0:r.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(e,n,i)=>C(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,midToTrackId:i})),this.midToTrackId=i,yield this.pcManager.setPublisherAnswer(e,n))}),this.client.onTrickle=(e,n)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:n})),this.pcManager.addIceCandidate(e,n))},this.client.onOffer=(e,n,i)=>C(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=n,!this.pcManager)return;this.midToTrackId=i;const r=yield this.pcManager.createSubscriberAnswerFromOffer(e,n);r&&this.client.sendAnswer(r,n)}),this.client.onLocalTrackPublished=e=>{var n;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(n=e.track)===null||n===void 0?void 0:n.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:i}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],i(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(N.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(N.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{var n;this.token=e,(n=this.regionUrlProvider)===null||n===void 0||n.updateToken(e)},this.client.onRemoteMuteChanged=(e,n)=>{this.emit(N.RemoteMute,e,n)},this.client.onSubscribedQualityUpdate=e=>{this.emit(N.SubscribedQualityUpdate,e)},this.client.onRoomMoved=e=>{var n;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=e.room),this.emit(N.RoomMoved,e)},this.client.onMediaSectionsRequirement=e=>{var n,i;const r={direction:"recvonly"};for(let s=0;s<e.numAudios;s++)(n=this.pcManager)===null||n===void 0||n.addPublisherTransceiverOfKind("audio",r);for(let s=0;s<e.numVideos;s++)(i=this.pcManager)===null||i===void 0||i.addPublisherTransceiverOfKind("video",r);this.negotiate()},this.client.onClose=()=>{this.handleDisconnect("signal",Si.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e==null?void 0:e.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions({updatedAtInMs:Date.now(),maxAgeInMs:Zk,regionSettings:e.regions})),e.action){case Sr.DISCONNECT:this.emit(N.Disconnected,e==null?void 0:e.reason),this.close();break;case Sr.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(Rc);break;case Sr.RESUME:this.handleDisconnect(Rc)}}}makeRTCConfiguration(e){var n;const i=Object.assign({},this.rtcConfig);if(!((n=this.signalOpts)===null||n===void 0)&&n.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),i.encodedInsertableStreams=!0),e.iceServers&&!i.iceServers){const r=[];e.iceServers.forEach(s=>{const o={urls:s.urls};s.username&&(o.username=s.username),s.credential&&(o.credential=s.credential),r.push(o)}),i.iceServers=r}return e.clientConfiguration&&e.clientConfiguration.forceRelay===Zs.ENABLED&&(i.iceTransportPolicy="relay"),i.sdpSemantics="unified-plan",i.continualGatheringPolicy="gather_continually",i}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(jm,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(Vm,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow,this.cleanupLossyDataStats(),this.lossyDataStatInterval=setInterval(()=>{this.lossyDataStatByterate=this.lossyDataStatCurrentBytes,this.lossyDataStatCurrentBytes=0;const e=this.dataChannelForKind(G.LOSSY);if(e){const n=this.lossyDataStatByterate/10;e.bufferedAmountLowThreshold=Math.min(Math.max(n,Z_),e1)}},1e3))}createSender(e,n,i){return C(this,void 0,void 0,function*(){if(Xu())return yield this.createTransceiverRTCRtpSender(e,n,i);if(Zu())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new Pe("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,n,i,r){return C(this,void 0,void 0,function*(){if(Xu())return this.createSimulcastTransceiverSender(e,n,i,r);if(Zu())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new Pe("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,n,i){return C(this,void 0,void 0,function*(){if(!this.pcManager)throw new Pe("publisher is closed");const r=[];e.mediaStream&&r.push(e.mediaStream),pi(e)&&(e.codec=n.videoCodec);const s={direction:"sendonly",streams:r};return i&&(s.sendEncodings=i),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,s)).sender})}createSimulcastTransceiverSender(e,n,i,r){return C(this,void 0,void 0,function*(){if(!this.pcManager)throw new Pe("publisher is closed");const s={direction:"sendonly"};r&&(s.sendEncodings=r);const o=yield this.pcManager.addPublisherTransceiver(n.mediaStreamTrack,s);if(i.videoCodec)return e.setSimulcastTrackSender(i.videoCodec,o.sender),o.sender})}createRTCRtpSender(e){return C(this,void 0,void 0,function*(){if(!this.pcManager)throw new Pe("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return C(this,void 0,void 0,function*(){var n,i,r;if(!this._isClosed){if(this.attemptingReconnect){H.warn("already attempting reconnect, returning early",this.logContext);return}(((n=this.clientConfiguration)===null||n===void 0?void 0:n.resumeConnection)===Zs.DISABLED||((r=(i=this.pcManager)===null||i===void 0?void 0:i.currentState)!==null&&r!==void 0?r:ke.NEW)===ke.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(s){this.reconnectAttempts+=1;let o=!0;s instanceof Pe?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:s})),o=!1):s instanceof Hi||(this.fullReconnectOnNext=!0),o?this.handleDisconnect("reconnect",Si.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(N.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(n){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:n}))}return null}restartConnection(e){return C(this,void 0,void 0,function*(){var n,i,r;try{if(!this.url||!this.token)throw new Pe("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(N.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let s;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new Hi;s=yield this.join(e??this.url,this.token,this.signalOpts,void 0,!this.options.singlePeerConnection)}catch(o){throw o instanceof B&&o.reason===oe.NotAllowed?new Pe("could not reconnect, token might be expired"):new Hi}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(N.SignalRestarted,s),yield this.waitForPCReconnected(),this.client.currentState!==se.CONNECTED)throw new Hi("Signal connection got severed during reconnect");(n=this.regionUrlProvider)===null||n===void 0||n.resetAttempts(),this.emit(N.Restarted)}catch(s){const o=yield(i=this.regionUrlProvider)===null||i===void 0?void 0:i.getNextBestRegionUrl();if(o){yield this.restartConnection(o);return}else throw(r=this.regionUrlProvider)===null||r===void 0||r.resetAttempts(),s}})}resumeConnection(e){return C(this,void 0,void 0,function*(){var n;if(!this.url||!this.token)throw new Pe("could not reconnect, url or token not saved");if(!this.pcManager)throw new Pe("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(N.Resuming);let i;try{this.setupSignalClientCallbacks(),i=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(r){let s="";throw r instanceof Error&&(s=r.message,this.log.error(r.message,Object.assign(Object.assign({},this.logContext),{error:r}))),r instanceof B&&r.reason===oe.NotAllowed?new Pe("could not reconnect, token might be expired"):r instanceof B&&r.reason===oe.LeaveRequest?r:new Hi(s)}if(this.emit(N.SignalResumed),i){const r=this.makeRTCConfiguration(i);this.pcManager.updateConfiguration(r),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=i.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==se.CONNECTED)throw new Hi("Signal connection got severed during reconnect");this.client.setReconnected(),((n=this.reliableDC)===null||n===void 0?void 0:n.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),i!=null&&i.lastMessageSeq&&this.resendReliableMessagesForResume(i.lastMessageSeq),this.emit(N.Resumed)})}waitForPCInitialConnection(e,n){return C(this,void 0,void 0,function*(){if(!this.pcManager)throw new Pe("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(n,e)})}waitForPCReconnected(){return C(this,void 0,void 0,function*(){this.pcState=wt.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield ze(Y_),!this.pcManager)throw new Pe("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=wt.Connected}catch(e){throw this.pcState=wt.Disconnected,B.internal("could not establish PC connection, ".concat(e.message))}})}publishRpcResponse(e,n,i,r){return C(this,void 0,void 0,function*(){const s=new Ze({destinationIdentities:[e],kind:G.RELIABLE,value:{case:"rpcResponse",value:new Rh({requestId:n,value:r?{case:"error",value:r.toProto()}:{case:"payload",value:i??""}})}});yield this.sendDataPacket(s,G.RELIABLE)})}publishRpcAck(e,n){return C(this,void 0,void 0,function*(){const i=new Ze({destinationIdentities:[e],kind:G.RELIABLE,value:{case:"rpcAck",value:new _h({requestId:n})}});yield this.sendDataPacket(i,G.RELIABLE)})}sendDataPacket(e,n){return C(this,void 0,void 0,function*(){if(yield this.ensurePublisherConnected(n),this.e2eeManager&&this.e2eeManager.isDataChannelEncryptionEnabled){const s=u_(e);if(s){const o=yield this.e2eeManager.encryptData(s.toBinary());e.value={case:"encryptedPacket",value:new B0({encryptedValue:o.payload,iv:o.iv,keyIndex:o.keyIndex})}}}n===G.RELIABLE&&(e.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const i=e.toBinary(),r=this.dataChannelForKind(n);if(r){if(n===G.RELIABLE)yield this.waitForBufferStatusLow(n),this.reliableMessageBuffer.push({data:i,sequence:e.sequence});else{if(!this.isBufferStatusLow(n)){this.lossyDataDropCount+=1,this.lossyDataDropCount%100===0&&this.log.warn("dropping lossy data channel messages, total dropped: ".concat(this.lossyDataDropCount),this.logContext);return}this.lossyDataStatCurrentBytes+=i.byteLength}if(this.attemptingReconnect)return;r.send(i)}this.updateAndEmitDCBufferStatus(n)})}resendReliableMessagesForResume(e){return C(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(G.RELIABLE);const n=this.dataChannelForKind(G.RELIABLE);n&&(this.reliableMessageBuffer.popToSequence(e),this.reliableMessageBuffer.getAll().forEach(i=>{n.send(i.data)})),this.updateAndEmitDCBufferStatus(G.RELIABLE)})}waitForBufferStatusLow(e){return new lt((n,i)=>C(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))n();else{const r=()=>i(new Pe("engine closed"));for(this.once(N.Closing,r);!this.dcBufferStatus.get(e);)yield ze(10);this.off(N.Closing,r),n()}}))}ensureDataTransportConnected(e){return C(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return function*(){var s;if(!i.pcManager)throw new Pe("PC manager is closed");const o=r?i.pcManager.subscriber:i.pcManager.publisher,a=r?"Subscriber":"Publisher";if(!o)throw B.internal("".concat(a," connection not set"));let l=!1;!r&&!i.dataChannelForKind(n,r)&&(i.createDataChannels(),l=!0),!l&&!r&&!i.pcManager.publisher.isICEConnected&&i.pcManager.publisher.getICEConnectionState()!=="checking"&&(l=!0),l&&i.negotiate().catch(d=>{H.error(d,i.logContext)});const c=i.dataChannelForKind(n,r);if((c==null?void 0:c.readyState)==="open")return;const u=new Date().getTime()+i.peerConnectionTimeout;for(;new Date().getTime()<u;){if(o.isICEConnected&&((s=i.dataChannelForKind(n,r))===null||s===void 0?void 0:s.readyState)==="open")return;yield ze(50)}throw B.internal("could not establish ".concat(a," connection, state: ").concat(o.getICEConnectionState()))}()})}ensurePublisherConnected(e){return C(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==ke.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return C(this,void 0,void 0,function*(){return new lt((e,n)=>C(this,void 0,void 0,function*(){if(!this.pcManager){n(new Cr("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const i=new AbortController,r=()=>{i.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&n(new Cr("cannot negotiate on closed engine")),this.on(N.Closing,r),this.pcManager.publisher.once(Pr.RTPVideoPayloadTypes,s=>{const o=new Map;s.forEach(a=>{const l=a.codec.toLowerCase();GP(l)&&o.set(a.payload,l)}),this.emit(N.RTPVideoMapUpdate,o)});try{yield this.pcManager.negotiate(i),e()}catch(s){s instanceof Cr&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",Si.RR_UNKNOWN),s instanceof Error?n(s):n(new Error(String(s)))}finally{this.off(N.Closing,r)}}))})}dataChannelForKind(e,n){if(n){if(e===G.LOSSY)return this.lossyDCSub;if(e===G.RELIABLE)return this.reliableDCSub}else{if(e===G.LOSSY)return this.lossyDC;if(e===G.RELIABLE)return this.reliableDC}}sendSyncState(e,n){var i,r,s,o;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const a=this.pcManager.publisher.getLocalDescription(),l=this.pcManager.publisher.getRemoteDescription(),c=(i=this.pcManager.subscriber)===null||i===void 0?void 0:i.getRemoteDescription(),u=(r=this.pcManager.subscriber)===null||r===void 0?void 0:r.getLocalDescription(),d=(o=(s=this.signalOpts)===null||s===void 0?void 0:s.autoSubscribe)!==null&&o!==void 0?o:!0,h=new Array,f=new Array;e.forEach(v=>{v.isDesired!==d&&h.push(v.trackSid),v.isEnabled||f.push(v.trackSid)}),this.client.sendSyncState(new Ah({answer:this.pcManager.mode==="publisher-only"?l?ar({sdp:l.sdp,type:l.type}):void 0:u?ar({sdp:u.sdp,type:u.type}):void 0,offer:this.pcManager.mode==="publisher-only"?a?ar({sdp:a.sdp,type:a.type}):void 0:c?ar({sdp:c.sdp,type:c.type}):void 0,subscription:new xl({trackSids:h,subscribe:!d,participantTracks:[]}),publishTracks:IP(n),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:f,datachannelReceiveStates:this.reliableReceivedState.map((v,g)=>new ak({publisherSid:g,lastSeq:v}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],n=(i,r)=>{(i==null?void 0:i.id)!==void 0&&i.id!==null&&e.push(new lk({label:i.label,id:i.id,target:r}))};return n(this.dataChannelForKind(G.LOSSY),Wt.PUBLISHER),n(this.dataChannelForKind(G.RELIABLE),Wt.PUBLISHER),n(this.dataChannelForKind(G.LOSSY,!0),Wt.SUBSCRIBER),n(this.dataChannelForKind(G.RELIABLE,!0),Wt.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&Be.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){ct()&&(window.addEventListener("online",this.handleBrowserOnLine),window.addEventListener("offline",this.handleBrowserOffline))}deregisterOnLineListener(){ct()&&(window.removeEventListener("online",this.handleBrowserOnLine),window.removeEventListener("offline",this.handleBrowserOffline))}getTrackIdForReceiver(e){var n;const i=(n=this.pcManager)===null||n===void 0?void 0:n.getMidForReceiver(e);if(i){const r=Object.entries(this.midToTrackId).find(s=>{let[o]=s;return o===i});if(r)return r[1]}}}function n1(t){return t!==void 0&&t>13}function Bm(t,e){const n=t.participantIdentity?t.participantIdentity:e.participantIdentity;t.participantIdentity=n,e.participantIdentity=n;const i=t.destinationIdentities.length!==0?t.destinationIdentities:e.destinationIdentities;t.destinationIdentities=i,e.destinationIdentities=i}class rS{get info(){return this._info}validateBytesReceived(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!(typeof this.totalByteSize!="number"||this.totalByteSize===0)){if(e&&this.bytesReceived<this.totalByteSize)throw new Pt("Not enough chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, only received ").concat(this.bytesReceived," bytes"),Xe.Incomplete);if(this.bytesReceived>this.totalByteSize)throw new Pt("Extra chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, received ").concat(this.bytesReceived," bytes"),Xe.LengthExceeded)}}constructor(e,n,i,r){this.reader=n,this.totalByteSize=i,this._info=e,this.bytesReceived=0,this.outOfBandFailureRejectingFuture=r}}class i1 extends rS{handleChunkReceived(e){var n;this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const i=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,i)}[Symbol.asyncIterator](){const e=this.reader.getReader();let n=new It,i=null,r=null;if(this.signal){const o=this.signal;r=()=>{var a;(a=n.reject)===null||a===void 0||a.call(n,o.reason)},o.addEventListener("abort",r),i=o}const s=()=>{e.releaseLock(),i&&r&&i.removeEventListener("abort",r),this.signal=void 0};return{next:()=>C(this,void 0,void 0,function*(){var o,a;try{const{done:l,value:c}=yield Promise.race([e.read(),n.promise,(a=(o=this.outOfBandFailureRejectingFuture)===null||o===void 0?void 0:o.promise)!==null&&a!==void 0?a:new Promise(()=>{})]);return l?(this.validateBytesReceived(!0),{done:!0,value:void 0}):(this.handleChunkReceived(c),{done:!1,value:c.content})}catch(l){throw s(),l}}),return(){return C(this,void 0,void 0,function*(){return s(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return C(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function*(){var i,r,s,o;let a=new Set;const l=n.signal?e.withAbortSignal(n.signal):e;try{for(var c=!0,u=kn(l),d;d=yield u.next(),i=d.done,!i;c=!0){o=d.value,c=!1;const h=o;a.add(h)}}catch(h){r={error:h}}finally{try{!c&&!i&&(s=u.return)&&(yield s.call(u))}finally{if(r)throw r.error}}return Array.from(a)}()})}}class r1 extends rS{constructor(e,n,i,r){super(e,n,i,r),this.receivedChunks=new Map}handleChunkReceived(e){var n;const i=ma(e.chunkIndex),r=this.receivedChunks.get(i);if(r&&r.version>e.version)return;this.receivedChunks.set(i,e),this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const s=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,s)}[Symbol.asyncIterator](){const e=this.reader.getReader(),n=new TextDecoder("utf-8",{fatal:!0});let i=new It,r=null,s=null;if(this.signal){const a=this.signal;s=()=>{var l;(l=i.reject)===null||l===void 0||l.call(i,a.reason)},a.addEventListener("abort",s),r=a}const o=()=>{e.releaseLock(),r&&s&&r.removeEventListener("abort",s),this.signal=void 0};return{next:()=>C(this,void 0,void 0,function*(){var a,l;try{const{done:c,value:u}=yield Promise.race([e.read(),i.promise,(l=(a=this.outOfBandFailureRejectingFuture)===null||a===void 0?void 0:a.promise)!==null&&l!==void 0?l:new Promise(()=>{})]);if(c)return this.validateBytesReceived(!0),{done:!0,value:void 0};{this.handleChunkReceived(u);let d;try{d=n.decode(u.content)}catch(h){throw new Pt("Cannot decode datastream chunk ".concat(u.chunkIndex," as text: ").concat(h),Xe.DecodeFailed)}return{done:!1,value:d}}}catch(c){throw o(),c}}),return(){return C(this,void 0,void 0,function*(){return o(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return C(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function*(){var i,r,s,o;let a="";const l=n.signal?e.withAbortSignal(n.signal):e;try{for(var c=!0,u=kn(l),d;d=yield u.next(),i=d.done,!i;c=!0)o=d.value,c=!1,a+=o}catch(h){r={error:h}}finally{try{!c&&!i&&(s=u.return)&&(yield s.call(u))}finally{if(r)throw r.error}}return a}()})}}class s1{constructor(){this.log=H,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map}registerTextStreamHandler(e,n){if(this.textStreamHandlers.has(e))throw new Pt('A text stream handler for topic "'.concat(e,'" has already been set.'),Xe.HandlerAlreadyRegistered);this.textStreamHandlers.set(e,n)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,n){if(this.byteStreamHandlers.has(e))throw new Pt('A byte stream handler for topic "'.concat(e,'" has already been set.'),Xe.HandlerAlreadyRegistered);this.byteStreamHandlers.set(e,n)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}clearControllers(){this.byteStreamControllers.clear(),this.textStreamControllers.clear()}validateParticipantHasNoActiveDataStreams(e){var n,i,r,s;const o=Array.from(this.textStreamControllers.entries()).filter(l=>l[1].sendingParticipantIdentity===e),a=Array.from(this.byteStreamControllers.entries()).filter(l=>l[1].sendingParticipantIdentity===e);if(o.length>0||a.length>0){const l=new Pt("Participant ".concat(e," unexpectedly disconnected in the middle of sending data"),Xe.AbnormalEnd);for(const[c,u]of a)(i=(n=u.outOfBandFailureRejectingFuture).reject)===null||i===void 0||i.call(n,l),this.byteStreamControllers.delete(c);for(const[c,u]of o)(s=(r=u.outOfBandFailureRejectingFuture).reject)===null||s===void 0||s.call(r,l),this.textStreamControllers.delete(c)}}handleDataStreamPacket(e,n){return C(this,void 0,void 0,function*(){switch(e.value.case){case"streamHeader":return this.handleStreamHeader(e.value.value,e.participantIdentity,n);case"streamChunk":return this.handleStreamChunk(e.value.value,n);case"streamTrailer":return this.handleStreamTrailer(e.value.value,n);default:throw new Error('DataPacket of value "'.concat(e.value.case,'" is not data stream related!'))}})}handleStreamHeader(e,n,i){return C(this,void 0,void 0,function*(){var r;if(e.contentHeader.case==="byteHeader"){const s=this.byteStreamHandlers.get(e.topic);if(!s){this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);return}let o;const a=new It;a.promise.catch(u=>{this.log.error(u)});const l={id:e.streamId,name:(r=e.contentHeader.value.name)!==null&&r!==void 0?r:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:ma(e.timestamp),attributes:e.attributes,encryptionType:i},c=new ReadableStream({start:u=>{if(o=u,this.textStreamControllers.has(e.streamId))throw new Pt("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),Xe.AlreadyOpened);this.byteStreamControllers.set(e.streamId,{info:l,controller:o,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:a})}});s(new i1(l,c,ma(e.totalLength),a),{identity:n})}else if(e.contentHeader.case==="textHeader"){const s=this.textStreamHandlers.get(e.topic);if(!s){this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);return}let o;const a=new It;a.promise.catch(u=>{this.log.error(u)});const l={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes,encryptionType:i},c=new ReadableStream({start:u=>{if(o=u,this.textStreamControllers.has(e.streamId))throw new Pt("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),Xe.AlreadyOpened);this.textStreamControllers.set(e.streamId,{info:l,controller:o,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:a})}});s(new r1(l,c,ma(e.totalLength),a),{identity:n})}})}handleStreamChunk(e,n){const i=this.byteStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==n?(i.controller.error(new Pt("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(i.info.encryptionType),Xe.EncryptionTypeMismatch)),this.byteStreamControllers.delete(e.streamId)):e.content.length>0&&i.controller.enqueue(e));const r=this.textStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==n?(r.controller.error(new Pt("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(r.info.encryptionType),Xe.EncryptionTypeMismatch)),this.textStreamControllers.delete(e.streamId)):e.content.length>0&&r.controller.enqueue(e))}handleStreamTrailer(e,n){const i=this.textStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==n?i.controller.error(new Pt("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(i.info.encryptionType),Xe.EncryptionTypeMismatch)):(i.info.attributes=Object.assign(Object.assign({},i.info.attributes),e.attributes),i.controller.close(),this.textStreamControllers.delete(e.streamId)));const r=this.byteStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==n?r.controller.error(new Pt("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(r.info.encryptionType),Xe.EncryptionTypeMismatch)):(r.info.attributes=Object.assign(Object.assign({},r.info.attributes),e.attributes),r.controller.close()),this.byteStreamControllers.delete(e.streamId))}}class sS{constructor(e,n,i){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=i,this.info=n}write(e){return this.defaultWriter.write(e)}close(){return C(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(e=this.onClose)===null||e===void 0||e.call(this)})}}class o1 extends sS{}class a1 extends sS{}const zm=15e3;class l1{constructor(e,n){this.engine=e,this.log=n}setupEngine(e){this.engine=e}sendText(e,n){return C(this,void 0,void 0,function*(){var i;const r=crypto.randomUUID(),o=new TextEncoder().encode(e).byteLength,a=(i=n==null?void 0:n.attachments)===null||i===void 0?void 0:i.map(()=>crypto.randomUUID()),l=new Array(a?a.length+1:1).fill(0),c=(d,h)=>{var f;l[h]=d;const v=l.reduce((g,y)=>g+y,0);(f=n==null?void 0:n.onProgress)===null||f===void 0||f.call(n,v)},u=yield this.streamText({streamId:r,totalSize:o,destinationIdentities:n==null?void 0:n.destinationIdentities,topic:n==null?void 0:n.topic,attachedStreamIds:a,attributes:n==null?void 0:n.attributes});return yield u.write(e),c(1,0),yield u.close(),n!=null&&n.attachments&&a&&(yield Promise.all(n.attachments.map((d,h)=>C(this,void 0,void 0,function*(){return this._sendFile(a[h],d,{topic:n.topic,mimeType:d.type,onProgress:f=>{c(f,h+1)}})})))),u.info})}streamText(e){return C(this,void 0,void 0,function*(){var n,i,r;const s=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),o={id:s,mimeType:"text/plain",timestamp:Date.now(),topic:(i=e==null?void 0:e.topic)!==null&&i!==void 0?i:"",size:e==null?void 0:e.totalSize,attributes:e==null?void 0:e.attributes,encryptionType:!((r=this.engine.e2eeManager)===null||r===void 0)&&r.isDataChannelEncryptionEnabled?Ae.GCM:Ae.NONE},a=new Ga({streamId:s,mimeType:o.mimeType,topic:o.topic,timestamp:Ti(o.timestamp),totalLength:Ti(e==null?void 0:e.totalSize),attributes:o.attributes,contentHeader:{case:"textHeader",value:new Z0({version:e==null?void 0:e.version,attachedStreamIds:e==null?void 0:e.attachedStreamIds,replyToStreamId:e==null?void 0:e.replyToStreamId,operationType:(e==null?void 0:e.type)==="update"?Uu.UPDATE:Uu.CREATE})}}),l=e==null?void 0:e.destinationIdentities,c=new Ze({destinationIdentities:l,value:{case:"streamHeader",value:a}});yield this.engine.sendDataPacket(c,G.RELIABLE);let u=0;const d=this.engine,h=new WritableStream({write(g){return C(this,void 0,void 0,function*(){for(const y of ZP(g,zm)){const p=new $a({content:y,streamId:s,chunkIndex:Ti(u)}),m=new Ze({destinationIdentities:l,value:{case:"streamChunk",value:p}});yield d.sendDataPacket(m,G.RELIABLE),u+=1}})},close(){return C(this,void 0,void 0,function*(){const g=new Ja({streamId:s}),y=new Ze({destinationIdentities:l,value:{case:"streamTrailer",value:g}});yield d.sendDataPacket(y,G.RELIABLE)})},abort(g){console.log("Sink error:",g)}});let f=()=>C(this,void 0,void 0,function*(){yield v.close()});d.once(N.Closing,f);const v=new o1(h,o,()=>this.engine.off(N.Closing,f));return v})}sendFile(e,n){return C(this,void 0,void 0,function*(){const i=crypto.randomUUID();return yield this._sendFile(i,e,n),{id:i}})}_sendFile(e,n,i){return C(this,void 0,void 0,function*(){var r;const s=yield this.streamBytes({streamId:e,totalSize:n.size,name:n.name,mimeType:(r=i==null?void 0:i.mimeType)!==null&&r!==void 0?r:n.type,topic:i==null?void 0:i.topic,destinationIdentities:i==null?void 0:i.destinationIdentities}),o=n.stream().getReader();for(;;){const{done:a,value:l}=yield o.read();if(a)break;yield s.write(l)}return yield s.close(),s.info})}streamBytes(e){return C(this,void 0,void 0,function*(){var n,i,r,s,o,a;const l=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),c=e==null?void 0:e.destinationIdentities,u={id:l,mimeType:(i=e==null?void 0:e.mimeType)!==null&&i!==void 0?i:"application/octet-stream",topic:(r=e==null?void 0:e.topic)!==null&&r!==void 0?r:"",timestamp:Date.now(),attributes:e==null?void 0:e.attributes,size:e==null?void 0:e.totalSize,name:(s=e==null?void 0:e.name)!==null&&s!==void 0?s:"unknown",encryptionType:!((o=this.engine.e2eeManager)===null||o===void 0)&&o.isDataChannelEncryptionEnabled?Ae.GCM:Ae.NONE},d=new Ga({totalLength:Ti((a=u.size)!==null&&a!==void 0?a:0),mimeType:u.mimeType,streamId:l,topic:u.topic,timestamp:Ti(Date.now()),attributes:u.attributes,contentHeader:{case:"byteHeader",value:new ek({name:u.name})}}),h=new Ze({destinationIdentities:c,value:{case:"streamHeader",value:d}});yield this.engine.sendDataPacket(h,G.RELIABLE);let f=0;const v=new tt,g=this.engine,y=this.log,p=new WritableStream({write(k){return C(this,void 0,void 0,function*(){const S=yield v.lock();let T=0;try{for(;T<k.byteLength;){const b=k.slice(T,T+zm),P=new Ze({destinationIdentities:c,value:{case:"streamChunk",value:new $a({content:b,streamId:l,chunkIndex:Ti(f)})}});yield g.sendDataPacket(P,G.RELIABLE),f+=1,T+=b.byteLength}}finally{S()}})},close(){return C(this,void 0,void 0,function*(){const k=new Ja({streamId:l}),S=new Ze({destinationIdentities:c,value:{case:"streamTrailer",value:k}});yield g.sendDataPacket(S,G.RELIABLE)})},abort(k){y.error("Sink error:",k)}});return new a1(p,u)})}}class oS extends R{constructor(e,n,i,r,s){super(e,i,s),this.sid=n,this.receiver=r}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?O.Muted:O.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const n=i=>{i.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",n),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(O.Ended,this))};e.addEventListener("removetrack",n)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return C(this,void 0,void 0,function*(){var e;return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),Hh)),DP()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var n;this.timeSyncHandle=requestAnimationFrame(()=>e());const i=(n=this.receiver)===null||n===void 0?void 0:n.getSynchronizationSources()[0];if(i){const{timestamp:r,rtpTimestamp:s}=i;s&&this.rtpTimestamp!==s&&(this.emit(O.TimeSyncUpdate,{timestamp:r,rtpTimestamp:s}),this.rtpTimestamp=s)}};e()}}class c1 extends oS{constructor(e,n,i,r,s,o){super(e,n,R.Kind.Audio,i,o),this.monitorReceiver=()=>C(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const a=yield this.getReceiverStats();a&&this.prevStats&&this.receiver&&(this._currentBitrate=Ml(a,this.prevStats)),this.prevStats=a}),this.audioContext=r,this.webAudioPluginNodes=[],s&&(this.sinkId=s.deviceId)}setVolume(e){var n;for(const i of this.attachedElements)this.audioContext?(n=this.gainNode)===null||n===void 0||n.gain.setTargetAtTime(e,0,.1):i.volume=e;an()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(an())return 1;let e=0;return this.attachedElements.forEach(n=>{n.volume>e&&(e=n.volume)}),e}setSinkId(e){return C(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(n=>{if(ed(n))return n.setSinkId(e)}))})}attach(e){const n=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&ed(e)&&e.setSinkId(this.sinkId).catch(i=>{this.log.error("Failed to set sink id on remote audio track",i,this.logContext)}),this.audioContext&&n&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let n;return e?(n=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(n=super.detach(),this.disconnectWebAudio()),n}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,n){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(n.srcObject);let i=this.sourceNode;this.webAudioPluginNodes.forEach(r=>{i.connect(r),i=r}),this.gainNode=e.createGain(),i.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(O.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(r=>{this.emit(O.AudioPlaybackFailed,r)})}disconnectWebAudio(){var e,n;(e=this.gainNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return C(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n;return e.forEach(i=>{i.type==="inbound-rtp"&&(n={type:"audio",streamId:i.id,timestamp:i.timestamp,jitter:i.jitter,bytesReceived:i.bytesReceived,concealedSamples:i.concealedSamples,concealmentEvents:i.concealmentEvents,silentConcealedSamples:i.silentConcealedSamples,silentConcealmentEvents:i.silentConcealmentEvents,totalAudioEnergy:i.totalAudioEnergy,totalSamplesDuration:i.totalSamplesDuration})}),n})}}const xc=100;class u1 extends oS{constructor(e,n,i,r,s){super(e,n,R.Kind.Video,i,s),this.elementInfos=[],this.monitorReceiver=()=>C(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const o=yield this.getReceiverStats();o&&this.prevStats&&this.receiver&&(this._currentBitrate=Ml(o,this.prevStats)),this.prevStats=o}),this.debouncedHandleResize=zh(()=>{this.updateDimensions()},xc),this.adaptiveStreamSettings=r}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}setStreamState(e){super.setStreamState(e),this.log.debug("setStreamState",e),this.isAdaptiveStream&&e===R.StreamState.Active&&this.updateVisibility()}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(n=>{e?br(this._mediaStreamTrack,n):or(this._mediaStreamTrack,n)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(n=>n.element===e)===void 0){const n=new d1(e);this.observeElementInfo(n)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(n=>n===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const n=this.elementInfos.filter(i=>i===e);for(const i of n)i.stopObserving();this.elementInfos=this.elementInfos.filter(i=>i!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let n=[];if(e)return this.stopObservingElement(e),super.detach(e);n=super.detach();for(const i of n)this.stopObservingElement(i);return n}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return C(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n,i="",r=new Map;return e.forEach(s=>{s.type==="inbound-rtp"?(i=s.codecId,n={type:"video",streamId:s.id,framesDecoded:s.framesDecoded,framesDropped:s.framesDropped,framesReceived:s.framesReceived,packetsReceived:s.packetsReceived,packetsLost:s.packetsLost,frameWidth:s.frameWidth,frameHeight:s.frameHeight,pliCount:s.pliCount,firCount:s.firCount,nackCount:s.nackCount,jitter:s.jitter,timestamp:s.timestamp,bytesReceived:s.bytesReceived,decoderImplementation:s.decoderImplementation}):s.type==="codec"&&r.set(s.id,s)}),n&&i!==""&&r.get(i)&&(n.mimeType=r.get(i).mimeType),n})}stopObservingElement(e){const n=this.elementInfos.filter(i=>i.element===e);for(const i of n)this.stopObservingElementInfo(i)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return C(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(e){var n,i;const r=this.elementInfos.reduce((l,c)=>Math.max(l,c.visibilityChangedAt||0),0),s=!((i=(n=this.adaptiveStreamSettings)===null||n===void 0?void 0:n.pauseVideoInBackground)!==null&&i!==void 0)||i?this.isInBackground:!1,o=this.elementInfos.some(l=>l.pictureInPicture),a=this.elementInfos.some(l=>l.visible)&&!s||o;if(!(this.lastVisible===a&&!e)){if(!a&&Date.now()-r<xc){Be.setTimeout(()=>{this.updateVisibility()},xc);return}this.lastVisible=a,this.emit(O.VisibilityChanged,a,this)}}updateDimensions(){var e,n;let i=0,r=0;const s=this.getPixelDensity();for(const o of this.elementInfos){const a=o.width()*s,l=o.height()*s;a+l>i+r&&(i=a,r=l)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===i&&((n=this.lastDimensions)===null||n===void 0?void 0:n.height)===r||(this.lastDimensions={width:i,height:r},this.emit(O.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return n==="screen"?gm():n||(gm()>2?2:1)}}class d1{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,n){this.onVisibilityChanged=i=>{var r;const{target:s,isIntersecting:o}=i;s===this.element&&(this.isIntersecting=o,this.isPiP=os(this.element),this.visibilityChangedAt=Date.now(),(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this))},this.onEnterPiP=()=>{var i,r,s;(r=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||r===void 0||r.addEventListener("pagehide",this.onLeavePiP),this.isPiP=os(this.element),(s=this.handleVisibilityChanged)===null||s===void 0||s.call(this)},this.onLeavePiP=()=>{var i;this.isPiP=os(this.element),(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this)},this.element=e,this.isIntersecting=n??od(e),this.isPiP=ct()&&os(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,n,i;this.isIntersecting=od(this.element),this.isPiP=os(this.element),this.element.handleResize=()=>{var r;(r=this.handleResize)===null||r===void 0||r.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,ym().observe(this.element),vm().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(i=(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window)===null||i===void 0||i.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,n,i,r,s;(e=ym())===null||e===void 0||e.unobserve(this.element),(n=vm())===null||n===void 0||n.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(i=window.documentPictureInPicture)===null||i===void 0||i.removeEventListener("enter",this.onEnterPiP),(s=(r=window.documentPictureInPicture)===null||r===void 0?void 0:r.window)===null||s===void 0||s.removeEventListener("pagehide",this.onLeavePiP)}}function os(t){var e,n;return document.pictureInPictureElement===t?!0:!((e=window.documentPictureInPicture)===null||e===void 0)&&e.window?od(t,(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window):!1}function od(t,e){const n=e||window;let i=t.offsetTop,r=t.offsetLeft;const s=t.offsetWidth,o=t.offsetHeight,{hidden:a}=t,{display:l}=getComputedStyle(t);for(;t.offsetParent;)t=t.offsetParent,i+=t.offsetTop,r+=t.offsetLeft;return i<n.pageYOffset+n.innerHeight&&r<n.pageXOffset+n.innerWidth&&i+o>n.pageYOffset&&r+s>n.pageXOffset&&!a&&l!=="none"}class mn extends cn.EventEmitter{constructor(e,n,i,r){var s;super(),this.metadataMuted=!1,this.encryption=Ae.NONE,this.log=H,this.handleMuted=()=>{this.emit(O.Muted)},this.handleUnmuted=()=>{this.emit(O.Unmuted)},this.log=Dn((s=r==null?void 0:r.loggerName)!==null&&s!==void 0?s:Jt.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=n,this.trackName=i,this.source=R.Source.Unknown}setTrack(e){this.track&&(this.track.off(O.Muted,this.handleMuted),this.track.off(O.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(O.Muted,this.handleMuted),e.on(O.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),$(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==Ae.NONE}get audioTrack(){if(rn(this.track))return this.track}get videoTrack(){if(pi(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=R.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===R.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(t){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(t.SubscriptionStatus||(t.SubscriptionStatus={})),function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"}(t.PermissionStatus||(t.PermissionStatus={}))})(mn||(mn={}));class ad extends mn{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.handleTrackEnded=()=>{this.emit(O.Ended)},this.handleCpuConstrained=()=>{this.track&&pi(this.track)&&this.emit(O.CpuConstrained,this.track)},this.updateInfo(n),this.setTrack(i)}setTrack(e){this.track&&(this.track.off(O.Ended,this.handleTrackEnded),this.track.off(O.CpuConstrained,this.handleCpuConstrained)),super.setTrack(e),e&&(e.on(O.Ended,this.handleTrackEnded),e.on(O.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return C(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){return C(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){return C(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){return C(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(rn(this.track)){const n=this.track.getSourceTrackSettings(),i=new Set;return n.autoGainControl&&i.add(Ne.TF_AUTO_GAIN_CONTROL),n.echoCancellation&&i.add(Ne.TF_ECHO_CANCELLATION),n.noiseSuppression&&i.add(Ne.TF_NOISE_SUPPRESSION),n.channelCount&&n.channelCount>1&&i.add(Ne.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||i.add(Ne.TF_NO_DTX),this.track.enhancedNoiseCancellation&&i.add(Ne.TF_ENHANCED_NOISE_CANCELLATION),Array.from(i.values())}else return[]}}function Al(t,e){return C(this,void 0,void 0,function*(){t??(t={});let n=!1;const{audioProcessor:i,videoProcessor:r,optionsWithoutProcessor:s}=Hk(t);let o=s.audio,a=s.video;if(i&&typeof s.audio=="object"&&(s.audio.processor=i),r&&typeof s.video=="object"&&(s.video.processor=r),t.audio&&typeof s.audio=="object"&&typeof s.audio.deviceId=="string"){const d=s.audio.deviceId;s.audio.deviceId={exact:d},n=!0,o=Object.assign(Object.assign({},s.audio),{deviceId:{ideal:d}})}if(s.video&&typeof s.video=="object"&&typeof s.video.deviceId=="string"){const d=s.video.deviceId;s.video.deviceId={exact:d},n=!0,a=Object.assign(Object.assign({},s.video),{deviceId:{ideal:d}})}s.audio===!0?s.audio={deviceId:"default"}:typeof s.audio=="object"&&s.audio!==null&&(s.audio=Object.assign(Object.assign({},s.audio),{deviceId:s.audio.deviceId||"default"})),s.video===!0?s.video={deviceId:"default"}:typeof s.video=="object"&&!s.video.deviceId&&(s.video.deviceId="default");const l=Wk(s,Yk,Xk),c=Uh(l),u=navigator.mediaDevices.getUserMedia(c);s.audio&&(Fe.userMediaPromiseMap.set("audioinput",u),u.catch(()=>Fe.userMediaPromiseMap.delete("audioinput"))),s.video&&(Fe.userMediaPromiseMap.set("videoinput",u),u.catch(()=>Fe.userMediaPromiseMap.delete("videoinput")));try{const d=yield u;return yield Promise.all(d.getTracks().map(h=>C(this,void 0,void 0,function*(){const f=h.kind==="audio";let v=f?l.audio:l.video;(typeof v=="boolean"||!v)&&(v={});let g;const y=f?c.audio:c.video;typeof y!="boolean"&&(g=y);const p=h.getSettings().deviceId;g!=null&&g.deviceId&&ii(g.deviceId)!==p?g.deviceId=p:g||(g={deviceId:p});const m=j_(h,g,e);return m.kind===R.Kind.Video?m.source=R.Source.Camera:m.kind===R.Kind.Audio&&(m.source=R.Source.Microphone),m.mediaStream=d,rn(m)&&i?yield m.setProcessor(i):pi(m)&&r&&(yield m.setProcessor(r)),m})))}catch(d){if(!n)throw d;return Al(Object.assign(Object.assign({},t),{audio:o,video:a}),e)}})}function h1(t){return C(this,void 0,void 0,function*(){return(yield Al({audio:!1,video:!0}))[0]})}function aS(t){return C(this,void 0,void 0,function*(){return(yield Al({audio:t??!0,video:!1}))[0]})}var qn;(function(t){t.Excellent="excellent",t.Good="good",t.Poor="poor",t.Lost="lost",t.Unknown="unknown"})(qn||(qn={}));function f1(t){switch(t){case hs.EXCELLENT:return qn.Excellent;case hs.GOOD:return qn.Good;case hs.POOR:return qn.Poor;case hs.LOST:return qn.Lost;default:return qn.Unknown}}class lS extends cn.EventEmitter{get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===eo.AGENT}get isActive(){var e;return((e=this.participantInfo)===null||e===void 0?void 0:e.state)===kr.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,n,i,r,s,o){let a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:eo.STANDARD;var l;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=qn.Unknown,this.log=H,this.log=Dn((l=o==null?void 0:o.loggerName)!==null&&l!==void 0?l:Jt.Participant),this.loggerOptions=o,this.setMaxListeners(100),this.sid=e,this.identity=n,this.name=i,this.metadata=r,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=a,this._attributes=s??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,n]of this.trackPublications)if(n.source===e)return n}getTrackPublicationByName(e){for(const[,n]of this.trackPublications)if(n.trackName===e)return n}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new It,this.once(F.Active,()=>{var e,n;(n=(e=this.activeFuture)===null||e===void 0?void 0:e.resolve)===null||n===void 0||n.call(e),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const n=this.getTrackPublication(R.Source.Camera);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const n=this.getTrackPublication(R.Source.Microphone);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(R.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){var n;return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.state===kr.ACTIVE&&((n=this.participantInfo)===null||n===void 0?void 0:n.state)!==kr.ACTIVE&&this.emit(F.Active),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,!0)}_setMetadata(e){const n=this.metadata!==e,i=this.metadata;this.metadata=e,n&&this.emit(F.ParticipantMetadataChanged,i)}_setName(e){const n=this.name!==e;this.name=e,n&&this.emit(F.ParticipantNameChanged,e)}_setAttributes(e){const n=MP(this.attributes,e);this._attributes=e,Object.keys(n).length>0&&this.emit(F.AttributesChanged,n)}setPermissions(e){var n,i,r,s,o,a;const l=this.permissions,c=e.canPublish!==((n=this.permissions)===null||n===void 0?void 0:n.canPublish)||e.canSubscribe!==((i=this.permissions)===null||i===void 0?void 0:i.canSubscribe)||e.canPublishData!==((r=this.permissions)===null||r===void 0?void 0:r.canPublishData)||e.hidden!==((s=this.permissions)===null||s===void 0?void 0:s.hidden)||e.recorder!==((o=this.permissions)===null||o===void 0?void 0:o.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((u,d)=>{var h;return u!==((h=this.permissions)===null||h===void 0?void 0:h.canPublishSources[d])})||e.canSubscribeMetrics!==((a=this.permissions)===null||a===void 0?void 0:a.canSubscribeMetrics);return this.permissions=e,c&&this.emit(F.ParticipantPermissionsChanged,l),c}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(F.IsSpeakingChanged,e))}setConnectionQuality(e){const n=this._connectionQuality;this._connectionQuality=f1(e),n!==this._connectionQuality&&this.emit(F.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,n;this.activeFuture&&((n=(e=this.activeFuture).reject)===null||n===void 0||n.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(n=>rn(n.track)&&n.track.setAudioContext(e))}addTrackPublication(e){e.on(O.Muted,()=>{this.emit(F.TrackMuted,e)}),e.on(O.Unmuted,()=>{this.emit(F.TrackUnmuted,e)});const n=e;switch(n.track&&(n.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case R.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case R.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}function p1(t){var e,n,i;if(!t.participantSid&&!t.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new sk({participantIdentity:(e=t.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(n=t.participantSid)!==null&&n!==void 0?n:"",allTracks:(i=t.allowAll)!==null&&i!==void 0?i:!1,trackSids:t.allowedTrackSids||[]})}class m1 extends lS{constructor(e,n,i,r,s,o){super(e,n,void 0,void 0,void 0,{loggerName:r.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=Ae.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new It)},this.handleReconnected=()=>{var a,l;(l=(a=this.reconnectFuture)===null||a===void 0?void 0:a.resolve)===null||l===void 0||l.call(a),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleClosing=()=>{var a,l,c,u,d,h;this.reconnectFuture&&(this.reconnectFuture.promise.catch(f=>this.log.warn(f.message,this.logContext)),(l=(a=this.reconnectFuture)===null||a===void 0?void 0:a.reject)===null||l===void 0||l.call(a,new Error("Got disconnected during reconnection attempt")),this.reconnectFuture=void 0),this.signalConnectedFuture&&((u=(c=this.signalConnectedFuture).reject)===null||u===void 0||u.call(c,new Error("Got disconnected without signal connected")),this.signalConnectedFuture=void 0),(h=(d=this.activeAgentFuture)===null||d===void 0?void 0:d.reject)===null||h===void 0||h.call(d,new Error("Got disconnected without active agent present")),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=a=>{var l,c;a.participant&&this.updateInfo(a.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new It),(c=(l=this.signalConnectedFuture).resolve)===null||c===void 0||c.call(l)},this.handleSignalRequestResponse=a=>{const{requestId:l,reason:c,message:u}=a,d=this.pendingSignalRequests.get(l);d&&(c!==Oh.OK&&d.reject(new dm(u,c)),this.pendingSignalRequests.delete(l))},this.handleDataPacket=a=>{switch(a.value.case){case"rpcResponse":let l=a.value.value,c=null,u=null;l.value.case==="payload"?c=l.value.value:l.value.case==="error"&&(u=be.fromProto(l.value.value)),this.handleIncomingRpcResponse(l.requestId,c,u);break;case"rpcAck":let d=a.value.value;this.handleIncomingRpcAck(d.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(a=>p1(a)))},this.onTrackUnmuted=a=>{this.onTrackMuted(a,a.isUpstreamPaused)},this.onTrackMuted=(a,l)=>{if(l===void 0&&(l=!0),!a.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),$(a)));return}this.engine.updateMuteStatus(a.sid,l)},this.onTrackUpstreamPaused=a=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),$(a))),this.onTrackMuted(a,!0)},this.onTrackUpstreamResumed=a=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),$(a))),this.onTrackMuted(a,a.isMuted)},this.onTrackFeatureUpdate=a=>{const l=this.audioTrackPublications.get(a.sid);if(!l){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(a.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(l.trackSid,l.getTrackFeatures())},this.onTrackCpuConstrained=(a,l)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),$(l))),this.emit(F.LocalTrackCpuConstrained,a,l)},this.handleSubscribedQualityUpdate=a=>C(this,void 0,void 0,function*(){var l,c,u,d,h;if(!(!((h=this.roomOptions)===null||h===void 0)&&h.dynacast))return;const f=this.videoTrackPublications.get(a.trackSid);if(!f){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:a.trackSid}));return}if(!f.videoTrack)return;const v=yield f.videoTrack.setPublishingCodecs(a.subscribedCodecs);try{for(var g=!0,y=kn(v),p;p=yield y.next(),l=p.done,!l;g=!0){d=p.value,g=!1;const m=d;_P(m)&&(this.log.debug("publish ".concat(m," for ").concat(f.videoTrack.sid),Object.assign(Object.assign({},this.logContext),$(f))),yield this.publishAdditionalCodecForTrack(f.videoTrack,m,f.options))}}catch(m){c={error:m}}finally{try{!g&&!l&&(u=y.return)&&(yield u.call(y))}finally{if(c)throw c.error}}}),this.handleLocalTrackUnpublished=a=>{const l=this.trackPublications.get(a.trackSid);if(!l){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:a.trackSid}));return}this.unpublishTrack(l.track)},this.handleTrackEnded=a=>C(this,void 0,void 0,function*(){if(a.source===R.Source.ScreenShare||a.source===R.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),$(a))),this.unpublishTrack(a);else if(a.isUserProvided)yield a.mute();else if(hn(a)||Fn(a))try{if(ct())try{const l=yield navigator==null?void 0:navigator.permissions.query({name:a.source===R.Source.Camera?"camera":"microphone"});if(l&&l.state==="denied")throw this.log.warn("user has revoked access to ".concat(a.source),Object.assign(Object.assign({},this.logContext),$(a))),l.onchange=()=>{l.state!=="denied"&&(a.isMuted||a.restartTrack(),l.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}a.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),$(a))),hn(a)?yield a.restartTrack({deviceId:"default"}):yield a.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),$(a))),yield a.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=i,this.roomOptions=r,this.setupEngine(i),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=s,this.roomOutgoingDataStreamManager=o}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==Ae.NONE}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setupEngine(e){var n;this.engine=e,this.engine.on(N.RemoteMute,(i,r)=>{const s=this.trackPublications.get(i);!s||!s.track||(r?s.mute():s.unmute())}),!((n=this.signalConnectedFuture)===null||n===void 0)&&n.isResolved&&(this.signalConnectedFuture=void 0),this.engine.on(N.Connected,this.handleReconnected).on(N.SignalConnected,this.handleSignalConnected).on(N.SignalRestarted,this.handleReconnected).on(N.SignalResumed,this.handleReconnected).on(N.Restarting,this.handleReconnecting).on(N.Resuming,this.handleReconnecting).on(N.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(N.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(N.Closing,this.handleClosing).on(N.SignalRequestResponse,this.handleSignalRequestResponse).on(N.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return C(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return C(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return C(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return C(this,arguments,void 0,function(n){var i=this;let{metadata:r,name:s,attributes:o}=n;return function*(){return new lt((a,l)=>C(i,void 0,void 0,function*(){var c,u;try{let d=!1;const h=yield this.engine.client.sendUpdateLocalMetadata((c=r??this.metadata)!==null&&c!==void 0?c:"",(u=s??this.name)!==null&&u!==void 0?u:"",o),f=performance.now();for(this.pendingSignalRequests.set(h,{resolve:a,reject:v=>{l(v),d=!0},values:{name:s,metadata:r,attributes:o}});performance.now()-f<5e3&&!d;){if((!s||this.name===s)&&(!r||this.metadata===r)&&(!o||Object.entries(o).every(v=>{let[g,y]=v;return this.attributes[g]===y||y===""&&!this.attributes[g]}))){this.pendingSignalRequests.delete(h),a();return}yield ze(50)}l(new dm("Request to update local metadata timed out","TimeoutError"))}catch(d){d instanceof Error?l(d):l(new Error(String(d)))}}))}()})}setCameraEnabled(e,n,i){return this.setTrackEnabled(R.Source.Camera,e,n,i)}setMicrophoneEnabled(e,n,i){return this.setTrackEnabled(R.Source.Microphone,e,n,i)}setScreenShareEnabled(e,n,i){return this.setTrackEnabled(R.Source.ScreenShare,e,n,i)}setE2EEEnabled(e){return C(this,void 0,void 0,function*(){this.encryptionType=e?Ae.GCM:Ae.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,n,i,r){return C(this,void 0,void 0,function*(){var s,o;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:n})),this.republishPromise&&(yield this.republishPromise);let a=this.getTrackPublication(e);if(n)if(a)yield a.unmute();else{let l;if(this.pendingPublishing.has(e)){const c=yield this.waitForPendingPublicationOfSource(e);return c||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield c==null?void 0:c.unmute(),c}this.pendingPublishing.add(e);try{switch(e){case R.Source.Camera:l=yield this.createTracks({video:(s=i)!==null&&s!==void 0?s:!0});break;case R.Source.Microphone:l=yield this.createTracks({audio:(o=i)!==null&&o!==void 0?o:!0});break;case R.Source.ScreenShare:l=yield this.createScreenTracks(Object.assign({},i));break;default:throw new Sn(e)}}catch(c){throw l==null||l.forEach(u=>{u.stop()}),c instanceof Error&&this.emit(F.MediaDevicesError,c,Yu(e)),this.pendingPublishing.delete(e),c}for(const c of l){const u=Object.assign(Object.assign({},this.roomOptions.publishDefaults),i);e===R.Source.Microphone&&rn(c)&&u.preConnectBuffer&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),c.startPreConnectBuffer())}try{const c=[];for(const d of l)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),$(d))),c.push(this.publishTrack(d,r));[a]=yield Promise.all(c)}catch(c){throw l==null||l.forEach(u=>{u.stop()}),c}finally{this.pendingPublishing.delete(e)}}else if(!(a!=null&&a.track)&&this.pendingPublishing.has(e)&&(a=yield this.waitForPendingPublicationOfSource(e),a||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),a&&a.track)if(e===R.Source.ScreenShare){a=yield this.unpublishTrack(a.track);const l=this.getTrackPublication(R.Source.ScreenShareAudio);l&&l.track&&this.unpublishTrack(l.track)}else yield a.mute();return a})}enableCameraAndMicrophone(){return C(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(R.Source.Camera)||this.pendingPublishing.has(R.Source.Microphone))){this.pendingPublishing.add(R.Source.Camera),this.pendingPublishing.add(R.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(n=>this.publishTrack(n)))}finally{this.pendingPublishing.delete(R.Source.Camera),this.pendingPublishing.delete(R.Source.Microphone)}}})}createTracks(e){return C(this,void 0,void 0,function*(){var n,i;e??(e={});const r=Wk(e,(n=this.roomOptions)===null||n===void 0?void 0:n.audioCaptureDefaults,(i=this.roomOptions)===null||i===void 0?void 0:i.videoCaptureDefaults);try{return(yield Al(r,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(a=>(rn(a)&&(this.microphoneError=void 0,a.setAudioContext(this.audioContext),a.source=R.Source.Microphone,this.emit(F.AudioStreamAcquired)),pi(a)&&(this.cameraError=void 0,a.source=R.Source.Camera),a))}catch(s){throw s instanceof Error&&(e.audio&&(this.microphoneError=s),e.video&&(this.cameraError=s)),s}})}createScreenTracks(e){return C(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new Nh("getDisplayMedia not supported");e.resolution===void 0&&!BP()&&(e.resolution=Fh.h1080fps30.resolution);const n=xP(e),i=yield navigator.mediaDevices.getDisplayMedia(n),r=i.getVideoTracks();if(r.length===0)throw new Sn("no video track found");const s=new Xa(r[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});s.source=R.Source.ScreenShare,e.contentHint&&(s.mediaStreamTrack.contentHint=e.contentHint);const o=[s];if(i.getAudioTracks().length>0){this.emit(F.AudioStreamAcquired);const a=new Ya(i.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});a.source=R.Source.ScreenShareAudio,o.push(a)}return o})}publishTrack(e,n){return C(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,n)})}publishOrRepublishTrack(e,n){return C(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return function*(){var a,l,c,u;hn(i)&&i.setAudioContext(s.audioContext),yield(a=s.reconnectFuture)===null||a===void 0?void 0:a.promise,s.republishPromise&&!o&&(yield s.republishPromise),wr(i)&&s.pendingPublishPromises.has(i)&&(yield s.pendingPublishPromises.get(i));let d;if(i instanceof MediaStreamTrack)d=i.getConstraints();else{d=i.constraints;let p;switch(i.source){case R.Source.Microphone:p="audioinput";break;case R.Source.Camera:p="videoinput"}p&&s.activeDeviceMap.has(p)&&(d=Object.assign(Object.assign({},d),{deviceId:s.activeDeviceMap.get(p)}))}if(i instanceof MediaStreamTrack)switch(i.kind){case"audio":i=new Ya(i,d,!0,s.audioContext,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;case"video":i=new Xa(i,d,!0,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;default:throw new Sn("unsupported MediaStreamTrack kind ".concat(i.kind))}else i.updateLoggerOptions({loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});let h;if(s.trackPublications.forEach(p=>{p.track&&p.track===i&&(h=p)}),h)return s.log.warn("track has already been published, skipping",Object.assign(Object.assign({},s.logContext),$(h))),h;const f=Object.assign(Object.assign({},s.roomOptions.publishDefaults),r),v="channelCount"in i.mediaStreamTrack.getSettings()&&i.mediaStreamTrack.getSettings().channelCount===2||i.mediaStreamTrack.getConstraints().channelCount===2,g=(l=f.forceStereo)!==null&&l!==void 0?l:v;g&&(f.dtx===void 0&&s.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},s.logContext),$(i))),f.red===void 0&&s.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(c=f.dtx)!==null&&c!==void 0||(f.dtx=!1),(u=f.red)!==null&&u!==void 0||(f.red=!1)),!WP()&&s.roomOptions.e2ee&&(s.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},s.logContext)),f.simulcast=!1),f.source&&(i.source=f.source);const y=new Promise((p,m)=>C(s,void 0,void 0,function*(){try{if(this.engine.client.currentState!==se.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:$(i)}));let k=!1;const S=setTimeout(()=>{k=!0,i.stop(),m(new um("publishing rejected as engine not connected within timeout",408))},15e3);if(yield this.waitUntilEngineConnected(),clearTimeout(S),k)return;const T=yield this.publish(i,f,g);p(T)}else try{const k=yield this.publish(i,f,g);p(k)}catch(k){m(k)}}catch(k){m(k)}}));s.pendingPublishPromises.set(i,y);try{return yield y}catch(p){throw p}finally{s.pendingPublishPromises.delete(i)}}()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new It),this.signalConnectedFuture.promise}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),$(e))),!1;const{canPublish:n,canPublishSources:i}=this.permissions;return n&&(i.length===0||i.map(r=>AP(r)).includes(e.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),$(e))),!1)}publish(e,n,i){return C(this,void 0,void 0,function*(){var r,s,o,a,l,c,u,d,h,f;if(!this.hasPermissionsToPublish(e))throw new um("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(I=>wr(e)&&I.source===e.source)&&e.source!==R.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),$(e))),n.stopMicTrackOnMute&&rn(e)&&(e.stopOnMute=!0),e.source===R.Source.ScreenShare&&Fi()&&(n.simulcast=!1),n.videoCodec==="av1"&&!UP()&&(n.videoCodec=void 0),n.videoCodec==="vp9"&&!jP()&&(n.videoCodec=void 0),n.videoCodec===void 0&&(n.videoCodec=id),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(I=>n.videoCodec===Rs(I.mime))||(n.videoCodec=Rs(this.enabledPublishVideoCodecs[0].mime)));const g=n.videoCodec;e.on(O.Muted,this.onTrackMuted),e.on(O.Unmuted,this.onTrackUnmuted),e.on(O.Ended,this.handleTrackEnded),e.on(O.UpstreamPaused,this.onTrackUpstreamPaused),e.on(O.UpstreamResumed,this.onTrackUpstreamResumed),e.on(O.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const y=[],p=!(!((r=n.dtx)!==null&&r!==void 0)||r),m=e.getSourceTrackSettings();m.autoGainControl&&y.push(Ne.TF_AUTO_GAIN_CONTROL),m.echoCancellation&&y.push(Ne.TF_ECHO_CANCELLATION),m.noiseSuppression&&y.push(Ne.TF_NOISE_SUPPRESSION),m.channelCount&&m.channelCount>1&&y.push(Ne.TF_STEREO),p&&y.push(Ne.TF_NO_DTX),hn(e)&&e.hasPreConnectBuffer&&y.push(Ne.TF_PRECONNECT_BUFFER);const k=new to({cid:e.mediaStreamTrack.id,name:n.name,type:R.kindToProto(e.kind),muted:e.isMuted,source:R.sourceToProto(e.source),disableDtx:p,encryption:this.encryptionType,stereo:i,disableRed:this.isE2EEEnabled||!(!((s=n.red)!==null&&s!==void 0)||s),stream:n==null?void 0:n.stream,backupCodecPolicy:n==null?void 0:n.backupCodecPolicy,audioFeatures:y});let S;if(e.kind===R.Kind.Video){let I={width:0,height:0};try{I=yield e.waitForDimensions()}catch{const L=(a=(o=this.roomOptions.videoCaptureDefaults)===null||o===void 0?void 0:o.resolution)!==null&&a!==void 0?a:no.h720.resolution;I={width:L.width,height:L.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),$(e)),{dims:I}))}k.width=I.width,k.height=I.height,Fn(e)&&(qt(g)&&(e.source===R.Source.ScreenShare&&(n.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),$(e))))),n.scalabilityMode=(l=n.scalabilityMode)!==null&&l!==void 0?l:"L3T3_KEY"),k.simulcastCodecs=[new Vu({codec:g,cid:e.mediaStreamTrack.id})],n.backupCodec===!0&&(n.backupCodec={codec:id}),n.backupCodec&&g!==n.backupCodec.codec&&k.encryption===Ae.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),k.simulcastCodecs.push(new Vu({codec:n.backupCodec.codec,cid:""})))),S=sd(e.source===R.Source.ScreenShare,k.width,k.height,n),k.layers=Um(k.width,k.height,S,qt(n.videoCodec))}else e.kind===R.Kind.Audio&&(S=[{maxBitrate:(c=n.audioPreset)===null||c===void 0?void 0:c.maxBitrate,priority:(d=(u=n.audioPreset)===null||u===void 0?void 0:u.priority)!==null&&d!==void 0?d:"high",networkPriority:(f=(h=n.audioPreset)===null||h===void 0?void 0:h.priority)!==null&&f!==void 0?f:"high"}]);if(!this.engine||this.engine.isClosed)throw new Pe("cannot publish track when not connected");const T=()=>C(this,void 0,void 0,function*(){var I,_,L;if(!this.engine.pcManager)throw new Pe("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,n,S),this.emit(F.LocalSenderCreated,e.sender,e),Fn(e)&&((I=n.degradationPreference)!==null&&I!==void 0||(n.degradationPreference=J_(e)),e.setDegradationPreference(n.degradationPreference)),S)if(Fi()&&e.kind===R.Kind.Audio){let z;for(const Y of this.engine.pcManager.publisher.getTransceivers())if(Y.sender===e.sender){z=Y;break}z&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:z,codec:"opus",maxbr:!((_=S[0])===null||_===void 0)&&_.maxBitrate?S[0].maxBitrate/1e3:0})}else e.codec&&qt(e.codec)&&(!((L=S[0])===null||L===void 0)&&L.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:k.cid,codec:e.codec,maxbr:S[0].maxBitrate/1e3});yield this.engine.negotiate()});let b;const P=new Promise((I,_)=>C(this,void 0,void 0,function*(){var L;try{b=yield this.engine.addTrack(k),I(b)}catch(z){e.sender&&(!((L=this.engine.pcManager)===null||L===void 0)&&L.publisher)&&(this.engine.pcManager.publisher.removeTrack(e.sender),yield this.engine.negotiate().catch(Y=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),$(e)),{error:Y}))})),_(z)}}));if(this.enabledPublishVideoCodecs.length>0)b=(yield Promise.all([P,T()]))[0];else{b=yield P;let I;if(b.codecs.forEach(_=>{I===void 0&&(I=_.mimeType)}),I&&e.kind===R.Kind.Video){const _=Rs(I);_!==g&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),$(e)),{codec:_})),n.videoCodec=_,S=sd(e.source===R.Source.ScreenShare,k.width,k.height,n))}yield T()}const E=new ad(e.kind,b,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(E.on(O.CpuConstrained,I=>this.onTrackCpuConstrained(I,E)),E.options=n,e.sid=b.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:S,trackInfo:b})),Fn(e)?e.startMonitor(this.engine.client):hn(e)&&e.startMonitor(),this.addTrackPublication(E),this.emit(F.LocalTrackPublished,E),hn(e)&&b.audioFeatures.includes(Ne.TF_PRECONNECT_BUFFER)){const I=e.getPreConnectBuffer(),_=e.getPreConnectBufferMimeType();this.on(F.LocalTrackSubscribed,L=>{if(L.trackSid===b.sid){if(!e.hasPreConnectBuffer){this.log.warn("subscribe event came to late, buffer already closed",this.logContext);return}this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),$(e))),e.stopPreConnectBuffer()}}),I&&new Promise((z,Y)=>C(this,void 0,void 0,function*(){var we,De,te,ie,U,q;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),$(e)));const On=setTimeout(()=>{Y(new Error("agent not active within 10 seconds"))},1e4),dn=yield this.waitUntilActiveAgentPresent();clearTimeout(On),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),$(e)));const Wi=yield this.streamBytes({name:"preconnect-buffer",mimeType:_,topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[dn.identity],attributes:{trackId:E.trackSid,sampleRate:String((U=m.sampleRate)!==null&&U!==void 0?U:"48000"),channels:String((q=m.channelCount)!==null&&q!==void 0?q:"1")}});try{for(var K=!0,le=kn(I),ye;ye=yield le.next(),we=ye.done,!we;K=!0){ie=ye.value,K=!1;const Ot=ie;yield Wi.write(Ot)}}catch(Ot){De={error:Ot}}finally{try{!K&&!we&&(te=le.return)&&(yield te.call(le))}finally{if(De)throw De.error}}yield Wi.close(),z()}catch(On){Y(On)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),$(e)))}).catch(z=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),$(e)),{error:z}))})}return E})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,n,i){return C(this,void 0,void 0,function*(){var r;if(this.encryptionType!==Ae.NONE)return;let s;if(this.trackPublications.forEach(f=>{f.track&&f.track===e&&(s=f)}),!s)throw new Sn("track is not published");if(!Fn(e))throw new Sn("track is not a video track");const o=Object.assign(Object.assign({},(r=this.roomOptions)===null||r===void 0?void 0:r.publishDefaults),i),a=H_(e,n,o);if(!a){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),$(e)));return}const l=e.addSimulcastTrack(n,a);if(!l)return;const c=new to({cid:l.mediaStreamTrack.id,type:R.kindToProto(e.kind),muted:e.isMuted,source:R.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:o.videoCodec,cid:l.mediaStreamTrack.id}]});if(c.layers=Um(c.width,c.height,a),!this.engine||this.engine.isClosed)throw new Pe("cannot publish track when not connected");const u=()=>C(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,l,o,a),yield this.engine.negotiate()}),h=(yield Promise.all([this.engine.addTrack(c),u()]))[0];this.log.debug("published ".concat(n," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:a,trackInfo:h}))})}unpublishTrack(e,n){return C(this,void 0,void 0,function*(){var i,r;if(wr(e)){const c=this.pendingPublishPromises.get(e);c&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),$(e))),yield c)}const s=this.getPublicationForTrack(e),o=s?$(s):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),o)),!s||!s.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),o));return}e=s.track,e.off(O.Muted,this.onTrackMuted),e.off(O.Unmuted,this.onTrackUnmuted),e.off(O.Ended,this.handleTrackEnded),e.off(O.UpstreamPaused,this.onTrackUpstreamPaused),e.off(O.UpstreamResumed,this.onTrackUpstreamResumed),e.off(O.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),n===void 0&&(n=(r=(i=this.roomOptions)===null||i===void 0?void 0:i.stopLocalTrackOnUnpublish)!==null&&r!==void 0?r:!0),n?e.stop():e.stopMonitor();let a=!1;const l=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<ke.FAILED&&l)try{for(const c of this.engine.pcManager.publisher.getTransceivers())c.sender===l&&(c.direction="inactive",a=!0);if(this.engine.removeTrack(l)&&(a=!0),Fn(e)){for(const[,c]of e.simulcastCodecs)c.sender&&(this.engine.removeTrack(c.sender)&&(a=!0),c.sender=void 0);e.simulcastCodecs.clear()}}catch(c){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),o),{error:c}))}switch(this.trackPublications.delete(s.trackSid),s.kind){case R.Kind.Audio:this.audioTrackPublications.delete(s.trackSid);break;case R.Kind.Video:this.videoTrackPublications.delete(s.trackSid);break}return this.emit(F.LocalTrackUnpublished,s),s.setTrack(void 0),a&&(yield this.engine.negotiate()),s})}unpublishTracks(e){return C(this,void 0,void 0,function*(){return(yield Promise.all(e.map(i=>this.unpublishTrack(i)))).filter(i=>!!i)})}republishAllTracks(e){return C(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){i.republishPromise&&(yield i.republishPromise),i.republishPromise=new lt((s,o)=>C(i,void 0,void 0,function*(){try{const a=[];this.trackPublications.forEach(l=>{l.track&&(n&&(l.options=Object.assign(Object.assign({},l.options),n)),a.push(l))}),yield Promise.all(a.map(l=>C(this,void 0,void 0,function*(){const c=l.track;yield this.unpublishTrack(c,!1),r&&!c.isMuted&&c.source!==R.Source.ScreenShare&&c.source!==R.Source.ScreenShareAudio&&(hn(c)||Fn(c))&&!c.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:l.trackSid})),yield c.restartTrack()),yield this.publishOrRepublishTrack(c,l.options,!0)}))),s()}catch(a){a instanceof Error?o(a):o(new Error(String(a)))}finally{this.republishPromise=void 0}})),yield i.republishPromise}()})}publishData(e){return C(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const s=r.reliable?G.RELIABLE:G.LOSSY,o=r.destinationIdentities,a=r.topic;let l=new Eh({participantIdentity:i.identity,payload:n,destinationIdentities:o,topic:a});const c=new Ze({kind:s,value:{case:"user",value:l}});yield i.engine.sendDataPacket(c,s)}()})}publishDtmf(e,n){return C(this,void 0,void 0,function*(){const i=new Ze({kind:G.RELIABLE,value:{case:"sipDtmf",value:new q0({code:e,digit:n})}});yield this.engine.sendDataPacket(i,G.RELIABLE)})}sendChatMessage(e,n){return C(this,void 0,void 0,function*(){const i={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:n==null?void 0:n.attachments},r=new Ze({value:{case:"chatMessage",value:new Ha(Object.assign(Object.assign({},i),{timestamp:fe.parse(i.timestamp)}))}});return yield this.engine.sendDataPacket(r,G.RELIABLE),this.emit(F.ChatMessage,i),i})}editChatMessage(e,n){return C(this,void 0,void 0,function*(){const i=Object.assign(Object.assign({},n),{message:e,editTimestamp:Date.now()}),r=new Ze({value:{case:"chatMessage",value:new Ha(Object.assign(Object.assign({},i),{timestamp:fe.parse(i.timestamp),editTimestamp:fe.parse(i.editTimestamp)}))}});return yield this.engine.sendDataPacket(r,G.RELIABLE),this.emit(F.ChatMessage,i),i})}sendText(e,n){return C(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendText(e,n)})}streamText(e){return C(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamText(e)})}sendFile(e,n){return C(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendFile(e,n)})}streamBytes(e){return C(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamBytes(e)})}performRpc(e){let{destinationIdentity:n,method:i,payload:r,responseTimeout:s=15e3}=e;const o=7e3,a=o+1e3;return new lt((l,c)=>C(this,void 0,void 0,function*(){var u,d,h,f;if(Kh(r)>eS){c(be.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((d=(u=this.engine.latestJoinResponse)===null||u===void 0?void 0:u.serverInfo)===null||d===void 0)&&d.version&&ln((f=(h=this.engine.latestJoinResponse)===null||h===void 0?void 0:h.serverInfo)===null||f===void 0?void 0:f.version,"1.8.0")<0){c(be.builtIn("UNSUPPORTED_SERVER"));return}const v=Math.max(s,a),g=crypto.randomUUID();yield this.publishRpcRequest(n,g,i,r,v);const y=setTimeout(()=>{this.pendingAcks.delete(g),c(be.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(g),clearTimeout(p)},o);this.pendingAcks.set(g,{resolve:()=>{clearTimeout(y)},participantIdentity:n});const p=setTimeout(()=>{this.pendingResponses.delete(g),c(be.builtIn("RESPONSE_TIMEOUT"))},s);this.pendingResponses.set(g,{resolve:(m,k)=>{clearTimeout(p),this.pendingAcks.has(g)&&(this.log.warn("RPC response received before ack",g),this.pendingAcks.delete(g),clearTimeout(y)),k?c(k):l(m??"")},participantIdentity:n})}))}registerRpcMethod(e,n){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=n,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const n=this.pendingAcks.get(e);n?(n.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,n,i){const r=this.pendingResponses.get(e);r?(r.resolve(n,i),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,n,i,r,s){return C(this,void 0,void 0,function*(){const o=new Ze({destinationIdentities:[e],kind:G.RELIABLE,value:{case:"rpcRequest",value:new Ph({id:n,method:i,payload:r,responseTimeoutMs:s,version:1})}});yield this.engine.sendDataPacket(o,G.RELIABLE)})}handleParticipantDisconnected(e){for(const[n,{participantIdentity:i}]of this.pendingAcks)i===e&&this.pendingAcks.delete(n);for(const[n,{participantIdentity:i,resolve:r}]of this.pendingResponses)i===e&&(r(null,be.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(n))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(n=>n.mime.split("/")[0].toLowerCase()==="video")}updateInfo(e){return super.updateInfo(e)?(e.tracks.forEach(n=>{var i,r;const s=this.trackPublications.get(n.sid);if(s){const o=s.isMuted||((r=(i=s.track)===null||i===void 0?void 0:i.isUpstreamPaused)!==null&&r!==void 0?r:!1);o!==n.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),$(s)),{mutedOnServer:o})),this.engine.client.sendMuteTrack(n.sid,o))}}),!0):!1}setActiveAgent(e){var n,i,r,s;this.firstActiveAgent=e,e&&!this.firstActiveAgent&&(this.firstActiveAgent=e),e?(i=(n=this.activeAgentFuture)===null||n===void 0?void 0:n.resolve)===null||i===void 0||i.call(n,e):(s=(r=this.activeAgentFuture)===null||r===void 0?void 0:r.reject)===null||s===void 0||s.call(r,new Error("Agent disconnected")),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new It),this.activeAgentFuture.promise)}getPublicationForTrack(e){let n;return this.trackPublications.forEach(i=>{const r=i.track;r&&(e instanceof MediaStreamTrack?(hn(r)||Fn(r))&&r.mediaStreamTrack===e&&(n=i):e===r&&(n=i))}),n}waitForPendingPublicationOfSource(e){return C(this,void 0,void 0,function*(){const i=Date.now();for(;Date.now()<i+1e4;){const r=Array.from(this.pendingPublishPromises.entries()).find(s=>{let[o]=s;return o.source===e});if(r)return r[1];yield ze(20)}})}}class g1 extends mn{constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=s=>{this.setTrack(void 0),this.emit(O.Ended,s)},this.handleVisibilityChange=s=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(s),this.logContext),this.visible=s,this.emitTrackUpdate()},this.handleVideoDimensionsChange=s=>{this.log.debug("adaptivestream video dimensions ".concat(s.width,"x").concat(s.height),this.logContext),this.videoDimensionsAdaptiveStream=s,this.emitTrackUpdate()},this.subscribed=i,this.updateInfo(n)}setSubscribed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const r=new xl({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new H0({participantSid:"",trackSids:[this.trackSid]})]});this.emit(O.UpdateSubscription,r),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(i)}get subscriptionStatus(){return this.subscribed===!1?mn.SubscriptionStatus.Unsubscribed:super.isSubscribed?mn.SubscriptionStatus.Subscribed:mn.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?mn.PermissionStatus.Allowed:mn.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return this.requestedDisabled!==void 0?!this.requestedDisabled:this.isAdaptiveStream?this.visible:!0}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.requestedDisabled===!e||(this.requestedDisabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.requestedMaxQuality===e||(this.requestedMaxQuality=e,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var n,i;this.isManualOperationAllowed()&&(((n=this.requestedVideoDimensions)===null||n===void 0?void 0:n.width)===e.width&&((i=this.requestedVideoDimensions)===null||i===void 0?void 0:i.height)===e.height||(Cc(this.track)&&(this.requestedVideoDimensions=e),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&Cc(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){var e;return(e=this.requestedMaxQuality)!==null&&e!==void 0?e:gt.HIGH}setTrack(e){const n=this.subscriptionStatus,i=this.permissionStatus,r=this.track;r!==e&&(r&&(r.off(O.VideoDimensionsChanged,this.handleVideoDimensionsChange),r.off(O.VisibilityChanged,this.handleVisibilityChange),r.off(O.Ended,this.handleEnded),r.detach(),r.stopMonitor(),this.emit(O.Unsubscribed,r)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(O.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(O.VisibilityChanged,this.handleVisibilityChange),e.on(O.Ended,this.handleEnded),this.emit(O.Subscribed,e)),this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n))}setAllowed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n)}setSubscriptionError(e){this.emit(O.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const n=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):n!==e.muted&&this.emit(e.muted?O.Muted:O.Unmuted)}emitSubscriptionUpdateIfChanged(e){const n=this.subscriptionStatus;e!==n&&this.emit(O.SubscriptionStatusChanged,n,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(O.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return Cc(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new tk({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===R.Kind.Video){let n=this.requestedVideoDimensions;if(this.videoDimensionsAdaptiveStream!==void 0)if(n)fm(this.videoDimensionsAdaptiveStream,n)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream);else if(this.requestedMaxQuality!==void 0&&this.trackInfo){const i=OP(this.trackInfo,this.requestedMaxQuality);i&&fm(this.videoDimensionsAdaptiveStream,i)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream;n?(e.width=Math.ceil(n.width),e.height=Math.ceil(n.height)):this.requestedMaxQuality!==void 0?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),e.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:gt.HIGH})),e.quality=gt.HIGH)}this.emit(O.UpdateSettings,e)}}class Za extends lS{static fromParticipantInfo(e,n,i){return new Za(e,n.sid,n.identity,n.name,n.metadata,n.attributes,i,n.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,n,i,r,s,o,a){let l=arguments.length>7&&arguments[7]!==void 0?arguments[7]:eo.STANDARD;super(n,i||"",r,s,o,a,l),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(O.UpdateSettings,n=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),$(e)),{settings:n})),this.signalClient.sendUpdateTrackSettings(n)}),e.on(O.UpdateSubscription,n=>{n.participantTracks.forEach(i=>{i.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(n)}),e.on(O.SubscriptionPermissionChanged,n=>{this.emit(F.TrackSubscriptionPermissionChanged,e,n)}),e.on(O.SubscriptionStatusChanged,n=>{this.emit(F.TrackSubscriptionStatusChanged,e,n)}),e.on(O.Subscribed,n=>{this.emit(F.TrackSubscribed,n,e)}),e.on(O.Unsubscribed,n=>{this.emit(F.TrackUnsubscribed,n,e)}),e.on(O.SubscriptionFailed,n=>{this.emit(F.TrackSubscriptionFailed,e.trackSid,n)})}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setVolume(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:R.Source.Microphone;this.volumeMap.set(n,e);const i=this.getTrackPublication(n);i&&i.track&&i.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:R.Source.Microphone;const n=this.getTrackPublication(e);return n&&n.track?n.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,n,i,r,s,o){let a=this.getTrackPublicationBySid(n);if(a||n.startsWith("TR")||this.trackPublications.forEach(u=>{!a&&e.kind===u.kind.toString()&&(a=u)}),!a){if(o===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:n})),this.emit(F.TrackSubscriptionFailed,n);return}o===void 0&&(o=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,n,i,r,s,o-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),$(a))),this.emit(F.TrackSubscriptionFailed,n);return}const l=e.kind==="video";let c;return l?c=new u1(e,n,r,s):c=new c1(e,n,r,this.audioContext,this.audioOutput),c.source=a.source,c.isMuted=a.isMuted,c.setMediaStream(i),c.start(),a.setTrack(c),this.volumeMap.has(a.source)&&td(c)&&rn(c)&&c.setVolume(this.volumeMap.get(a.source)),a}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const n=new Map,i=new Map;return e.tracks.forEach(r=>{var s,o;let a=this.getTrackPublicationBySid(r.sid);if(a)a.updateInfo(r);else{const l=R.kindFromProto(r.type);if(!l)return;a=new g1(l,r,(s=this.signalClient.connectOptions)===null||s===void 0?void 0:s.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(o=this.loggerOptions)===null||o===void 0?void 0:o.loggerName}),a.updateInfo(r),i.set(r.sid,a);const c=Array.from(this.trackPublications.values()).find(u=>u.source===(a==null?void 0:a.source));c&&a.source!==R.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(a.source),Object.assign(Object.assign({},this.logContext),{oldTrack:$(c),newTrack:$(a)})),this.addTrackPublication(a)}n.set(r.sid,a)}),this.trackPublications.forEach(r=>{n.has(r.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),$(r))),this.unpublishTrack(r.trackSid,!0))}),i.forEach(r=>{this.emit(F.TrackPublished,r)}),!0}unpublishTrack(e,n){const i=this.trackPublications.get(e);if(!i)return;const{track:r}=i;switch(r&&(r.stop(),i.setTrack(void 0)),this.trackPublications.delete(e),i.kind){case R.Kind.Audio:this.audioTrackPublications.delete(e);break;case R.Kind.Video:this.videoTrackPublications.delete(e);break}n&&this.emit(F.TrackUnpublished,i)}setAudioOutput(e){return C(this,void 0,void 0,function*(){this.audioOutput=e;const n=[];this.audioTrackPublications.forEach(i=>{var r;rn(i.track)&&td(i.track)&&n.push(i.track.setSinkId((r=e.deviceId)!==null&&r!==void 0?r:"default"))}),yield Promise.all(n)})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:i})),super.emit(e,...i)}}var ee;(function(t){t.Disconnected="disconnected",t.Connecting="connecting",t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting"})(ee||(ee={}));const v1=4*1e3;class Fr extends cn.EventEmitter{get hasE2EESetup(){return this.e2eeManager!==void 0}constructor(e){var n,i,r,s,o;if(super(),n=this,this.state=ee.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=H,this.bufferedEvents=[],this.isResuming=!1,this.rpcHandlers=new Map,this.connect=(a,l,c)=>C(this,void 0,void 0,function*(){var u;if(!VP())throw an()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const d=yield this.disconnectLock.lock();if(this.state===ee.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),d(),Promise.resolve();if(this.connectFuture)return d(),this.connectFuture.promise;this.setAndEmitConnectionState(ee.Connecting),((u=this.regionUrlProvider)===null||u===void 0?void 0:u.getServerUrl().toString())!==Qk(a)&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),Nr(new URL(a))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new X(a,l):this.regionUrlProvider.updateToken(l),this.regionUrlProvider.fetchRegionSettings().then(v=>{var g;(g=this.regionUrlProvider)===null||g===void 0||g.setServerReportedRegions(v)}).catch(v=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:v}))}));const h=(v,g,y)=>C(this,void 0,void 0,function*(){var p,m;this.abortController&&this.abortController.abort();const k=new AbortController;this.abortController=k,d==null||d();try{if(yield Er.getInstance().getBackOffPromise(a),k.signal.aborted)throw B.cancelled("Connection attempt aborted");yield this.attemptConnection(y??a,l,c,k),this.abortController=void 0,v()}catch(S){if(this.regionUrlProvider&&S instanceof B&&S.reason!==oe.Cancelled&&S.reason!==oe.NotAllowed){let T=null;try{this.log.debug("Fetching next region"),T=yield this.regionUrlProvider.getNextBestRegionUrl((p=this.abortController)===null||p===void 0?void 0:p.signal)}catch(b){if(b instanceof B&&(b.status===401||b.reason===oe.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),g(b);return}}[oe.InternalError,oe.ServerUnreachable,oe.Timeout].includes(S.reason)&&(this.log.debug("Adding failed connection attempt to back off"),Er.getInstance().addFailedConnectionAttempt(a)),T&&!(!((m=this.abortController)===null||m===void 0)&&m.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(S.message,". Retrying with another region: ").concat(T),this.logContext),this.recreateEngine(),yield h(v,g,T)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Sm(S)),g(S))}else{let T=Kt.UNKNOWN_REASON;S instanceof B&&(T=Sm(S)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,T),g(S)}}}),f=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new It((v,g)=>{h(v,g,f)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(a,l,c,u,d,h)=>C(this,void 0,void 0,function*(){var f,v,g;const y=yield c.join(a,l,{autoSubscribe:u.autoSubscribe,adaptiveStream:typeof d.adaptiveStream=="object"?!0:d.adaptiveStream,maxRetries:u.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:u.websocketTimeout},h.signal,!d.singlePeerConnection);let p=y.serverInfo;if(p||(p={version:y.serverVersion,region:y.serverRegion}),this.serverInfo=p,this.log.debug("connected to Livekit Server ".concat(Object.entries(p).map(m=>{let[k,S]=m;return"".concat(k,": ").concat(S)}).join(", ")),{room:(f=y.room)===null||f===void 0?void 0:f.name,roomSid:(v=y.room)===null||v===void 0?void 0:v.sid,identity:(g=y.participant)===null||g===void 0?void 0:g.identity}),!p.version)throw new CP("unknown server version");return p.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),d.dynacast=!1),y}),this.applyJoinResponse=a=>{const l=a.participant;if(this.localParticipant.sid=l.sid,this.localParticipant.identity=l.identity,this.localParticipant.setEnabledPublishCodecs(a.enabledPublishCodecs),this.e2eeManager)try{this.e2eeManager.setSifTrailer(a.sifTrailer)}catch(c){this.log.error(c instanceof Error?c.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:c}))}this.handleParticipantUpdates([l,...a.otherParticipants]),a.room&&this.handleRoomUpdate(a.room)},this.attemptConnection=(a,l,c,u)=>C(this,void 0,void 0,function*(){var d,h;this.state===ee.Reconnecting||this.isResuming||!((d=this.engine)===null||d===void 0)&&d.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((h=this.regionUrlProvider)===null||h===void 0)&&h.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},qh),c),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const f=yield this.connectSignal(a,l,this.engine,this.connOptions,this.options,u);this.applyJoinResponse(f),this.setupLocalParticipantEvents(),this.emit(D.SignalConnected)}catch(f){yield this.engine.close(),this.recreateEngine();const v=u.signal.aborted?B.cancelled("Signal connection aborted"):B.serverUnreachable("could not establish signal connection");throw f instanceof Error&&(v.message="".concat(v.message,": ").concat(f.message)),f instanceof B&&(v.reason=f.reason,v.status=f.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:f})),v}if(u.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),B.cancelled("Connection attempt aborted");try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,u)}catch(f){throw yield this.engine.close(),this.recreateEngine(),f}ct()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),ct()&&window.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(ee.Connected),this.emit(D.Connected),Er.getInstance().resetFailedConnectionAttempts(a),this.registerConnectionReconcile(),this.regionUrlProvider&&this.regionUrlProvider.notifyConnected()}),this.disconnect=function(){for(var a=arguments.length,l=new Array(a),c=0;c<a;c++)l[c]=arguments[c];return C(n,[...l],void 0,function(){var u=this;let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var h,f,v;const g=yield u.disconnectLock.lock();try{if(u.state===ee.Disconnected){u.log.debug("already disconnected",u.logContext);return}if(u.log.info("disconnect from room",Object.assign({},u.logContext)),u.state===ee.Connecting||u.state===ee.Reconnecting||u.isResuming){const y="Abort connection attempt due to user initiated disconnect";u.log.warn(y,u.logContext),(h=u.abortController)===null||h===void 0||h.abort(y),(v=(f=u.connectFuture)===null||f===void 0?void 0:f.reject)===null||v===void 0||v.call(f,B.cancelled("Client initiated disconnect")),u.connectFuture=void 0}u.engine&&(u.engine.client.isDisconnected||(yield u.engine.client.sendLeave()),yield u.engine.close()),u.handleDisconnect(d,Kt.CLIENT_INITIATED),u.engine=void 0}finally{g()}}()})},this.onPageLeave=()=>C(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>C(this,void 0,void 0,function*(){const a=[],l=ft();if(l&&l.os==="iOS"){const c="livekit-dummy-audio-el";let u=document.getElementById(c);if(!u){u=document.createElement("audio"),u.id=c,u.autoplay=!0,u.hidden=!0;const d=Tc();d.enabled=!0;const h=new MediaStream([d]);u.srcObject=h,document.addEventListener("visibilitychange",()=>{u&&(u.srcObject=document.hidden?null:h,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(u),this.once(D.Disconnected,()=>{u==null||u.remove(),u=null})}a.push(u)}this.remoteParticipants.forEach(c=>{c.audioTrackPublications.forEach(u=>{u.track&&u.track.attachedElements.forEach(d=>{a.push(d)})})});try{yield Promise.all([this.acquireAudioContext(),...a.map(c=>(c.muted=!1,c.play()))]),this.handleAudioPlaybackStarted()}catch(c){throw this.handleAudioPlaybackFailed(c),c}}),this.startVideo=()=>C(this,void 0,void 0,function*(){const a=[];for(const l of this.remoteParticipants.values())l.videoTrackPublications.forEach(c=>{var u;(u=c.track)===null||u===void 0||u.attachedElements.forEach(d=>{a.includes(d)||a.push(d)})});yield Promise.all(a.map(l=>l.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(l=>{l.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const a of this.remoteParticipants.values())this.handleParticipantDisconnected(a.identity,a);this.setAndEmitConnectionState(ee.Reconnecting)&&this.emit(D.Reconnecting)},this.handleSignalRestarted=a=>C(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(a.serverRegion),Object.assign(Object.assign({},this.logContext),{region:a.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(a);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(l){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:l}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:a.serverRegion}))}catch{return}this.setAndEmitConnectionState(ee.Connected),this.emit(D.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=a=>{a.forEach(l=>{var c;if(l.identity===this.localParticipant.identity){this.localParticipant.updateInfo(l);return}l.identity===""&&(l.identity=(c=this.sidToIdentity.get(l.sid))!==null&&c!==void 0?c:"");let u=this.remoteParticipants.get(l.identity);l.state===kr.DISCONNECTED?this.handleParticipantDisconnected(l.identity,u):u=this.getOrCreateParticipant(l.identity,l)})},this.handleActiveSpeakersUpdate=a=>{const l=[],c={};a.forEach(u=>{if(c[u.sid]=!0,u.sid===this.localParticipant.sid)this.localParticipant.audioLevel=u.level,this.localParticipant.setIsSpeaking(!0),l.push(this.localParticipant);else{const d=this.getRemoteParticipantBySid(u.sid);d&&(d.audioLevel=u.level,d.setIsSpeaking(!0),l.push(d))}}),c[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(u=>{c[u.sid]||(u.audioLevel=0,u.setIsSpeaking(!1))}),this.activeSpeakers=l,this.emitWhenConnected(D.ActiveSpeakersChanged,l)},this.handleSpeakersChanged=a=>{const l=new Map;this.activeSpeakers.forEach(u=>{const d=this.remoteParticipants.get(u.identity);d&&d.sid!==u.sid||l.set(u.sid,u)}),a.forEach(u=>{let d=this.getRemoteParticipantBySid(u.sid);u.sid===this.localParticipant.sid&&(d=this.localParticipant),d&&(d.audioLevel=u.level,d.setIsSpeaking(u.active),u.active?l.set(u.sid,d):l.delete(u.sid))});const c=Array.from(l.values());c.sort((u,d)=>d.audioLevel-u.audioLevel),this.activeSpeakers=c,this.emitWhenConnected(D.ActiveSpeakersChanged,c)},this.handleStreamStateUpdate=a=>{a.streamStates.forEach(l=>{const c=this.getRemoteParticipantBySid(l.participantSid);if(!c)return;const u=c.getTrackPublicationBySid(l.trackSid);if(!u||!u.track)return;const d=R.streamStateFromProto(l.state);u.track.setStreamState(d),d!==u.track.streamState&&(c.emit(F.TrackStreamStateChanged,u,u.track.streamState),this.emitWhenConnected(D.TrackStreamStateChanged,u,u.track.streamState,c))})},this.handleSubscriptionPermissionUpdate=a=>{const l=this.getRemoteParticipantBySid(a.participantSid);if(!l)return;const c=l.getTrackPublicationBySid(a.trackSid);c&&c.setAllowed(a.allowed)},this.handleSubscriptionError=a=>{const l=Array.from(this.remoteParticipants.values()).find(u=>u.trackPublications.has(a.trackSid));if(!l)return;const c=l.getTrackPublicationBySid(a.trackSid);c&&c.setSubscriptionError(a.err)},this.handleDataPacket=(a,l)=>{const c=this.remoteParticipants.get(a.participantIdentity);if(a.value.case==="user")this.handleUserPacket(c,a.value.value,a.kind,l);else if(a.value.case==="transcription")this.handleTranscription(c,a.value.value);else if(a.value.case==="sipDtmf")this.handleSipDtmf(c,a.value.value);else if(a.value.case==="chatMessage")this.handleChatMessage(c,a.value.value);else if(a.value.case==="metrics")this.handleMetrics(a.value.value,c);else if(a.value.case==="streamHeader"||a.value.case==="streamChunk"||a.value.case==="streamTrailer")this.handleDataStream(a,l);else if(a.value.case==="rpcRequest"){const u=a.value.value;this.handleIncomingRpcRequest(a.participantIdentity,u.id,u.method,u.payload,u.responseTimeoutMs,u.version)}},this.handleUserPacket=(a,l,c,u)=>{this.emit(D.DataReceived,l.payload,a,c,l.topic,u),a==null||a.emit(F.DataReceived,l.payload,c,u)},this.handleSipDtmf=(a,l)=>{this.emit(D.SipDTMFReceived,l,a),a==null||a.emit(F.SipDTMFReceived,l)},this.handleTranscription=(a,l)=>{const c=l.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(l.transcribedParticipantIdentity),u=c==null?void 0:c.trackPublications.get(l.trackId),d=JP(l,this.transcriptionReceivedTimes);u==null||u.emit(O.TranscriptionReceived,d),c==null||c.emit(F.TranscriptionReceived,d,u),this.emit(D.TranscriptionReceived,d,c,u)},this.handleChatMessage=(a,l)=>{const c=QP(l);this.emit(D.ChatMessage,c,a)},this.handleMetrics=(a,l)=>{this.emit(D.MetricsReceived,a,l)},this.handleDataStream=(a,l)=>{this.incomingDataStreamManager.handleDataStreamPacket(a,l)},this.bufferedSegments=new Map,this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(D.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=a=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:a})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(D.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(D.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(D.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>C(this,void 0,void 0,function*(){var a;((a=ft())===null||a===void 0?void 0:a.os)!=="iOS"&&(yield this.selectDefaultDevices()),this.emit(D.MediaDevicesChanged)}),this.handleRoomUpdate=a=>{const l=this.roomInfo;this.roomInfo=a,l&&l.metadata!==a.metadata&&this.emitWhenConnected(D.RoomMetadataChanged,a.metadata),(l==null?void 0:l.activeRecording)!==a.activeRecording&&this.emitWhenConnected(D.RecordingStatusChanged,a.activeRecording)},this.handleConnectionQualityUpdate=a=>{a.updates.forEach(l=>{if(l.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(l.quality);return}const c=this.getRemoteParticipantBySid(l.participantSid);c&&c.setConnectionQuality(l.quality)})},this.onLocalParticipantMetadataChanged=a=>{this.emit(D.ParticipantMetadataChanged,a,this.localParticipant)},this.onLocalParticipantNameChanged=a=>{this.emit(D.ParticipantNameChanged,a,this.localParticipant)},this.onLocalAttributesChanged=a=>{this.emit(D.ParticipantAttributesChanged,a,this.localParticipant)},this.onLocalTrackMuted=a=>{this.emit(D.TrackMuted,a,this.localParticipant)},this.onLocalTrackUnmuted=a=>{this.emit(D.TrackUnmuted,a,this.localParticipant)},this.onTrackProcessorUpdate=a=>{var l;(l=a==null?void 0:a.onPublish)===null||l===void 0||l.call(a,this)},this.onLocalTrackPublished=a=>C(this,void 0,void 0,function*(){var l,c,u,d,h,f;(l=a.track)===null||l===void 0||l.on(O.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=a.track)===null||c===void 0||c.on(O.Restarted,this.onLocalTrackRestarted),(h=(d=(u=a.track)===null||u===void 0?void 0:u.getProcessor())===null||d===void 0?void 0:d.onPublish)===null||h===void 0||h.call(d,this),this.emit(D.LocalTrackPublished,a,this.localParticipant),hn(a.track)&&(yield a.track.checkForSilence())&&this.emit(D.LocalAudioSilenceDetected,a);const v=yield(f=a.track)===null||f===void 0?void 0:f.getDeviceId(!1),g=Yu(a.source);g&&v&&v!==this.localParticipant.activeDeviceMap.get(g)&&(this.localParticipant.activeDeviceMap.set(g,v),this.emit(D.ActiveDeviceChanged,g,v))}),this.onLocalTrackUnpublished=a=>{var l,c;(l=a.track)===null||l===void 0||l.off(O.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=a.track)===null||c===void 0||c.off(O.Restarted,this.onLocalTrackRestarted),this.emit(D.LocalTrackUnpublished,a,this.localParticipant)},this.onLocalTrackRestarted=a=>C(this,void 0,void 0,function*(){const l=yield a.getDeviceId(!1),c=Yu(a.source);c&&l&&l!==this.localParticipant.activeDeviceMap.get(c)&&(this.log.debug("local track restarted, setting ".concat(c," ").concat(l," active"),this.logContext),this.localParticipant.activeDeviceMap.set(c,l),this.emit(D.ActiveDeviceChanged,c,l))}),this.onLocalConnectionQualityChanged=a=>{this.emit(D.ConnectionQualityChanged,a,this.localParticipant)},this.onMediaDevicesError=(a,l)=>{this.emit(D.MediaDevicesError,a,l)},this.onLocalParticipantPermissionsChanged=a=>{this.emit(D.ParticipantPermissionsChanged,a,this.localParticipant)},this.onLocalChatMessageSent=a=>{this.emit(D.ChatMessage,a,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},x_),e),this.log=Dn((i=this.options.loggerName)!==null&&i!==void 0?i:Jt.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},Yk),e==null?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},Xk),e==null?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},R_),e==null?void 0:e.publishDefaults),this.maybeCreateEngine(),this.incomingDataStreamManager=new s1,this.outgoingDataStreamManager=new l1(this.engine,this.log),this.disconnectLock=new tt,this.localParticipant=new m1("","",this.engine,this.options,this.rpcHandlers,this.outgoingDataStreamManager),(this.options.e2ee||this.options.encryption)&&this.setupE2EE(),this.engine.e2eeManager=this.e2eeManager,this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",ii(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",ii(this.options.audioCaptureDefaults.deviceId)),!((r=this.options.audioOutput)===null||r===void 0)&&r.deviceId&&this.switchActiveDevice("audiooutput",ii(this.options.audioOutput.deviceId)).catch(a=>this.log.warn("Could not set audio output: ".concat(a.message),this.logContext)),ct()){const a=new AbortController;(o=(s=navigator.mediaDevices)===null||s===void 0?void 0:s.addEventListener)===null||o===void 0||o.call(s,"devicechange",this.handleDeviceChange,{signal:a.signal}),Fr.cleanupRegistry&&Fr.cleanupRegistry.register(this,()=>{a.abort()})}}registerTextStreamHandler(e,n){return this.incomingDataStreamManager.registerTextStreamHandler(e,n)}unregisterTextStreamHandler(e){return this.incomingDataStreamManager.unregisterTextStreamHandler(e)}registerByteStreamHandler(e,n){return this.incomingDataStreamManager.registerByteStreamHandler(e,n)}unregisterByteStreamHandler(e){return this.incomingDataStreamManager.unregisterByteStreamHandler(e)}registerRpcMethod(e,n){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setE2EEEnabled(e){return C(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;const n=!!this.options.encryption,i=this.options.encryption||this.options.e2ee;i&&("e2eeManager"in i?(this.e2eeManager=i.e2eeManager,this.e2eeManager.isDataChannelEncryptionEnabled=n):this.e2eeManager=new d_(i,n),this.e2eeManager.on(Gn.ParticipantEncryptionStatusChanged,(r,s)=>{XP(s)&&(this.isE2EEEnabled=r),this.emit(D.ParticipantEncryptionStatusChanged,r,s)}),this.e2eeManager.on(Gn.EncryptionError,(r,s)=>{const o=s?this.getParticipantByIdentity(s):void 0;this.emit(D.EncryptionError,r,o)}),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&n!==void 0?n:!1}getSid(){return this.state===ee.Disconnected?lt.resolve(""):this.roomInfo&&this.roomInfo.sid!==""?lt.resolve(this.roomInfo.sid):new lt((e,n)=>{const i=r=>{r.sid!==""&&(this.engine.off(N.RoomUpdate,i),e(r.sid))};this.engine.on(N.RoomUpdate,i),this.once(D.Disconnected,()=>{this.engine.off(N.RoomUpdate,i),n(new Pe("Room disconnected before room server id was available"))})})}get name(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&n!==void 0?n:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&n!==void 0?n:0}get numPublishers(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&n!==void 0?n:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new t1(this.options),this.engine.e2eeManager=this.e2eeManager,this.engine.on(N.ParticipantUpdate,this.handleParticipantUpdates).on(N.RoomUpdate,this.handleRoomUpdate).on(N.SpeakersChanged,this.handleSpeakersChanged).on(N.StreamStateChanged,this.handleStreamStateUpdate).on(N.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(N.SubscriptionError,this.handleSubscriptionError).on(N.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(N.MediaTrackAdded,(e,n,i)=>{this.onTrackAdded(e,n,i)}).on(N.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(N.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(N.DataPacketReceived,this.handleDataPacket).on(N.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(ee.SignalReconnecting)&&this.emit(D.SignalReconnecting)}).on(N.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(ee.Connected)&&this.emit(D.Reconnected)}).on(N.SignalResumed,()=>{this.bufferedEvents=[],(this.state===ee.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(N.Restarting,this.handleRestarting).on(N.SignalRestarted,this.handleSignalRestarted).on(N.Offline,()=>{this.setAndEmitConnectionState(ee.Reconnecting)&&this.emit(D.Reconnecting)}).on(N.DCBufferStatusChanged,(e,n)=>{this.emit(D.DCBufferStatusChanged,e,n)}).on(N.LocalTrackSubscribed,e=>{const n=this.localParticipant.getTrackPublications().find(i=>{let{trackSid:r}=i;return r===e});if(!n){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(F.LocalTrackSubscribed,n),this.emitWhenConnected(D.LocalTrackSubscribed,n,this.localParticipant)}).on(N.RoomMoved,e=>{this.log.debug("room moved",e),e.room&&this.handleRoomUpdate(e.room),this.remoteParticipants.forEach((n,i)=>{this.handleParticipantDisconnected(i,n)}),this.emit(D.Moved,e.room.name),e.participant?this.handleParticipantUpdates([e.participant,...e.otherParticipants]):this.handleParticipantUpdates(e.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine),this.outgoingDataStreamManager&&this.outgoingDataStreamManager.setupEngine(this.engine))}static getLocalDevices(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return Fe.getInstance().getDevices(e,n)}prepareConnection(e,n){return C(this,void 0,void 0,function*(){if(this.state===ee.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(Nr(new URL(e))&&n){this.regionUrlProvider=new X(e,n);const i=yield this.regionUrlProvider.getNextBestRegionUrl();i&&this.state===ee.Disconnected&&(this.regionUrl=i,yield fetch(ro(i),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(i),this.logContext))}else yield fetch(ro(e),{method:"HEAD"})}catch(i){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:i}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,n){return C(this,void 0,void 0,function*(){let i=()=>C(this,void 0,void 0,function*(){}),r;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":r=new Yt({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":r=new Yt({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":r=new Yt({scenario:{case:"serverLeave",value:!0}});break;case"migration":r=new Yt({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":i=()=>C(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new Yt({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":i=()=>C(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new Yt({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":r=new Yt({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),i=()=>C(this,void 0,void 0,function*(){const s=this.engine.client.onLeave;s&&s(new Il({reason:Kt.CLIENT_INITIATED,action:Sr.RECONNECT}))});break;case"subscriber-bandwidth":if(n===void 0||typeof n!="number")throw new Error("subscriber-bandwidth requires a number as argument");r=new Yt({scenario:{case:"subscriberBandwidth",value:Ti(n)}});break;case"leave-full-reconnect":r=new Yt({scenario:{case:"leaveRequestFullReconnect",value:!0}})}r&&(yield this.engine.client.sendSimulateScenario(r),yield i())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,n){return C(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return function*(){var a,l,c,u,d,h,f;let v=!0,g=!1;const y=o?{exact:r}:r;if(i==="audioinput"){g=s.localParticipant.audioTrackPublications.size===0;const p=(a=s.getActiveDevice(i))!==null&&a!==void 0?a:s.options.audioCaptureDefaults.deviceId;s.options.audioCaptureDefaults.deviceId=y;const m=Array.from(s.localParticipant.audioTrackPublications.values()).filter(S=>S.source===R.Source.Microphone);try{v=(yield Promise.all(m.map(S=>{var T;return(T=S.audioTrack)===null||T===void 0?void 0:T.setDeviceId(y)}))).every(S=>S===!0)}catch(S){throw s.options.audioCaptureDefaults.deviceId=p,S}const k=m.some(S=>{var T,b;return(b=(T=S.track)===null||T===void 0?void 0:T.isMuted)!==null&&b!==void 0?b:!1});v&&k&&(g=!0)}else if(i==="videoinput"){g=s.localParticipant.videoTrackPublications.size===0;const p=(l=s.getActiveDevice(i))!==null&&l!==void 0?l:s.options.videoCaptureDefaults.deviceId;s.options.videoCaptureDefaults.deviceId=y;const m=Array.from(s.localParticipant.videoTrackPublications.values()).filter(S=>S.source===R.Source.Camera);try{v=(yield Promise.all(m.map(S=>{var T;return(T=S.videoTrack)===null||T===void 0?void 0:T.setDeviceId(y)}))).every(S=>S===!0)}catch(S){throw s.options.videoCaptureDefaults.deviceId=p,S}const k=m.some(S=>{var T,b;return(b=(T=S.track)===null||T===void 0?void 0:T.isMuted)!==null&&b!==void 0?b:!1});v&&k&&(g=!0)}else if(i==="audiooutput"){if(g=!0,!ed()&&!s.options.webAudioMix||s.options.webAudioMix&&s.audioContext&&!("setSinkId"in s.audioContext))throw new Error("cannot switch audio output, the current browser does not support it");s.options.webAudioMix&&(r=(c=yield Fe.getInstance().normalizeDeviceId("audiooutput",r))!==null&&c!==void 0?c:""),(u=(f=s.options).audioOutput)!==null&&u!==void 0||(f.audioOutput={});const p=(d=s.getActiveDevice(i))!==null&&d!==void 0?d:s.options.audioOutput.deviceId;s.options.audioOutput.deviceId=r;try{s.options.webAudioMix&&((h=s.audioContext)===null||h===void 0||h.setSinkId(r)),yield Promise.all(Array.from(s.remoteParticipants.values()).map(m=>m.setAudioOutput({deviceId:r})))}catch(m){throw s.options.audioOutput.deviceId=p,m}}return g&&(s.localParticipant.activeDeviceMap.set(i,r),s.emit(D.ActiveDeviceChanged,i,r)),v}()})}setupLocalParticipantEvents(){this.localParticipant.on(F.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(F.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(F.AttributesChanged,this.onLocalAttributesChanged).on(F.TrackMuted,this.onLocalTrackMuted).on(F.TrackUnmuted,this.onLocalTrackUnmuted).on(F.LocalTrackPublished,this.onLocalTrackPublished).on(F.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(F.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(F.MediaDevicesError,this.onMediaDevicesError).on(F.AudioStreamAcquired,this.startAudio).on(F.ChatMessage,this.onLocalChatMessageSent).on(F.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,n,i){if(this.state===ee.Connecting||this.state===ee.Reconnecting){const d=()=>{this.log.debug("deferring on track for later",{mediaTrackId:e.id,mediaStreamId:n.id,tracksInStream:n.getTracks().map(f=>f.id)}),this.onTrackAdded(e,n,i),h()},h=()=>{this.off(D.Reconnected,d),this.off(D.Connected,d),this.off(D.Disconnected,h)};this.once(D.Reconnected,d),this.once(D.Connected,d),this.once(D.Disconnected,h);return}if(this.state===ee.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(e.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const r=FP(n.id),s=r[0];let o=r[1],a=e.id;if(o&&o.startsWith("TR")&&(a=o),s===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const l=Array.from(this.remoteParticipants.values()).find(d=>d.sid===s);if(!l){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(s),this.logContext);return}if(!a.startsWith("TR")){const d=this.engine.getTrackIdForReceiver(i);if(!d){this.log.error("Tried to add a track whose 'sid' could not be found for a participant, that's not present. Sid: ".concat(s),this.logContext);return}a=d}a.startsWith("TR")||this.log.warn("Tried to add a track whose 'sid' could not be determined for a participant, that's not present. Sid: ".concat(s,", streamId: ").concat(o,", trackId: ").concat(a),Object.assign(Object.assign({},this.logContext),{rpID:s,streamId:o,trackId:a}));let c;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?c=this.options.adaptiveStream:c={});const u=l.addSubscribedMediaTrack(e,a,n,i,c);u!=null&&u.isEncrypted&&!this.e2eeManager&&this.emit(D.EncryptionError,new Error("Encrypted ".concat(u.source," track received from participant ").concat(l.sid,", but room does not have encryption enabled!")))}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=arguments.length>1?arguments[1]:void 0;var i,r;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.incomingDataStreamManager.clearControllers(),this.state!==ee.Disconnected){this.regionUrl=void 0,this.regionUrlProvider&&this.regionUrlProvider.notifyDisconnected();try{this.remoteParticipants.forEach(s=>{s.trackPublications.forEach(o=>{s.unpublishTrack(o.trackSid)})}),this.localParticipant.trackPublications.forEach(s=>{var o,a,l;s.track&&this.localParticipant.unpublishTrack(s.track,e),e?((o=s.track)===null||o===void 0||o.detach(),(a=s.track)===null||a===void 0||a.stop()):(l=s.track)===null||l===void 0||l.stopMonitor()}),this.localParticipant.off(F.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(F.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(F.AttributesChanged,this.onLocalAttributesChanged).off(F.TrackMuted,this.onLocalTrackMuted).off(F.TrackUnmuted,this.onLocalTrackUnmuted).off(F.LocalTrackPublished,this.onLocalTrackPublished).off(F.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(F.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(F.MediaDevicesError,this.onMediaDevicesError).off(F.AudioStreamAcquired,this.startAudio).off(F.ChatMessage,this.onLocalChatMessageSent).off(F.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),ct()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(r=(i=navigator.mediaDevices)===null||i===void 0?void 0:i.removeEventListener)===null||r===void 0||r.call(i,"devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(ee.Disconnected),this.emit(D.Disconnected,n)}}}handleParticipantDisconnected(e,n){var i;this.remoteParticipants.delete(e),n&&(this.incomingDataStreamManager.validateParticipantHasNoActiveDataStreams(e),n.trackPublications.forEach(r=>{n.unpublishTrack(r.trackSid,!0)}),this.emit(D.ParticipantDisconnected,n),n.setDisconnected(),(i=this.localParticipant)===null||i===void 0||i.handleParticipantDisconnected(n.identity))}handleIncomingRpcRequest(e,n,i,r,s,o){return C(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,n),o!==1){yield this.engine.publishRpcResponse(e,n,null,be.builtIn("UNSUPPORTED_VERSION"));return}const a=this.rpcHandlers.get(i);if(!a){yield this.engine.publishRpcResponse(e,n,null,be.builtIn("UNSUPPORTED_METHOD"));return}let l=null,c=null;try{const u=yield a({requestId:n,callerIdentity:e,payload:r,responseTimeout:s});Kh(u)>eS?(l=be.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),this.log.warn("RPC Response payload too large for ".concat(i))):c=u}catch(u){u instanceof be?l=u:(this.log.warn("Uncaught error returned by RPC handler for ".concat(i,". Returning APPLICATION_ERROR instead."),u),l=be.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,n,c,l)})}selectDefaultDevices(){return C(this,void 0,void 0,function*(){var e,n,i;const r=Fe.getInstance().previousDevices,s=yield Fe.getInstance().getDevices(void 0,!1),o=ft();if((o==null?void 0:o.name)==="Chrome"&&o.os!=="iOS")for(let l of s){const c=r.find(u=>u.deviceId===l.deviceId);c&&c.label!==""&&c.kind===l.kind&&c.label!==l.label&&this.getActiveDevice(l.kind)==="default"&&this.emit(D.ActiveDeviceChanged,l.kind,l.deviceId)}const a=["audiooutput","audioinput","videoinput"];for(let l of a){const c=RP(l),u=this.localParticipant.getTrackPublication(c);if(u&&(!((e=u.track)===null||e===void 0)&&e.isUserProvided))continue;const d=s.filter(f=>f.kind===l),h=this.getActiveDevice(l);if(h===((n=r.filter(f=>f.kind===l)[0])===null||n===void 0?void 0:n.deviceId)&&d.length>0&&((i=d[0])===null||i===void 0?void 0:i.deviceId)!==h){yield this.switchActiveDevice(l,d[0].deviceId);continue}l==="audioinput"&&!io()||l==="videoinput"||d.length>0&&!d.find(f=>f.deviceId===this.getActiveDevice(l))&&(l!=="audiooutput"||!io())&&(yield this.switchActiveDevice(l,d[0].deviceId))}})}acquireAudioContext(){return C(this,void 0,void 0,function*(){var e,n;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=Kk())!==null&&e!==void 0?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(r=>r.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),ze(200)])}catch(r){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:r}))}const i=((n=this.audioContext)===null||n===void 0?void 0:n.state)==="running";i!==this.canPlaybackAudio&&(this.audioEnabled=i,this.emit(D.AudioPlaybackStatusChanged,i))})}createParticipant(e,n){var i;let r;return n?r=Za.fromParticipantInfo(this.engine.client,n,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):r=new Za(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&r.setAudioContext(this.audioContext),!((i=this.options.audioOutput)===null||i===void 0)&&i.deviceId&&r.setAudioOutput(this.options.audioOutput).catch(s=>this.log.warn("Could not set audio output: ".concat(s.message),this.logContext)),r}getOrCreateParticipant(e,n){if(this.remoteParticipants.has(e)){const r=this.remoteParticipants.get(e);return n&&r.updateInfo(n)&&this.sidToIdentity.set(n.sid,n.identity),r}const i=this.createParticipant(e,n);return this.remoteParticipants.set(e,i),this.sidToIdentity.set(n.sid,n.identity),this.emitWhenConnected(D.ParticipantConnected,i),i.on(F.TrackPublished,r=>{this.emitWhenConnected(D.TrackPublished,r,i)}).on(F.TrackSubscribed,(r,s)=>{r.kind===R.Kind.Audio?(r.on(O.AudioPlaybackStarted,this.handleAudioPlaybackStarted),r.on(O.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):r.kind===R.Kind.Video&&(r.on(O.VideoPlaybackFailed,this.handleVideoPlaybackFailed),r.on(O.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(D.TrackSubscribed,r,s,i)}).on(F.TrackUnpublished,r=>{this.emit(D.TrackUnpublished,r,i)}).on(F.TrackUnsubscribed,(r,s)=>{this.emit(D.TrackUnsubscribed,r,s,i)}).on(F.TrackMuted,r=>{this.emitWhenConnected(D.TrackMuted,r,i)}).on(F.TrackUnmuted,r=>{this.emitWhenConnected(D.TrackUnmuted,r,i)}).on(F.ParticipantMetadataChanged,r=>{this.emitWhenConnected(D.ParticipantMetadataChanged,r,i)}).on(F.ParticipantNameChanged,r=>{this.emitWhenConnected(D.ParticipantNameChanged,r,i)}).on(F.AttributesChanged,r=>{this.emitWhenConnected(D.ParticipantAttributesChanged,r,i)}).on(F.ConnectionQualityChanged,r=>{this.emitWhenConnected(D.ConnectionQualityChanged,r,i)}).on(F.ParticipantPermissionsChanged,r=>{this.emitWhenConnected(D.ParticipantPermissionsChanged,r,i)}).on(F.TrackSubscriptionStatusChanged,(r,s)=>{this.emitWhenConnected(D.TrackSubscriptionStatusChanged,r,s,i)}).on(F.TrackSubscriptionFailed,(r,s)=>{this.emit(D.TrackSubscriptionFailed,r,i,s)}).on(F.TrackSubscriptionPermissionChanged,(r,s)=>{this.emitWhenConnected(D.TrackSubscriptionPermissionChanged,r,s,i)}).on(F.Active,()=>{this.emitWhenConnected(D.ParticipantActive,i),i.kind===eo.AGENT&&this.localParticipant.setActiveAgent(i)}),n&&i.updateInfo(n),i}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((i,r)=>(i.push(...r.getTrackPublications()),i),[]),n=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,n)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const n of e.videoTrackPublications.values())n.isSubscribed&&YP(n)&&n.emitTrackUpdate()}getRemoteParticipantBySid(e){const n=this.sidToIdentity.get(e);if(n)return this.remoteParticipants.get(n)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=Be.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Kt.STATE_MISMATCH))):e=0},v1)}clearConnectionReconcile(){this.connectionReconcileInterval&&Be.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(D.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[n,i]=e;this.emit(n,...i)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(this.state===ee.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,i]);else if(this.state===ee.Connected)return this.emit(e,...i);return!1}simulateParticipants(e){return C(this,void 0,void 0,function*(){var n,i,r,s;const o=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),a=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new Pl({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:fe.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new Ni({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(D.SignalConnected),this.emit(D.Connected),this.setAndEmitConnectionState(ee.Connected),o.video){const l=new ad(R.Kind.Video,new sr({source:xe.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:zt.AUDIO,name:"video-dummy"}),new Xa(o.useRealTracks&&(!((n=window.navigator.mediaDevices)===null||n===void 0)&&n.getUserMedia)?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:km(160*((i=a.aspectRatios[0])!==null&&i!==void 0?i:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(l),this.localParticipant.emit(F.LocalTrackPublished,l)}if(o.audio){const l=new ad(R.Kind.Audio,new sr({source:xe.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:zt.AUDIO}),new Ya(o.useRealTracks&&(!((r=navigator.mediaDevices)===null||r===void 0)&&r.getUserMedia)?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:Tc(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(l),this.localParticipant.emit(F.LocalTrackPublished,l)}for(let l=0;l<a.count-1;l+=1){let c=new Ni({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(l),state:kr.ACTIVE,tracks:[],joinedAt:fe.parse(Date.now())});const u=this.getOrCreateParticipant(c.identity,c);if(a.video){const d=km(160*((s=a.aspectRatios[l%a.aspectRatios.length])!==null&&s!==void 0?s:1),160,!1,!0),h=new sr({source:xe.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:zt.AUDIO});u.addSubscribedMediaTrack(d,h.sid,new MediaStream([d]),new RTCRtpReceiver),c.tracks=[...c.tracks,h]}if(a.audio){const d=Tc(),h=new sr({source:xe.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:zt.AUDIO});u.addSubscribedMediaTrack(d,h.sid,new MediaStream([d]),new RTCRtpReceiver),c.tracks=[...c.tracks,h]}u.updateInfo(c)}})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(e!==D.ActiveSpeakersChanged&&e!==D.TranscriptionReceived){const s=cS(i).filter(o=>o!==void 0);(e===D.TrackSubscribed||e===D.TrackUnsubscribed)&&this.log.trace("subscribe trace: ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:s})),this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:s}))}return super.emit(e,...i)}}Fr.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(t=>{t()});function cS(t){return t.map(e=>{if(e)return Array.isArray(e)?cS(e):typeof e=="object"?"logContext"in e?e.logContext:void 0:e})}var Vt;(function(t){t[t.IDLE=0]="IDLE",t[t.RUNNING=1]="RUNNING",t[t.SKIPPED=2]="SKIPPED",t[t.SUCCESS=3]="SUCCESS",t[t.FAILED=4]="FAILED"})(Vt||(Vt={}));class mi extends cn.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=Vt.IDLE,this.logs=[],this.options={},this.url=e,this.token=n,this.name=this.constructor.name,this.room=new Fr(i.roomOptions),this.connectOptions=i.connectOptions,this.options=i}run(e){return C(this,void 0,void 0,function*(){if(this.status!==Vt.IDLE)throw Error("check is running already");this.setStatus(Vt.RUNNING);try{yield this.perform()}catch(n){n instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(n.message):this.appendError(n.message))}return yield this.disconnect(),yield new Promise(n=>setTimeout(n,500)),this.status!==Vt.SKIPPED&&this.setStatus(this.isSuccess()?Vt.SUCCESS:Vt.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(e){return C(this,void 0,void 0,function*(){return this.room.state===ee.Connected?this.room:(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions),this.room)})}disconnect(){return C(this,void 0,void 0,function*(){this.room&&this.room.state!==ee.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(Vt.SKIPPED)}switchProtocol(e){return C(this,void 0,void 0,function*(){let n=!1,i=!1;if(this.room.on(D.Reconnecting,()=>{n=!0}),this.room.once(D.Reconnected,()=>{i=!0}),this.room.simulateScenario("force-".concat(e)),yield new Promise(s=>setTimeout(s,1e3)),!n)return;const r=Date.now()+1e4;for(;Date.now()<r;){if(i)return;yield ze(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class y1 extends mi{get description(){return"Cloud regions"}perform(){return C(this,void 0,void 0,function*(){const e=new X(this.url,this.token);if(!e.isCloud()){this.skip();return}const n=[],i=new Set;for(let s=0;s<3;s++){const o=yield e.getNextBestRegionUrl();if(!o)break;if(i.has(o))continue;i.add(o);const a=yield this.checkCloudRegion(o);this.appendMessage("".concat(a.region," RTT: ").concat(a.rtt,"ms, duration: ").concat(a.duration,"ms")),n.push(a)}n.sort((s,o)=>(s.duration-o.duration)*.5+(s.rtt-o.rtt)*.5);const r=n[0];this.bestStats=r,this.appendMessage("best Cloud region: ".concat(r.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return C(this,void 0,void 0,function*(){var n,i;yield this.connect(e),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const r=(n=this.room.serverInfo)===null||n===void 0?void 0:n.region;if(!r)throw new Error("Region not found");const s=yield this.room.localParticipant.streamText({topic:"test"}),o=1e3,l=1e6/o,c="A".repeat(o),u=Date.now();for(let v=0;v<l;v++)yield s.write(c);yield s.close();const d=Date.now(),h=yield(i=this.room.engine.pcManager)===null||i===void 0?void 0:i.publisher.getStats(),f={region:r,rtt:1e4,duration:d-u};return h==null||h.forEach(v=>{v.type==="candidate-pair"&&v.nominated&&(f.rtt=v.currentRoundTripTime*1e3)}),yield this.disconnect(),f})}}const Ic=1e4;class k1 extends mi{get description(){return"Connection via UDP vs TCP"}perform(){return C(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),n=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-n.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-n.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=n):this.appendMessage("best connection quality via udp");const i=this.bestStats;this.appendMessage("upstream bitrate: ".concat((i.bitrateTotal/i.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((i.rttTotal/i.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((i.jitterTotal/i.count*1e3).toFixed(2)," ms")),i.packetsLost>0&&this.appendWarning("packets lost: ".concat((i.packetsLost/i.packetsSent*100).toFixed(2),"%")),i.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((i.qualityLimitationDurations.bandwidth/(Ic/1e3)*100).toFixed(2),"%")),i.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((i.qualityLimitationDurations.cpu/(Ic/1e3)*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return C(this,void 0,void 0,function*(){yield this.connect(),e==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const n=document.createElement("canvas");n.width=1280,n.height=720;const i=n.getContext("2d");if(!i)throw new Error("Could not get canvas context");let r=0;const s=()=>{r=(r+1)%360,i.fillStyle="hsl(".concat(r,", 100%, 50%)"),i.fillRect(0,0,n.width,n.height),requestAnimationFrame(s)};s();const a=n.captureStream(30).getVideoTracks()[0],c=(yield this.room.localParticipant.publishTrack(a,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,u={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},d=setInterval(()=>C(this,void 0,void 0,function*(){const h=yield c.getRTCStatsReport();h==null||h.forEach(f=>{f.type==="outbound-rtp"?(u.packetsSent=f.packetsSent,u.qualityLimitationDurations=f.qualityLimitationDurations,u.bitrateTotal+=f.targetBitrate,u.count++):f.type==="remote-inbound-rtp"&&(u.packetsLost=f.packetsLost,u.rttTotal+=f.roundTripTime,u.jitterTotal+=f.jitter)})}),1e3);return yield new Promise(h=>setTimeout(h,Ic)),clearInterval(d),a.stop(),n.remove(),yield this.disconnect(),u})}}class S1 extends mi{get description(){return"Can publish audio"}perform(){return C(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield aS();if(yield qk(i,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),n.localParticipant.publishTrack(i),yield new Promise(a=>setTimeout(a,3e3));const s=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!s)throw new Error("Could not get RTCStats");let o=0;if(s.forEach(a=>{a.type==="outbound-rtp"&&(a.kind==="audio"||!a.kind&&a.mediaType==="audio")&&(o=a.packetsSent)}),o===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(o," audio packets"))})}}class T1 extends mi{get description(){return"Can publish video"}perform(){return C(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield h1();yield this.checkForVideo(i.mediaStreamTrack),n.localParticipant.publishTrack(i),yield new Promise(o=>setTimeout(o,5e3));const r=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!r)throw new Error("Could not get RTCStats");let s=0;if(r.forEach(o=>{o.type==="outbound-rtp"&&(o.kind==="video"||!o.kind&&o.mediaType==="video")&&(s+=o.packetsSent)}),s===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(s," video packets"))})}checkForVideo(e){return C(this,void 0,void 0,function*(){const n=new MediaStream;n.addTrack(e.clone());const i=document.createElement("video");i.srcObject=n,i.muted=!0,i.autoplay=!0,i.playsInline=!0,i.setAttribute("playsinline","true"),document.body.appendChild(i),yield new Promise(r=>{i.onplay=()=>{setTimeout(()=>{var s,o,a,l;const c=document.createElement("canvas"),u=e.getSettings(),d=(o=(s=u.width)!==null&&s!==void 0?s:i.videoWidth)!==null&&o!==void 0?o:1280,h=(l=(a=u.height)!==null&&a!==void 0?a:i.videoHeight)!==null&&l!==void 0?l:720;c.width=d,c.height=h;const f=c.getContext("2d");f.drawImage(i,0,0);const g=f.getImageData(0,0,c.width,c.height).data;let y=!0;for(let p=0;p<g.length;p+=4)if(g[p]!==0||g[p+1]!==0||g[p+2]!==0){y=!1;break}y?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),r()},1e3)},i.play()}),n.getTracks().forEach(r=>r.stop()),i.remove()})}}class C1 extends mi{get description(){return"Resuming connection after interruption"}perform(){return C(this,void 0,void 0,function*(){var e;const n=yield this.connect();let i=!1,r=!1,s;const o=new Promise(c=>{setTimeout(c,5e3),s=c}),a=()=>{i=!0};n.on(D.SignalReconnecting,a).on(D.Reconnecting,a).on(D.Reconnected,()=>{r=!0,s(!0)}),(e=n.engine.client.ws)===null||e===void 0||e.close();const l=n.engine.client.onClose;if(l&&l(""),yield o,i){if(!r||n.state!==ee.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class b1 extends mi{get description(){return"Can connect via TURN"}perform(){return C(this,void 0,void 0,function*(){var e,n,i;Nr(new URL(this.url))&&(this.appendMessage("Using region specific url"),this.url=(e=yield new X(this.url,this.token).getNextBestRegionUrl())!==null&&e!==void 0?e:this.url);const r=new Vh,s=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3},void 0,!0);let o=!1,a=!1,l=!1;for(let c of s.iceServers)for(let u of c.urls)u.startsWith("turn:")?(a=!0,l=!0):u.startsWith("turns:")&&(a=!0,l=!0,o=!0),u.startsWith("stun:")&&(l=!0);l?a&&!o&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield r.close(),!((i=(n=this.connectOptions)===null||n===void 0?void 0:n.rtcConfig)===null||i===void 0)&&i.iceServers||a?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(c=>setTimeout(c,0)))})}}class w1 extends mi{get description(){return"Establishing WebRTC connection"}perform(){return C(this,void 0,void 0,function*(){let e=!1,n=!1;this.room.on(D.SignalConnected,()=>{var i;const r=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(s,o)=>{if(s.candidate){const a=new RTCIceCandidate(s);let l="".concat(a.protocol," ").concat(a.address,":").concat(a.port," ").concat(a.type);a.address&&(E1(a.address)?l+=" (private)":a.protocol==="tcp"&&a.tcpType==="passive"?(e=!0,l+=" (passive)"):a.protocol==="udp"&&(n=!0)),this.appendMessage(l)}r&&r(s,o)},!((i=this.room.engine.pcManager)===null||i===void 0)&&i.subscriber&&(this.room.engine.pcManager.subscriber.onIceCandidateError=s=>{s instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(s.errorCode," ").concat(s.errorText," ").concat(s.url))})});try{yield this.connect(),H.info("now the room is connected")}catch(i){throw this.appendWarning("ports need to be open on firewall in order to connect."),i}e||this.appendWarning("Server is not configured for ICE/TCP"),n||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function E1(t){const e=t.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const n=parseInt(e[1],10);if(n>=16&&n<=31)return!0}}return!1}class P1 extends mi{get description(){return"Connecting to signal connection via WebSocket"}perform(){return C(this,void 0,void 0,function*(){var e,n,i;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let r=new Vh,s;try{s=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3},void 0,!0)}catch(o){if(Nr(new URL(this.url))){this.appendMessage("Initial connection failed with error ".concat(o.message,". Retrying with region fallback"));const l=yield new X(this.url,this.token).getNextBestRegionUrl();l&&(s=yield r.join(l,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3},void 0,!0),this.appendMessage("Fallback to region worked. To avoid initial connections failing, ensure you're calling room.prepareConnection() ahead of time"))}}s?(this.appendMessage("Connected to server, version ".concat(s.serverVersion,".")),((e=s.serverInfo)===null||e===void 0?void 0:e.edition)===$0.Cloud&&(!((n=s.serverInfo)===null||n===void 0)&&n.region)&&this.appendMessage("LiveKit Cloud: ".concat((i=s.serverInfo)===null||i===void 0?void 0:i.region))):this.appendError("Websocket connection could not be established"),yield r.close()})}}class FM extends cn.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=n,this.options=i}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:Vt.IDLE,name:"",description:""}),e}updateCheck(e,n){this.checkResults.set(e,n),this.emit("checkUpdate",e,n)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==Vt.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return C(this,void 0,void 0,function*(){const n=this.getNextCheckId(),i=new e(this.url,this.token,this.options),r=o=>{this.updateCheck(n,o)};i.on("update",r);const s=yield i.run();return i.off("update",r),s})}checkWebsocket(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(P1)})}checkWebRTC(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(w1)})}checkTURN(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(b1)})}checkReconnect(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(C1)})}checkPublishAudio(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(S1)})}checkPublishVideo(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(T1)})}checkConnectionProtocol(){return C(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck(k1);if(e.data&&"protocol"in e.data){const n=e.data;this.options.protocol=n.protocol}return e})}checkCloudRegion(){return C(this,void 0,void 0,function*(){return this.createAndRunCheck(y1)})}}function J(t,e,n){return(e=R1(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _1(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function R1(t){var e=_1(t,"string");return typeof e=="symbol"?e:e+""}new TextEncoder;new TextDecoder;class rt extends Error{constructor(e,n){var i;super(e,n),J(this,"code","ERR_JOSE_GENERIC"),this.name=this.constructor.name,(i=Error.captureStackTrace)===null||i===void 0||i.call(Error,this,this.constructor)}}J(rt,"code","ERR_JOSE_GENERIC");class x1 extends rt{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:i,reason:r,payload:n}}),J(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED"),J(this,"claim",void 0),J(this,"reason",void 0),J(this,"payload",void 0),this.claim=i,this.reason=r,this.payload=n}}J(x1,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class I1 extends rt{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:i,reason:r,payload:n}}),J(this,"code","ERR_JWT_EXPIRED"),J(this,"claim",void 0),J(this,"reason",void 0),J(this,"payload",void 0),this.claim=i,this.reason=r,this.payload=n}}J(I1,"code","ERR_JWT_EXPIRED");class D1 extends rt{constructor(){super(...arguments),J(this,"code","ERR_JOSE_ALG_NOT_ALLOWED")}}J(D1,"code","ERR_JOSE_ALG_NOT_ALLOWED");class M1 extends rt{constructor(){super(...arguments),J(this,"code","ERR_JOSE_NOT_SUPPORTED")}}J(M1,"code","ERR_JOSE_NOT_SUPPORTED");class A1 extends rt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"decryption operation failed",n=arguments.length>1?arguments[1]:void 0;super(e,n),J(this,"code","ERR_JWE_DECRYPTION_FAILED")}}J(A1,"code","ERR_JWE_DECRYPTION_FAILED");class O1 extends rt{constructor(){super(...arguments),J(this,"code","ERR_JWE_INVALID")}}J(O1,"code","ERR_JWE_INVALID");class L1 extends rt{constructor(){super(...arguments),J(this,"code","ERR_JWS_INVALID")}}J(L1,"code","ERR_JWS_INVALID");class N1 extends rt{constructor(){super(...arguments),J(this,"code","ERR_JWT_INVALID")}}J(N1,"code","ERR_JWT_INVALID");class F1 extends rt{constructor(){super(...arguments),J(this,"code","ERR_JWK_INVALID")}}J(F1,"code","ERR_JWK_INVALID");class U1 extends rt{constructor(){super(...arguments),J(this,"code","ERR_JWKS_INVALID")}}J(U1,"code","ERR_JWKS_INVALID");class j1 extends rt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"no applicable key found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(e,n),J(this,"code","ERR_JWKS_NO_MATCHING_KEY")}}J(j1,"code","ERR_JWKS_NO_MATCHING_KEY");class V1 extends rt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"multiple matching keys found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(e,n),J(this,Symbol.asyncIterator,void 0),J(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}}J(V1,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");class B1 extends rt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"request timed out",n=arguments.length>1?arguments[1]:void 0;super(e,n),J(this,"code","ERR_JWKS_TIMEOUT")}}J(B1,"code","ERR_JWKS_TIMEOUT");class z1 extends rt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"signature verification failed",n=arguments.length>1?arguments[1]:void 0;super(e,n),J(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}J(z1,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");function bn(){return bn=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)({}).hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},bn.apply(null,arguments)}const Wm=new Uint8Array(0);class so{static getFullOptions(e){return bn({clientTools:{},onConnect:()=>{},onDebug:()=>{},onDisconnect:()=>{},onError:()=>{},onMessage:()=>{},onAudio:()=>{},onModeChange:()=>{},onStatusChange:()=>{},onCanSendFeedbackChange:()=>{},onInterruption:()=>{}},e)}constructor(e,n){var i=this;this.options=void 0,this.connection=void 0,this.lastInterruptTimestamp=0,this.mode="listening",this.status="connecting",this.volume=1,this.currentEventId=1,this.lastFeedbackEventId=0,this.canSendFeedback=!1,this.endSessionWithDetails=async function(r){i.status!=="connected"&&i.status!=="connecting"||(i.updateStatus("disconnecting"),await i.handleEndSession(),i.updateStatus("disconnected"),i.options.onDisconnect&&i.options.onDisconnect(r))},this.onMessage=async function(r){switch(r.type){case"interruption":return void i.handleInterruption(r);case"agent_response":return void i.handleAgentResponse(r);case"user_transcript":return void i.handleUserTranscript(r);case"internal_tentative_agent_response":return void i.handleTentativeAgentResponse(r);case"client_tool_call":try{await i.handleClientToolCall(r)}catch(s){i.onError(`Unexpected error in client tool call handling: ${s instanceof Error?s.message:String(s)}`,{clientToolName:r.client_tool_call.tool_name,toolCallId:r.client_tool_call.tool_call_id})}return;case"audio":return void i.handleAudio(r);case"vad_score":return void i.handleVadScore(r);case"ping":return void i.connection.sendMessage({type:"pong",event_id:r.ping_event.event_id});case"mcp_tool_call":return void i.handleMCPToolCall(r);case"mcp_connection_status":return void i.handleMCPConnectionStatus(r);case"agent_tool_request":return void i.handleAgentToolRequest(r);case"agent_tool_response":return void i.handleAgentToolResponse(r);case"conversation_initiation_metadata":return void i.handleConversationMetadata(r);case"asr_initiation_metadata":return void i.handleAsrInitiationMetadata(r);case"agent_chat_response_part":return void i.handleAgentChatResponsePart(r);case"error":return void i.handleErrorEvent(r);default:return void(i.options.onDebug&&i.options.onDebug(r))}},this.setVolume=({volume:r})=>{this.volume=r},this.options=e,this.connection=n,this.options.onConnect&&this.options.onConnect({conversationId:n.conversationId}),this.connection.onMessage(this.onMessage),this.connection.onDisconnect(this.endSessionWithDetails),this.connection.onModeChange(r=>this.updateMode(r)),this.updateStatus("connected")}endSession(){return this.endSessionWithDetails({reason:"user"})}async handleEndSession(){this.connection.close()}updateMode(e){e!==this.mode&&(this.mode=e,this.options.onModeChange&&this.options.onModeChange({mode:e}))}updateStatus(e){e!==this.status&&(this.status=e,this.options.onStatusChange&&this.options.onStatusChange({status:e}))}updateCanSendFeedback(){const e=this.currentEventId!==this.lastFeedbackEventId;this.canSendFeedback!==e&&(this.canSendFeedback=e,this.options.onCanSendFeedbackChange&&this.options.onCanSendFeedbackChange({canSendFeedback:e}))}handleInterruption(e){e.interruption_event&&(this.lastInterruptTimestamp=e.interruption_event.event_id,this.options.onInterruption&&this.options.onInterruption({event_id:e.interruption_event.event_id}))}handleAgentResponse(e){this.options.onMessage&&this.options.onMessage({source:"ai",role:"agent",message:e.agent_response_event.agent_response})}handleUserTranscript(e){this.options.onMessage&&this.options.onMessage({source:"user",role:"user",message:e.user_transcription_event.user_transcript})}handleTentativeAgentResponse(e){this.options.onDebug&&this.options.onDebug({type:"tentative_agent_response",response:e.tentative_agent_response_internal_event.tentative_agent_response})}handleVadScore(e){this.options.onVadScore&&this.options.onVadScore({vadScore:e.vad_score_event.vad_score})}async handleClientToolCall(e){if(Object.prototype.hasOwnProperty.call(this.options.clientTools,e.client_tool_call.tool_name))try{var n;const i=(n=await this.options.clientTools[e.client_tool_call.tool_name](e.client_tool_call.parameters))!=null?n:"Client tool execution successful.",r=typeof i=="object"?JSON.stringify(i):String(i);this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:r,is_error:!1})}catch(i){this.onError(`Client tool execution failed with following error: ${i==null?void 0:i.message}`,{clientToolName:e.client_tool_call.tool_name}),this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:`Client tool execution failed: ${i==null?void 0:i.message}`,is_error:!0})}else{if(this.options.onUnhandledClientToolCall)return void this.options.onUnhandledClientToolCall(e.client_tool_call);this.onError(`Client tool with name ${e.client_tool_call.tool_name} is not defined on client`,{clientToolName:e.client_tool_call.tool_name}),this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:`Client tool with name ${e.client_tool_call.tool_name} is not defined on client`,is_error:!0})}}handleAudio(e){}handleMCPToolCall(e){this.options.onMCPToolCall&&this.options.onMCPToolCall(e.mcp_tool_call)}handleMCPConnectionStatus(e){this.options.onMCPConnectionStatus&&this.options.onMCPConnectionStatus(e.mcp_connection_status)}handleAgentToolRequest(e){this.options.onAgentToolRequest&&this.options.onAgentToolRequest(e.agent_tool_request)}handleAgentToolResponse(e){e.agent_tool_response.tool_name==="end_call"&&this.endSessionWithDetails({reason:"agent",context:new CloseEvent("end_call",{reason:"Agent ended the call"})}),this.options.onAgentToolResponse&&this.options.onAgentToolResponse(e.agent_tool_response)}handleConversationMetadata(e){this.options.onConversationMetadata&&this.options.onConversationMetadata(e.conversation_initiation_metadata_event)}handleAsrInitiationMetadata(e){this.options.onAsrInitiationMetadata&&this.options.onAsrInitiationMetadata(e.asr_initiation_metadata_event)}handleAgentChatResponsePart(e){this.options.onAgentChatResponsePart&&this.options.onAgentChatResponsePart(e.text_response_part)}handleErrorEvent(e){const n=e.error_event.error_type,i=e.error_event.message||e.error_event.reason||"Unknown error";n!=="max_duration_exceeded"?this.onError(`Server error: ${i}`,{errorType:n,code:e.error_event.code,debugMessage:e.error_event.debug_message,details:e.error_event.details}):this.endSessionWithDetails({reason:"error",message:i,context:new Event("max_duration_exceeded")})}onError(e,n){console.error(e,n),this.options.onError&&this.options.onError(e,n)}getId(){return this.connection.conversationId}isOpen(){return this.status==="connected"}setMicMuted(e){this.connection.setMicMuted(e)}getInputByteFrequencyData(){return Wm}getOutputByteFrequencyData(){return Wm}getInputVolume(){return 0}getOutputVolume(){return 0}sendFeedback(e){this.canSendFeedback?(this.connection.sendMessage({type:"feedback",score:e?"like":"dislike",event_id:this.currentEventId}),this.lastFeedbackEventId=this.currentEventId,this.updateCanSendFeedback()):console.warn(this.lastFeedbackEventId===0?"Cannot send feedback: the conversation has not started yet.":"Cannot send feedback: feedback has already been sent for the current response.")}sendContextualUpdate(e){this.connection.sendMessage({type:"contextual_update",text:e})}sendUserMessage(e){this.connection.sendMessage({type:"user_message",text:e})}sendUserActivity(){this.connection.sendMessage({type:"user_activity"})}sendMCPToolApprovalResult(e,n){this.connection.sendMessage({type:"mcp_tool_approval_result",tool_call_id:e,is_approved:n})}}let uS=class{constructor(e={}){this.queue=[],this.disconnectionDetails=null,this.onDisconnectCallback=null,this.onMessageCallback=null,this.onModeChangeCallback=null,this.onDebug=void 0,this.onDebug=e.onDebug}debug(e){this.onDebug&&this.onDebug(e)}onMessage(e){this.onMessageCallback=e;const n=this.queue;this.queue=[],n.length>0&&queueMicrotask(()=>{n.forEach(e)})}onDisconnect(e){this.onDisconnectCallback=e;const n=this.disconnectionDetails;n&&queueMicrotask(()=>{e(n)})}onModeChange(e){this.onModeChangeCallback=e}updateMode(e){var n;(n=this.onModeChangeCallback)==null||n.call(this,e)}disconnect(e){var n;this.disconnectionDetails||(this.disconnectionDetails=e,(n=this.onDisconnectCallback)==null||n.call(this,e))}handleMessage(e){this.onMessageCallback?this.onMessageCallback(e):this.queue.push(e)}};function el(t){const[e,n]=t.split("_");if(!["pcm","ulaw"].includes(e))throw new Error(`Invalid format: ${t}`);const i=Number.parseInt(n);if(Number.isNaN(i))throw new Error(`Invalid sample rate: ${n}`);return{format:e,sampleRate:i}}const dS="0.13.0";function ld(t){return!!t.type}const hS="conversation_initiation_client_data";function fS(t){var e;const n={type:hS};var i,r,s,o,a,l,c,u;return t.overrides&&(n.conversation_config_override={agent:{prompt:(i=t.overrides.agent)==null?void 0:i.prompt,first_message:(r=t.overrides.agent)==null?void 0:r.firstMessage,language:(s=t.overrides.agent)==null?void 0:s.language},tts:{voice_id:(o=t.overrides.tts)==null?void 0:o.voiceId,speed:(a=t.overrides.tts)==null?void 0:a.speed,stability:(l=t.overrides.tts)==null?void 0:l.stability,similarity_boost:(c=t.overrides.tts)==null?void 0:c.similarityBoost},conversation:{text_only:(u=t.overrides.conversation)==null?void 0:u.textOnly}}),t.customLlmExtraBody&&(n.custom_llm_extra_body=t.customLlmExtraBody),t.dynamicVariables&&(n.dynamic_variables=t.dynamicVariables),t.userId&&(n.user_id=t.userId),(e=t.overrides)!=null&&e.client&&(n.source_info={source:t.overrides.client.source,version:t.overrides.client.version}),n}let qm=class extends Error{constructor(e,n){super(e),this.closeCode=void 0,this.closeReason=void 0,this.name="SessionConnectionError",this.closeCode=n==null?void 0:n.closeCode,this.closeReason=n==null?void 0:n.closeReason}},cd=class pS extends uS{constructor(e,n,i,r){super(),this.socket=void 0,this.conversationId=void 0,this.inputFormat=void 0,this.outputFormat=void 0,this.socket=e,this.conversationId=n,this.inputFormat=i,this.outputFormat=r,this.socket.addEventListener("error",s=>{setTimeout(()=>this.disconnect({reason:"error",message:"The connection was closed due to a socket error.",context:s}),0)}),this.socket.addEventListener("close",s=>{this.disconnect(s.code===1e3?{reason:"agent",context:s,closeCode:s.code,closeReason:s.reason||void 0}:{reason:"error",message:s.reason||"The connection was closed by the server.",context:s,closeCode:s.code,closeReason:s.reason||void 0})}),this.socket.addEventListener("message",s=>{try{const o=JSON.parse(s.data);if(!ld(o))return void this.debug({type:"invalid_event",message:"Received invalid socket event",data:s.data});this.handleMessage(o)}catch(o){this.debug({type:"parsing_error",message:"Failed to parse socket message",error:o instanceof Error?o.message:String(o),data:s.data})}})}static async create(e){let n=null;try{var i,r,s;const a=(i=e.origin)!=null?i:"wss://api.elevenlabs.io";let l;const c=((r=e.overrides)==null||(r=r.client)==null?void 0:r.version)||dS,u=((s=e.overrides)==null||(s=s.client)==null?void 0:s.source)||"js_sdk";if(e.signedUrl){const m=e.signedUrl.includes("?")?"&":"?";l=`${e.signedUrl}${m}source=${u}&version=${c}`}else l=`${a}/v1/convai/conversation?agent_id=${e.agentId}&source=${u}&version=${c}`;const d=["convai"];e.authorization&&d.push(`bearer.${e.authorization}`),n=new WebSocket(l,d);const h=await new Promise((m,k)=>{n.addEventListener("open",()=>{var S;const T=fS(e);(S=n)==null||S.send(JSON.stringify(T))},{once:!0}),n.addEventListener("error",S=>{setTimeout(()=>k(new qm("The connection was closed due to a socket error.")),0)}),n.addEventListener("close",S=>{k(new qm(S.reason||(S.code===1e3?"Connection closed normally before session could be established.":"Connection closed unexpectedly before session could be established."),{closeCode:S.code,closeReason:S.reason||void 0}))}),n.addEventListener("message",S=>{const T=JSON.parse(S.data);ld(T)&&(T.type==="conversation_initiation_metadata"?m(T.conversation_initiation_metadata_event):console.warn("First received message is not conversation metadata."))},{once:!0})}),{conversation_id:f,agent_output_audio_format:v,user_input_audio_format:g}=h,y=el(g??"pcm_16000"),p=el(v);return new pS(n,f,y,p)}catch(a){var o;throw(o=n)==null||o.close(),a}}close(){this.socket.close(1e3,"User ended conversation")}sendMessage(e){this.socket.send(JSON.stringify(e))}async setMicMuted(e){console.warn(`WebSocket connection setMicMuted called with ${e}, but this is handled by VoiceConversation`)}};function mS(t){const e=new Uint8Array(t);return window.btoa(String.fromCharCode(...e))}function W1(t){const e=window.atob(t),n=e.length,i=new Uint8Array(n);for(let r=0;r<n;r++)i[r]=e.charCodeAt(r);return i.buffer}const Bo=new Map;function gS(t,e){return async(n,i)=>{const r=Bo.get(t);if(r)return n.addModule(r);if(i)try{return await n.addModule(i),void Bo.set(t,i)}catch(a){throw new Error(`Failed to load the ${t} worklet module from path: ${i}. Error: ${a}`)}const s=new Blob([e],{type:"application/javascript"}),o=URL.createObjectURL(s);try{return await n.addModule(o),void Bo.set(t,o)}catch{URL.revokeObjectURL(o)}try{const a=`data:application/javascript;base64,${btoa(e)}`;await n.addModule(a),Bo.set(t,a)}catch{throw new Error(`Failed to load the ${t} worklet module. Make sure the browser supports AudioWorklets. If you are using a strict CSP, you may need to self-host the worklet files.`)}}}const vS=gS("rawAudioProcessor",`/*
 * ulaw encoding logic taken from the wavefile library
 * https://github.com/rochars/wavefile/blob/master/lib/codecs/mulaw.js
 * USED BY @elevenlabs/client
 */

const BIAS = 0x84;
const CLIP = 32635;
const encodeTable = [
  0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,
  4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,
  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,
  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7
];

function encodeSample(sample) {
  let sign;
  let exponent;
  let mantissa;
  let muLawSample;
  sign = (sample >> 8) & 0x80;
  if (sign !== 0) sample = -sample;
  sample = sample + BIAS;
  if (sample > CLIP) sample = CLIP;
  exponent = encodeTable[(sample>>7) & 0xFF];
  mantissa = (sample >> (exponent+3)) & 0x0F;
  muLawSample = ~(sign | (exponent << 4) | mantissa);
  
  return muLawSample;
}

class RawAudioProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
              
    this.port.onmessage = ({ data }) => {
      switch (data.type) {
        case "setFormat":
          this.isMuted = false;
          this.buffer = []; // Initialize an empty buffer
          this.bufferSize = data.sampleRate / 4;
          this.format = data.format;

          if (globalThis.LibSampleRate && sampleRate !== data.sampleRate) {
            globalThis.LibSampleRate.create(1, sampleRate, data.sampleRate).then(resampler => {
              this.resampler = resampler;
            });
          }
          break;
        case "setMuted":
          this.isMuted = data.isMuted;
          break;
      }
    };
  }
  process(inputs) {
    if (!this.buffer) {
      return true;
    }
    
    const input = inputs[0]; // Get the first input node
    if (input.length > 0) {
      let channelData = input[0]; // Get the first channel's data

      // Resample the audio if necessary
      if (this.resampler) {
        channelData = this.resampler.full(channelData);
      }

      // Add channel data to the buffer
      this.buffer.push(...channelData);
      // Get max volume 
      let sum = 0.0;
      for (let i = 0; i < channelData.length; i++) {
        sum += channelData[i] * channelData[i];
      }
      const maxVolume = Math.sqrt(sum / channelData.length);
      // Check if buffer size has reached or exceeded the threshold
      if (this.buffer.length >= this.bufferSize) {
        const float32Array = this.isMuted 
          ? new Float32Array(this.buffer.length)
          : new Float32Array(this.buffer);

        let encodedArray = this.format === "ulaw"
          ? new Uint8Array(float32Array.length)
          : new Int16Array(float32Array.length);

        // Iterate through the Float32Array and convert each sample to PCM16
        for (let i = 0; i < float32Array.length; i++) {
          // Clamp the value to the range [-1, 1]
          let sample = Math.max(-1, Math.min(1, float32Array[i]));

          // Scale the sample to the range [-32768, 32767]
          let value = sample < 0 ? sample * 32768 : sample * 32767;
          if (this.format === "ulaw") {
            value = encodeSample(Math.round(value));
          }

          encodedArray[i] = value;
        }

        // Send the buffered data to the main script
        this.port.postMessage([encodedArray, maxVolume]);

        // Clear the buffer after sending
        this.buffer = [];
      }
    }
    return true; // Continue processing
  }
}
registerProcessor("rawAudioProcessor", RawAudioProcessor);
`);class gn extends uS{constructor(e,n,i,r,s={}){super(s),this.conversationId=void 0,this.inputFormat=void 0,this.outputFormat=void 0,this.room=void 0,this.isConnected=!1,this.audioEventId=1,this.audioCaptureContext=null,this.audioElements=[],this.outputDeviceId=null,this.outputAnalyser=null,this.outputFrequencyData=null,this.room=e,this.conversationId=n,this.inputFormat=i,this.outputFormat=r,this.setupRoomEventListeners()}static async create(e){let n;if("conversationToken"in e&&e.conversationToken)n=e.conversationToken;else{if(!("agentId"in e)||!e.agentId)throw new Error("Either conversationToken or agentId is required for WebRTC connection");try{var i,r,s;const c=((i=e.overrides)==null||(i=i.client)==null?void 0:i.version)||dS,u=((r=e.overrides)==null||(r=r.client)==null?void 0:r.source)||"js_sdk",d=`${o=(s=e.origin)!=null?s:"https://api.elevenlabs.io",o.replace(/^wss:\/\//,"https://")}/v1/convai/conversation/token?agent_id=${e.agentId}&source=${u}&version=${c}`,h=await fetch(d);if(!h.ok)throw new Error(`ElevenLabs API returned ${h.status} ${h.statusText}`);if(n=(await h.json()).token,!n)throw new Error("No conversation token received from API")}catch(c){let u=c instanceof Error?c.message:String(c);throw c instanceof Error&&c.message.includes("401")&&(u="Your agent has authentication enabled, but no signed URL or conversation token was provided."),new Error(`Failed to fetch conversation token for agent ${e.agentId}: ${u}`)}}var o;const a=new Fr;try{const c=`room_${Date.now()}`,u=el("pcm_48000"),d=el("pcm_48000"),h=new gn(a,c,u,d,e),f=e.livekitUrl||"wss://livekit.rtc.elevenlabs.io";var l;await a.connect(f,n),await new Promise(g=>{if(h.isConnected)g();else{const y=()=>{a.off(D.Connected,y),g()};a.on(D.Connected,y)}}),a.name&&(h.conversationId=((l=a.name.match(/(conv_[a-zA-Z0-9]+)/))==null?void 0:l[0])||a.name),e.textOnly||await a.localParticipant.setMicrophoneEnabled(!0);const v=fS(e);return h.debug({type:hS,message:v}),await h.sendMessage(v),h}catch(c){throw await a.disconnect(),c}}setupRoomEventListeners(){var e=this;this.room.on(D.Connected,async function(){e.isConnected=!0,console.info("WebRTC room connected")}),this.room.on(D.Disconnected,n=>{this.isConnected=!1,this.disconnect({reason:"agent",context:new CloseEvent("close",{reason:n==null?void 0:n.toString()})})}),this.room.on(D.ConnectionStateChanged,n=>{n===ee.Disconnected&&(this.isConnected=!1,this.disconnect({reason:"error",message:`LiveKit connection state changed to ${n}`,context:new Event("connection_state_changed")}))}),this.room.on(D.DataReceived,(n,i)=>{try{const r=JSON.parse(new TextDecoder().decode(n));if(r.type==="audio")return;ld(r)?this.handleMessage(r):console.warn("Invalid socket event received:",r)}catch(r){console.warn("Failed to parse incoming data message:",r),console.warn("Raw payload:",new TextDecoder().decode(n))}}),this.room.on(D.TrackSubscribed,async function(n,i,r){if(n.kind===R.Kind.Audio&&r.identity.includes("agent")){const s=n,o=s.attach();if(o.autoplay=!0,o.controls=!1,e.outputDeviceId&&o.setSinkId)try{await o.setSinkId(e.outputDeviceId)}catch(a){console.warn("Failed to set output device for new audio element:",a)}o.style.display="none",document.body.appendChild(o),e.audioElements.push(o),e.audioElements.length===1&&(e.onDebug==null||e.onDebug({type:"audio_element_ready"})),await e.setupAudioCapture(s)}}),this.room.on(D.ActiveSpeakersChanged,async function(n){e.updateMode(n.length>0&&n[0].identity.startsWith("agent")?"speaking":"listening")}),this.room.on(D.ParticipantDisconnected,n=>{var i;(i=n.identity)!=null&&i.startsWith("agent")&&this.disconnect({reason:"agent",context:new CloseEvent("close",{reason:"agent disconnected"})})})}close(){if(this.isConnected){try{this.room.localParticipant.audioTrackPublications.forEach(e=>{e.track&&e.track.stop()})}catch(e){console.warn("Error stopping local tracks:",e)}this.audioCaptureContext&&(this.audioCaptureContext.close().catch(e=>{console.warn("Error closing audio capture context:",e)}),this.audioCaptureContext=null),this.audioElements.forEach(e=>{e.parentNode&&e.parentNode.removeChild(e)}),this.audioElements=[],this.room.disconnect()}}async sendMessage(e){if(this.isConnected&&this.room.localParticipant){if(!("user_audio_chunk"in e))try{const n=new TextEncoder().encode(JSON.stringify(e));await this.room.localParticipant.publishData(n,{reliable:!0})}catch(n){this.debug({type:"send_message_error",message:{message:e,error:n}}),console.error("Failed to send message via WebRTC:",n)}}else console.warn("Cannot send message: room not connected or no local participant")}getRoom(){return this.room}async setMicMuted(e){if(!this.isConnected||!this.room.localParticipant)return void console.warn("Cannot set microphone muted: room not connected or no local participant");const n=this.room.localParticipant.getTrackPublication(R.Source.Microphone);if(n!=null&&n.track)try{e?await n.track.mute():await n.track.unmute()}catch{await this.room.localParticipant.setMicrophoneEnabled(!e)}else await this.room.localParticipant.setMicrophoneEnabled(!e)}async setupAudioCapture(e){try{const n=new AudioContext;this.audioCaptureContext=n,this.outputAnalyser=n.createAnalyser(),this.outputAnalyser.fftSize=2048,this.outputAnalyser.smoothingTimeConstant=.8;const i=new MediaStream([e.mediaStreamTrack]),r=n.createMediaStreamSource(i);r.connect(this.outputAnalyser),await vS(n.audioWorklet);const s=new AudioWorkletNode(n,"rawAudioProcessor");this.outputAnalyser.connect(s),s.port.postMessage({type:"setFormat",format:this.outputFormat.format,sampleRate:this.outputFormat.sampleRate}),s.port.onmessage=o=>{const[a,l]=o.data;if(l>.01){const c=mS(a.buffer),u=this.audioEventId++;this.handleMessage({type:"audio",audio_event:{audio_base_64:c,event_id:u}})}},r.connect(s)}catch(n){console.warn("Failed to set up audio capture:",n)}}setAudioVolume(e){this.audioElements.forEach(n=>{n.volume=e})}async setAudioOutputDevice(e){if(!("setSinkId"in HTMLAudioElement.prototype))throw new Error("setSinkId is not supported in this browser");const n=this.audioElements.map(async function(i){try{await i.setSinkId(e)}catch(r){throw console.error("Failed to set sink ID for audio element:",r),r}});await Promise.all(n),this.outputDeviceId=e}async setAudioInputDevice(e){if(!this.isConnected||!this.room.localParticipant)throw new Error("Cannot change input device: room not connected or no local participant");try{const n=this.room.localParticipant.getTrackPublication(R.Source.Microphone);n!=null&&n.track&&(await n.track.stop(),await this.room.localParticipant.unpublishTrack(n.track));const i={deviceId:{exact:e},echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,channelCount:{ideal:1}},r=await aS(i);await this.room.localParticipant.publishTrack(r,{name:"microphone",source:R.Source.Microphone})}catch(n){console.error("Failed to change input device:",n);try{await this.room.localParticipant.setMicrophoneEnabled(!0)}catch(i){console.error("Failed to recover microphone after device switch error:",i)}throw n}}getOutputByteFrequencyData(){return this.outputAnalyser?(this.outputFrequencyData!=null||(this.outputFrequencyData=new Uint8Array(this.outputAnalyser.frequencyBinCount)),this.outputAnalyser.getByteFrequencyData(this.outputFrequencyData),this.outputFrequencyData):null}}async function yS(t){const e=function(n){return n.connectionType?n.connectionType:"conversationToken"in n&&n.conversationToken?"webrtc":"websocket"}(t);switch(e){case"websocket":return cd.create(t);case"webrtc":return gn.create(t);default:throw new Error(`Unknown connection type: ${e}`)}}function ud(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}async function kS(t={default:0,android:3e3}){let e=t.default;var n;if(/android/i.test(navigator.userAgent))e=(n=t.android)!=null?n:e;else if(ud()){var i;e=(i=t.ios)!=null?i:e}e>0&&await new Promise(r=>setTimeout(r,e))}class $h extends so{static async startSession(e){const n=so.getFullOptions(e);n.onStatusChange&&n.onStatusChange({status:"connecting"}),n.onCanSendFeedbackChange&&n.onCanSendFeedbackChange({canSendFeedback:!1}),n.onModeChange&&n.onModeChange({mode:"listening"}),n.onCanSendFeedbackChange&&n.onCanSendFeedbackChange({canSendFeedback:!1});let i=null;try{return await kS(n.connectionDelay),i=await yS(e),new $h(n,i)}catch(s){var r;throw n.onStatusChange&&n.onStatusChange({status:"disconnected"}),(r=i)==null||r.close(),s}}}const Km={echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,channelCount:{ideal:1}};class _r{static async create({sampleRate:e,format:n,preferHeadphonesForIosDevices:i,inputDeviceId:r,workletPaths:s,libsampleratePath:o}){let a=null,l=null;try{const d=bn({sampleRate:{ideal:e}},Km);if(ud()&&i){const p=(await window.navigator.mediaDevices.enumerateDevices()).find(m=>m.kind==="audioinput"&&["airpod","headphone","earphone"].find(k=>m.label.toLowerCase().includes(k)));p&&(d.deviceId={ideal:p.deviceId})}r&&(d.deviceId=_r.getDeviceIdConstraint(r));const h=navigator.mediaDevices.getSupportedConstraints().sampleRate;a=new window.AudioContext(h?{sampleRate:e}:{});const f=a.createAnalyser();if(!h){const p=o||"https://cdn.jsdelivr.net/npm/@alexanderolsen/libsamplerate-js@2.1.2/dist/libsamplerate.worklet.js";await a.audioWorklet.addModule(p)}await vS(a.audioWorklet,s==null?void 0:s.rawAudioProcessor);const v=bn({voiceIsolation:!0},d);l=await navigator.mediaDevices.getUserMedia({audio:v});const g=a.createMediaStreamSource(l),y=new AudioWorkletNode(a,"rawAudioProcessor");return y.port.postMessage({type:"setFormat",format:n,sampleRate:e}),g.connect(f),f.connect(y),await a.resume(),new _r(a,f,y,l,g)}catch(d){var c,u;throw(c=l)==null||c.getTracks().forEach(h=>{h.stop()}),(u=a)==null||u.close(),d}}static getDeviceIdConstraint(e){if(e)return ud()?{ideal:e}:{exact:e}}constructor(e,n,i,r,s){this.context=void 0,this.analyser=void 0,this.worklet=void 0,this.inputStream=void 0,this.mediaStreamSource=void 0,this.context=e,this.analyser=n,this.worklet=i,this.inputStream=r,this.mediaStreamSource=s}async close(){this.inputStream.getTracks().forEach(e=>{e.stop()}),this.mediaStreamSource.disconnect(),await this.context.close()}setMuted(e){this.worklet.port.postMessage({type:"setMuted",isMuted:e})}async setInputDevice(e){try{const n=bn({},Km);e&&(n.deviceId=_r.getDeviceIdConstraint(e));const i=bn({voiceIsolation:!0},n),r=await navigator.mediaDevices.getUserMedia({audio:i});this.inputStream.getTracks().forEach(s=>{s.stop()}),this.mediaStreamSource.disconnect(),this.inputStream=r,this.mediaStreamSource=this.context.createMediaStreamSource(r),this.mediaStreamSource.connect(this.analyser)}catch(n){throw console.error("Failed to switch input device:",n),n}}}const q1=gS("audioConcatProcessor",`/*
 * ulaw decoding logic taken from the wavefile library
 * https://github.com/rochars/wavefile/blob/master/lib/codecs/mulaw.js
 * USED BY @elevenlabs/client
 */

const decodeTable = [0,132,396,924,1980,4092,8316,16764];

function decodeSample(muLawSample) {
  let sign;
  let exponent;
  let mantissa;
  let sample;
  muLawSample = ~muLawSample;
  sign = (muLawSample & 0x80);
  exponent = (muLawSample >> 4) & 0x07;
  mantissa = muLawSample & 0x0F;
  sample = decodeTable[exponent] + (mantissa << (exponent+3));
  if (sign !== 0) sample = -sample;

  return sample;
}

class AudioConcatProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
    this.buffers = []; // Initialize an empty buffer
    this.cursor = 0;
    this.currentBuffer = null;
    this.wasInterrupted = false;
    this.finished = false;
    
    this.port.onmessage = ({ data }) => {
      switch (data.type) {
        case "setFormat":
          this.format = data.format;
          break;
        case "buffer":
          this.wasInterrupted = false;
          this.buffers.push(
            this.format === "ulaw"
              ? new Uint8Array(data.buffer)
              : new Int16Array(data.buffer)
          );
          break;
        case "interrupt":
          this.wasInterrupted = true;
          break;
        case "clearInterrupted":
          if (this.wasInterrupted) {
            this.wasInterrupted = false;
            this.buffers = [];
            this.currentBuffer = null;
          }
      }
    };
  }
  process(_, outputs) {
    let finished = false;
    const output = outputs[0][0];
    for (let i = 0; i < output.length; i++) {
      if (!this.currentBuffer) {
        if (this.buffers.length === 0) {
          finished = true;
          break;
        }
        this.currentBuffer = this.buffers.shift();
        this.cursor = 0;
      }

      let value = this.currentBuffer[this.cursor];
      if (this.format === "ulaw") {
        value = decodeSample(value);
      }
      output[i] = value / 32768;
      this.cursor++;

      if (this.cursor >= this.currentBuffer.length) {
        this.currentBuffer = null;
      }
    }

    if (this.finished !== finished) {
      this.finished = finished;
      this.port.postMessage({ type: "process", finished });
    }

    return true; // Continue processing
  }
}

registerProcessor("audioConcatProcessor", AudioConcatProcessor);
`);class tl{static async create({sampleRate:e,format:n,outputDeviceId:i,workletPaths:r}){let s=null,o=null;try{s=new AudioContext({sampleRate:e});const c=s.createAnalyser(),u=s.createGain();o=new Audio,o.src="",o.load(),o.autoplay=!0,o.style.display="none",document.body.appendChild(o);const d=s.createMediaStreamDestination();o.srcObject=d.stream,u.connect(c),c.connect(d),await q1(s.audioWorklet,r==null?void 0:r.audioConcatProcessor);const h=new AudioWorkletNode(s,"audioConcatProcessor");return h.port.postMessage({type:"setFormat",format:n}),h.connect(u),await s.resume(),i&&o.setSinkId&&await o.setSinkId(i),new tl(s,c,u,h,o)}catch(c){var a,l;throw(a=o)!=null&&a.parentNode&&o.parentNode.removeChild(o),(l=o)==null||l.pause(),s&&s.state!=="closed"&&await s.close(),c}}constructor(e,n,i,r,s){this.context=void 0,this.analyser=void 0,this.gain=void 0,this.worklet=void 0,this.audioElement=void 0,this.context=e,this.analyser=n,this.gain=i,this.worklet=r,this.audioElement=s}async setOutputDevice(e){if(!("setSinkId"in HTMLAudioElement.prototype))throw new Error("setSinkId is not supported in this browser");await this.audioElement.setSinkId(e||"")}async close(){this.audioElement.parentNode&&this.audioElement.parentNode.removeChild(this.audioElement),this.audioElement.pause(),await this.context.close()}}class Is extends so{static async requestWakeLock(){if("wakeLock"in navigator)try{return await navigator.wakeLock.request("screen")}catch{}return null}static async startSession(e){var n;const i=so.getFullOptions(e);i.onStatusChange&&i.onStatusChange({status:"connecting"}),i.onCanSendFeedbackChange&&i.onCanSendFeedbackChange({canSendFeedback:!1});let r=null,s=null,o=null,a=null,l=null;((n=e.useWakeLock)==null||n)&&(l=await Is.requestWakeLock());try{var c;return a=await navigator.mediaDevices.getUserMedia({audio:!0}),await kS(i.connectionDelay),s=await yS(e),[r,o]=await Promise.all([_r.create(bn({},s.inputFormat,{preferHeadphonesForIosDevices:e.preferHeadphonesForIosDevices,inputDeviceId:e.inputDeviceId,workletPaths:e.workletPaths,libsampleratePath:e.libsampleratePath})),tl.create(bn({},s.outputFormat,{outputDeviceId:e.outputDeviceId,workletPaths:e.workletPaths}))]),(c=a)==null||c.getTracks().forEach(g=>{g.stop()}),a=null,new Is(i,s,r,o,l)}catch(g){var u,d,h,f;i.onStatusChange&&i.onStatusChange({status:"disconnected"}),(u=a)==null||u.getTracks().forEach(y=>{y.stop()}),(d=s)==null||d.close(),await((h=r)==null?void 0:h.close()),await((f=o)==null?void 0:f.close());try{var v;await((v=l)==null?void 0:v.release()),l=null}catch{}throw g}}constructor(e,n,i,r,s){super(e,n),this.input=void 0,this.output=void 0,this.wakeLock=void 0,this.inputFrequencyData=void 0,this.outputFrequencyData=void 0,this.visibilityChangeHandler=null,this.onInputWorkletMessage=o=>{this.status==="connected"&&this.connection.sendMessage({user_audio_chunk:mS(o.data[0].buffer)})},this.onOutputWorkletMessage=({data:o})=>{o.type==="process"&&this.updateMode(o.finished?"listening":"speaking")},this.addAudioBase64Chunk=o=>{this.output.gain.gain.cancelScheduledValues(this.output.context.currentTime),this.output.gain.gain.value=this.volume,this.output.worklet.port.postMessage({type:"clearInterrupted"}),this.output.worklet.port.postMessage({type:"buffer",buffer:W1(o)})},this.fadeOutAudio=()=>{this.updateMode("listening"),this.output.worklet.port.postMessage({type:"interrupt"}),this.output.gain.gain.exponentialRampToValueAtTime(1e-4,this.output.context.currentTime+2),setTimeout(()=>{this.output.gain.gain.value=this.volume,this.output.worklet.port.postMessage({type:"clearInterrupted"})},2e3)},this.calculateVolume=o=>{if(o.length===0)return 0;let a=0;for(let l=0;l<o.length;l++)a+=o[l]/255;return a/=o.length,a<0?0:a>1?1:a},this.setVolume=({volume:o})=>{const a=Number.isFinite(o)?Math.min(1,Math.max(0,o)):1;this.volume=a,this.connection instanceof gn?this.connection.setAudioVolume(a):this.output.gain.gain.value=a},this.input=i,this.output=r,this.wakeLock=s,this.input.worklet.port.onmessage=this.onInputWorkletMessage,this.output.worklet.port.onmessage=this.onOutputWorkletMessage,s&&(this.visibilityChangeHandler=()=>{var o;document.visibilityState==="visible"&&(o=this.wakeLock)!=null&&o.released&&Is.requestWakeLock().then(a=>{this.wakeLock=a})},document.addEventListener("visibilitychange",this.visibilityChangeHandler))}async handleEndSession(){await super.handleEndSession(),this.visibilityChangeHandler&&document.removeEventListener("visibilitychange",this.visibilityChangeHandler);try{var e;await((e=this.wakeLock)==null?void 0:e.release()),this.wakeLock=null}catch{}await this.input.close(),await this.output.close()}handleInterruption(e){super.handleInterruption(e),this.fadeOutAudio()}handleAudio(e){var n,i;super.handleAudio(e),e.audio_event.alignment&&this.options.onAudioAlignment&&this.options.onAudioAlignment(e.audio_event.alignment),this.lastInterruptTimestamp<=e.audio_event.event_id&&(e.audio_event.audio_base_64&&((n=(i=this.options).onAudio)==null||n.call(i,e.audio_event.audio_base_64),this.connection instanceof gn||this.addAudioBase64Chunk(e.audio_event.audio_base_64)),this.currentEventId=e.audio_event.event_id,this.updateCanSendFeedback(),this.updateMode("speaking"))}setMicMuted(e){this.connection instanceof gn?this.connection.setMicMuted(e):this.input.setMuted(e)}getInputByteFrequencyData(){return this.inputFrequencyData!=null||(this.inputFrequencyData=new Uint8Array(this.input.analyser.frequencyBinCount)),this.input.analyser.getByteFrequencyData(this.inputFrequencyData),this.inputFrequencyData}getOutputByteFrequencyData(){return this.connection instanceof gn?this.connection.getOutputByteFrequencyData()||new Uint8Array(1024):(this.outputFrequencyData!=null||(this.outputFrequencyData=new Uint8Array(this.output.analyser.frequencyBinCount)),this.output.analyser.getByteFrequencyData(this.outputFrequencyData),this.outputFrequencyData)}getInputVolume(){return this.calculateVolume(this.getInputByteFrequencyData())}getOutputVolume(){return this.calculateVolume(this.getOutputByteFrequencyData())}async changeInputDevice({sampleRate:e,format:n,preferHeadphonesForIosDevices:i,inputDeviceId:r}){try{if(this.connection instanceof cd)try{return await this.input.setInputDevice(r),this.input}catch(o){console.warn("Failed to change device on existing input, recreating:",o)}this.connection instanceof gn&&await this.connection.setAudioInputDevice(r||""),await this.input.close();const s=await _r.create({sampleRate:e??this.connection.inputFormat.sampleRate,format:n??this.connection.inputFormat.format,preferHeadphonesForIosDevices:i,inputDeviceId:r,workletPaths:this.options.workletPaths,libsampleratePath:this.options.libsampleratePath});return this.input=s,this.input.worklet.port.onmessage=this.onInputWorkletMessage,this.input}catch(s){throw console.error("Error changing input device",s),s}}async changeOutputDevice({sampleRate:e,format:n,outputDeviceId:i}){try{if(this.connection instanceof cd)try{return await this.output.setOutputDevice(i),this.output}catch(s){console.warn("Failed to change device on existing output, recreating:",s)}this.connection instanceof gn&&await this.connection.setAudioOutputDevice(i||""),await this.output.close();const r=await tl.create({sampleRate:e??this.connection.outputFormat.sampleRate,format:n??this.connection.outputFormat.format,outputDeviceId:i,workletPaths:this.options.workletPaths});return this.output=r,this.output}catch(r){throw console.error("Error changing output device",r),r}}}var Hm;(function(t){t.SESSION_STARTED="session_started",t.PARTIAL_TRANSCRIPT="partial_transcript",t.COMMITTED_TRANSCRIPT="committed_transcript",t.COMMITTED_TRANSCRIPT_WITH_TIMESTAMPS="committed_transcript_with_timestamps",t.AUTH_ERROR="auth_error",t.ERROR="error",t.OPEN="open",t.CLOSE="close",t.QUOTA_EXCEEDED="quota_exceeded",t.COMMIT_THROTTLED="commit_throttled",t.TRANSCRIBER_ERROR="transcriber_error",t.UNACCEPTED_TERMS="unaccepted_terms",t.RATE_LIMITED="rate_limited",t.INPUT_ERROR="input_error",t.QUEUE_OVERFLOW="queue_overflow",t.RESOURCE_EXHAUSTED="resource_exhausted",t.SESSION_TIME_LIMIT_EXCEEDED="session_time_limit_exceeded",t.CHUNK_SIZE_EXCEEDED="chunk_size_exceeded",t.INSUFFICIENT_AUDIO_ACTIVITY="insufficient_audio_activity"})(Hm||(Hm={}));var Gm,$m;(function(t){t.PCM_8000="pcm_8000",t.PCM_16000="pcm_16000",t.PCM_22050="pcm_22050",t.PCM_24000="pcm_24000",t.PCM_44100="pcm_44100",t.PCM_48000="pcm_48000",t.ULAW_8000="ulaw_8000"})(Gm||(Gm={})),function(t){t.MANUAL="manual",t.VAD="vad"}($m||($m={}));class K1 extends so{static startSession(e){return e.textOnly?$h.startSession(e):Is.startSession(e)}}function Ds(){return Ds=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)({}).hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},Ds.apply(null,arguments)}const H1=["micMuted","volume","serverLocation"];function G1(t="us"){switch(t){case"eu-residency":case"in-residency":case"us":case"global":return t;default:return console.warn(`[ConversationalAI] Invalid server-location: ${t}. Defaulting to "us"`),"us"}}function $1(t){return{us:"wss://api.elevenlabs.io","eu-residency":"wss://api.eu.residency.elevenlabs.io","in-residency":"wss://api.in.residency.elevenlabs.io",global:"wss://api.elevenlabs.io"}[t]}function J1(t){return{us:"wss://livekit.rtc.elevenlabs.io","eu-residency":"wss://livekit.rtc.eu.residency.elevenlabs.io","in-residency":"wss://livekit.rtc.in.residency.elevenlabs.io",global:"wss://livekit.rtc.elevenlabs.io"}[t]}function Q1(t={}){const{micMuted:e,volume:n,serverLocation:i}=t,r=function(y,p){if(y==null)return{};var m={};for(var k in y)if({}.hasOwnProperty.call(y,k)){if(p.indexOf(k)!==-1)continue;m[k]=y[k]}return m}(t,H1),s=V.useRef(null),o=V.useRef(null),a=V.useRef(!1),[l,c]=V.useState("disconnected"),[u,d]=V.useState(!1),[h,f]=V.useState("listening"),v=V.useRef(e),g=V.useRef(n);return v.current=e,g.current=n,V.useEffect(()=>{var y;e!==void 0&&(s==null||(y=s.current)==null||y.setMicMuted(e))},[e]),V.useEffect(()=>{var y;n!==void 0&&(s==null||(y=s.current)==null||y.setVolume({volume:n}))},[n]),V.useEffect(()=>()=>{var y;a.current=!0,o.current?o.current.then(p=>p.endSession()):(y=s.current)==null||y.endSession()},[]),{startSession:async y=>{var p;if((p=s.current)!=null&&p.isOpen())return s.current.getId();if(o.current)return(await o.current).getId();a.current=!1;try{var m,k,S,T,b,P,E,I,_,L;const z=G1((y==null?void 0:y.serverLocation)||i),Y=$1(z),we=J1(z);if(o.current=K1.startSession(Ds({},r??{},y??{},{origin:Y,livekitUrl:(y==null?void 0:y.livekitUrl)||(r==null?void 0:r.livekitUrl)||we,overrides:Ds({},(m=r==null?void 0:r.overrides)!=null?m:{},(k=y==null?void 0:y.overrides)!=null?k:{},{client:Ds({},(S=r==null||(T=r.overrides)==null?void 0:T.client)!=null?S:{},(b=y==null||(P=y.overrides)==null?void 0:P.client)!=null?b:{},{source:(y==null||(E=y.overrides)==null||(E=E.client)==null?void 0:E.source)||(r==null||(I=r.overrides)==null||(I=I.client)==null?void 0:I.source)||"react_sdk",version:(y==null||(_=y.overrides)==null||(_=_.client)==null?void 0:_.version)||(r==null||(L=r.overrides)==null||(L=L.client)==null?void 0:L.version)||"0.13.0"})}),onConnect:(y==null?void 0:y.onConnect)||(r==null?void 0:r.onConnect),onDisconnect:(y==null?void 0:y.onDisconnect)||(r==null?void 0:r.onDisconnect),onError:(y==null?void 0:y.onError)||(r==null?void 0:r.onError),onMessage:(y==null?void 0:y.onMessage)||(r==null?void 0:r.onMessage),onAudio:(y==null?void 0:y.onAudio)||(r==null?void 0:r.onAudio),onDebug:(y==null?void 0:y.onDebug)||(r==null?void 0:r.onDebug),onUnhandledClientToolCall:(y==null?void 0:y.onUnhandledClientToolCall)||(r==null?void 0:r.onUnhandledClientToolCall),onVadScore:(y==null?void 0:y.onVadScore)||(r==null?void 0:r.onVadScore),onInterruption:(y==null?void 0:y.onInterruption)||(r==null?void 0:r.onInterruption),onAgentToolRequest:(y==null?void 0:y.onAgentToolRequest)||(r==null?void 0:r.onAgentToolRequest),onAgentToolResponse:(y==null?void 0:y.onAgentToolResponse)||(r==null?void 0:r.onAgentToolResponse),onConversationMetadata:(y==null?void 0:y.onConversationMetadata)||(r==null?void 0:r.onConversationMetadata),onMCPToolCall:(y==null?void 0:y.onMCPToolCall)||(r==null?void 0:r.onMCPToolCall),onMCPConnectionStatus:(y==null?void 0:y.onMCPConnectionStatus)||(r==null?void 0:r.onMCPConnectionStatus),onAsrInitiationMetadata:(y==null?void 0:y.onAsrInitiationMetadata)||(r==null?void 0:r.onAsrInitiationMetadata),onAgentChatResponsePart:(y==null?void 0:y.onAgentChatResponsePart)||(r==null?void 0:r.onAgentChatResponsePart),onAudioAlignment:(y==null?void 0:y.onAudioAlignment)||(r==null?void 0:r.onAudioAlignment),onModeChange:({mode:De})=>{var te;f(De),(te=(y==null?void 0:y.onModeChange)||(r==null?void 0:r.onModeChange))==null||te({mode:De})},onStatusChange:({status:De})=>{var te;c(De),(te=(y==null?void 0:y.onStatusChange)||(r==null?void 0:r.onStatusChange))==null||te({status:De})},onCanSendFeedbackChange:({canSendFeedback:De})=>{var te;d(De),(te=(y==null?void 0:y.onCanSendFeedbackChange)||(r==null?void 0:r.onCanSendFeedbackChange))==null||te({canSendFeedback:De})}})),s.current=await o.current,a.current)throw await s.current.endSession(),s.current=null,o.current=null,new Error("Session cancelled during connection");return v.current!==void 0&&s.current.setMicMuted(v.current),g.current!==void 0&&s.current.setVolume({volume:g.current}),s.current.getId()}finally{o.current=null}},endSession:async()=>{a.current=!0;const y=o.current,p=s.current;s.current=null,y?await(await y).endSession():await(p==null?void 0:p.endSession())},setVolume:({volume:y})=>{var p;(p=s.current)==null||p.setVolume({volume:y})},getInputByteFrequencyData:()=>{var y;return(y=s.current)==null?void 0:y.getInputByteFrequencyData()},getOutputByteFrequencyData:()=>{var y;return(y=s.current)==null?void 0:y.getOutputByteFrequencyData()},getInputVolume:()=>{var y,p;return(y=(p=s.current)==null?void 0:p.getInputVolume())!=null?y:0},getOutputVolume:()=>{var y,p;return(y=(p=s.current)==null?void 0:p.getOutputVolume())!=null?y:0},sendFeedback:y=>{var p;(p=s.current)==null||p.sendFeedback(y)},getId:()=>{var y;return(y=s.current)==null?void 0:y.getId()},sendContextualUpdate:y=>{var p;(p=s.current)==null||p.sendContextualUpdate(y)},sendUserMessage:y=>{var p;(p=s.current)==null||p.sendUserMessage(y)},sendUserActivity:()=>{var y;(y=s.current)==null||y.sendUserActivity()},sendMCPToolApprovalResult:(y,p)=>{var m;(m=s.current)==null||m.sendMCPToolApprovalResult(y,p)},changeInputDevice:async y=>{if(s.current&&"changeInputDevice"in s.current)return await s.current.changeInputDevice(y);throw new Error("Device switching is only available for voice conversations")},changeOutputDevice:async y=>{if(s.current&&"changeOutputDevice"in s.current)return await s.current.changeOutputDevice(y);throw new Error("Device switching is only available for voice conversations")},status:l,canSendFeedback:u,micMuted:e,isSpeaking:h==="speaking"}}const Y1=zr.forwardRef(({content:t,children:e,...n},i)=>M.jsx("span",{ref:i,...n,children:t||e}));Y1.displayName="UIText";const X1=zr.forwardRef(({label:t,onPress:e,onClick:n,children:i,...r},s)=>M.jsx("button",{ref:s,onClick:o=>{e&&e(),n&&n(o)},style:{padding:"8px 16px",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},...r,children:t||i}));X1.displayName="UIButton";const Z1=zr.forwardRef(({direction:t="vertical",spacing:e="8",align:n="stretch",justify:i="flex-start",children:r,...s},o)=>M.jsx("div",{ref:o,style:{display:"flex",flexDirection:t==="horizontal"?"row":"column",gap:`${e}px`,alignItems:n,justifyContent:i},...s,children:r}));Z1.displayName="UIStack";const eR=zr.forwardRef(({src:t,alt:e,width:n,height:i,children:r,...s},o)=>M.jsx("img",{ref:o,src:t,alt:e,width:n,height:i,style:{maxWidth:"100%",height:"auto",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)"},...s}));eR.displayName="UIImage";const SS=V.createContext({});function tR(t){const e=V.useRef(null);return e.current===null&&(e.current=t()),e.current}const Jh=V.createContext(null),TS=V.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"});function nR(t=!0){const e=V.useContext(Jh);if(e===null)return[!0,null];const{isPresent:n,onExitComplete:i,register:r}=e,s=V.useId();V.useEffect(()=>{t&&r(s)},[t]);const o=V.useCallback(()=>t&&i&&i(s),[s,i,t]);return!n&&i?[!1,o]:[!0]}const Qh=typeof window<"u",iR=Qh?V.useLayoutEffect:V.useEffect,yt=t=>t;let CS=yt;function Yh(t){let e;return()=>(e===void 0&&(e=t()),e)}const Ur=(t,e,n)=>{const i=e-t;return i===0?1:(n-t)/i},En=t=>t*1e3,Pn=t=>t/1e3,rR={useManualTiming:!1};function sR(t){let e=new Set,n=new Set,i=!1,r=!1;const s=new WeakSet;let o={delta:0,timestamp:0,isProcessing:!1};function a(c){s.has(c)&&(l.schedule(c),t()),c(o)}const l={schedule:(c,u=!1,d=!1)=>{const f=d&&i?e:n;return u&&s.add(c),f.has(c)||f.add(c),c},cancel:c=>{n.delete(c),s.delete(c)},process:c=>{if(o=c,i){r=!0;return}i=!0,[e,n]=[n,e],e.forEach(a),e.clear(),i=!1,r&&(r=!1,l.process(c))}};return l}const zo=["read","resolveKeyframes","update","preRender","render","postRender"],oR=40;function bS(t,e){let n=!1,i=!0;const r={delta:0,timestamp:0,isProcessing:!1},s=()=>n=!0,o=zo.reduce((p,m)=>(p[m]=sR(s),p),{}),{read:a,resolveKeyframes:l,update:c,preRender:u,render:d,postRender:h}=o,f=()=>{const p=performance.now();n=!1,r.delta=i?1e3/60:Math.max(Math.min(p-r.timestamp,oR),1),r.timestamp=p,r.isProcessing=!0,a.process(r),l.process(r),c.process(r),u.process(r),d.process(r),h.process(r),r.isProcessing=!1,n&&e&&(i=!1,t(f))},v=()=>{n=!0,i=!0,r.isProcessing||t(f)};return{schedule:zo.reduce((p,m)=>{const k=o[m];return p[m]=(S,T=!1,b=!1)=>(n||v(),k.schedule(S,T,b)),p},{}),cancel:p=>{for(let m=0;m<zo.length;m++)o[zo[m]].cancel(p)},state:r,steps:o}}const{schedule:de,cancel:ci,state:Ve,steps:Dc}=bS(typeof requestAnimationFrame<"u"?requestAnimationFrame:yt,!0),wS=V.createContext({strict:!1}),Jm={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},jr={};for(const t in Jm)jr[t]={isEnabled:e=>Jm[t].some(n=>!!e[n])};function aR(t){for(const e in t)jr[e]={...jr[e],...t[e]}}const lR=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function nl(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||lR.has(t)}let ES=t=>!nl(t);function cR(t){t&&(ES=e=>e.startsWith("on")?!nl(e):t(e))}try{cR(require("@emotion/is-prop-valid").default)}catch{}function uR(t,e,n){const i={};for(const r in t)r==="values"&&typeof t.values=="object"||(ES(r)||n===!0&&nl(r)||!e&&!nl(r)||t.draggable&&r.startsWith("onDrag"))&&(i[r]=t[r]);return i}function dR(t){if(typeof Proxy>"u")return t;const e=new Map,n=(...i)=>t(...i);return new Proxy(n,{get:(i,r)=>r==="create"?t:(e.has(r)||e.set(r,t(r)),e.get(r))})}const Ol=V.createContext({});function oo(t){return typeof t=="string"||Array.isArray(t)}function Ll(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}const Xh=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Zh=["initial",...Xh];function Nl(t){return Ll(t.animate)||Zh.some(e=>oo(t[e]))}function PS(t){return!!(Nl(t)||t.variants)}function hR(t,e){if(Nl(t)){const{initial:n,animate:i}=t;return{initial:n===!1||oo(n)?n:void 0,animate:oo(i)?i:void 0}}return t.inherit!==!1?e:{}}function fR(t){const{initial:e,animate:n}=hR(t,V.useContext(Ol));return V.useMemo(()=>({initial:e,animate:n}),[Qm(e),Qm(n)])}function Qm(t){return Array.isArray(t)?t.join(" "):t}const pR=Symbol.for("motionComponentSymbol");function lr(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function mR(t,e,n){return V.useCallback(i=>{i&&t.onMount&&t.onMount(i),e&&(i?e.mount(i):e.unmount()),n&&(typeof n=="function"?n(i):lr(n)&&(n.current=i))},[e])}const ef=t=>t.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),gR="framerAppearId",_S="data-"+ef(gR),{schedule:tf}=bS(queueMicrotask,!1),RS=V.createContext({});function vR(t,e,n,i,r){var s,o;const{visualElement:a}=V.useContext(Ol),l=V.useContext(wS),c=V.useContext(Jh),u=V.useContext(TS).reducedMotion,d=V.useRef(null);i=i||l.renderer,!d.current&&i&&(d.current=i(t,{visualState:e,parent:a,props:n,presenceContext:c,blockInitialAnimation:c?c.initial===!1:!1,reducedMotionConfig:u}));const h=d.current,f=V.useContext(RS);h&&!h.projection&&r&&(h.type==="html"||h.type==="svg")&&yR(d.current,n,r,f);const v=V.useRef(!1);V.useInsertionEffect(()=>{h&&v.current&&h.update(n,c)});const g=n[_S],y=V.useRef(!!g&&!(!((s=window.MotionHandoffIsComplete)===null||s===void 0)&&s.call(window,g))&&((o=window.MotionHasOptimisedAnimation)===null||o===void 0?void 0:o.call(window,g)));return iR(()=>{h&&(v.current=!0,window.MotionIsMounted=!0,h.updateFeatures(),tf.render(h.render),y.current&&h.animationState&&h.animationState.animateChanges())}),V.useEffect(()=>{h&&(!y.current&&h.animationState&&h.animationState.animateChanges(),y.current&&(queueMicrotask(()=>{var p;(p=window.MotionHandoffMarkAsComplete)===null||p===void 0||p.call(window,g)}),y.current=!1))}),h}function yR(t,e,n,i){const{layoutId:r,layout:s,drag:o,dragConstraints:a,layoutScroll:l,layoutRoot:c}=e;t.projection=new n(t.latestValues,e["data-framer-portal-id"]?void 0:xS(t.parent)),t.projection.setOptions({layoutId:r,layout:s,alwaysMeasureLayout:!!o||a&&lr(a),visualElement:t,animationType:typeof s=="string"?s:"both",initialPromotionConfig:i,layoutScroll:l,layoutRoot:c})}function xS(t){if(t)return t.options.allowProjection!==!1?t.projection:xS(t.parent)}function kR({preloadedFeatures:t,createVisualElement:e,useRender:n,useVisualState:i,Component:r}){var s,o;t&&aR(t);function a(c,u){let d;const h={...V.useContext(TS),...c,layoutId:SR(c)},{isStatic:f}=h,v=fR(c),g=i(c,f);if(!f&&Qh){TR();const y=CR(h);d=y.MeasureLayout,v.visualElement=vR(r,g,h,e,y.ProjectionNode)}return M.jsxs(Ol.Provider,{value:v,children:[d&&v.visualElement?M.jsx(d,{visualElement:v.visualElement,...h}):null,n(r,c,mR(g,v.visualElement,u),g,f,v.visualElement)]})}a.displayName=`motion.${typeof r=="string"?r:`create(${(o=(s=r.displayName)!==null&&s!==void 0?s:r.name)!==null&&o!==void 0?o:""})`}`;const l=V.forwardRef(a);return l[pR]=r,l}function SR({layoutId:t}){const e=V.useContext(SS).id;return e&&t!==void 0?e+"-"+t:t}function TR(t,e){V.useContext(wS).strict}function CR(t){const{drag:e,layout:n}=jr;if(!e&&!n)return{};const i={...e,...n};return{MeasureLayout:e!=null&&e.isEnabled(t)||n!=null&&n.isEnabled(t)?i.MeasureLayout:void 0,ProjectionNode:i.ProjectionNode}}const bR=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function nf(t){return typeof t!="string"||t.includes("-")?!1:!!(bR.indexOf(t)>-1||/[A-Z]/u.test(t))}function Ym(t){const e=[{},{}];return t==null||t.values.forEach((n,i)=>{e[0][i]=n.get(),e[1][i]=n.getVelocity()}),e}function rf(t,e,n,i){if(typeof e=="function"){const[r,s]=Ym(i);e=e(n!==void 0?n:t.custom,r,s)}if(typeof e=="string"&&(e=t.variants&&t.variants[e]),typeof e=="function"){const[r,s]=Ym(i);e=e(n!==void 0?n:t.custom,r,s)}return e}const dd=t=>Array.isArray(t),wR=t=>!!(t&&typeof t=="object"&&t.mix&&t.toValue),ER=t=>dd(t)?t[t.length-1]||0:t,Je=t=>!!(t&&t.getVelocity);function ga(t){const e=Je(t)?t.get():t;return wR(e)?e.toValue():e}function PR({scrapeMotionValuesFromProps:t,createRenderState:e,onUpdate:n},i,r,s){const o={latestValues:_R(i,r,s,t),renderState:e()};return n&&(o.onMount=a=>n({props:i,current:a,...o}),o.onUpdate=a=>n(a)),o}const IS=t=>(e,n)=>{const i=V.useContext(Ol),r=V.useContext(Jh),s=()=>PR(t,e,i,r);return n?s():tR(s)};function _R(t,e,n,i){const r={},s=i(t,{});for(const h in s)r[h]=ga(s[h]);let{initial:o,animate:a}=t;const l=Nl(t),c=PS(t);e&&c&&!l&&t.inherit!==!1&&(o===void 0&&(o=e.initial),a===void 0&&(a=e.animate));let u=n?n.initial===!1:!1;u=u||o===!1;const d=u?a:o;if(d&&typeof d!="boolean"&&!Ll(d)){const h=Array.isArray(d)?d:[d];for(let f=0;f<h.length;f++){const v=rf(t,h[f]);if(v){const{transitionEnd:g,transition:y,...p}=v;for(const m in p){let k=p[m];if(Array.isArray(k)){const S=u?k.length-1:0;k=k[S]}k!==null&&(r[m]=k)}for(const m in g)r[m]=g[m]}}}return r}const Kr=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],zi=new Set(Kr),DS=t=>e=>typeof e=="string"&&e.startsWith(t),MS=DS("--"),RR=DS("var(--"),sf=t=>RR(t)?xR.test(t.split("/*")[0].trim()):!1,xR=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,AS=(t,e)=>e&&typeof t=="number"?e.transform(t):t,Mn=(t,e,n)=>n>e?e:n<t?t:n,Hr={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},ao={...Hr,transform:t=>Mn(0,1,t)},Wo={...Hr,default:1},vo=t=>({test:e=>typeof e=="string"&&e.endsWith(t)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${t}`}),jn=vo("deg"),sn=vo("%"),W=vo("px"),IR=vo("vh"),DR=vo("vw"),Xm={...sn,parse:t=>sn.parse(t)/100,transform:t=>sn.transform(t*100)},MR={borderWidth:W,borderTopWidth:W,borderRightWidth:W,borderBottomWidth:W,borderLeftWidth:W,borderRadius:W,radius:W,borderTopLeftRadius:W,borderTopRightRadius:W,borderBottomRightRadius:W,borderBottomLeftRadius:W,width:W,maxWidth:W,height:W,maxHeight:W,top:W,right:W,bottom:W,left:W,padding:W,paddingTop:W,paddingRight:W,paddingBottom:W,paddingLeft:W,margin:W,marginTop:W,marginRight:W,marginBottom:W,marginLeft:W,backgroundPositionX:W,backgroundPositionY:W},AR={rotate:jn,rotateX:jn,rotateY:jn,rotateZ:jn,scale:Wo,scaleX:Wo,scaleY:Wo,scaleZ:Wo,skew:jn,skewX:jn,skewY:jn,distance:W,translateX:W,translateY:W,translateZ:W,x:W,y:W,z:W,perspective:W,transformPerspective:W,opacity:ao,originX:Xm,originY:Xm,originZ:W},Zm={...Hr,transform:Math.round},of={...MR,...AR,zIndex:Zm,size:W,fillOpacity:ao,strokeOpacity:ao,numOctaves:Zm},OR={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},LR=Kr.length;function NR(t,e,n){let i="",r=!0;for(let s=0;s<LR;s++){const o=Kr[s],a=t[o];if(a===void 0)continue;let l=!0;if(typeof a=="number"?l=a===(o.startsWith("scale")?1:0):l=parseFloat(a)===0,!l||n){const c=AS(a,of[o]);if(!l){r=!1;const u=OR[o]||o;i+=`${u}(${c}) `}n&&(e[o]=c)}}return i=i.trim(),n?i=n(e,r?"":i):r&&(i="none"),i}function af(t,e,n){const{style:i,vars:r,transformOrigin:s}=t;let o=!1,a=!1;for(const l in e){const c=e[l];if(zi.has(l)){o=!0;continue}else if(MS(l)){r[l]=c;continue}else{const u=AS(c,of[l]);l.startsWith("origin")?(a=!0,s[l]=u):i[l]=u}}if(e.transform||(o||n?i.transform=NR(e,t.transform,n):i.transform&&(i.transform="none")),a){const{originX:l="50%",originY:c="50%",originZ:u=0}=s;i.transformOrigin=`${l} ${c} ${u}`}}const FR={offset:"stroke-dashoffset",array:"stroke-dasharray"},UR={offset:"strokeDashoffset",array:"strokeDasharray"};function jR(t,e,n=1,i=0,r=!0){t.pathLength=1;const s=r?FR:UR;t[s.offset]=W.transform(-i);const o=W.transform(e),a=W.transform(n);t[s.array]=`${o} ${a}`}function eg(t,e,n){return typeof t=="string"?t:W.transform(e+n*t)}function VR(t,e,n){const i=eg(e,t.x,t.width),r=eg(n,t.y,t.height);return`${i} ${r}`}function lf(t,{attrX:e,attrY:n,attrScale:i,originX:r,originY:s,pathLength:o,pathSpacing:a=1,pathOffset:l=0,...c},u,d){if(af(t,c,d),u){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:h,style:f,dimensions:v}=t;h.transform&&(v&&(f.transform=h.transform),delete h.transform),v&&(r!==void 0||s!==void 0||f.transform)&&(f.transformOrigin=VR(v,r!==void 0?r:.5,s!==void 0?s:.5)),e!==void 0&&(h.x=e),n!==void 0&&(h.y=n),i!==void 0&&(h.scale=i),o!==void 0&&jR(h,o,a,l,!1)}const cf=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),OS=()=>({...cf(),attrs:{}}),uf=t=>typeof t=="string"&&t.toLowerCase()==="svg";function LS(t,{style:e,vars:n},i,r){Object.assign(t.style,e,r&&r.getProjectionStyles(i));for(const s in n)t.style.setProperty(s,n[s])}const NS=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function FS(t,e,n,i){LS(t,e,void 0,i);for(const r in e.attrs)t.setAttribute(NS.has(r)?r:ef(r),e.attrs[r])}const il={};function BR(t){Object.assign(il,t)}function US(t,{layout:e,layoutId:n}){return zi.has(t)||t.startsWith("origin")||(e||n!==void 0)&&(!!il[t]||t==="opacity")}function df(t,e,n){var i;const{style:r}=t,s={};for(const o in r)(Je(r[o])||e.style&&Je(e.style[o])||US(o,t)||((i=n==null?void 0:n.getValue(o))===null||i===void 0?void 0:i.liveStyle)!==void 0)&&(s[o]=r[o]);return s}function jS(t,e,n){const i=df(t,e,n);for(const r in t)if(Je(t[r])||Je(e[r])){const s=Kr.indexOf(r)!==-1?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r;i[s]=t[r]}return i}function zR(t,e){try{e.dimensions=typeof t.getBBox=="function"?t.getBBox():t.getBoundingClientRect()}catch{e.dimensions={x:0,y:0,width:0,height:0}}}const tg=["x","y","width","height","cx","cy","r"],WR={useVisualState:IS({scrapeMotionValuesFromProps:jS,createRenderState:OS,onUpdate:({props:t,prevProps:e,current:n,renderState:i,latestValues:r})=>{if(!n)return;let s=!!t.drag;if(!s){for(const a in r)if(zi.has(a)){s=!0;break}}if(!s)return;let o=!e;if(e)for(let a=0;a<tg.length;a++){const l=tg[a];t[l]!==e[l]&&(o=!0)}o&&de.read(()=>{zR(n,i),de.render(()=>{lf(i,r,uf(n.tagName),t.transformTemplate),FS(n,i)})})}})},qR={useVisualState:IS({scrapeMotionValuesFromProps:df,createRenderState:cf})};function VS(t,e,n){for(const i in e)!Je(e[i])&&!US(i,n)&&(t[i]=e[i])}function KR({transformTemplate:t},e){return V.useMemo(()=>{const n=cf();return af(n,e,t),Object.assign({},n.vars,n.style)},[e])}function HR(t,e){const n=t.style||{},i={};return VS(i,n,t),Object.assign(i,KR(t,e)),i}function GR(t,e){const n={},i=HR(t,e);return t.drag&&t.dragListener!==!1&&(n.draggable=!1,i.userSelect=i.WebkitUserSelect=i.WebkitTouchCallout="none",i.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(n.tabIndex=0),n.style=i,n}function $R(t,e,n,i){const r=V.useMemo(()=>{const s=OS();return lf(s,e,uf(i),t.transformTemplate),{...s.attrs,style:{...s.style}}},[e]);if(t.style){const s={};VS(s,t.style,t),r.style={...s,...r.style}}return r}function JR(t=!1){return(n,i,r,{latestValues:s},o)=>{const l=(nf(n)?$R:GR)(i,s,o,n),c=uR(i,typeof n=="string",t),u=n!==V.Fragment?{...c,...l,ref:r}:{},{children:d}=i,h=V.useMemo(()=>Je(d)?d.get():d,[d]);return V.createElement(n,{...u,children:h})}}function QR(t,e){return function(i,{forwardMotionProps:r}={forwardMotionProps:!1}){const o={...nf(i)?WR:qR,preloadedFeatures:t,useRender:JR(r),createVisualElement:e,Component:i};return kR(o)}}function BS(t,e){if(!Array.isArray(e))return!1;const n=e.length;if(n!==t.length)return!1;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}function Fl(t,e,n){const i=t.getProps();return rf(i,e,n!==void 0?n:i.custom,t)}const YR=Yh(()=>window.ScrollTimeline!==void 0);class XR{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}get finished(){return Promise.all(this.animations.map(e=>"finished"in e?e.finished:e))}getAll(e){return this.animations[0][e]}setAll(e,n){for(let i=0;i<this.animations.length;i++)this.animations[i][e]=n}attachTimeline(e,n){const i=this.animations.map(r=>{if(YR()&&r.attachTimeline)return r.attachTimeline(e);if(typeof n=="function")return n(r)});return()=>{i.forEach((r,s)=>{r&&r(),this.animations[s].stop()})}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get startTime(){return this.getAll("startTime")}get duration(){let e=0;for(let n=0;n<this.animations.length;n++)e=Math.max(e,this.animations[n].duration);return e}runAll(e){this.animations.forEach(n=>n[e]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class ZR extends XR{then(e,n){return Promise.all(this.animations).then(e).catch(n)}}function hf(t,e){return t?t[e]||t.default||t:void 0}const hd=2e4;function zS(t){let e=0;const n=50;let i=t.next(e);for(;!i.done&&e<hd;)e+=n,i=t.next(e);return e>=hd?1/0:e}function ff(t){return typeof t=="function"}function ng(t,e){t.timeline=e,t.onfinish=null}const pf=t=>Array.isArray(t)&&typeof t[0]=="number",ex={linearEasing:void 0};function tx(t,e){const n=Yh(t);return()=>{var i;return(i=ex[e])!==null&&i!==void 0?i:n()}}const rl=tx(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),WS=(t,e,n=10)=>{let i="";const r=Math.max(Math.round(e/n),2);for(let s=0;s<r;s++)i+=t(Ur(0,r-1,s))+", ";return`linear(${i.substring(0,i.length-2)})`};function qS(t){return!!(typeof t=="function"&&rl()||!t||typeof t=="string"&&(t in fd||rl())||pf(t)||Array.isArray(t)&&t.every(qS))}const ps=([t,e,n,i])=>`cubic-bezier(${t}, ${e}, ${n}, ${i})`,fd={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:ps([0,.65,.55,1]),circOut:ps([.55,0,1,.45]),backIn:ps([.31,.01,.66,-.59]),backOut:ps([.33,1.53,.69,.99])};function KS(t,e){if(t)return typeof t=="function"&&rl()?WS(t,e):pf(t)?ps(t):Array.isArray(t)?t.map(n=>KS(n,e)||fd.easeOut):fd[t]}const Ft={x:!1,y:!1};function HS(){return Ft.x||Ft.y}function nx(t,e,n){var i;if(t instanceof Element)return[t];if(typeof t=="string"){let r=document;const s=(i=void 0)!==null&&i!==void 0?i:r.querySelectorAll(t);return s?Array.from(s):[]}return Array.from(t)}function GS(t,e){const n=nx(t),i=new AbortController,r={passive:!0,...e,signal:i.signal};return[n,r,()=>i.abort()]}function ig(t){return e=>{e.pointerType==="touch"||HS()||t(e)}}function ix(t,e,n={}){const[i,r,s]=GS(t,n),o=ig(a=>{const{target:l}=a,c=e(a);if(typeof c!="function"||!l)return;const u=ig(d=>{c(d),l.removeEventListener("pointerleave",u)});l.addEventListener("pointerleave",u,r)});return i.forEach(a=>{a.addEventListener("pointerenter",o,r)}),s}const $S=(t,e)=>e?t===e?!0:$S(t,e.parentElement):!1,mf=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1,rx=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function sx(t){return rx.has(t.tagName)||t.tabIndex!==-1}const ms=new WeakSet;function rg(t){return e=>{e.key==="Enter"&&t(e)}}function Mc(t,e){t.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const ox=(t,e)=>{const n=t.currentTarget;if(!n)return;const i=rg(()=>{if(ms.has(n))return;Mc(n,"down");const r=rg(()=>{Mc(n,"up")}),s=()=>Mc(n,"cancel");n.addEventListener("keyup",r,e),n.addEventListener("blur",s,e)});n.addEventListener("keydown",i,e),n.addEventListener("blur",()=>n.removeEventListener("keydown",i),e)};function sg(t){return mf(t)&&!HS()}function ax(t,e,n={}){const[i,r,s]=GS(t,n),o=a=>{const l=a.currentTarget;if(!sg(a)||ms.has(l))return;ms.add(l);const c=e(a),u=(f,v)=>{window.removeEventListener("pointerup",d),window.removeEventListener("pointercancel",h),!(!sg(f)||!ms.has(l))&&(ms.delete(l),typeof c=="function"&&c(f,{success:v}))},d=f=>{u(f,n.useGlobalTarget||$S(l,f.target))},h=f=>{u(f,!1)};window.addEventListener("pointerup",d,r),window.addEventListener("pointercancel",h,r)};return i.forEach(a=>{!sx(a)&&a.getAttribute("tabindex")===null&&(a.tabIndex=0),(n.useGlobalTarget?window:a).addEventListener("pointerdown",o,r),a.addEventListener("focus",c=>ox(c,r),r)}),s}function lx(t){return t==="x"||t==="y"?Ft[t]?null:(Ft[t]=!0,()=>{Ft[t]=!1}):Ft.x||Ft.y?null:(Ft.x=Ft.y=!0,()=>{Ft.x=Ft.y=!1})}const JS=new Set(["width","height","top","left","right","bottom",...Kr]);let va;function cx(){va=void 0}const on={now:()=>(va===void 0&&on.set(Ve.isProcessing||rR.useManualTiming?Ve.timestamp:performance.now()),va),set:t=>{va=t,queueMicrotask(cx)}};function gf(t,e){t.indexOf(e)===-1&&t.push(e)}function vf(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}class yf{constructor(){this.subscriptions=[]}add(e){return gf(this.subscriptions,e),()=>vf(this.subscriptions,e)}notify(e,n,i){const r=this.subscriptions.length;if(r)if(r===1)this.subscriptions[0](e,n,i);else for(let s=0;s<r;s++){const o=this.subscriptions[s];o&&o(e,n,i)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function QS(t,e){return e?t*(1e3/e):0}const og=30,ux=t=>!isNaN(parseFloat(t));class dx{constructor(e,n={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(i,r=!0)=>{const s=on.now();this.updatedAt!==s&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(i),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),r&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=n.owner}setCurrent(e){this.current=e,this.updatedAt=on.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=ux(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,n){this.events[e]||(this.events[e]=new yf);const i=this.events[e].add(n);return e==="change"?()=>{i(),de.read(()=>{this.events.change.getSize()||this.stop()})}:i}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,n){this.passiveEffect=e,this.stopPassiveEffect=n}set(e,n=!0){!n||!this.passiveEffect?this.updateAndNotify(e,n):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,n,i){this.set(n),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-i}jump(e,n=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=on.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>og)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,og);return QS(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(e){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=e(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function lo(t,e){return new dx(t,e)}function hx(t,e,n){t.hasValue(e)?t.getValue(e).set(n):t.addValue(e,lo(n))}function fx(t,e){const n=Fl(t,e);let{transitionEnd:i={},transition:r={},...s}=n||{};s={...s,...i};for(const o in s){const a=ER(s[o]);hx(t,o,a)}}function px(t){return!!(Je(t)&&t.add)}function pd(t,e){const n=t.getValue("willChange");if(px(n))return n.add(e)}function YS(t){return t.props[_S]}const XS=(t,e,n)=>(((1-3*n+3*e)*t+(3*n-6*e))*t+3*e)*t,mx=1e-7,gx=12;function vx(t,e,n,i,r){let s,o,a=0;do o=e+(n-e)/2,s=XS(o,i,r)-t,s>0?n=o:e=o;while(Math.abs(s)>mx&&++a<gx);return o}function yo(t,e,n,i){if(t===e&&n===i)return yt;const r=s=>vx(s,0,1,t,n);return s=>s===0||s===1?s:XS(r(s),e,i)}const ZS=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,eT=t=>e=>1-t(1-e),tT=yo(.33,1.53,.69,.99),kf=eT(tT),nT=ZS(kf),iT=t=>(t*=2)<1?.5*kf(t):.5*(2-Math.pow(2,-10*(t-1))),Sf=t=>1-Math.sin(Math.acos(t)),rT=eT(Sf),sT=ZS(Sf),oT=t=>/^0[^.\s]+$/u.test(t);function yx(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||oT(t):!0}const Ms=t=>Math.round(t*1e5)/1e5,Tf=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function kx(t){return t==null}const Sx=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Cf=(t,e)=>n=>!!(typeof n=="string"&&Sx.test(n)&&n.startsWith(t)||e&&!kx(n)&&Object.prototype.hasOwnProperty.call(n,e)),aT=(t,e,n)=>i=>{if(typeof i!="string")return i;const[r,s,o,a]=i.match(Tf);return{[t]:parseFloat(r),[e]:parseFloat(s),[n]:parseFloat(o),alpha:a!==void 0?parseFloat(a):1}},Tx=t=>Mn(0,255,t),Ac={...Hr,transform:t=>Math.round(Tx(t))},_i={test:Cf("rgb","red"),parse:aT("red","green","blue"),transform:({red:t,green:e,blue:n,alpha:i=1})=>"rgba("+Ac.transform(t)+", "+Ac.transform(e)+", "+Ac.transform(n)+", "+Ms(ao.transform(i))+")"};function Cx(t){let e="",n="",i="",r="";return t.length>5?(e=t.substring(1,3),n=t.substring(3,5),i=t.substring(5,7),r=t.substring(7,9)):(e=t.substring(1,2),n=t.substring(2,3),i=t.substring(3,4),r=t.substring(4,5),e+=e,n+=n,i+=i,r+=r),{red:parseInt(e,16),green:parseInt(n,16),blue:parseInt(i,16),alpha:r?parseInt(r,16)/255:1}}const md={test:Cf("#"),parse:Cx,transform:_i.transform},cr={test:Cf("hsl","hue"),parse:aT("hue","saturation","lightness"),transform:({hue:t,saturation:e,lightness:n,alpha:i=1})=>"hsla("+Math.round(t)+", "+sn.transform(Ms(e))+", "+sn.transform(Ms(n))+", "+Ms(ao.transform(i))+")"},Ge={test:t=>_i.test(t)||md.test(t)||cr.test(t),parse:t=>_i.test(t)?_i.parse(t):cr.test(t)?cr.parse(t):md.parse(t),transform:t=>typeof t=="string"?t:t.hasOwnProperty("red")?_i.transform(t):cr.transform(t)},bx=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function wx(t){var e,n;return isNaN(t)&&typeof t=="string"&&(((e=t.match(Tf))===null||e===void 0?void 0:e.length)||0)+(((n=t.match(bx))===null||n===void 0?void 0:n.length)||0)>0}const lT="number",cT="color",Ex="var",Px="var(",ag="${}",_x=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function co(t){const e=t.toString(),n=[],i={color:[],number:[],var:[]},r=[];let s=0;const a=e.replace(_x,l=>(Ge.test(l)?(i.color.push(s),r.push(cT),n.push(Ge.parse(l))):l.startsWith(Px)?(i.var.push(s),r.push(Ex),n.push(l)):(i.number.push(s),r.push(lT),n.push(parseFloat(l))),++s,ag)).split(ag);return{values:n,split:a,indexes:i,types:r}}function uT(t){return co(t).values}function dT(t){const{split:e,types:n}=co(t),i=e.length;return r=>{let s="";for(let o=0;o<i;o++)if(s+=e[o],r[o]!==void 0){const a=n[o];a===lT?s+=Ms(r[o]):a===cT?s+=Ge.transform(r[o]):s+=r[o]}return s}}const Rx=t=>typeof t=="number"?0:t;function xx(t){const e=uT(t);return dT(t)(e.map(Rx))}const ui={test:wx,parse:uT,createTransformer:dT,getAnimatableNone:xx},Ix=new Set(["brightness","contrast","saturate","opacity"]);function Dx(t){const[e,n]=t.slice(0,-1).split("(");if(e==="drop-shadow")return t;const[i]=n.match(Tf)||[];if(!i)return t;const r=n.replace(i,"");let s=Ix.has(e)?1:0;return i!==n&&(s*=100),e+"("+s+r+")"}const Mx=/\b([a-z-]*)\(.*?\)/gu,gd={...ui,getAnimatableNone:t=>{const e=t.match(Mx);return e?e.map(Dx).join(" "):t}},Ax={...of,color:Ge,backgroundColor:Ge,outlineColor:Ge,fill:Ge,stroke:Ge,borderColor:Ge,borderTopColor:Ge,borderRightColor:Ge,borderBottomColor:Ge,borderLeftColor:Ge,filter:gd,WebkitFilter:gd},bf=t=>Ax[t];function hT(t,e){let n=bf(t);return n!==gd&&(n=ui),n.getAnimatableNone?n.getAnimatableNone(e):void 0}const Ox=new Set(["auto","none","0"]);function Lx(t,e,n){let i=0,r;for(;i<t.length&&!r;){const s=t[i];typeof s=="string"&&!Ox.has(s)&&co(s).values.length&&(r=t[i]),i++}if(r&&n)for(const s of e)t[s]=hT(n,r)}const lg=t=>t===Hr||t===W,cg=(t,e)=>parseFloat(t.split(", ")[e]),ug=(t,e)=>(n,{transform:i})=>{if(i==="none"||!i)return 0;const r=i.match(/^matrix3d\((.+)\)$/u);if(r)return cg(r[1],e);{const s=i.match(/^matrix\((.+)\)$/u);return s?cg(s[1],t):0}},Nx=new Set(["x","y","z"]),Fx=Kr.filter(t=>!Nx.has(t));function Ux(t){const e=[];return Fx.forEach(n=>{const i=t.getValue(n);i!==void 0&&(e.push([n,i.get()]),i.set(n.startsWith("scale")?1:0))}),e}const Vr={width:({x:t},{paddingLeft:e="0",paddingRight:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),height:({y:t},{paddingTop:e="0",paddingBottom:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),top:(t,{top:e})=>parseFloat(e),left:(t,{left:e})=>parseFloat(e),bottom:({y:t},{top:e})=>parseFloat(e)+(t.max-t.min),right:({x:t},{left:e})=>parseFloat(e)+(t.max-t.min),x:ug(4,13),y:ug(5,14)};Vr.translateX=Vr.x;Vr.translateY=Vr.y;const Ii=new Set;let vd=!1,yd=!1;function fT(){if(yd){const t=Array.from(Ii).filter(i=>i.needsMeasurement),e=new Set(t.map(i=>i.element)),n=new Map;e.forEach(i=>{const r=Ux(i);r.length&&(n.set(i,r),i.render())}),t.forEach(i=>i.measureInitialState()),e.forEach(i=>{i.render();const r=n.get(i);r&&r.forEach(([s,o])=>{var a;(a=i.getValue(s))===null||a===void 0||a.set(o)})}),t.forEach(i=>i.measureEndState()),t.forEach(i=>{i.suspendedScrollY!==void 0&&window.scrollTo(0,i.suspendedScrollY)})}yd=!1,vd=!1,Ii.forEach(t=>t.complete()),Ii.clear()}function pT(){Ii.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&(yd=!0)})}function jx(){pT(),fT()}class wf{constructor(e,n,i,r,s,o=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=n,this.name=i,this.motionValue=r,this.element=s,this.isAsync=o}scheduleResolve(){this.isScheduled=!0,this.isAsync?(Ii.add(this),vd||(vd=!0,de.read(pT),de.resolveKeyframes(fT))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:n,element:i,motionValue:r}=this;for(let s=0;s<e.length;s++)if(e[s]===null)if(s===0){const o=r==null?void 0:r.get(),a=e[e.length-1];if(o!==void 0)e[0]=o;else if(i&&n){const l=i.readValue(n,a);l!=null&&(e[0]=l)}e[0]===void 0&&(e[0]=a),r&&o===void 0&&r.set(e[0])}else e[s]=e[s-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),Ii.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,Ii.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const mT=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t),Vx=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function Bx(t){const e=Vx.exec(t);if(!e)return[,];const[,n,i,r]=e;return[`--${n??i}`,r]}function gT(t,e,n=1){const[i,r]=Bx(t);if(!i)return;const s=window.getComputedStyle(e).getPropertyValue(i);if(s){const o=s.trim();return mT(o)?parseFloat(o):o}return sf(r)?gT(r,e,n+1):r}const vT=t=>e=>e.test(t),zx={test:t=>t==="auto",parse:t=>t},yT=[Hr,W,sn,jn,DR,IR,zx],dg=t=>yT.find(vT(t));class kT extends wf{constructor(e,n,i,r,s){super(e,n,i,r,s,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:n,name:i}=this;if(!n||!n.current)return;super.readKeyframes();for(let l=0;l<e.length;l++){let c=e[l];if(typeof c=="string"&&(c=c.trim(),sf(c))){const u=gT(c,n.current);u!==void 0&&(e[l]=u),l===e.length-1&&(this.finalKeyframe=c)}}if(this.resolveNoneKeyframes(),!JS.has(i)||e.length!==2)return;const[r,s]=e,o=dg(r),a=dg(s);if(o!==a)if(lg(o)&&lg(a))for(let l=0;l<e.length;l++){const c=e[l];typeof c=="string"&&(e[l]=parseFloat(c))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:n}=this,i=[];for(let r=0;r<e.length;r++)yx(e[r])&&i.push(r);i.length&&Lx(e,i,n)}measureInitialState(){const{element:e,unresolvedKeyframes:n,name:i}=this;if(!e||!e.current)return;i==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Vr[i](e.measureViewportBox(),window.getComputedStyle(e.current)),n[0]=this.measuredOrigin;const r=n[n.length-1];r!==void 0&&e.getValue(i,r).jump(r,!1)}measureEndState(){var e;const{element:n,name:i,unresolvedKeyframes:r}=this;if(!n||!n.current)return;const s=n.getValue(i);s&&s.jump(this.measuredOrigin,!1);const o=r.length-1,a=r[o];r[o]=Vr[i](n.measureViewportBox(),window.getComputedStyle(n.current)),a!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=a),!((e=this.removedTransforms)===null||e===void 0)&&e.length&&this.removedTransforms.forEach(([l,c])=>{n.getValue(l).set(c)}),this.resolveNoneKeyframes()}}const hg=(t,e)=>e==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(ui.test(t)||t==="0")&&!t.startsWith("url("));function Wx(t){const e=t[0];if(t.length===1)return!0;for(let n=0;n<t.length;n++)if(t[n]!==e)return!0}function qx(t,e,n,i){const r=t[0];if(r===null)return!1;if(e==="display"||e==="visibility")return!0;const s=t[t.length-1],o=hg(r,e),a=hg(s,e);return!o||!a?!1:Wx(t)||(n==="spring"||ff(n))&&i}const Kx=t=>t!==null;function Ul(t,{repeat:e,repeatType:n="loop"},i){const r=t.filter(Kx),s=e&&n!=="loop"&&e%2===1?0:r.length-1;return!s||i===void 0?r[s]:i}const Hx=40;class ST{constructor({autoplay:e=!0,delay:n=0,type:i="keyframes",repeat:r=0,repeatDelay:s=0,repeatType:o="loop",...a}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=on.now(),this.options={autoplay:e,delay:n,type:i,repeat:r,repeatDelay:s,repeatType:o,...a},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>Hx?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&jx(),this._resolved}onKeyframesResolved(e,n){this.resolvedAt=on.now(),this.hasAttemptedResolve=!0;const{name:i,type:r,velocity:s,delay:o,onComplete:a,onUpdate:l,isGenerator:c}=this.options;if(!c&&!qx(e,i,r,s))if(o)this.options.duration=0;else{l&&l(Ul(e,this.options,n)),a&&a(),this.resolveFinishedPromise();return}const u=this.initPlayback(e,n);u!==!1&&(this._resolved={keyframes:e,finalKeyframe:n,...u},this.onPostResolved())}onPostResolved(){}then(e,n){return this.currentFinishedPromise.then(e,n)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(e=>{this.resolveFinishedPromise=e})}}const me=(t,e,n)=>t+(e-t)*n;function Oc(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*(2/3-n)*6:t}function Gx({hue:t,saturation:e,lightness:n,alpha:i}){t/=360,e/=100,n/=100;let r=0,s=0,o=0;if(!e)r=s=o=n;else{const a=n<.5?n*(1+e):n+e-n*e,l=2*n-a;r=Oc(l,a,t+1/3),s=Oc(l,a,t),o=Oc(l,a,t-1/3)}return{red:Math.round(r*255),green:Math.round(s*255),blue:Math.round(o*255),alpha:i}}function sl(t,e){return n=>n>0?e:t}const Lc=(t,e,n)=>{const i=t*t,r=n*(e*e-i)+i;return r<0?0:Math.sqrt(r)},$x=[md,_i,cr],Jx=t=>$x.find(e=>e.test(t));function fg(t){const e=Jx(t);if(!e)return!1;let n=e.parse(t);return e===cr&&(n=Gx(n)),n}const pg=(t,e)=>{const n=fg(t),i=fg(e);if(!n||!i)return sl(t,e);const r={...n};return s=>(r.red=Lc(n.red,i.red,s),r.green=Lc(n.green,i.green,s),r.blue=Lc(n.blue,i.blue,s),r.alpha=me(n.alpha,i.alpha,s),_i.transform(r))},Qx=(t,e)=>n=>e(t(n)),ko=(...t)=>t.reduce(Qx),kd=new Set(["none","hidden"]);function Yx(t,e){return kd.has(t)?n=>n<=0?t:e:n=>n>=1?e:t}function Xx(t,e){return n=>me(t,e,n)}function Ef(t){return typeof t=="number"?Xx:typeof t=="string"?sf(t)?sl:Ge.test(t)?pg:tI:Array.isArray(t)?TT:typeof t=="object"?Ge.test(t)?pg:Zx:sl}function TT(t,e){const n=[...t],i=n.length,r=t.map((s,o)=>Ef(s)(s,e[o]));return s=>{for(let o=0;o<i;o++)n[o]=r[o](s);return n}}function Zx(t,e){const n={...t,...e},i={};for(const r in n)t[r]!==void 0&&e[r]!==void 0&&(i[r]=Ef(t[r])(t[r],e[r]));return r=>{for(const s in i)n[s]=i[s](r);return n}}function eI(t,e){var n;const i=[],r={color:0,var:0,number:0};for(let s=0;s<e.values.length;s++){const o=e.types[s],a=t.indexes[o][r[o]],l=(n=t.values[a])!==null&&n!==void 0?n:0;i[s]=l,r[o]++}return i}const tI=(t,e)=>{const n=ui.createTransformer(e),i=co(t),r=co(e);return i.indexes.var.length===r.indexes.var.length&&i.indexes.color.length===r.indexes.color.length&&i.indexes.number.length>=r.indexes.number.length?kd.has(t)&&!r.values.length||kd.has(e)&&!i.values.length?Yx(t,e):ko(TT(eI(i,r),r.values),n):sl(t,e)};function CT(t,e,n){return typeof t=="number"&&typeof e=="number"&&typeof n=="number"?me(t,e,n):Ef(t)(t,e)}const nI=5;function bT(t,e,n){const i=Math.max(e-nI,0);return QS(n-t(i),e-i)}const Se={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},Nc=.001;function iI({duration:t=Se.duration,bounce:e=Se.bounce,velocity:n=Se.velocity,mass:i=Se.mass}){let r,s,o=1-e;o=Mn(Se.minDamping,Se.maxDamping,o),t=Mn(Se.minDuration,Se.maxDuration,Pn(t)),o<1?(r=c=>{const u=c*o,d=u*t,h=u-n,f=Sd(c,o),v=Math.exp(-d);return Nc-h/f*v},s=c=>{const d=c*o*t,h=d*n+n,f=Math.pow(o,2)*Math.pow(c,2)*t,v=Math.exp(-d),g=Sd(Math.pow(c,2),o);return(-r(c)+Nc>0?-1:1)*((h-f)*v)/g}):(r=c=>{const u=Math.exp(-c*t),d=(c-n)*t+1;return-Nc+u*d},s=c=>{const u=Math.exp(-c*t),d=(n-c)*(t*t);return u*d});const a=5/t,l=sI(r,s,a);if(t=En(t),isNaN(l))return{stiffness:Se.stiffness,damping:Se.damping,duration:t};{const c=Math.pow(l,2)*i;return{stiffness:c,damping:o*2*Math.sqrt(i*c),duration:t}}}const rI=12;function sI(t,e,n){let i=n;for(let r=1;r<rI;r++)i=i-t(i)/e(i);return i}function Sd(t,e){return t*Math.sqrt(1-e*e)}const oI=["duration","bounce"],aI=["stiffness","damping","mass"];function mg(t,e){return e.some(n=>t[n]!==void 0)}function lI(t){let e={velocity:Se.velocity,stiffness:Se.stiffness,damping:Se.damping,mass:Se.mass,isResolvedFromDuration:!1,...t};if(!mg(t,aI)&&mg(t,oI))if(t.visualDuration){const n=t.visualDuration,i=2*Math.PI/(n*1.2),r=i*i,s=2*Mn(.05,1,1-(t.bounce||0))*Math.sqrt(r);e={...e,mass:Se.mass,stiffness:r,damping:s}}else{const n=iI(t);e={...e,...n,mass:Se.mass},e.isResolvedFromDuration=!0}return e}function wT(t=Se.visualDuration,e=Se.bounce){const n=typeof t!="object"?{visualDuration:t,keyframes:[0,1],bounce:e}:t;let{restSpeed:i,restDelta:r}=n;const s=n.keyframes[0],o=n.keyframes[n.keyframes.length-1],a={done:!1,value:s},{stiffness:l,damping:c,mass:u,duration:d,velocity:h,isResolvedFromDuration:f}=lI({...n,velocity:-Pn(n.velocity||0)}),v=h||0,g=c/(2*Math.sqrt(l*u)),y=o-s,p=Pn(Math.sqrt(l/u)),m=Math.abs(y)<5;i||(i=m?Se.restSpeed.granular:Se.restSpeed.default),r||(r=m?Se.restDelta.granular:Se.restDelta.default);let k;if(g<1){const T=Sd(p,g);k=b=>{const P=Math.exp(-g*p*b);return o-P*((v+g*p*y)/T*Math.sin(T*b)+y*Math.cos(T*b))}}else if(g===1)k=T=>o-Math.exp(-p*T)*(y+(v+p*y)*T);else{const T=p*Math.sqrt(g*g-1);k=b=>{const P=Math.exp(-g*p*b),E=Math.min(T*b,300);return o-P*((v+g*p*y)*Math.sinh(E)+T*y*Math.cosh(E))/T}}const S={calculatedDuration:f&&d||null,next:T=>{const b=k(T);if(f)a.done=T>=d;else{let P=0;g<1&&(P=T===0?En(v):bT(k,T,b));const E=Math.abs(P)<=i,I=Math.abs(o-b)<=r;a.done=E&&I}return a.value=a.done?o:b,a},toString:()=>{const T=Math.min(zS(S),hd),b=WS(P=>S.next(T*P).value,T,30);return T+"ms "+b}};return S}function gg({keyframes:t,velocity:e=0,power:n=.8,timeConstant:i=325,bounceDamping:r=10,bounceStiffness:s=500,modifyTarget:o,min:a,max:l,restDelta:c=.5,restSpeed:u}){const d=t[0],h={done:!1,value:d},f=E=>a!==void 0&&E<a||l!==void 0&&E>l,v=E=>a===void 0?l:l===void 0||Math.abs(a-E)<Math.abs(l-E)?a:l;let g=n*e;const y=d+g,p=o===void 0?y:o(y);p!==y&&(g=p-d);const m=E=>-g*Math.exp(-E/i),k=E=>p+m(E),S=E=>{const I=m(E),_=k(E);h.done=Math.abs(I)<=c,h.value=h.done?p:_};let T,b;const P=E=>{f(h.value)&&(T=E,b=wT({keyframes:[h.value,v(h.value)],velocity:bT(k,E,h.value),damping:r,stiffness:s,restDelta:c,restSpeed:u}))};return P(0),{calculatedDuration:null,next:E=>{let I=!1;return!b&&T===void 0&&(I=!0,S(E),P(E)),T!==void 0&&E>=T?b.next(E-T):(!I&&S(E),h)}}}const cI=yo(.42,0,1,1),uI=yo(0,0,.58,1),ET=yo(.42,0,.58,1),dI=t=>Array.isArray(t)&&typeof t[0]!="number",hI={linear:yt,easeIn:cI,easeInOut:ET,easeOut:uI,circIn:Sf,circInOut:sT,circOut:rT,backIn:kf,backInOut:nT,backOut:tT,anticipate:iT},vg=t=>{if(pf(t)){CS(t.length===4);const[e,n,i,r]=t;return yo(e,n,i,r)}else if(typeof t=="string")return hI[t];return t};function fI(t,e,n){const i=[],r=n||CT,s=t.length-1;for(let o=0;o<s;o++){let a=r(t[o],t[o+1]);if(e){const l=Array.isArray(e)?e[o]||yt:e;a=ko(l,a)}i.push(a)}return i}function pI(t,e,{clamp:n=!0,ease:i,mixer:r}={}){const s=t.length;if(CS(s===e.length),s===1)return()=>e[0];if(s===2&&e[0]===e[1])return()=>e[1];const o=t[0]===t[1];t[0]>t[s-1]&&(t=[...t].reverse(),e=[...e].reverse());const a=fI(e,i,r),l=a.length,c=u=>{if(o&&u<t[0])return e[0];let d=0;if(l>1)for(;d<t.length-2&&!(u<t[d+1]);d++);const h=Ur(t[d],t[d+1],u);return a[d](h)};return n?u=>c(Mn(t[0],t[s-1],u)):c}function mI(t,e){const n=t[t.length-1];for(let i=1;i<=e;i++){const r=Ur(0,e,i);t.push(me(n,1,r))}}function gI(t){const e=[0];return mI(e,t.length-1),e}function vI(t,e){return t.map(n=>n*e)}function yI(t,e){return t.map(()=>e||ET).splice(0,t.length-1)}function ol({duration:t=300,keyframes:e,times:n,ease:i="easeInOut"}){const r=dI(i)?i.map(vg):vg(i),s={done:!1,value:e[0]},o=vI(n&&n.length===e.length?n:gI(e),t),a=pI(o,e,{ease:Array.isArray(r)?r:yI(e,r)});return{calculatedDuration:t,next:l=>(s.value=a(l),s.done=l>=t,s)}}const kI=t=>{const e=({timestamp:n})=>t(n);return{start:()=>de.update(e,!0),stop:()=>ci(e),now:()=>Ve.isProcessing?Ve.timestamp:on.now()}},SI={decay:gg,inertia:gg,tween:ol,keyframes:ol,spring:wT},TI=t=>t/100;class Pf extends ST{constructor(e){super(e),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:l}=this.options;l&&l()};const{name:n,motionValue:i,element:r,keyframes:s}=this.options,o=(r==null?void 0:r.KeyframeResolver)||wf,a=(l,c)=>this.onKeyframesResolved(l,c);this.resolver=new o(s,a,n,i,r),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(e){const{type:n="keyframes",repeat:i=0,repeatDelay:r=0,repeatType:s,velocity:o=0}=this.options,a=ff(n)?n:SI[n]||ol;let l,c;a!==ol&&typeof e[0]!="number"&&(l=ko(TI,CT(e[0],e[1])),e=[0,100]);const u=a({...this.options,keyframes:e});s==="mirror"&&(c=a({...this.options,keyframes:[...e].reverse(),velocity:-o})),u.calculatedDuration===null&&(u.calculatedDuration=zS(u));const{calculatedDuration:d}=u,h=d+r,f=h*(i+1)-r;return{generator:u,mirroredGenerator:c,mapPercentToKeyframes:l,calculatedDuration:d,resolvedDuration:h,totalDuration:f}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!e?this.pause():this.state=this.pendingPlayState}tick(e,n=!1){const{resolved:i}=this;if(!i){const{keyframes:E}=this.options;return{done:!0,value:E[E.length-1]}}const{finalKeyframe:r,generator:s,mirroredGenerator:o,mapPercentToKeyframes:a,keyframes:l,calculatedDuration:c,totalDuration:u,resolvedDuration:d}=i;if(this.startTime===null)return s.next(0);const{delay:h,repeat:f,repeatType:v,repeatDelay:g,onUpdate:y}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-u/this.speed,this.startTime)),n?this.currentTime=e:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const p=this.currentTime-h*(this.speed>=0?1:-1),m=this.speed>=0?p<0:p>u;this.currentTime=Math.max(p,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=u);let k=this.currentTime,S=s;if(f){const E=Math.min(this.currentTime,u)/d;let I=Math.floor(E),_=E%1;!_&&E>=1&&(_=1),_===1&&I--,I=Math.min(I,f+1),!!(I%2)&&(v==="reverse"?(_=1-_,g&&(_-=g/d)):v==="mirror"&&(S=o)),k=Mn(0,1,_)*d}const T=m?{done:!1,value:l[0]}:S.next(k);a&&(T.value=a(T.value));let{done:b}=T;!m&&c!==null&&(b=this.speed>=0?this.currentTime>=u:this.currentTime<=0);const P=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&b);return P&&r!==void 0&&(T.value=Ul(l,this.options,r)),y&&y(T.value),P&&this.finish(),T}get duration(){const{resolved:e}=this;return e?Pn(e.calculatedDuration):0}get time(){return Pn(this.currentTime)}set time(e){e=En(e),this.currentTime=e,this.holdTime!==null||this.speed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const n=this.playbackSpeed!==e;this.playbackSpeed=e,n&&(this.time=Pn(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:e=kI,onPlay:n,startTime:i}=this.options;this.driver||(this.driver=e(s=>this.tick(s))),n&&n();const r=this.driver.now();this.holdTime!==null?this.startTime=r-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=r):this.startTime=i??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(e=this.currentTime)!==null&&e!==void 0?e:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const CI=new Set(["opacity","clipPath","filter","transform"]);function bI(t,e,n,{delay:i=0,duration:r=300,repeat:s=0,repeatType:o="loop",ease:a="easeInOut",times:l}={}){const c={[e]:n};l&&(c.offset=l);const u=KS(a,r);return Array.isArray(u)&&(c.easing=u),t.animate(c,{delay:i,duration:r,easing:Array.isArray(u)?"linear":u,fill:"both",iterations:s+1,direction:o==="reverse"?"alternate":"normal"})}const wI=Yh(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),al=10,EI=2e4;function PI(t){return ff(t.type)||t.type==="spring"||!qS(t.ease)}function _I(t,e){const n=new Pf({...e,keyframes:t,repeat:0,delay:0,isGenerator:!0});let i={done:!1,value:t[0]};const r=[];let s=0;for(;!i.done&&s<EI;)i=n.sample(s),r.push(i.value),s+=al;return{times:void 0,keyframes:r,duration:s-al,ease:"linear"}}const PT={anticipate:iT,backInOut:nT,circInOut:sT};function RI(t){return t in PT}class yg extends ST{constructor(e){super(e);const{name:n,motionValue:i,element:r,keyframes:s}=this.options;this.resolver=new kT(s,(o,a)=>this.onKeyframesResolved(o,a),n,i,r),this.resolver.scheduleResolve()}initPlayback(e,n){let{duration:i=300,times:r,ease:s,type:o,motionValue:a,name:l,startTime:c}=this.options;if(!a.owner||!a.owner.current)return!1;if(typeof s=="string"&&rl()&&RI(s)&&(s=PT[s]),PI(this.options)){const{onComplete:d,onUpdate:h,motionValue:f,element:v,...g}=this.options,y=_I(e,g);e=y.keyframes,e.length===1&&(e[1]=e[0]),i=y.duration,r=y.times,s=y.ease,o="keyframes"}const u=bI(a.owner.current,l,e,{...this.options,duration:i,times:r,ease:s});return u.startTime=c??this.calcStartTime(),this.pendingTimeline?(ng(u,this.pendingTimeline),this.pendingTimeline=void 0):u.onfinish=()=>{const{onComplete:d}=this.options;a.set(Ul(e,this.options,n)),d&&d(),this.cancel(),this.resolveFinishedPromise()},{animation:u,duration:i,times:r,type:o,ease:s,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:n}=e;return Pn(n)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:n}=e;return Pn(n.currentTime||0)}set time(e){const{resolved:n}=this;if(!n)return;const{animation:i}=n;i.currentTime=En(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:n}=e;return n.playbackRate}set speed(e){const{resolved:n}=this;if(!n)return;const{animation:i}=n;i.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:n}=e;return n.playState}get startTime(){const{resolved:e}=this;if(!e)return null;const{animation:n}=e;return n.startTime}attachTimeline(e){if(!this._resolved)this.pendingTimeline=e;else{const{resolved:n}=this;if(!n)return yt;const{animation:i}=n;ng(i,e)}return yt}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:n}=e;n.playState==="finished"&&this.updateFinishedPromise(),n.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:n}=e;n.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:e}=this;if(!e)return;const{animation:n,keyframes:i,duration:r,type:s,ease:o,times:a}=e;if(n.playState==="idle"||n.playState==="finished")return;if(this.time){const{motionValue:c,onUpdate:u,onComplete:d,element:h,...f}=this.options,v=new Pf({...f,keyframes:i,duration:r,type:s,ease:o,times:a,isGenerator:!0}),g=En(this.time);c.setWithVelocity(v.sample(g-al).value,v.sample(g).value,al)}const{onStop:l}=this.options;l&&l(),this.cancel()}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:n,name:i,repeatDelay:r,repeatType:s,damping:o,type:a}=e;if(!n||!n.owner||!(n.owner.current instanceof HTMLElement))return!1;const{onUpdate:l,transformTemplate:c}=n.owner.getProps();return wI()&&i&&CI.has(i)&&!l&&!c&&!r&&s!=="mirror"&&o!==0&&a!=="inertia"}}const xI={type:"spring",stiffness:500,damping:25,restSpeed:10},II=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),DI={type:"keyframes",duration:.8},MI={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},AI=(t,{keyframes:e})=>e.length>2?DI:zi.has(t)?t.startsWith("scale")?II(e[1]):xI:MI;function OI({when:t,delay:e,delayChildren:n,staggerChildren:i,staggerDirection:r,repeat:s,repeatType:o,repeatDelay:a,from:l,elapsed:c,...u}){return!!Object.keys(u).length}const _f=(t,e,n,i={},r,s)=>o=>{const a=hf(i,t)||{},l=a.delay||i.delay||0;let{elapsed:c=0}=i;c=c-En(l);let u={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:e.getVelocity(),...a,delay:-c,onUpdate:h=>{e.set(h),a.onUpdate&&a.onUpdate(h)},onComplete:()=>{o(),a.onComplete&&a.onComplete()},name:t,motionValue:e,element:s?void 0:r};OI(a)||(u={...u,...AI(t,u)}),u.duration&&(u.duration=En(u.duration)),u.repeatDelay&&(u.repeatDelay=En(u.repeatDelay)),u.from!==void 0&&(u.keyframes[0]=u.from);let d=!1;if((u.type===!1||u.duration===0&&!u.repeatDelay)&&(u.duration=0,u.delay===0&&(d=!0)),d&&!s&&e.get()!==void 0){const h=Ul(u.keyframes,a);if(h!==void 0)return de.update(()=>{u.onUpdate(h),u.onComplete()}),new ZR([])}return!s&&yg.supports(u)?new yg(u):new Pf(u)};function LI({protectedKeys:t,needsAnimating:e},n){const i=t.hasOwnProperty(n)&&e[n]!==!0;return e[n]=!1,i}function _T(t,e,{delay:n=0,transitionOverride:i,type:r}={}){var s;let{transition:o=t.getDefaultTransition(),transitionEnd:a,...l}=e;i&&(o=i);const c=[],u=r&&t.animationState&&t.animationState.getState()[r];for(const d in l){const h=t.getValue(d,(s=t.latestValues[d])!==null&&s!==void 0?s:null),f=l[d];if(f===void 0||u&&LI(u,d))continue;const v={delay:n,...hf(o||{},d)};let g=!1;if(window.MotionHandoffAnimation){const p=YS(t);if(p){const m=window.MotionHandoffAnimation(p,d,de);m!==null&&(v.startTime=m,g=!0)}}pd(t,d),h.start(_f(d,h,f,t.shouldReduceMotion&&JS.has(d)?{type:!1}:v,t,g));const y=h.animation;y&&c.push(y)}return a&&Promise.all(c).then(()=>{de.update(()=>{a&&fx(t,a)})}),c}function Td(t,e,n={}){var i;const r=Fl(t,e,n.type==="exit"?(i=t.presenceContext)===null||i===void 0?void 0:i.custom:void 0);let{transition:s=t.getDefaultTransition()||{}}=r||{};n.transitionOverride&&(s=n.transitionOverride);const o=r?()=>Promise.all(_T(t,r,n)):()=>Promise.resolve(),a=t.variantChildren&&t.variantChildren.size?(c=0)=>{const{delayChildren:u=0,staggerChildren:d,staggerDirection:h}=s;return NI(t,e,u+c,d,h,n)}:()=>Promise.resolve(),{when:l}=s;if(l){const[c,u]=l==="beforeChildren"?[o,a]:[a,o];return c().then(()=>u())}else return Promise.all([o(),a(n.delay)])}function NI(t,e,n=0,i=0,r=1,s){const o=[],a=(t.variantChildren.size-1)*i,l=r===1?(c=0)=>c*i:(c=0)=>a-c*i;return Array.from(t.variantChildren).sort(FI).forEach((c,u)=>{c.notify("AnimationStart",e),o.push(Td(c,e,{...s,delay:n+l(u)}).then(()=>c.notify("AnimationComplete",e)))}),Promise.all(o)}function FI(t,e){return t.sortNodePosition(e)}function UI(t,e,n={}){t.notify("AnimationStart",e);let i;if(Array.isArray(e)){const r=e.map(s=>Td(t,s,n));i=Promise.all(r)}else if(typeof e=="string")i=Td(t,e,n);else{const r=typeof e=="function"?Fl(t,e,n.custom):e;i=Promise.all(_T(t,r,n))}return i.then(()=>{t.notify("AnimationComplete",e)})}const jI=Zh.length;function RT(t){if(!t)return;if(!t.isControllingVariants){const n=t.parent?RT(t.parent)||{}:{};return t.props.initial!==void 0&&(n.initial=t.props.initial),n}const e={};for(let n=0;n<jI;n++){const i=Zh[n],r=t.props[i];(oo(r)||r===!1)&&(e[i]=r)}return e}const VI=[...Xh].reverse(),BI=Xh.length;function zI(t){return e=>Promise.all(e.map(({animation:n,options:i})=>UI(t,n,i)))}function WI(t){let e=zI(t),n=kg(),i=!0;const r=l=>(c,u)=>{var d;const h=Fl(t,u,l==="exit"?(d=t.presenceContext)===null||d===void 0?void 0:d.custom:void 0);if(h){const{transition:f,transitionEnd:v,...g}=h;c={...c,...g,...v}}return c};function s(l){e=l(t)}function o(l){const{props:c}=t,u=RT(t.parent)||{},d=[],h=new Set;let f={},v=1/0;for(let y=0;y<BI;y++){const p=VI[y],m=n[p],k=c[p]!==void 0?c[p]:u[p],S=oo(k),T=p===l?m.isActive:null;T===!1&&(v=y);let b=k===u[p]&&k!==c[p]&&S;if(b&&i&&t.manuallyAnimateOnMount&&(b=!1),m.protectedKeys={...f},!m.isActive&&T===null||!k&&!m.prevProp||Ll(k)||typeof k=="boolean")continue;const P=qI(m.prevProp,k);let E=P||p===l&&m.isActive&&!b&&S||y>v&&S,I=!1;const _=Array.isArray(k)?k:[k];let L=_.reduce(r(p),{});T===!1&&(L={});const{prevResolvedValues:z={}}=m,Y={...z,...L},we=ie=>{E=!0,h.has(ie)&&(I=!0,h.delete(ie)),m.needsAnimating[ie]=!0;const U=t.getValue(ie);U&&(U.liveStyle=!1)};for(const ie in Y){const U=L[ie],q=z[ie];if(f.hasOwnProperty(ie))continue;let K=!1;dd(U)&&dd(q)?K=!BS(U,q):K=U!==q,K?U!=null?we(ie):h.add(ie):U!==void 0&&h.has(ie)?we(ie):m.protectedKeys[ie]=!0}m.prevProp=k,m.prevResolvedValues=L,m.isActive&&(f={...f,...L}),i&&t.blockInitialAnimation&&(E=!1),E&&(!(b&&P)||I)&&d.push(..._.map(ie=>({animation:ie,options:{type:p}})))}if(h.size){const y={};h.forEach(p=>{const m=t.getBaseTarget(p),k=t.getValue(p);k&&(k.liveStyle=!0),y[p]=m??null}),d.push({animation:y})}let g=!!d.length;return i&&(c.initial===!1||c.initial===c.animate)&&!t.manuallyAnimateOnMount&&(g=!1),i=!1,g?e(d):Promise.resolve()}function a(l,c){var u;if(n[l].isActive===c)return Promise.resolve();(u=t.variantChildren)===null||u===void 0||u.forEach(h=>{var f;return(f=h.animationState)===null||f===void 0?void 0:f.setActive(l,c)}),n[l].isActive=c;const d=o(l);for(const h in n)n[h].protectedKeys={};return d}return{animateChanges:o,setActive:a,setAnimateFunction:s,getState:()=>n,reset:()=>{n=kg(),i=!0}}}function qI(t,e){return typeof e=="string"?e!==t:Array.isArray(e)?!BS(e,t):!1}function vi(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function kg(){return{animate:vi(!0),whileInView:vi(),whileHover:vi(),whileTap:vi(),whileDrag:vi(),whileFocus:vi(),exit:vi()}}class gi{constructor(e){this.isMounted=!1,this.node=e}update(){}}class KI extends gi{constructor(e){super(e),e.animationState||(e.animationState=WI(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();Ll(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:n}=this.node.prevProps||{};e!==n&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)===null||e===void 0||e.call(this)}}let HI=0;class GI extends gi{constructor(){super(...arguments),this.id=HI++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:n}=this.node.presenceContext,{isPresent:i}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===i)return;const r=this.node.animationState.setActive("exit",!e);n&&!e&&r.then(()=>n(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}const $I={animation:{Feature:KI},exit:{Feature:GI}};function uo(t,e,n,i={passive:!0}){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n)}function So(t){return{point:{x:t.pageX,y:t.pageY}}}const JI=t=>e=>mf(e)&&t(e,So(e));function As(t,e,n,i){return uo(t,e,JI(n),i)}const Sg=(t,e)=>Math.abs(t-e);function QI(t,e){const n=Sg(t.x,e.x),i=Sg(t.y,e.y);return Math.sqrt(n**2+i**2)}class xT{constructor(e,n,{transformPagePoint:i,contextWindow:r,dragSnapToOrigin:s=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const d=Uc(this.lastMoveEventInfo,this.history),h=this.startEvent!==null,f=QI(d.offset,{x:0,y:0})>=3;if(!h&&!f)return;const{point:v}=d,{timestamp:g}=Ve;this.history.push({...v,timestamp:g});const{onStart:y,onMove:p}=this.handlers;h||(y&&y(this.lastMoveEvent,d),this.startEvent=this.lastMoveEvent),p&&p(this.lastMoveEvent,d)},this.handlePointerMove=(d,h)=>{this.lastMoveEvent=d,this.lastMoveEventInfo=Fc(h,this.transformPagePoint),de.update(this.updatePoint,!0)},this.handlePointerUp=(d,h)=>{this.end();const{onEnd:f,onSessionEnd:v,resumeAnimation:g}=this.handlers;if(this.dragSnapToOrigin&&g&&g(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const y=Uc(d.type==="pointercancel"?this.lastMoveEventInfo:Fc(h,this.transformPagePoint),this.history);this.startEvent&&f&&f(d,y),v&&v(d,y)},!mf(e))return;this.dragSnapToOrigin=s,this.handlers=n,this.transformPagePoint=i,this.contextWindow=r||window;const o=So(e),a=Fc(o,this.transformPagePoint),{point:l}=a,{timestamp:c}=Ve;this.history=[{...l,timestamp:c}];const{onSessionStart:u}=n;u&&u(e,Uc(a,this.history)),this.removeListeners=ko(As(this.contextWindow,"pointermove",this.handlePointerMove),As(this.contextWindow,"pointerup",this.handlePointerUp),As(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),ci(this.updatePoint)}}function Fc(t,e){return e?{point:e(t.point)}:t}function Tg(t,e){return{x:t.x-e.x,y:t.y-e.y}}function Uc({point:t},e){return{point:t,delta:Tg(t,IT(e)),offset:Tg(t,YI(e)),velocity:XI(e,.1)}}function YI(t){return t[0]}function IT(t){return t[t.length-1]}function XI(t,e){if(t.length<2)return{x:0,y:0};let n=t.length-1,i=null;const r=IT(t);for(;n>=0&&(i=t[n],!(r.timestamp-i.timestamp>En(e)));)n--;if(!i)return{x:0,y:0};const s=Pn(r.timestamp-i.timestamp);if(s===0)return{x:0,y:0};const o={x:(r.x-i.x)/s,y:(r.y-i.y)/s};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}const DT=1e-4,ZI=1-DT,eD=1+DT,MT=.01,tD=0-MT,nD=0+MT;function St(t){return t.max-t.min}function iD(t,e,n){return Math.abs(t-e)<=n}function Cg(t,e,n,i=.5){t.origin=i,t.originPoint=me(e.min,e.max,t.origin),t.scale=St(n)/St(e),t.translate=me(n.min,n.max,t.origin)-t.originPoint,(t.scale>=ZI&&t.scale<=eD||isNaN(t.scale))&&(t.scale=1),(t.translate>=tD&&t.translate<=nD||isNaN(t.translate))&&(t.translate=0)}function Os(t,e,n,i){Cg(t.x,e.x,n.x,i?i.originX:void 0),Cg(t.y,e.y,n.y,i?i.originY:void 0)}function bg(t,e,n){t.min=n.min+e.min,t.max=t.min+St(e)}function rD(t,e,n){bg(t.x,e.x,n.x),bg(t.y,e.y,n.y)}function wg(t,e,n){t.min=e.min-n.min,t.max=t.min+St(e)}function Ls(t,e,n){wg(t.x,e.x,n.x),wg(t.y,e.y,n.y)}function sD(t,{min:e,max:n},i){return e!==void 0&&t<e?t=i?me(e,t,i.min):Math.max(t,e):n!==void 0&&t>n&&(t=i?me(n,t,i.max):Math.min(t,n)),t}function Eg(t,e,n){return{min:e!==void 0?t.min+e:void 0,max:n!==void 0?t.max+n-(t.max-t.min):void 0}}function oD(t,{top:e,left:n,bottom:i,right:r}){return{x:Eg(t.x,n,r),y:Eg(t.y,e,i)}}function Pg(t,e){let n=e.min-t.min,i=e.max-t.max;return e.max-e.min<t.max-t.min&&([n,i]=[i,n]),{min:n,max:i}}function aD(t,e){return{x:Pg(t.x,e.x),y:Pg(t.y,e.y)}}function lD(t,e){let n=.5;const i=St(t),r=St(e);return r>i?n=Ur(e.min,e.max-i,t.min):i>r&&(n=Ur(t.min,t.max-r,e.min)),Mn(0,1,n)}function cD(t,e){const n={};return e.min!==void 0&&(n.min=e.min-t.min),e.max!==void 0&&(n.max=e.max-t.min),n}const Cd=.35;function uD(t=Cd){return t===!1?t=0:t===!0&&(t=Cd),{x:_g(t,"left","right"),y:_g(t,"top","bottom")}}function _g(t,e,n){return{min:Rg(t,e),max:Rg(t,n)}}function Rg(t,e){return typeof t=="number"?t:t[e]||0}const xg=()=>({translate:0,scale:1,origin:0,originPoint:0}),ur=()=>({x:xg(),y:xg()}),Ig=()=>({min:0,max:0}),Ee=()=>({x:Ig(),y:Ig()});function Et(t){return[t("x"),t("y")]}function AT({top:t,left:e,right:n,bottom:i}){return{x:{min:e,max:n},y:{min:t,max:i}}}function dD({x:t,y:e}){return{top:e.min,right:t.max,bottom:e.max,left:t.min}}function hD(t,e){if(!e)return t;const n=e({x:t.left,y:t.top}),i=e({x:t.right,y:t.bottom});return{top:n.y,left:n.x,bottom:i.y,right:i.x}}function jc(t){return t===void 0||t===1}function bd({scale:t,scaleX:e,scaleY:n}){return!jc(t)||!jc(e)||!jc(n)}function Ci(t){return bd(t)||OT(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function OT(t){return Dg(t.x)||Dg(t.y)}function Dg(t){return t&&t!=="0%"}function ll(t,e,n){const i=t-n,r=e*i;return n+r}function Mg(t,e,n,i,r){return r!==void 0&&(t=ll(t,r,i)),ll(t,n,i)+e}function wd(t,e=0,n=1,i,r){t.min=Mg(t.min,e,n,i,r),t.max=Mg(t.max,e,n,i,r)}function LT(t,{x:e,y:n}){wd(t.x,e.translate,e.scale,e.originPoint),wd(t.y,n.translate,n.scale,n.originPoint)}const Ag=.999999999999,Og=1.0000000000001;function fD(t,e,n,i=!1){const r=n.length;if(!r)return;e.x=e.y=1;let s,o;for(let a=0;a<r;a++){s=n[a],o=s.projectionDelta;const{visualElement:l}=s.options;l&&l.props.style&&l.props.style.display==="contents"||(i&&s.options.layoutScroll&&s.scroll&&s!==s.root&&hr(t,{x:-s.scroll.offset.x,y:-s.scroll.offset.y}),o&&(e.x*=o.x.scale,e.y*=o.y.scale,LT(t,o)),i&&Ci(s.latestValues)&&hr(t,s.latestValues))}e.x<Og&&e.x>Ag&&(e.x=1),e.y<Og&&e.y>Ag&&(e.y=1)}function dr(t,e){t.min=t.min+e,t.max=t.max+e}function Lg(t,e,n,i,r=.5){const s=me(t.min,t.max,r);wd(t,e,n,s,i)}function hr(t,e){Lg(t.x,e.x,e.scaleX,e.scale,e.originX),Lg(t.y,e.y,e.scaleY,e.scale,e.originY)}function NT(t,e){return AT(hD(t.getBoundingClientRect(),e))}function pD(t,e,n){const i=NT(t,n),{scroll:r}=e;return r&&(dr(i.x,r.offset.x),dr(i.y,r.offset.y)),i}const FT=({current:t})=>t?t.ownerDocument.defaultView:null,mD=new WeakMap;class gD{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Ee(),this.visualElement=e}start(e,{snapToCursor:n=!1}={}){const{presenceContext:i}=this.visualElement;if(i&&i.isPresent===!1)return;const r=u=>{const{dragSnapToOrigin:d}=this.getProps();d?this.pauseAnimation():this.stopAnimation(),n&&this.snapToCursor(So(u).point)},s=(u,d)=>{const{drag:h,dragPropagation:f,onDragStart:v}=this.getProps();if(h&&!f&&(this.openDragLock&&this.openDragLock(),this.openDragLock=lx(h),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Et(y=>{let p=this.getAxisMotionValue(y).get()||0;if(sn.test(p)){const{projection:m}=this.visualElement;if(m&&m.layout){const k=m.layout.layoutBox[y];k&&(p=St(k)*(parseFloat(p)/100))}}this.originPoint[y]=p}),v&&de.postRender(()=>v(u,d)),pd(this.visualElement,"transform");const{animationState:g}=this.visualElement;g&&g.setActive("whileDrag",!0)},o=(u,d)=>{const{dragPropagation:h,dragDirectionLock:f,onDirectionLock:v,onDrag:g}=this.getProps();if(!h&&!this.openDragLock)return;const{offset:y}=d;if(f&&this.currentDirection===null){this.currentDirection=vD(y),this.currentDirection!==null&&v&&v(this.currentDirection);return}this.updateAxis("x",d.point,y),this.updateAxis("y",d.point,y),this.visualElement.render(),g&&g(u,d)},a=(u,d)=>this.stop(u,d),l=()=>Et(u=>{var d;return this.getAnimationState(u)==="paused"&&((d=this.getAxisMotionValue(u).animation)===null||d===void 0?void 0:d.play())}),{dragSnapToOrigin:c}=this.getProps();this.panSession=new xT(e,{onSessionStart:r,onStart:s,onMove:o,onSessionEnd:a,resumeAnimation:l},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:c,contextWindow:FT(this.visualElement)})}stop(e,n){const i=this.isDragging;if(this.cancel(),!i)return;const{velocity:r}=n;this.startAnimation(r);const{onDragEnd:s}=this.getProps();s&&de.postRender(()=>s(e,n))}cancel(){this.isDragging=!1;const{projection:e,animationState:n}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:i}=this.getProps();!i&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),n&&n.setActive("whileDrag",!1)}updateAxis(e,n,i){const{drag:r}=this.getProps();if(!i||!qo(e,r,this.currentDirection))return;const s=this.getAxisMotionValue(e);let o=this.originPoint[e]+i[e];this.constraints&&this.constraints[e]&&(o=sD(o,this.constraints[e],this.elastic[e])),s.set(o)}resolveConstraints(){var e;const{dragConstraints:n,dragElastic:i}=this.getProps(),r=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(e=this.visualElement.projection)===null||e===void 0?void 0:e.layout,s=this.constraints;n&&lr(n)?this.constraints||(this.constraints=this.resolveRefConstraints()):n&&r?this.constraints=oD(r.layoutBox,n):this.constraints=!1,this.elastic=uD(i),s!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&Et(o=>{this.constraints!==!1&&this.getAxisMotionValue(o)&&(this.constraints[o]=cD(r.layoutBox[o],this.constraints[o]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:n}=this.getProps();if(!e||!lr(e))return!1;const i=e.current,{projection:r}=this.visualElement;if(!r||!r.layout)return!1;const s=pD(i,r.root,this.visualElement.getTransformPagePoint());let o=aD(r.layout.layoutBox,s);if(n){const a=n(dD(o));this.hasMutatedConstraints=!!a,a&&(o=AT(a))}return o}startAnimation(e){const{drag:n,dragMomentum:i,dragElastic:r,dragTransition:s,dragSnapToOrigin:o,onDragTransitionEnd:a}=this.getProps(),l=this.constraints||{},c=Et(u=>{if(!qo(u,n,this.currentDirection))return;let d=l&&l[u]||{};o&&(d={min:0,max:0});const h=r?200:1e6,f=r?40:1e7,v={type:"inertia",velocity:i?e[u]:0,bounceStiffness:h,bounceDamping:f,timeConstant:750,restDelta:1,restSpeed:10,...s,...d};return this.startAxisValueAnimation(u,v)});return Promise.all(c).then(a)}startAxisValueAnimation(e,n){const i=this.getAxisMotionValue(e);return pd(this.visualElement,e),i.start(_f(e,i,0,n,this.visualElement,!1))}stopAnimation(){Et(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Et(e=>{var n;return(n=this.getAxisMotionValue(e).animation)===null||n===void 0?void 0:n.pause()})}getAnimationState(e){var n;return(n=this.getAxisMotionValue(e).animation)===null||n===void 0?void 0:n.state}getAxisMotionValue(e){const n=`_drag${e.toUpperCase()}`,i=this.visualElement.getProps(),r=i[n];return r||this.visualElement.getValue(e,(i.initial?i.initial[e]:void 0)||0)}snapToCursor(e){Et(n=>{const{drag:i}=this.getProps();if(!qo(n,i,this.currentDirection))return;const{projection:r}=this.visualElement,s=this.getAxisMotionValue(n);if(r&&r.layout){const{min:o,max:a}=r.layout.layoutBox[n];s.set(e[n]-me(o,a,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:n}=this.getProps(),{projection:i}=this.visualElement;if(!lr(n)||!i||!this.constraints)return;this.stopAnimation();const r={x:0,y:0};Et(o=>{const a=this.getAxisMotionValue(o);if(a&&this.constraints!==!1){const l=a.get();r[o]=lD({min:l,max:l},this.constraints[o])}});const{transformTemplate:s}=this.visualElement.getProps();this.visualElement.current.style.transform=s?s({},""):"none",i.root&&i.root.updateScroll(),i.updateLayout(),this.resolveConstraints(),Et(o=>{if(!qo(o,e,null))return;const a=this.getAxisMotionValue(o),{min:l,max:c}=this.constraints[o];a.set(me(l,c,r[o]))})}addListeners(){if(!this.visualElement.current)return;mD.set(this.visualElement,this);const e=this.visualElement.current,n=As(e,"pointerdown",l=>{const{drag:c,dragListener:u=!0}=this.getProps();c&&u&&this.start(l)}),i=()=>{const{dragConstraints:l}=this.getProps();lr(l)&&l.current&&(this.constraints=this.resolveRefConstraints())},{projection:r}=this.visualElement,s=r.addEventListener("measure",i);r&&!r.layout&&(r.root&&r.root.updateScroll(),r.updateLayout()),de.read(i);const o=uo(window,"resize",()=>this.scalePositionWithinConstraints()),a=r.addEventListener("didUpdate",({delta:l,hasLayoutChanged:c})=>{this.isDragging&&c&&(Et(u=>{const d=this.getAxisMotionValue(u);d&&(this.originPoint[u]+=l[u].translate,d.set(d.get()+l[u].translate))}),this.visualElement.render())});return()=>{o(),n(),s(),a&&a()}}getProps(){const e=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:i=!1,dragPropagation:r=!1,dragConstraints:s=!1,dragElastic:o=Cd,dragMomentum:a=!0}=e;return{...e,drag:n,dragDirectionLock:i,dragPropagation:r,dragConstraints:s,dragElastic:o,dragMomentum:a}}}function qo(t,e,n){return(e===!0||e===t)&&(n===null||n===t)}function vD(t,e=10){let n=null;return Math.abs(t.y)>e?n="y":Math.abs(t.x)>e&&(n="x"),n}class yD extends gi{constructor(e){super(e),this.removeGroupControls=yt,this.removeListeners=yt,this.controls=new gD(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||yt}unmount(){this.removeGroupControls(),this.removeListeners()}}const Ng=t=>(e,n)=>{t&&de.postRender(()=>t(e,n))};class kD extends gi{constructor(){super(...arguments),this.removePointerDownListener=yt}onPointerDown(e){this.session=new xT(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:FT(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:n,onPan:i,onPanEnd:r}=this.node.getProps();return{onSessionStart:Ng(e),onStart:Ng(n),onMove:i,onEnd:(s,o)=>{delete this.session,r&&de.postRender(()=>r(s,o))}}}mount(){this.removePointerDownListener=As(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const ya={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function Fg(t,e){return e.max===e.min?0:t/(e.max-e.min)*100}const as={correct:(t,e)=>{if(!e.target)return t;if(typeof t=="string")if(W.test(t))t=parseFloat(t);else return t;const n=Fg(t,e.target.x),i=Fg(t,e.target.y);return`${n}% ${i}%`}},SD={correct:(t,{treeScale:e,projectionDelta:n})=>{const i=t,r=ui.parse(t);if(r.length>5)return i;const s=ui.createTransformer(t),o=typeof r[0]!="number"?1:0,a=n.x.scale*e.x,l=n.y.scale*e.y;r[0+o]/=a,r[1+o]/=l;const c=me(a,l,.5);return typeof r[2+o]=="number"&&(r[2+o]/=c),typeof r[3+o]=="number"&&(r[3+o]/=c),s(r)}};class TD extends V.Component{componentDidMount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:i,layoutId:r}=this.props,{projection:s}=e;BR(CD),s&&(n.group&&n.group.add(s),i&&i.register&&r&&i.register(s),s.root.didUpdate(),s.addEventListener("animationComplete",()=>{this.safeToRemove()}),s.setOptions({...s.options,onExitComplete:()=>this.safeToRemove()})),ya.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:n,visualElement:i,drag:r,isPresent:s}=this.props,o=i.projection;return o&&(o.isPresent=s,r||e.layoutDependency!==n||n===void 0?o.willUpdate():this.safeToRemove(),e.isPresent!==s&&(s?o.promote():o.relegate()||de.postRender(()=>{const a=o.getStack();(!a||!a.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),tf.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:i}=this.props,{projection:r}=e;r&&(r.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(r),i&&i.deregister&&i.deregister(r))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function UT(t){const[e,n]=nR(),i=V.useContext(SS);return M.jsx(TD,{...t,layoutGroup:i,switchLayoutGroup:V.useContext(RS),isPresent:e,safeToRemove:n})}const CD={borderRadius:{...as,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:as,borderTopRightRadius:as,borderBottomLeftRadius:as,borderBottomRightRadius:as,boxShadow:SD};function bD(t,e,n){const i=Je(t)?t:lo(t);return i.start(_f("",i,e,n)),i.animation}function wD(t){return t instanceof SVGElement&&t.tagName!=="svg"}const ED=(t,e)=>t.depth-e.depth;class PD{constructor(){this.children=[],this.isDirty=!1}add(e){gf(this.children,e),this.isDirty=!0}remove(e){vf(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(ED),this.isDirty=!1,this.children.forEach(e)}}function _D(t,e){const n=on.now(),i=({timestamp:r})=>{const s=r-n;s>=e&&(ci(i),t(s-e))};return de.read(i,!0),()=>ci(i)}const jT=["TopLeft","TopRight","BottomLeft","BottomRight"],RD=jT.length,Ug=t=>typeof t=="string"?parseFloat(t):t,jg=t=>typeof t=="number"||W.test(t);function xD(t,e,n,i,r,s){r?(t.opacity=me(0,n.opacity!==void 0?n.opacity:1,ID(i)),t.opacityExit=me(e.opacity!==void 0?e.opacity:1,0,DD(i))):s&&(t.opacity=me(e.opacity!==void 0?e.opacity:1,n.opacity!==void 0?n.opacity:1,i));for(let o=0;o<RD;o++){const a=`border${jT[o]}Radius`;let l=Vg(e,a),c=Vg(n,a);if(l===void 0&&c===void 0)continue;l||(l=0),c||(c=0),l===0||c===0||jg(l)===jg(c)?(t[a]=Math.max(me(Ug(l),Ug(c),i),0),(sn.test(c)||sn.test(l))&&(t[a]+="%")):t[a]=c}(e.rotate||n.rotate)&&(t.rotate=me(e.rotate||0,n.rotate||0,i))}function Vg(t,e){return t[e]!==void 0?t[e]:t.borderRadius}const ID=VT(0,.5,rT),DD=VT(.5,.95,yt);function VT(t,e,n){return i=>i<t?0:i>e?1:n(Ur(t,e,i))}function Bg(t,e){t.min=e.min,t.max=e.max}function bt(t,e){Bg(t.x,e.x),Bg(t.y,e.y)}function zg(t,e){t.translate=e.translate,t.scale=e.scale,t.originPoint=e.originPoint,t.origin=e.origin}function Wg(t,e,n,i,r){return t-=e,t=ll(t,1/n,i),r!==void 0&&(t=ll(t,1/r,i)),t}function MD(t,e=0,n=1,i=.5,r,s=t,o=t){if(sn.test(e)&&(e=parseFloat(e),e=me(o.min,o.max,e/100)-o.min),typeof e!="number")return;let a=me(s.min,s.max,i);t===s&&(a-=e),t.min=Wg(t.min,e,n,a,r),t.max=Wg(t.max,e,n,a,r)}function qg(t,e,[n,i,r],s,o){MD(t,e[n],e[i],e[r],e.scale,s,o)}const AD=["x","scaleX","originX"],OD=["y","scaleY","originY"];function Kg(t,e,n,i){qg(t.x,e,AD,n?n.x:void 0,i?i.x:void 0),qg(t.y,e,OD,n?n.y:void 0,i?i.y:void 0)}function Hg(t){return t.translate===0&&t.scale===1}function BT(t){return Hg(t.x)&&Hg(t.y)}function Gg(t,e){return t.min===e.min&&t.max===e.max}function LD(t,e){return Gg(t.x,e.x)&&Gg(t.y,e.y)}function $g(t,e){return Math.round(t.min)===Math.round(e.min)&&Math.round(t.max)===Math.round(e.max)}function zT(t,e){return $g(t.x,e.x)&&$g(t.y,e.y)}function Jg(t){return St(t.x)/St(t.y)}function Qg(t,e){return t.translate===e.translate&&t.scale===e.scale&&t.originPoint===e.originPoint}class ND{constructor(){this.members=[]}add(e){gf(this.members,e),e.scheduleRender()}remove(e){if(vf(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(e){const n=this.members.findIndex(r=>e===r);if(n===0)return!1;let i;for(let r=n;r>=0;r--){const s=this.members[r];if(s.isPresent!==!1){i=s;break}}return i?(this.promote(i),!0):!1}promote(e,n){const i=this.lead;if(e!==i&&(this.prevLead=i,this.lead=e,e.show(),i)){i.instance&&i.scheduleRender(),e.scheduleRender(),e.resumeFrom=i,n&&(e.resumeFrom.preserveOpacity=!0),i.snapshot&&(e.snapshot=i.snapshot,e.snapshot.latestValues=i.animationValues||i.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:r}=e.options;r===!1&&i.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:n,resumingFrom:i}=e;n.onExitComplete&&n.onExitComplete(),i&&i.options.onExitComplete&&i.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function FD(t,e,n){let i="";const r=t.x.translate/e.x,s=t.y.translate/e.y,o=(n==null?void 0:n.z)||0;if((r||s||o)&&(i=`translate3d(${r}px, ${s}px, ${o}px) `),(e.x!==1||e.y!==1)&&(i+=`scale(${1/e.x}, ${1/e.y}) `),n){const{transformPerspective:c,rotate:u,rotateX:d,rotateY:h,skewX:f,skewY:v}=n;c&&(i=`perspective(${c}px) ${i}`),u&&(i+=`rotate(${u}deg) `),d&&(i+=`rotateX(${d}deg) `),h&&(i+=`rotateY(${h}deg) `),f&&(i+=`skewX(${f}deg) `),v&&(i+=`skewY(${v}deg) `)}const a=t.x.scale*e.x,l=t.y.scale*e.y;return(a!==1||l!==1)&&(i+=`scale(${a}, ${l})`),i||"none"}const bi={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},gs=typeof window<"u"&&window.MotionDebug!==void 0,Vc=["","X","Y","Z"],UD={visibility:"hidden"},Yg=1e3;let jD=0;function Bc(t,e,n,i){const{latestValues:r}=e;r[t]&&(n[t]=r[t],e.setStaticValue(t,0),i&&(i[t]=0))}function WT(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:e}=t.options;if(!e)return;const n=YS(e);if(window.MotionHasOptimisedAnimation(n,"transform")){const{layout:r,layoutId:s}=t.options;window.MotionCancelOptimisedAnimation(n,"transform",de,!(r||s))}const{parent:i}=t;i&&!i.hasCheckedOptimisedAppear&&WT(i)}function qT({attachResizeListener:t,defaultParent:e,measureScroll:n,checkIsScrollRoot:i,resetTransform:r}){return class{constructor(o={},a=e==null?void 0:e()){this.id=jD++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,gs&&(bi.totalNodes=bi.resolvedTargetDeltas=bi.recalculatedProjection=0),this.nodes.forEach(zD),this.nodes.forEach(GD),this.nodes.forEach($D),this.nodes.forEach(WD),gs&&window.MotionDebug.record(bi)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=o,this.root=a?a.root||a:this,this.path=a?[...a.path,a]:[],this.parent=a,this.depth=a?a.depth+1:0;for(let l=0;l<this.path.length;l++)this.path[l].shouldResetTransform=!0;this.root===this&&(this.nodes=new PD)}addEventListener(o,a){return this.eventHandlers.has(o)||this.eventHandlers.set(o,new yf),this.eventHandlers.get(o).add(a)}notifyListeners(o,...a){const l=this.eventHandlers.get(o);l&&l.notify(...a)}hasListeners(o){return this.eventHandlers.has(o)}mount(o,a=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=wD(o),this.instance=o;const{layoutId:l,layout:c,visualElement:u}=this.options;if(u&&!u.current&&u.mount(o),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),a&&(c||l)&&(this.isLayoutDirty=!0),t){let d;const h=()=>this.root.updateBlockedByResize=!1;t(o,()=>{this.root.updateBlockedByResize=!0,d&&d(),d=_D(h,250),ya.hasAnimatedSinceResize&&(ya.hasAnimatedSinceResize=!1,this.nodes.forEach(Zg))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&u&&(l||c)&&this.addEventListener("didUpdate",({delta:d,hasLayoutChanged:h,hasRelativeTargetChanged:f,layout:v})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const g=this.options.transition||u.getDefaultTransition()||ZD,{onLayoutAnimationStart:y,onLayoutAnimationComplete:p}=u.getProps(),m=!this.targetLayout||!zT(this.targetLayout,v)||f,k=!h&&f;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||k||h&&(m||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(d,k);const S={...hf(g,"layout"),onPlay:y,onComplete:p};(u.shouldReduceMotion||this.options.layoutRoot)&&(S.delay=0,S.type=!1),this.startAnimation(S)}else h||Zg(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=v})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const o=this.getStack();o&&o.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,ci(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(JD),this.animationId++)}getTransformTemplate(){const{visualElement:o}=this.options;return o&&o.getProps().transformTemplate}willUpdate(o=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&WT(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const d=this.path[u];d.shouldResetTransform=!0,d.updateScroll("snapshot"),d.options.layoutRoot&&d.willUpdate(!1)}const{layoutId:a,layout:l}=this.options;if(a===void 0&&!l)return;const c=this.getTransformTemplate();this.prevTransformTemplateValue=c?c(this.latestValues,""):void 0,this.updateSnapshot(),o&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(Xg);return}this.isUpdating||this.nodes.forEach(KD),this.isUpdating=!1,this.nodes.forEach(HD),this.nodes.forEach(VD),this.nodes.forEach(BD),this.clearAllSnapshots();const a=on.now();Ve.delta=Mn(0,1e3/60,a-Ve.timestamp),Ve.timestamp=a,Ve.isProcessing=!0,Dc.update.process(Ve),Dc.preRender.process(Ve),Dc.render.process(Ve),Ve.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,tf.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(qD),this.sharedNodes.forEach(QD)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,de.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){de.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let l=0;l<this.path.length;l++)this.path[l].updateScroll();const o=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Ee(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:a}=this.options;a&&a.notify("LayoutMeasure",this.layout.layoutBox,o?o.layoutBox:void 0)}updateScroll(o="measure"){let a=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===o&&(a=!1),a){const l=i(this.instance);this.scroll={animationId:this.root.animationId,phase:o,isRoot:l,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:l}}}resetTransform(){if(!r)return;const o=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,a=this.projectionDelta&&!BT(this.projectionDelta),l=this.getTransformTemplate(),c=l?l(this.latestValues,""):void 0,u=c!==this.prevTransformTemplateValue;o&&(a||Ci(this.latestValues)||u)&&(r(this.instance,c),this.shouldResetTransform=!1,this.scheduleRender())}measure(o=!0){const a=this.measurePageBox();let l=this.removeElementScroll(a);return o&&(l=this.removeTransform(l)),eM(l),{animationId:this.root.animationId,measuredBox:a,layoutBox:l,latestValues:{},source:this.id}}measurePageBox(){var o;const{visualElement:a}=this.options;if(!a)return Ee();const l=a.measureViewportBox();if(!(((o=this.scroll)===null||o===void 0?void 0:o.wasRoot)||this.path.some(tM))){const{scroll:u}=this.root;u&&(dr(l.x,u.offset.x),dr(l.y,u.offset.y))}return l}removeElementScroll(o){var a;const l=Ee();if(bt(l,o),!((a=this.scroll)===null||a===void 0)&&a.wasRoot)return l;for(let c=0;c<this.path.length;c++){const u=this.path[c],{scroll:d,options:h}=u;u!==this.root&&d&&h.layoutScroll&&(d.wasRoot&&bt(l,o),dr(l.x,d.offset.x),dr(l.y,d.offset.y))}return l}applyTransform(o,a=!1){const l=Ee();bt(l,o);for(let c=0;c<this.path.length;c++){const u=this.path[c];!a&&u.options.layoutScroll&&u.scroll&&u!==u.root&&hr(l,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),Ci(u.latestValues)&&hr(l,u.latestValues)}return Ci(this.latestValues)&&hr(l,this.latestValues),l}removeTransform(o){const a=Ee();bt(a,o);for(let l=0;l<this.path.length;l++){const c=this.path[l];if(!c.instance||!Ci(c.latestValues))continue;bd(c.latestValues)&&c.updateSnapshot();const u=Ee(),d=c.measurePageBox();bt(u,d),Kg(a,c.latestValues,c.snapshot?c.snapshot.layoutBox:void 0,u)}return Ci(this.latestValues)&&Kg(a,this.latestValues),a}setTargetDelta(o){this.targetDelta=o,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(o){this.options={...this.options,...o,crossfade:o.crossfade!==void 0?o.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Ve.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(o=!1){var a;const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const c=!!this.resumingFrom||this!==l;if(!(o||c&&this.isSharedProjectionDirty||this.isProjectionDirty||!((a=this.parent)===null||a===void 0)&&a.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:d,layoutId:h}=this.options;if(!(!this.layout||!(d||h))){if(this.resolvedRelativeTargetAt=Ve.timestamp,!this.targetDelta&&!this.relativeTarget){const f=this.getClosestProjectingParent();f&&f.layout&&this.animationProgress!==1?(this.relativeParent=f,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ee(),this.relativeTargetOrigin=Ee(),Ls(this.relativeTargetOrigin,this.layout.layoutBox,f.layout.layoutBox),bt(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Ee(),this.targetWithTransforms=Ee()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),rD(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):bt(this.target,this.layout.layoutBox),LT(this.target,this.targetDelta)):bt(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const f=this.getClosestProjectingParent();f&&!!f.resumingFrom==!!this.resumingFrom&&!f.options.layoutScroll&&f.target&&this.animationProgress!==1?(this.relativeParent=f,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ee(),this.relativeTargetOrigin=Ee(),Ls(this.relativeTargetOrigin,this.target,f.target),bt(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}gs&&bi.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||bd(this.parent.latestValues)||OT(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var o;const a=this.getLead(),l=!!this.resumingFrom||this!==a;let c=!0;if((this.isProjectionDirty||!((o=this.parent)===null||o===void 0)&&o.isProjectionDirty)&&(c=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),this.resolvedRelativeTargetAt===Ve.timestamp&&(c=!1),c)return;const{layout:u,layoutId:d}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(u||d))return;bt(this.layoutCorrected,this.layout.layoutBox);const h=this.treeScale.x,f=this.treeScale.y;fD(this.layoutCorrected,this.treeScale,this.path,l),a.layout&&!a.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(a.target=a.layout.layoutBox,a.targetWithTransforms=Ee());const{target:v}=a;if(!v){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(zg(this.prevProjectionDelta.x,this.projectionDelta.x),zg(this.prevProjectionDelta.y,this.projectionDelta.y)),Os(this.projectionDelta,this.layoutCorrected,v,this.latestValues),(this.treeScale.x!==h||this.treeScale.y!==f||!Qg(this.projectionDelta.x,this.prevProjectionDelta.x)||!Qg(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",v)),gs&&bi.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(o=!0){var a;if((a=this.options.visualElement)===null||a===void 0||a.scheduleRender(),o){const l=this.getStack();l&&l.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=ur(),this.projectionDelta=ur(),this.projectionDeltaWithTransform=ur()}setAnimationOrigin(o,a=!1){const l=this.snapshot,c=l?l.latestValues:{},u={...this.latestValues},d=ur();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!a;const h=Ee(),f=l?l.source:void 0,v=this.layout?this.layout.source:void 0,g=f!==v,y=this.getStack(),p=!y||y.members.length<=1,m=!!(g&&!p&&this.options.crossfade===!0&&!this.path.some(XD));this.animationProgress=0;let k;this.mixTargetDelta=S=>{const T=S/1e3;ev(d.x,o.x,T),ev(d.y,o.y,T),this.setTargetDelta(d),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Ls(h,this.layout.layoutBox,this.relativeParent.layout.layoutBox),YD(this.relativeTarget,this.relativeTargetOrigin,h,T),k&&LD(this.relativeTarget,k)&&(this.isProjectionDirty=!1),k||(k=Ee()),bt(k,this.relativeTarget)),g&&(this.animationValues=u,xD(u,c,this.latestValues,T,m,p)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=T},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(o){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(ci(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=de.update(()=>{ya.hasAnimatedSinceResize=!0,this.currentAnimation=bD(0,Yg,{...o,onUpdate:a=>{this.mixTargetDelta(a),o.onUpdate&&o.onUpdate(a)},onComplete:()=>{o.onComplete&&o.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const o=this.getStack();o&&o.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(Yg),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const o=this.getLead();let{targetWithTransforms:a,target:l,layout:c,latestValues:u}=o;if(!(!a||!l||!c)){if(this!==o&&this.layout&&c&&KT(this.options.animationType,this.layout.layoutBox,c.layoutBox)){l=this.target||Ee();const d=St(this.layout.layoutBox.x);l.x.min=o.target.x.min,l.x.max=l.x.min+d;const h=St(this.layout.layoutBox.y);l.y.min=o.target.y.min,l.y.max=l.y.min+h}bt(a,l),hr(a,u),Os(this.projectionDeltaWithTransform,this.layoutCorrected,a,u)}}registerSharedNode(o,a){this.sharedNodes.has(o)||this.sharedNodes.set(o,new ND),this.sharedNodes.get(o).add(a);const c=a.options.initialPromotionConfig;a.promote({transition:c?c.transition:void 0,preserveFollowOpacity:c&&c.shouldPreserveFollowOpacity?c.shouldPreserveFollowOpacity(a):void 0})}isLead(){const o=this.getStack();return o?o.lead===this:!0}getLead(){var o;const{layoutId:a}=this.options;return a?((o=this.getStack())===null||o===void 0?void 0:o.lead)||this:this}getPrevLead(){var o;const{layoutId:a}=this.options;return a?(o=this.getStack())===null||o===void 0?void 0:o.prevLead:void 0}getStack(){const{layoutId:o}=this.options;if(o)return this.root.sharedNodes.get(o)}promote({needsReset:o,transition:a,preserveFollowOpacity:l}={}){const c=this.getStack();c&&c.promote(this,l),o&&(this.projectionDelta=void 0,this.needsReset=!0),a&&this.setOptions({transition:a})}relegate(){const o=this.getStack();return o?o.relegate(this):!1}resetSkewAndRotation(){const{visualElement:o}=this.options;if(!o)return;let a=!1;const{latestValues:l}=o;if((l.z||l.rotate||l.rotateX||l.rotateY||l.rotateZ||l.skewX||l.skewY)&&(a=!0),!a)return;const c={};l.z&&Bc("z",o,c,this.animationValues);for(let u=0;u<Vc.length;u++)Bc(`rotate${Vc[u]}`,o,c,this.animationValues),Bc(`skew${Vc[u]}`,o,c,this.animationValues);o.render();for(const u in c)o.setStaticValue(u,c[u]),this.animationValues&&(this.animationValues[u]=c[u]);o.scheduleRender()}getProjectionStyles(o){var a,l;if(!this.instance||this.isSVG)return;if(!this.isVisible)return UD;const c={visibility:""},u=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,c.opacity="",c.pointerEvents=ga(o==null?void 0:o.pointerEvents)||"",c.transform=u?u(this.latestValues,""):"none",c;const d=this.getLead();if(!this.projectionDelta||!this.layout||!d.target){const g={};return this.options.layoutId&&(g.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,g.pointerEvents=ga(o==null?void 0:o.pointerEvents)||""),this.hasProjected&&!Ci(this.latestValues)&&(g.transform=u?u({},""):"none",this.hasProjected=!1),g}const h=d.animationValues||d.latestValues;this.applyTransformsToTarget(),c.transform=FD(this.projectionDeltaWithTransform,this.treeScale,h),u&&(c.transform=u(h,c.transform));const{x:f,y:v}=this.projectionDelta;c.transformOrigin=`${f.origin*100}% ${v.origin*100}% 0`,d.animationValues?c.opacity=d===this?(l=(a=h.opacity)!==null&&a!==void 0?a:this.latestValues.opacity)!==null&&l!==void 0?l:1:this.preserveOpacity?this.latestValues.opacity:h.opacityExit:c.opacity=d===this?h.opacity!==void 0?h.opacity:"":h.opacityExit!==void 0?h.opacityExit:0;for(const g in il){if(h[g]===void 0)continue;const{correct:y,applyTo:p}=il[g],m=c.transform==="none"?h[g]:y(h[g],d);if(p){const k=p.length;for(let S=0;S<k;S++)c[p[S]]=m}else c[g]=m}return this.options.layoutId&&(c.pointerEvents=d===this?ga(o==null?void 0:o.pointerEvents)||"":"none"),c}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(o=>{var a;return(a=o.currentAnimation)===null||a===void 0?void 0:a.stop()}),this.root.nodes.forEach(Xg),this.root.sharedNodes.clear()}}}function VD(t){t.updateLayout()}function BD(t){var e;const n=((e=t.resumeFrom)===null||e===void 0?void 0:e.snapshot)||t.snapshot;if(t.isLead()&&t.layout&&n&&t.hasListeners("didUpdate")){const{layoutBox:i,measuredBox:r}=t.layout,{animationType:s}=t.options,o=n.source!==t.layout.source;s==="size"?Et(d=>{const h=o?n.measuredBox[d]:n.layoutBox[d],f=St(h);h.min=i[d].min,h.max=h.min+f}):KT(s,n.layoutBox,i)&&Et(d=>{const h=o?n.measuredBox[d]:n.layoutBox[d],f=St(i[d]);h.max=h.min+f,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[d].max=t.relativeTarget[d].min+f)});const a=ur();Os(a,i,n.layoutBox);const l=ur();o?Os(l,t.applyTransform(r,!0),n.measuredBox):Os(l,i,n.layoutBox);const c=!BT(a);let u=!1;if(!t.resumeFrom){const d=t.getClosestProjectingParent();if(d&&!d.resumeFrom){const{snapshot:h,layout:f}=d;if(h&&f){const v=Ee();Ls(v,n.layoutBox,h.layoutBox);const g=Ee();Ls(g,i,f.layoutBox),zT(v,g)||(u=!0),d.options.layoutRoot&&(t.relativeTarget=g,t.relativeTargetOrigin=v,t.relativeParent=d)}}}t.notifyListeners("didUpdate",{layout:i,snapshot:n,delta:l,layoutDelta:a,hasLayoutChanged:c,hasRelativeTargetChanged:u})}else if(t.isLead()){const{onExitComplete:i}=t.options;i&&i()}t.options.transition=void 0}function zD(t){gs&&bi.totalNodes++,t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function WD(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function qD(t){t.clearSnapshot()}function Xg(t){t.clearMeasurements()}function KD(t){t.isLayoutDirty=!1}function HD(t){const{visualElement:e}=t.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),t.resetTransform()}function Zg(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function GD(t){t.resolveTargetDelta()}function $D(t){t.calcProjection()}function JD(t){t.resetSkewAndRotation()}function QD(t){t.removeLeadSnapshot()}function ev(t,e,n){t.translate=me(e.translate,0,n),t.scale=me(e.scale,1,n),t.origin=e.origin,t.originPoint=e.originPoint}function tv(t,e,n,i){t.min=me(e.min,n.min,i),t.max=me(e.max,n.max,i)}function YD(t,e,n,i){tv(t.x,e.x,n.x,i),tv(t.y,e.y,n.y,i)}function XD(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const ZD={duration:.45,ease:[.4,0,.1,1]},nv=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),iv=nv("applewebkit/")&&!nv("chrome/")?Math.round:yt;function rv(t){t.min=iv(t.min),t.max=iv(t.max)}function eM(t){rv(t.x),rv(t.y)}function KT(t,e,n){return t==="position"||t==="preserve-aspect"&&!iD(Jg(e),Jg(n),.2)}function tM(t){var e;return t!==t.root&&((e=t.scroll)===null||e===void 0?void 0:e.wasRoot)}const nM=qT({attachResizeListener:(t,e)=>uo(t,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),zc={current:void 0},HT=qT({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!zc.current){const t=new nM({});t.mount(window),t.setOptions({layoutScroll:!0}),zc.current=t}return zc.current},resetTransform:(t,e)=>{t.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),iM={pan:{Feature:kD},drag:{Feature:yD,ProjectionNode:HT,MeasureLayout:UT}};function sv(t,e,n){const{props:i}=t;t.animationState&&i.whileHover&&t.animationState.setActive("whileHover",n==="Start");const r="onHover"+n,s=i[r];s&&de.postRender(()=>s(e,So(e)))}class rM extends gi{mount(){const{current:e}=this.node;e&&(this.unmount=ix(e,n=>(sv(this.node,n,"Start"),i=>sv(this.node,i,"End"))))}unmount(){}}class sM extends gi{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=ko(uo(this.node.current,"focus",()=>this.onFocus()),uo(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function ov(t,e,n){const{props:i}=t;t.animationState&&i.whileTap&&t.animationState.setActive("whileTap",n==="Start");const r="onTap"+(n==="End"?"":n),s=i[r];s&&de.postRender(()=>s(e,So(e)))}class oM extends gi{mount(){const{current:e}=this.node;e&&(this.unmount=ax(e,n=>(ov(this.node,n,"Start"),(i,{success:r})=>ov(this.node,i,r?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const Ed=new WeakMap,Wc=new WeakMap,aM=t=>{const e=Ed.get(t.target);e&&e(t)},lM=t=>{t.forEach(aM)};function cM({root:t,...e}){const n=t||document;Wc.has(n)||Wc.set(n,{});const i=Wc.get(n),r=JSON.stringify(e);return i[r]||(i[r]=new IntersectionObserver(lM,{root:t,...e})),i[r]}function uM(t,e,n){const i=cM(e);return Ed.set(t,n),i.observe(t),()=>{Ed.delete(t),i.unobserve(t)}}const dM={some:0,all:1};class hM extends gi{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:n,margin:i,amount:r="some",once:s}=e,o={root:n?n.current:void 0,rootMargin:i,threshold:typeof r=="number"?r:dM[r]},a=l=>{const{isIntersecting:c}=l;if(this.isInView===c||(this.isInView=c,s&&!c&&this.hasEnteredView))return;c&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",c);const{onViewportEnter:u,onViewportLeave:d}=this.node.getProps(),h=c?u:d;h&&h(l)};return uM(this.node.current,o,a)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:n}=this.node;["amount","margin","root"].some(fM(e,n))&&this.startObserver()}unmount(){}}function fM({viewport:t={}},{viewport:e={}}={}){return n=>t[n]!==e[n]}const pM={inView:{Feature:hM},tap:{Feature:oM},focus:{Feature:sM},hover:{Feature:rM}},mM={layout:{ProjectionNode:HT,MeasureLayout:UT}},Pd={current:null},GT={current:!1};function gM(){if(GT.current=!0,!!Qh)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>Pd.current=t.matches;t.addListener(e),e()}else Pd.current=!1}const vM=[...yT,Ge,ui],yM=t=>vM.find(vT(t)),av=new WeakMap;function kM(t,e,n){for(const i in e){const r=e[i],s=n[i];if(Je(r))t.addValue(i,r);else if(Je(s))t.addValue(i,lo(r,{owner:t}));else if(s!==r)if(t.hasValue(i)){const o=t.getValue(i);o.liveStyle===!0?o.jump(r):o.hasAnimated||o.set(r)}else{const o=t.getStaticValue(i);t.addValue(i,lo(o!==void 0?o:r,{owner:t}))}}for(const i in n)e[i]===void 0&&t.removeValue(i);return e}const lv=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class SM{scrapeMotionValuesFromProps(e,n,i){return{}}constructor({parent:e,props:n,presenceContext:i,reducedMotionConfig:r,blockInitialAnimation:s,visualState:o},a={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=wf,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const f=on.now();this.renderScheduledAt<f&&(this.renderScheduledAt=f,de.render(this.render,!1,!0))};const{latestValues:l,renderState:c,onUpdate:u}=o;this.onUpdate=u,this.latestValues=l,this.baseTarget={...l},this.initialValues=n.initial?{...l}:{},this.renderState=c,this.parent=e,this.props=n,this.presenceContext=i,this.depth=e?e.depth+1:0,this.reducedMotionConfig=r,this.options=a,this.blockInitialAnimation=!!s,this.isControllingVariants=Nl(n),this.isVariantNode=PS(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:d,...h}=this.scrapeMotionValuesFromProps(n,{},this);for(const f in h){const v=h[f];l[f]!==void 0&&Je(v)&&v.set(l[f],!1)}}mount(e){this.current=e,av.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((n,i)=>this.bindToMotionValue(i,n)),GT.current||gM(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:Pd.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){av.delete(this.current),this.projection&&this.projection.unmount(),ci(this.notifyUpdate),ci(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const n=this.features[e];n&&(n.unmount(),n.isMounted=!1)}this.current=null}bindToMotionValue(e,n){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const i=zi.has(e),r=n.on("change",a=>{this.latestValues[e]=a,this.props.onUpdate&&de.preRender(this.notifyUpdate),i&&this.projection&&(this.projection.isTransformDirty=!0)}),s=n.on("renderRequest",this.scheduleRender);let o;window.MotionCheckAppearSync&&(o=window.MotionCheckAppearSync(this,e,n)),this.valueSubscriptions.set(e,()=>{r(),s(),o&&o(),n.owner&&n.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in jr){const n=jr[e];if(!n)continue;const{isEnabled:i,Feature:r}=n;if(!this.features[e]&&r&&i(this.props)&&(this.features[e]=new r(this)),this.features[e]){const s=this.features[e];s.isMounted?s.update():(s.mount(),s.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Ee()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,n){this.latestValues[e]=n}update(e,n){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let i=0;i<lv.length;i++){const r=lv[i];this.propEventSubscriptions[r]&&(this.propEventSubscriptions[r](),delete this.propEventSubscriptions[r]);const s="on"+r,o=e[s];o&&(this.propEventSubscriptions[r]=this.on(r,o))}this.prevMotionValues=kM(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(e),()=>n.variantChildren.delete(e)}addValue(e,n){const i=this.values.get(e);n!==i&&(i&&this.removeValue(e),this.bindToMotionValue(e,n),this.values.set(e,n),this.latestValues[e]=n.get())}removeValue(e){this.values.delete(e);const n=this.valueSubscriptions.get(e);n&&(n(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,n){if(this.props.values&&this.props.values[e])return this.props.values[e];let i=this.values.get(e);return i===void 0&&n!==void 0&&(i=lo(n===null?void 0:n,{owner:this}),this.addValue(e,i)),i}readValue(e,n){var i;let r=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:(i=this.getBaseTargetFromProps(this.props,e))!==null&&i!==void 0?i:this.readValueFromInstance(this.current,e,this.options);return r!=null&&(typeof r=="string"&&(mT(r)||oT(r))?r=parseFloat(r):!yM(r)&&ui.test(n)&&(r=hT(e,n)),this.setBaseTarget(e,Je(r)?r.get():r)),Je(r)?r.get():r}setBaseTarget(e,n){this.baseTarget[e]=n}getBaseTarget(e){var n;const{initial:i}=this.props;let r;if(typeof i=="string"||typeof i=="object"){const o=rf(this.props,i,(n=this.presenceContext)===null||n===void 0?void 0:n.custom);o&&(r=o[e])}if(i&&r!==void 0)return r;const s=this.getBaseTargetFromProps(this.props,e);return s!==void 0&&!Je(s)?s:this.initialValues[e]!==void 0&&r===void 0?void 0:this.baseTarget[e]}on(e,n){return this.events[e]||(this.events[e]=new yf),this.events[e].add(n)}notify(e,...n){this.events[e]&&this.events[e].notify(...n)}}class $T extends SM{constructor(){super(...arguments),this.KeyframeResolver=kT}sortInstanceNodePosition(e,n){return e.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(e,n){return e.style?e.style[n]:void 0}removeValueFromRenderState(e,{vars:n,style:i}){delete n[e],delete i[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Je(e)&&(this.childSubscription=e.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}}function TM(t){return window.getComputedStyle(t)}class CM extends $T{constructor(){super(...arguments),this.type="html",this.renderInstance=LS}readValueFromInstance(e,n){if(zi.has(n)){const i=bf(n);return i&&i.default||0}else{const i=TM(e),r=(MS(n)?i.getPropertyValue(n):i[n])||0;return typeof r=="string"?r.trim():r}}measureInstanceViewportBox(e,{transformPagePoint:n}){return NT(e,n)}build(e,n,i){af(e,n,i.transformTemplate)}scrapeMotionValuesFromProps(e,n,i){return df(e,n,i)}}class bM extends $T{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Ee}getBaseTargetFromProps(e,n){return e[n]}readValueFromInstance(e,n){if(zi.has(n)){const i=bf(n);return i&&i.default||0}return n=NS.has(n)?n:ef(n),e.getAttribute(n)}scrapeMotionValuesFromProps(e,n,i){return jS(e,n,i)}build(e,n,i){lf(e,n,this.isSVGTag,i.transformTemplate)}renderInstance(e,n,i,r){FS(e,n,i,r)}mount(e){this.isSVGTag=uf(e.tagName),super.mount(e)}}const wM=(t,e)=>nf(t)?new bM(e):new CM(e,{allowProjection:t!==V.Fragment}),EM=QR({...$I,...pM,...iM,...mM},wM),_d=dR(EM);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PM=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),JT=(...t)=>t.filter((e,n,i)=>!!e&&i.indexOf(e)===n).join(" ");/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var _M={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RM=V.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:n=2,absoluteStrokeWidth:i,className:r="",children:s,iconNode:o,...a},l)=>V.createElement("svg",{ref:l,..._M,width:e,height:e,stroke:t,strokeWidth:i?Number(n)*24/Number(e):n,className:JT("lucide",r),...a},[...o.map(([c,u])=>V.createElement(c,u)),...Array.isArray(s)?s:[s]]));/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jl=(t,e)=>{const n=V.forwardRef(({className:i,...r},s)=>V.createElement(RM,{ref:s,iconNode:e,className:JT(`lucide-${PM(t)}`,i),...r}));return n.displayName=`${t}`,n};/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xM=jl("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IM=jl("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DM=jl("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MM=jl("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]),AM=({isSpeaking:t})=>M.jsx("div",{className:"flex items-center justify-center gap-1 h-6",children:[...Array(8)].map((e,n)=>M.jsx(_d.div,{className:"w-1 bg-white rounded-full",animate:{height:t?[4,16,6,12,4]:4},transition:{duration:.5,repeat:1/0,delay:n*.05,ease:"easeInOut"}},n))});function OM(){const[t,e]=V.useState(5),[n,i]=V.useState([]),[r,s]=V.useState(!1),o=Q1({onConnect:()=>console.log("Connected to Heba"),onDisconnect:()=>{s(!1)},onMCPToolCall:async f=>{console.log("MCP Tool Call intercepted:",f),s(!0)},onError:f=>{console.error("ElevenLabs Error:",f),s(!1)}}),{status:a,startSession:l,stopSession:c,mcpToolResults:u}=o;zr.useEffect(()=>{u&&u.length>0&&(console.log("New MCP Tool Results captured:",u),i(f=>[...f,...u]),s(!1))},[u]),console.log("Conversation status:",a),console.log("MCP Tool Results:",u);const d=a==="connected",h=V.useCallback(async()=>{if(d)await c();else try{await l({agentId:"agent_7601kcnkqfntev8tb1b3a5ez089g"})}catch(f){console.error("Failed to start session:",f)}},[d,l,c]);return M.jsx("div",{style:{width:"100%",minHeight:"100vh",background:"white",position:"relative",overflowX:"hidden"},children:M.jsxs("div",{style:{width:1366,margin:"0 auto",position:"relative"},children:[M.jsxs("div",{style:{width:1366,height:558,position:"relative",background:"linear-gradient(90deg, rgba(222, 128, 0, 0.96) 3%, rgba(200, 83, 132, 0.96) 36%, rgba(217, 59, 0, 0.96) 100%)",overflow:"hidden"},children:[M.jsx("img",{style:{height:"100%",position:"absolute",right:0,bottom:0,objectFit:"contain",zIndex:0},src:"/images/hero-woman.png",alt:"Hafla Planner"}),M.jsx("div",{style:{left:40,top:40,position:"absolute"},children:M.jsx("span",{style:{fontSize:40,fontFamily:"Basic",fontWeight:"900",color:"white",fontStyle:"italic",letterSpacing:"-2px"},children:"hafla"})}),M.jsxs("div",{style:{width:560,left:40,top:118,position:"absolute",flexDirection:"column",justifyContent:"flex-start",alignItems:"flex-start",gap:12,display:"inline-flex"},children:[M.jsx("div",{style:{alignSelf:"stretch",color:"white",fontSize:56,fontFamily:"Basic",fontWeight:"400",lineHeight:"64px",wordWrap:"break-word"},children:"Experience AI Powered Event Planning"}),M.jsxs("div",{style:{width:560,color:"white",fontSize:16,fontFamily:"Montserrat",fontWeight:"500",lineHeight:"24px",wordWrap:"break-word"},children:["By Expert Planners, with Professional Partners, ",M.jsx("br",{}),"for Everything for Entire Event"]})]}),M.jsxs("button",{onClick:h,style:{width:343,height:56,left:40,top:338,position:"absolute",background:"white",borderRadius:99,border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",paddingLeft:32,paddingRight:8,boxShadow:"0 4px 12px rgba(0,0,0,0.1)"},className:"hover:scale-[1.02] active:scale-95 transition-all",children:[M.jsx("span",{style:{color:"#DE8000",fontSize:20,fontFamily:"Basic",fontWeight:"400",textTransform:"uppercase",letterSpacing:3},children:d?"Talking to Heba":"Talk to Shop"}),M.jsx("div",{style:{width:40,height:40,background:"linear-gradient(90deg, #DE8000 3%, #C85384 53%, #D93B00 100%)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center"},children:d?M.jsx(IM,{size:18,color:"white"}):M.jsx(xM,{size:18,color:"white"})})]}),d&&M.jsxs(_d.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},style:{left:40,top:410,position:"absolute",display:"flex",alignItems:"center",gap:12,background:"rgba(255,255,255,0.15)",padding:"10px 20px",borderRadius:99,backdropFilter:"blur(10px)"},children:[M.jsx(AM,{isSpeaking:!0}),M.jsx("span",{style:{color:"white",fontFamily:"Montserrat",fontSize:13,fontWeight:"600",letterSpacing:"1px"},children:"Heba is listening..."})]}),M.jsxs("div",{style:{right:40,top:43,position:"absolute",display:"flex",alignItems:"center",gap:24},children:[M.jsx(DM,{size:24,color:"white",style:{cursor:"pointer"}}),M.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,color:"white",fontFamily:"Montserrat",fontSize:14,fontWeight:"500",cursor:"pointer"},children:M.jsxs("span",{children:["Hello,",M.jsx("br",{}),"Sign in"]})}),M.jsxs("div",{style:{position:"relative",cursor:"pointer"},children:[M.jsx(MM,{size:24,color:"white"}),M.jsx("div",{style:{position:"absolute",top:-10,right:-15,width:22,height:22,background:"linear-gradient(90deg, #EF8023 0%, #D95799 54%, #EA3D24 100%)",borderRadius:"50%",color:"white",fontSize:11,fontWeight:"700",display:"flex",alignItems:"center",justifyContent:"center"},children:t})]})]}),M.jsxs("div",{style:{left:40,bottom:40,position:"absolute",display:"flex",gap:48},children:[M.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[M.jsx("div",{style:{color:"white",fontSize:16,fontFamily:"Montserrat",fontWeight:"700"},children:"Ideas"}),M.jsx("div",{style:{color:"white",fontSize:12,fontFamily:"Montserrat",fontWeight:"400",opacity:.8},children:"Tailored concepts"})]}),M.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[M.jsx("div",{style:{color:"white",fontSize:16,fontFamily:"Montserrat",fontWeight:"700"},children:"Sourcing"}),M.jsx("div",{style:{color:"white",fontSize:12,fontFamily:"Montserrat",fontWeight:"400",opacity:.8},children:"Easy booking"})]}),M.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[M.jsx("div",{style:{color:"white",fontSize:16,fontFamily:"Montserrat",fontWeight:"700"},children:"Management"}),M.jsx("div",{style:{color:"white",fontSize:12,fontFamily:"Montserrat",fontWeight:"400",opacity:.8},children:"White glove service"})]})]})]}),M.jsxs("div",{style:{width:1366,height:200,position:"relative",overflow:"hidden",padding:"40px 0"},children:[M.jsx("div",{style:{textAlign:"center",color:"#9A9A9A",fontSize:18,fontFamily:"Basic",textTransform:"uppercase",letterSpacing:4.4,marginBottom:40},children:"Trusted by top brands"}),M.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:60,opacity:.4,padding:"0 40px"},children:[M.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/a/a9/Amazon_logo.svg",style:{height:24},alt:"Amazon"}),M.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/2/2f/Google_2015_logo.svg",style:{height:24},alt:"Google"}),M.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/b/b1/Samsung_Logo.svg",style:{height:24},alt:"Samsung"}),M.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/9/96/Microsoft_logo_%282012%29.svg",style:{height:24},alt:"Microsoft"}),M.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/a/a2/Ford_Motor_Company_Logo.svg",style:{height:24},alt:"Ford"}),M.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/0/08/Emaar_Properties_Logo.svg",style:{height:24},alt:"Emaar"})]})]}),(n.length>0||r)&&M.jsxs(_d.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},style:{width:1280,margin:"40px auto",background:"white",borderRadius:32,padding:48,border:"1px solid #f0f0f0",boxShadow:"0 20px 40px rgba(0,0,0,0.05)",position:"relative"},children:[M.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:40},children:[M.jsxs("div",{children:[M.jsx("h2",{style:{fontFamily:"Basic",fontSize:32,color:"#DE8000",textTransform:"uppercase",margin:0},children:"Interactive Storefront"}),M.jsx("p",{style:{color:"#999",fontFamily:"Montserrat",fontSize:14,marginTop:4},children:"Real-time event planning resources from book.hafla.com"})]}),r&&M.jsxs("div",{className:"flex items-center gap-3 px-4 py-2 bg-orange-50 text-orange-600 rounded-full animate-pulse",children:[M.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full"}),M.jsx("span",{className:"text-sm font-bold",children:"STREAMS FROM MCP..."})]}),M.jsx("button",{onClick:()=>i([]),style:{border:"none",background:"#f5f5f5",padding:"8px 16px",borderRadius:99,cursor:"pointer",fontFamily:"Montserrat",fontSize:12,fontWeight:"600"},children:"CLEAR RESULTS"})]}),M.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:32},children:[n.map((f,v)=>f.type!=="resource"||!f.resource?null:(console.log("Rendering Interactive Resource:",v,f.resource.uri),M.jsx("div",{className:"mcp-resource-wrapper bg-gray-50/50 rounded-2xl overflow-hidden border border-gray-100 shadow-sm p-4",children:M.jsxs("div",{style:{color:"#DE8000",fontWeight:"bold"},children:["Resource Detected: ",f.resource.uri]})},v))),n.length===0&&r&&M.jsxs("div",{className:"h-64 flex flex-col items-center justify-center border-2 border-dashed border-gray-100 rounded-2xl",children:[M.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500 mb-4"}),M.jsx("p",{className:"color-gray-400 font-montserrat",children:"Heba is fetching the product details..."})]})]})]}),M.jsxs("div",{style:{padding:"80px 40px"},children:[M.jsx("div",{style:{textAlign:"center",color:"#222222",fontSize:35,fontFamily:"Basic",textTransform:"uppercase",letterSpacing:7.7,marginBottom:60},children:"Explore Services"}),M.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(6, 1fr)",gap:20},children:["Venue","Production","Rentals","Decor","Catering","Artists"].map((f,v)=>M.jsxs("div",{style:{textAlign:"center"},children:[M.jsx("div",{style:{width:"100%",aspectRatio:"172/188",background:"#eee",borderRadius:12,overflow:"hidden",marginBottom:16},children:M.jsx("img",{src:`https://placehold.co/172x188?text=${f}`,style:{width:"100%",height:"100%",objectFit:"cover"}})}),M.jsx("div",{style:{color:"#222222",fontSize:18,fontFamily:"Montserrat",fontWeight:"500"},children:f})]},v))})]}),M.jsxs("div",{style:{background:"#222222",padding:"80px 40px",color:"white"},children:[M.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:60},children:[M.jsxs("div",{style:{maxWidth:300},children:[M.jsx("span",{style:{fontSize:32,fontFamily:"Basic",fontWeight:"900",color:"white",fontStyle:"italic"},children:"hafla"}),M.jsx("p",{style:{color:"#9C9CAF",fontSize:14,marginTop:16,lineHeight:1.6},children:"UAE's largest event planning ecosystem powered by Artificial Intelligence."})]}),M.jsxs("div",{children:[M.jsx("h4",{style:{fontFamily:"Basic",letterSpacing:2,marginBottom:20},children:"EXPLORE"}),M.jsxs("ul",{style:{listStyle:"none",padding:0,display:"flex",flexDirection:"column",gap:12,color:"#CBCBCB",fontSize:14},children:[M.jsx("li",{children:"About Hafla"}),M.jsx("li",{children:"Weddings"}),M.jsx("li",{children:"Corporate"}),M.jsx("li",{children:"Contact Us"})]})]}),M.jsxs("div",{children:[M.jsx("h4",{style:{fontFamily:"Basic",letterSpacing:2,marginBottom:20},children:"ADDRESS"}),M.jsxs("p",{style:{color:"#CBCBCB",fontSize:14,lineHeight:1.6},children:["2nd Floor Nook Office",M.jsx("br",{}),"One JLT, Dubai",M.jsx("br",{}),"United Arab Emirates"]})]})]}),M.jsx("div",{style:{marginTop:60,paddingTop:40,borderTop:"1px solid rgba(255,255,255,0.1)",textAlign:"center",color:"#9C9CAF",fontSize:12},children:" 2025 Hafla. All rights reserved."})]})]})})}qc.createRoot(document.getElementById("root")).render(M.jsx(zr.StrictMode,{children:M.jsx(OM,{})}));
